{"version":3,"sources":["../src/actions/transfer.ts","../src/utils/index.ts","../src/index.ts"],"sourcesContent":["import {\n    ActionExample,\n    HandlerCallback,\n    IAgentRuntime,\n    Memory,\n    ModelClass,\n    State,\n    type Action,\n    composeContext,\n    generateObject,\n} from \"@elizaos/core\";\nimport {\n    getQuaiAccount,\n    isTransferContent,\n    validateSettings,\n} from \"../utils\";\nimport { formatUnits, TransactionRequest } from \"quais\";\n\nconst transferTemplate = `Respond with a JSON markdown block containing only the extracted values. Use null for any values that cannot be determined.\n\nExample response:\n\\`\\`\\`json\n{\n    \"tokenAddress\": \"0x49d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\n    \"recipient\": \"0x0005C06bD1339c79700a8DAb35DE0a1b61dFBD71\",\n    \"amount\": \"0.001\"\n}\n\\`\\`\\`\n\n{{recentMessages}}\n\nGiven the recent messages, extract the following information about the requested token transfer:\n- Token contract address (if available)\n- Recipient wallet address\n- Amount to send\n\nRespond with a JSON markdown block containing only the extracted values.`;\n\nexport default {\n    name: \"SEND_TOKEN\",\n    similes: [\n        \"TRANSFER_TOKEN_ON_QUAI\",\n        \"TRANSFER_TOKENS_ON_QUAI\",\n        \"SEND_TOKENS_ON_QUAI\",\n        \"SEND_QUAI\",\n        \"PAY_ON_QUAI\",\n    ],\n    validate: async (runtime: IAgentRuntime, message: Memory) => {\n        return validateSettings(runtime);\n    },\n    description:\n        \"MUST use this action if the user requests send a token or transfer a token, the request might be varied, but it will always be a token transfer. If the user requests a transfer of lords, use this action.\",\n    handler: async (\n        runtime: IAgentRuntime,\n        message: Memory,\n        state: State,\n        _options: { [key: string]: unknown },\n        callback?: HandlerCallback\n    ): Promise<boolean> => {\n        console.log(\"Starting TRANSFER_TOKEN handler...\");\n\n        // Initialize or update state\n        if (!state) {\n            state = (await runtime.composeState(message)) as State;\n        } else {\n            state = await runtime.updateRecentMessageState(state);\n        }\n\n        // Compose transfer context\n        const transferContext = composeContext({\n            state,\n            template: transferTemplate,\n        });\n\n        // Generate transfer content\n        const content = await generateObject({\n            runtime,\n            context: transferContext,\n            modelClass: ModelClass.MEDIUM,\n        });\n\n        console.log(\"Transfer content:\", content);\n\n        // Validate transfer content\n        if (!isTransferContent(content)) {\n            console.error(\"Invalid content for TRANSFER_TOKEN action.\");\n            if (callback) {\n                callback({\n                    text: \"Not enough information to transfer tokens. Please respond with token address, recipient, and amount.\",\n                    content: { error: \"Invalid transfer content\" },\n                });\n            }\n            return false;\n        }\n\n        try {\n            const account = getQuaiAccount(runtime);\n            const amount =  formatUnits(content.amount, \"wei\");\n\n            var txObj: TransactionRequest = {};\n            if (content.tokenAddress) {\n                // TODO: transfer QRC20s\n            } else {\n                txObj = {\n                    to:  content.recipient,\n                    value: amount,\n                    from: account.address,\n                };\n\n                console.log(\n                    \"Transferring\",\n                    amount,\n                    \"QUAI\",\n                    \"to\",\n                    content.recipient\n                );\n            }\n\n            const tx = await account.sendTransaction(txObj)\n\n            console.log(\n                \"Transfer completed successfully! tx: \" + tx.hash\n            );\n            if (callback) {\n                callback({\n                    text:\n                        \"Transfer completed successfully! tx: \" +\n                        tx.hash,\n                    content: {},\n                });\n            }\n\n            return true;\n        } catch (error) {\n            console.error(\"Error during token transfer:\", error);\n            if (callback) {\n                callback({\n                    text: `Error transferring tokens: ${error.message}`,\n                    content: { error: error.message },\n                });\n            }\n            return false;\n        }\n    },\n\n    examples: [\n        [\n            {\n                user: \"{{user1}}\",\n                content: {\n                    text: \"Send 10 QUAI to 0x049d36570d4e46f48e99674bd3fcc84644ddd6b96f7c741b1562b82f9e004dc7\",\n                },\n            },\n            {\n                user: \"{{agent}}\",\n                content: {\n                    text: \"I'll transfer 10 QUAI to that address right away. Let me process that for you.\",\n                },\n            },\n        ],\n        [\n            {\n                user: \"{{user1}}\",\n                content: {\n                    text: \"Please send 0.5 QUAI to 0x03fe2b97c1fd336e750087d68b9b867997fd64a2661ff3ca5a7c771641e8e7ac\",\n                },\n            },\n            {\n                user: \"{{agent}}\",\n                content: {\n                    text: \"Got it, initiating transfer of 0.5 QUAI to the provided address. I'll confirm once it's complete.\",\n                },\n            },\n        ],\n    ] as ActionExample[][],\n} as Action;\n","import { Content, IAgentRuntime } from \"@elizaos/core\";\nimport { JsonRpcProvider, Wallet } from \"quais\";\n\nexport const validateSettings = (runtime: IAgentRuntime) => {\n    const requiredSettings = [\n        \"QUAI_PRIVATE_KEY\",\n        \"QUAI_RPC_URL\",\n    ];\n\n    for (const setting of requiredSettings) {\n        if (!runtime.getSetting(setting)) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\nexport const getQuaiProvider = (runtime: IAgentRuntime) => {\n    return new JsonRpcProvider(\n        runtime.getSetting(\"QUAI_RPC_URL\"),\n    );\n};\n\nexport const getQuaiAccount = (runtime: IAgentRuntime) => {\n    const provider = getQuaiProvider(runtime);\n    const account = new Wallet(runtime.getSetting(\"QUAI_PRIVATE_KEY\"), provider);\n    return account;\n};\n\nexport interface TransferContent extends Content {\n    tokenAddress: string;\n    recipient: string;\n    amount: string | number;\n}\n\nexport function isTransferContent(\n    content: any\n): content is TransferContent {\n    // Validate types\n    const validTypes =\n        (content.tokenAddress === null || typeof content.tokenAddress === \"string\") &&\n        typeof content.recipient === \"string\" &&\n        (typeof content.amount === \"string\" ||\n            typeof content.amount === \"number\");\n    if (!validTypes) {\n        return false;\n    }\n\n    // Validate addresses (20-bytes with 0x prefix)\n    const validRecipient =\n        content.recipient.startsWith(\"0x\") &&\n        content.recipient.length === 42;\n\n    // If tokenAddress is provided, validate it\n    const validTokenAddress = content.tokenAddress === null ||\n        (content.tokenAddress.startsWith(\"0x\") &&\n        content.tokenAddress.length === 42);\n\n    return validRecipient && validTokenAddress;\n}\n","import { Plugin } from \"@elizaos/core\";\nimport transfer from \"./actions/transfer\";\n\nexport const quaiPlugin: Plugin = {\n    name: \"quai\",\n    description: \"Quai Plugin for Eliza\",\n    actions: [transfer],\n    evaluators: [],\n    providers: [],\n};\n\nexport default quaiPlugin;\n"],"mappings":";AAAA;AAAA,EAKI;AAAA,EAGA;AAAA,EACA;AAAA,OACG;;;ACTP,SAAS,iBAAiB,cAAc;AAEjC,IAAM,mBAAmB,CAAC,YAA2B;AACxD,QAAM,mBAAmB;AAAA,IACrB;AAAA,IACA;AAAA,EACJ;AAEA,aAAW,WAAW,kBAAkB;AACpC,QAAI,CAAC,QAAQ,WAAW,OAAO,GAAG;AAC9B,aAAO;AAAA,IACX;AAAA,EACJ;AAEA,SAAO;AACX;AAEO,IAAM,kBAAkB,CAAC,YAA2B;AACvD,SAAO,IAAI;AAAA,IACP,QAAQ,WAAW,cAAc;AAAA,EACrC;AACJ;AAEO,IAAM,iBAAiB,CAAC,YAA2B;AACtD,QAAM,WAAW,gBAAgB,OAAO;AACxC,QAAM,UAAU,IAAI,OAAO,QAAQ,WAAW,kBAAkB,GAAG,QAAQ;AAC3E,SAAO;AACX;AAQO,SAAS,kBACZ,SAC0B;AAE1B,QAAM,cACD,QAAQ,iBAAiB,QAAQ,OAAO,QAAQ,iBAAiB,aAClE,OAAO,QAAQ,cAAc,aAC5B,OAAO,QAAQ,WAAW,YACvB,OAAO,QAAQ,WAAW;AAClC,MAAI,CAAC,YAAY;AACb,WAAO;AAAA,EACX;AAGA,QAAM,iBACF,QAAQ,UAAU,WAAW,IAAI,KACjC,QAAQ,UAAU,WAAW;AAGjC,QAAM,oBAAoB,QAAQ,iBAAiB,QAC9C,QAAQ,aAAa,WAAW,IAAI,KACrC,QAAQ,aAAa,WAAW;AAEpC,SAAO,kBAAkB;AAC7B;;;AD5CA,SAAS,mBAAuC;AAEhD,IAAM,mBAAmB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAoBzB,IAAO,mBAAQ;AAAA,EACX,MAAM;AAAA,EACN,SAAS;AAAA,IACL;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,IACA;AAAA,EACJ;AAAA,EACA,UAAU,OAAO,SAAwB,YAAoB;AACzD,WAAO,iBAAiB,OAAO;AAAA,EACnC;AAAA,EACA,aACI;AAAA,EACJ,SAAS,OACL,SACA,SACA,OACA,UACA,aACmB;AACnB,YAAQ,IAAI,oCAAoC;AAGhD,QAAI,CAAC,OAAO;AACR,cAAS,MAAM,QAAQ,aAAa,OAAO;AAAA,IAC/C,OAAO;AACH,cAAQ,MAAM,QAAQ,yBAAyB,KAAK;AAAA,IACxD;AAGA,UAAM,kBAAkB,eAAe;AAAA,MACnC;AAAA,MACA,UAAU;AAAA,IACd,CAAC;AAGD,UAAM,UAAU,MAAM,eAAe;AAAA,MACjC;AAAA,MACA,SAAS;AAAA,MACT,YAAY,WAAW;AAAA,IAC3B,CAAC;AAED,YAAQ,IAAI,qBAAqB,OAAO;AAGxC,QAAI,CAAC,kBAAkB,OAAO,GAAG;AAC7B,cAAQ,MAAM,4CAA4C;AAC1D,UAAI,UAAU;AACV,iBAAS;AAAA,UACL,MAAM;AAAA,UACN,SAAS,EAAE,OAAO,2BAA2B;AAAA,QACjD,CAAC;AAAA,MACL;AACA,aAAO;AAAA,IACX;AAEA,QAAI;AACA,YAAM,UAAU,eAAe,OAAO;AACtC,YAAM,SAAU,YAAY,QAAQ,QAAQ,KAAK;AAEjD,UAAI,QAA4B,CAAC;AACjC,UAAI,QAAQ,cAAc;AAAA,MAE1B,OAAO;AACH,gBAAQ;AAAA,UACJ,IAAK,QAAQ;AAAA,UACb,OAAO;AAAA,UACP,MAAM,QAAQ;AAAA,QAClB;AAEA,gBAAQ;AAAA,UACJ;AAAA,UACA;AAAA,UACA;AAAA,UACA;AAAA,UACA,QAAQ;AAAA,QACZ;AAAA,MACJ;AAEA,YAAM,KAAK,MAAM,QAAQ,gBAAgB,KAAK;AAE9C,cAAQ;AAAA,QACJ,0CAA0C,GAAG;AAAA,MACjD;AACA,UAAI,UAAU;AACV,iBAAS;AAAA,UACL,MACI,0CACA,GAAG;AAAA,UACP,SAAS,CAAC;AAAA,QACd,CAAC;AAAA,MACL;AAEA,aAAO;AAAA,IACX,SAAS,OAAO;AACZ,cAAQ,MAAM,gCAAgC,KAAK;AACnD,UAAI,UAAU;AACV,iBAAS;AAAA,UACL,MAAM,8BAA8B,MAAM,OAAO;AAAA,UACjD,SAAS,EAAE,OAAO,MAAM,QAAQ;AAAA,QACpC,CAAC;AAAA,MACL;AACA,aAAO;AAAA,IACX;AAAA,EACJ;AAAA,EAEA,UAAU;AAAA,IACN;AAAA,MACI;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,UACL,MAAM;AAAA,QACV;AAAA,MACJ;AAAA,MACA;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,UACL,MAAM;AAAA,QACV;AAAA,MACJ;AAAA,IACJ;AAAA,IACA;AAAA,MACI;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,UACL,MAAM;AAAA,QACV;AAAA,MACJ;AAAA,MACA;AAAA,QACI,MAAM;AAAA,QACN,SAAS;AAAA,UACL,MAAM;AAAA,QACV;AAAA,MACJ;AAAA,IACJ;AAAA,EACJ;AACJ;;;AE5KO,IAAM,aAAqB;AAAA,EAC9B,MAAM;AAAA,EACN,aAAa;AAAA,EACb,SAAS,CAAC,gBAAQ;AAAA,EAClB,YAAY,CAAC;AAAA,EACb,WAAW,CAAC;AAChB;AAEA,IAAO,gBAAQ;","names":[]}