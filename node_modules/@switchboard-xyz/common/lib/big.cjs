"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.median = median;
exports.weightedAverage = weightedAverage;
exports.weightedMedian = weightedMedian;
exports.min = min;
exports.max = max;
exports.variance = variance;
exports.safeDiv = safeDiv;
exports.safeMul = safeMul;
exports.safeNthRoot = safeNthRoot;
exports.safeSqrt = safeSqrt;
exports.safePow = safePow;
exports.fromBN = fromBN;
exports.fromBigint = fromBigint;
exports.toDecimal = toDecimal;
exports.fromDecimal = fromDecimal;
const big_js_1 = require("big.js");
const bn_js_1 = __importDefault(require("bn.js"));
const decimal_js_1 = require("decimal.js");
function comparator(a, b) {
    if (a.gt(b))
        return 1;
    if (a.lt(b))
        return -1;
    return 0;
}
function median(results) {
    if (!results?.length)
        throw new Error("Cannot take median of empty array.");
    const arrSort = results.slice().sort(comparator);
    const mid = Math.ceil(arrSort.length / 2);
    if (arrSort.length % 2 === 0) {
        const addition = arrSort[mid].add(arrSort[mid - 1]);
        return safeDiv(addition, new big_js_1.Big(2.0));
    }
    return arrSort[mid - 1];
}
function weightedAverage(v1, w1, v2, w2) {
    return safeDiv(safeMul(v1, w1).add(safeMul(v2, w2)), w1.add(w2));
}
function weightedMedian(results) {
    if (!results?.length)
        throw new Error("Cannot take median of empty array.");
    for (let i = 0; i < results.length; ++i) {
        if (results[i].weight === 0) {
            results[i].weight = 1;
        }
    }
    const arrSort = results.slice().sort((a, b) => comparator(a.value, b.value));
    const halfWeight = arrSort.reduce((sum, { weight }) => weight + sum, 0) / 2;
    let i = 0;
    let w = 0;
    // get the index (i) and total weight (w) of item just above half
    for (; w < halfWeight; ++i) {
        w = w + arrSort[i].weight;
    }
    // if it actually is exactly the half, we need to take the average
    if (w === halfWeight) {
        return weightedAverage(arrSort[i - 1].value, new big_js_1.Big(arrSort[i - 1].weight), arrSort[i].value, new big_js_1.Big(arrSort[i].weight));
    }
    // otherwise we return the value
    return arrSort[i - 1].value;
}
function min(results) {
    if (results.length === 0) {
        throw new Error("Cannot reduce empty array.");
    }
    return results.reduce((val, current) => (val.lt(current) ? val : current), results[0]);
}
function max(results) {
    if (results.length === 0) {
        throw new Error("Cannot reduce empty array.");
    }
    return results.reduce((val, current) => (val.gt(current) ? val : current), results[0]);
}
// This export function returns the ratio between the max value and the min value.
// If we pull data that may be negative, this information is not entirely relevant.
function variance(results) {
    if (results?.length === 0) {
        throw new Error("Cannot take variance of empty array");
    }
    const arrSort = results
        .slice()
        .sort((n1, n2) => n1.minus(n2).toNumber());
    const min = arrSort[0];
    const max = arrSort[arrSort.length - 1];
    return max.minus(min);
}
////// BIG.JS UTILS
function safeDiv(number_, denominator, decimals = 20) {
    const oldDp = big_js_1.Big.DP;
    big_js_1.Big.DP = decimals;
    const result = number_.div(denominator);
    big_js_1.Big.DP = oldDp;
    return result;
}
function safeMul(...n) {
    if (n.length === 0) {
        throw new Error(`need to provide elements to multiply ${n}`);
    }
    let result = new big_js_1.Big(1);
    for (const x of n) {
        result = result.mul(x);
    }
    return result;
}
function safeNthRoot(big, nthRoot, decimals = 20) {
    if (nthRoot <= 0) {
        throw new Error(`cannot take the nth root of a negative number`);
    }
    const oldDp = big_js_1.Big.DP;
    big_js_1.Big.DP = decimals;
    const oldPrecision = decimal_js_1.Decimal.precision;
    decimal_js_1.Decimal.set({ precision: decimals });
    const decimal = toDecimal(big);
    const frac = new decimal_js_1.Decimal(1).div(nthRoot);
    const root = big.s === -1
        ? decimal.abs().pow(frac).mul(new decimal_js_1.Decimal(big.s))
        : decimal.pow(frac);
    const result = fromDecimal(root);
    decimal_js_1.Decimal.set({ precision: oldPrecision });
    big_js_1.Big.DP = oldDp;
    return result;
}
function safeSqrt(n, decimals = 20) {
    const oldDp = big_js_1.Big.DP;
    big_js_1.Big.DP = decimals;
    const result = n.sqrt();
    big_js_1.Big.DP = oldDp;
    return result;
}
function safePow(n, exp, decimals = 20) {
    const oldDp = big_js_1.Big.DP;
    big_js_1.Big.DP = decimals;
    const oldPrecision = decimal_js_1.Decimal.precision;
    decimal_js_1.Decimal.set({ precision: decimals });
    const base = toDecimal(n);
    const value = base.pow(exp);
    const result = fromDecimal(value);
    decimal_js_1.Decimal.set({ precision: oldPrecision });
    big_js_1.Big.DP = oldDp;
    return result;
}
/**
 * Convert a BN.js to a Big.js
 * @param n - the BN.js object to convert
 * @param decimals - the number of decimal places to scale the BN.js
 *
 * @returns Big.js
 */
function fromBN(n, decimals = 0) {
    let mantissa = new bn_js_1.default(n, 10);
    let s = 1;
    const c = [];
    const ZERO = new bn_js_1.default(0, 10);
    const TEN = new bn_js_1.default(10, 10);
    if (mantissa.lt(ZERO)) {
        s = -1;
        mantissa = mantissa.abs();
    }
    while (mantissa.gt(ZERO)) {
        c.unshift(mantissa.mod(TEN).toNumber());
        mantissa = mantissa.div(TEN);
    }
    const e = c.length - decimals - 1;
    const result = new big_js_1.Big(0);
    if (c.length === 0) {
        return result;
    }
    result.s = s;
    result.c = c;
    result.e = e;
    return result;
}
/**
 * Convert a BigInt to a Big.js
 * @param n - the BigInt to convert
 *
 * @returns Big.js
 */
function fromBigint(n) {
    const big = new big_js_1.Big(n.toString(10));
    return big;
}
/**
 * Convert a Big.js to a Decimal.js
 * @param big - the Big.js object to convert
 * @param decimals - the number of decimal places
 *
 * @returns Decimal.js
 */
function toDecimal(big, decimals = 20) {
    const oldPrecision = decimal_js_1.Decimal.precision;
    decimal_js_1.Decimal.set({ precision: decimals });
    const decimal = new decimal_js_1.Decimal(big.toFixed(decimals, 0));
    decimal_js_1.Decimal.set({ precision: oldPrecision });
    return decimal;
}
/**
 * Convert a Decimal.js to a Big.js
 * @param decimal - the Decimal.js object to convert
 * @param decimals - the number of decimal places
 *
 * @returns Big.js
 */
function fromDecimal(decimal, decimals = 20) {
    if (decimal.isNaN()) {
        throw new TypeError(`cannot convert NaN decimal.js to Big.js`);
    }
    if (!decimal.isFinite()) {
        throw new TypeError(`cannot convert INF decimal.js to Big.js`);
    }
    const big = new big_js_1.Big(decimal.toFixed(decimals, 0));
    return big;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7OztBQWdCQSx3QkFVQztBQUVELDBDQUVDO0FBRUQsd0NBOEJDO0FBRUQsa0JBUUM7QUFFRCxrQkFRQztBQUlELDRCQVVDO0FBSUQsMEJBTUM7QUFFRCwwQkFXQztBQUVELGtDQXVCQztBQUVELDRCQU1DO0FBRUQsMEJBY0M7QUFTRCx3QkF1QkM7QUFRRCxnQ0FHQztBQVNELDhCQVFDO0FBU0Qsa0NBV0M7QUF4UEQsbUNBQTZCO0FBQzdCLGtEQUF1QjtBQUN2QiwyQ0FBcUM7QUFRckMsU0FBUyxVQUFVLENBQUMsQ0FBTSxFQUFFLENBQU07SUFDaEMsSUFBSSxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUFFLE9BQU8sQ0FBQyxDQUFDO0lBQ3RCLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQyxDQUFDO0lBQ3ZCLE9BQU8sQ0FBQyxDQUFDO0FBQ1gsQ0FBQztBQUVELFNBQWdCLE1BQU0sQ0FBQyxPQUFtQjtJQUN4QyxJQUFJLENBQUMsT0FBTyxFQUFFLE1BQU07UUFBRSxNQUFNLElBQUksS0FBSyxDQUFDLG9DQUFvQyxDQUFDLENBQUM7SUFFNUUsTUFBTSxPQUFPLEdBQUcsT0FBTyxDQUFDLEtBQUssRUFBRSxDQUFDLElBQUksQ0FBQyxVQUFVLENBQUMsQ0FBQztJQUNqRCxNQUFNLEdBQUcsR0FBRyxJQUFJLENBQUMsSUFBSSxDQUFDLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDMUMsSUFBSSxPQUFPLENBQUMsTUFBTSxHQUFHLENBQUMsS0FBSyxDQUFDLEVBQUUsQ0FBQztRQUM3QixNQUFNLFFBQVEsR0FBRyxPQUFPLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxDQUFDLE9BQU8sQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FB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RSxRQUFRLEdBQUcsRUFBRTtJQUN6RCxJQUFJLE9BQU8sQ0FBQyxLQUFLLEVBQUUsRUFBRSxDQUFDO1FBQ3BCLE1BQU0sSUFBSSxTQUFTLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsSUFBSSxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsRUFBRSxDQUFDO1FBQ3hCLE1BQU0sSUFBSSxTQUFTLENBQUMseUNBQXlDLENBQUMsQ0FBQztJQUNqRSxDQUFDO0lBRUQsTUFBTSxHQUFHLEdBQUcsSUFBSSxZQUFHLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNsRCxPQUFPLEdBQUcsQ0FBQztBQUNiLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBCaWcgfSBmcm9tIFwiYmlnLmpzXCI7XG5pbXBvcnQgQk4gZnJvbSBcImJuLmpzXCI7XG5pbXBvcnQgeyBEZWNpbWFsIH0gZnJvbSBcImRlY2ltYWwuanNcIjtcblxuZXhwb3J0IGludGVyZmFjZSBXZWlnaHRlZFZhbHVlIHtcbiAgaWR4OiBudW1iZXI7XG4gIHZhbHVlOiBCaWc7XG4gIHdlaWdodDogbnVtYmVyO1xufVxuXG5mdW5jdGlvbiBjb21wYXJhdG9yKGE6IEJpZywgYjogQmlnKTogbnVtYmVyIHtcbiAgaWYgKGEuZ3QoYikpIHJldHVybiAxO1xuICBpZiAoYS5sdChiKSkgcmV0dXJuIC0xO1xuICByZXR1cm4gMDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1lZGlhbihyZXN1bHRzOiBBcnJheTxCaWc+KTogQmlnIHtcbiAgaWYgKCFyZXN1bHRzPy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCB0YWtlIG1lZGlhbiBvZiBlbXB0eSBhcnJheS5cIik7XG5cbiAgY29uc3QgYXJyU29ydCA9IHJlc3VsdHMuc2xpY2UoKS5zb3J0KGNvbXBhcmF0b3IpO1xuICBjb25zdCBtaWQgPSBNYXRoLmNlaWwoYXJyU29ydC5sZW5ndGggLyAyKTtcbiAgaWYgKGFyclNvcnQubGVuZ3RoICUgMiA9PT0gMCkge1xuICAgIGNvbnN0IGFkZGl0aW9uID0gYXJyU29ydFttaWRdLmFkZChhcnJTb3J0W21pZCAtIDFdKTtcbiAgICByZXR1cm4gc2FmZURpdihhZGRpdGlvbiwgbmV3IEJpZygyLjApKTtcbiAgfVxuICByZXR1cm4gYXJyU29ydFttaWQgLSAxXTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdlaWdodGVkQXZlcmFnZSh2MTogQmlnLCB3MTogQmlnLCB2MjogQmlnLCB3MjogQmlnKTogQmlnIHtcbiAgcmV0dXJuIHNhZmVEaXYoc2FmZU11bCh2MSwgdzEpLmFkZChzYWZlTXVsKHYyLCB3MikpLCB3MS5hZGQodzIpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHdlaWdodGVkTWVkaWFuKHJlc3VsdHM6IEFycmF5PFdlaWdodGVkVmFsdWU+KTogQmlnIHtcbiAgaWYgKCFyZXN1bHRzPy5sZW5ndGgpIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCB0YWtlIG1lZGlhbiBvZiBlbXB0eSBhcnJheS5cIik7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgcmVzdWx0cy5sZW5ndGg7ICsraSkge1xuICAgIGlmIChyZXN1bHRzW2ldLndlaWdodCA9PT0gMCkge1xuICAgICAgcmVzdWx0c1tpXS53ZWlnaHQgPSAxO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IGFyclNvcnQgPSByZXN1bHRzLnNsaWNlKCkuc29ydCgoYSwgYikgPT4gY29tcGFyYXRvcihhLnZhbHVlLCBiLnZhbHVlKSk7XG4gIGNvbnN0IGhhbGZXZWlnaHQgPSBhcnJTb3J0LnJlZHVjZSgoc3VtLCB7IHdlaWdodCB9KSA9PiB3ZWlnaHQgKyBzdW0sIDApIC8gMjtcbiAgbGV0IGkgPSAwO1xuICBsZXQgdyA9IDA7XG5cbiAgLy8gZ2V0IHRoZSBpbmRleCAoaSkgYW5kIHRvdGFsIHdlaWdodCAodykgb2YgaXRlbSBqdXN0IGFib3ZlIGhhbGZcbiAgZm9yICg7IHcgPCBoYWxmV2VpZ2h0OyArK2kpIHtcbiAgICB3ID0gdyArIGFyclNvcnRbaV0ud2VpZ2h0O1xuICB9XG5cbiAgLy8gaWYgaXQgYWN0dWFsbHkgaXMgZXhhY3RseSB0aGUgaGFsZiwgd2UgbmVlZCB0byB0YWtlIHRoZSBhdmVyYWdlXG4gIGlmICh3ID09PSBoYWxmV2VpZ2h0KSB7XG4gICAgcmV0dXJuIHdlaWdodGVkQXZlcmFnZShcbiAgICAgIGFyclNvcnRbaSAtIDFdLnZhbHVlLFxuICAgICAgbmV3IEJpZyhhcnJTb3J0W2kgLSAxXS53ZWlnaHQpLFxuICAgICAgYXJyU29ydFtpXS52YWx1ZSxcbiAgICAgIG5ldyBCaWcoYXJyU29ydFtpXS53ZWlnaHQpXG4gICAgKTtcbiAgfVxuXG4gIC8vIG90aGVyd2lzZSB3ZSByZXR1cm4gdGhlIHZhbHVlXG4gIHJldHVybiBhcnJTb3J0W2kgLSAxXS52YWx1ZTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIG1pbihyZXN1bHRzOiBBcnJheTxCaWc+KTogQmlnIHtcbiAgaWYgKHJlc3VsdHMubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHJlZHVjZSBlbXB0eSBhcnJheS5cIik7XG4gIH1cbiAgcmV0dXJuIHJlc3VsdHMucmVkdWNlKFxuICAgICh2YWwsIGN1cnJlbnQpID0+ICh2YWwubHQoY3VycmVudCkgPyB2YWwgOiBjdXJyZW50KSxcbiAgICByZXN1bHRzWzBdXG4gICk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtYXgocmVzdWx0czogQXJyYXk8QmlnPik6IEJpZyB7XG4gIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZWR1Y2UgZW1wdHkgYXJyYXkuXCIpO1xuICB9XG4gIHJldHVybiByZXN1bHRzLnJlZHVjZShcbiAgICAodmFsLCBjdXJyZW50KSA9PiAodmFsLmd0KGN1cnJlbnQpID8gdmFsIDogY3VycmVudCksXG4gICAgcmVzdWx0c1swXVxuICApO1xufVxuXG4vLyBUaGlzIGV4cG9ydCBmdW5jdGlvbiByZXR1cm5zIHRoZSByYXRpbyBiZXR3ZWVuIHRoZSBtYXggdmFsdWUgYW5kIHRoZSBtaW4gdmFsdWUuXG4vLyBJZiB3ZSBwdWxsIGRhdGEgdGhhdCBtYXkgYmUgbmVnYXRpdmUsIHRoaXMgaW5mb3JtYXRpb24gaXMgbm90IGVudGlyZWx5IHJlbGV2YW50LlxuZXhwb3J0IGZ1bmN0aW9uIHZhcmlhbmNlKHJlc3VsdHM6IEFycmF5PEJpZz4pOiBCaWcge1xuICBpZiAocmVzdWx0cz8ubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiQ2Fubm90IHRha2UgdmFyaWFuY2Ugb2YgZW1wdHkgYXJyYXlcIik7XG4gIH1cbiAgY29uc3QgYXJyU29ydCA9IHJlc3VsdHNcbiAgICAuc2xpY2UoKVxuICAgIC5zb3J0KChuMTogQmlnLCBuMjogQmlnKSA9PiBuMS5taW51cyhuMikudG9OdW1iZXIoKSk7XG4gIGNvbnN0IG1pbiA9IGFyclNvcnRbMF07XG4gIGNvbnN0IG1heCA9IGFyclNvcnRbYXJyU29ydC5sZW5ndGggLSAxXTtcbiAgcmV0dXJuIG1heC5taW51cyhtaW4pO1xufVxuXG4vLy8vLy8gQklHLkpTIFVUSUxTXG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlRGl2KG51bWJlcl86IEJpZywgZGVub21pbmF0b3I6IEJpZywgZGVjaW1hbHMgPSAyMCk6IEJpZyB7XG4gIGNvbnN0IG9sZERwID0gQmlnLkRQO1xuICBCaWcuRFAgPSBkZWNpbWFscztcbiAgY29uc3QgcmVzdWx0ID0gbnVtYmVyXy5kaXYoZGVub21pbmF0b3IpO1xuICBCaWcuRFAgPSBvbGREcDtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVNdWwoLi4ubjogQmlnW10pOiBCaWcge1xuICBpZiAobi5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoYG5lZWQgdG8gcHJvdmlkZSBlbGVtZW50cyB0byBtdWx0aXBseSAke259YCk7XG4gIH1cblxuICBsZXQgcmVzdWx0ID0gbmV3IEJpZygxKTtcbiAgZm9yIChjb25zdCB4IG9mIG4pIHtcbiAgICByZXN1bHQgPSByZXN1bHQubXVsKHgpO1xuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVOdGhSb290KGJpZzogQmlnLCBudGhSb290OiBudW1iZXIsIGRlY2ltYWxzID0gMjApOiBCaWcge1xuICBpZiAobnRoUm9vdCA8PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBjYW5ub3QgdGFrZSB0aGUgbnRoIHJvb3Qgb2YgYSBuZWdhdGl2ZSBudW1iZXJgKTtcbiAgfVxuXG4gIGNvbnN0IG9sZERwID0gQmlnLkRQO1xuICBCaWcuRFAgPSBkZWNpbWFscztcbiAgY29uc3Qgb2xkUHJlY2lzaW9uID0gRGVjaW1hbC5wcmVjaXNpb247XG4gIERlY2ltYWwuc2V0KHsgcHJlY2lzaW9uOiBkZWNpbWFscyB9KTtcblxuICBjb25zdCBkZWNpbWFsID0gdG9EZWNpbWFsKGJpZyk7XG4gIGNvbnN0IGZyYWMgPSBuZXcgRGVjaW1hbCgxKS5kaXYobnRoUm9vdCk7XG4gIGNvbnN0IHJvb3Q6IERlY2ltYWwgPVxuICAgIGJpZy5zID09PSAtMVxuICAgICAgPyBkZWNpbWFsLmFicygpLnBvdyhmcmFjKS5tdWwobmV3IERlY2ltYWwoYmlnLnMpKVxuICAgICAgOiBkZWNpbWFsLnBvdyhmcmFjKTtcblxuICBjb25zdCByZXN1bHQ6IEJpZyA9IGZyb21EZWNpbWFsKHJvb3QpO1xuXG4gIERlY2ltYWwuc2V0KHsgcHJlY2lzaW9uOiBvbGRQcmVjaXNpb24gfSk7XG4gIEJpZy5EUCA9IG9sZERwO1xuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlU3FydChuOiBCaWcsIGRlY2ltYWxzID0gMjApOiBCaWcge1xuICBjb25zdCBvbGREcCA9IEJpZy5EUDtcbiAgQmlnLkRQID0gZGVjaW1hbHM7XG4gIGNvbnN0IHJlc3VsdCA9IG4uc3FydCgpO1xuICBCaWcuRFAgPSBvbGREcDtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHNhZmVQb3cobjogQmlnLCBleHA6IG51bWJlciwgZGVjaW1hbHMgPSAyMCk6IEJpZyB7XG4gIGNvbnN0IG9sZERwID0gQmlnLkRQO1xuICBCaWcuRFAgPSBkZWNpbWFscztcblxuICBjb25zdCBvbGRQcmVjaXNpb24gPSBEZWNpbWFsLnByZWNpc2lvbjtcbiAgRGVjaW1hbC5zZXQoeyBwcmVjaXNpb246IGRlY2ltYWxzIH0pO1xuICBjb25zdCBiYXNlID0gdG9EZWNpbWFsKG4pO1xuICBjb25zdCB2YWx1ZSA9IGJhc2UucG93KGV4cCk7XG4gIGNvbnN0IHJlc3VsdCA9IGZyb21EZWNpbWFsKHZhbHVlKTtcblxuICBEZWNpbWFsLnNldCh7IHByZWNpc2lvbjogb2xkUHJlY2lzaW9uIH0pO1xuICBCaWcuRFAgPSBvbGREcDtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG4vKipcbiAqIENvbnZlcnQgYSBCTi5qcyB0byBhIEJpZy5qc1xuICogQHBhcmFtIG4gLSB0aGUgQk4uanMgb2JqZWN0IHRvIGNvbnZlcnRcbiAqIEBwYXJhbSBkZWNpbWFscyAtIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXMgdG8gc2NhbGUgdGhlIEJOLmpzXG4gKlxuICogQHJldHVybnMgQmlnLmpzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiBmcm9tQk4objogQk4sIGRlY2ltYWxzID0gMCk6IEJpZyB7XG4gIGxldCBtYW50aXNzYTogQk4gPSBuZXcgQk4obiwgMTApO1xuICBsZXQgcyA9IDE7XG4gIGNvbnN0IGM6IEFycmF5PG51bWJlcj4gPSBbXTtcbiAgY29uc3QgWkVSTyA9IG5ldyBCTigwLCAxMCk7XG4gIGNvbnN0IFRFTiA9IG5ldyBCTigxMCwgMTApO1xuICBpZiAobWFudGlzc2EubHQoWkVSTykpIHtcbiAgICBzID0gLTE7XG4gICAgbWFudGlzc2EgPSBtYW50aXNzYS5hYnMoKTtcbiAgfVxuICB3aGlsZSAobWFudGlzc2EuZ3QoWkVSTykpIHtcbiAgICBjLnVuc2hpZnQobWFudGlzc2EubW9kKFRFTikudG9OdW1iZXIoKSk7XG4gICAgbWFudGlzc2EgPSBtYW50aXNzYS5kaXYoVEVOKTtcbiAgfVxuICBjb25zdCBlID0gYy5sZW5ndGggLSBkZWNpbWFscyAtIDE7XG4gIGNvbnN0IHJlc3VsdCA9IG5ldyBCaWcoMCk7XG4gIGlmIChjLmxlbmd0aCA9PT0gMCkge1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cbiAgcmVzdWx0LnMgPSBzO1xuICByZXN1bHQuYyA9IGM7XG4gIHJlc3VsdC5lID0gZTtcbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGEgQmlnSW50IHRvIGEgQmlnLmpzXG4gKiBAcGFyYW0gbiAtIHRoZSBCaWdJbnQgdG8gY29udmVydFxuICpcbiAqIEByZXR1cm5zIEJpZy5qc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUJpZ2ludChuOiBiaWdpbnQpOiBCaWcge1xuICBjb25zdCBiaWcgPSBuZXcgQmlnKG4udG9TdHJpbmcoMTApKTtcbiAgcmV0dXJuIGJpZztcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGEgQmlnLmpzIHRvIGEgRGVjaW1hbC5qc1xuICogQHBhcmFtIGJpZyAtIHRoZSBCaWcuanMgb2JqZWN0IHRvIGNvbnZlcnRcbiAqIEBwYXJhbSBkZWNpbWFscyAtIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXNcbiAqXG4gKiBAcmV0dXJucyBEZWNpbWFsLmpzXG4gKi9cbmV4cG9ydCBmdW5jdGlvbiB0b0RlY2ltYWwoYmlnOiBCaWcsIGRlY2ltYWxzID0gMjApOiBEZWNpbWFsIHtcbiAgY29uc3Qgb2xkUHJlY2lzaW9uID0gRGVjaW1hbC5wcmVjaXNpb247XG5cbiAgRGVjaW1hbC5zZXQoeyBwcmVjaXNpb246IGRlY2ltYWxzIH0pO1xuICBjb25zdCBkZWNpbWFsID0gbmV3IERlY2ltYWwoYmlnLnRvRml4ZWQoZGVjaW1hbHMsIDApKTtcbiAgRGVjaW1hbC5zZXQoeyBwcmVjaXNpb246IG9sZFByZWNpc2lvbiB9KTtcblxuICByZXR1cm4gZGVjaW1hbDtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGEgRGVjaW1hbC5qcyB0byBhIEJpZy5qc1xuICogQHBhcmFtIGRlY2ltYWwgLSB0aGUgRGVjaW1hbC5qcyBvYmplY3QgdG8gY29udmVydFxuICogQHBhcmFtIGRlY2ltYWxzIC0gdGhlIG51bWJlciBvZiBkZWNpbWFsIHBsYWNlc1xuICpcbiAqIEByZXR1cm5zIEJpZy5qc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbURlY2ltYWwoZGVjaW1hbDogRGVjaW1hbCwgZGVjaW1hbHMgPSAyMCk6IEJpZyB7XG4gIGlmIChkZWNpbWFsLmlzTmFOKCkpIHtcbiAgICB0aHJvdyBuZXcgVHlwZUVycm9yKGBjYW5ub3QgY29udmVydCBOYU4gZGVjaW1hbC5qcyB0byBCaWcuanNgKTtcbiAgfVxuXG4gIGlmICghZGVjaW1hbC5pc0Zpbml0ZSgpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgY2Fubm90IGNvbnZlcnQgSU5GIGRlY2ltYWwuanMgdG8gQmlnLmpzYCk7XG4gIH1cblxuICBjb25zdCBiaWcgPSBuZXcgQmlnKGRlY2ltYWwudG9GaXhlZChkZWNpbWFscywgMCkpO1xuICByZXR1cm4gYmlnO1xufVxuIl19