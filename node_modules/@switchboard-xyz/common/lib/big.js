import { Big } from "big.js";
import BN from "bn.js";
import { Decimal } from "decimal.js";
function comparator(a, b) {
    if (a.gt(b))
        return 1;
    if (a.lt(b))
        return -1;
    return 0;
}
export function median(results) {
    if (!results?.length)
        throw new Error("Cannot take median of empty array.");
    const arrSort = results.slice().sort(comparator);
    const mid = Math.ceil(arrSort.length / 2);
    if (arrSort.length % 2 === 0) {
        const addition = arrSort[mid].add(arrSort[mid - 1]);
        return safeDiv(addition, new Big(2.0));
    }
    return arrSort[mid - 1];
}
export function weightedAverage(v1, w1, v2, w2) {
    return safeDiv(safeMul(v1, w1).add(safeMul(v2, w2)), w1.add(w2));
}
export function weightedMedian(results) {
    if (!results?.length)
        throw new Error("Cannot take median of empty array.");
    for (let i = 0; i < results.length; ++i) {
        if (results[i].weight === 0) {
            results[i].weight = 1;
        }
    }
    const arrSort = results.slice().sort((a, b) => comparator(a.value, b.value));
    const halfWeight = arrSort.reduce((sum, { weight }) => weight + sum, 0) / 2;
    let i = 0;
    let w = 0;
    // get the index (i) and total weight (w) of item just above half
    for (; w < halfWeight; ++i) {
        w = w + arrSort[i].weight;
    }
    // if it actually is exactly the half, we need to take the average
    if (w === halfWeight) {
        return weightedAverage(arrSort[i - 1].value, new Big(arrSort[i - 1].weight), arrSort[i].value, new Big(arrSort[i].weight));
    }
    // otherwise we return the value
    return arrSort[i - 1].value;
}
export function min(results) {
    if (results.length === 0) {
        throw new Error("Cannot reduce empty array.");
    }
    return results.reduce((val, current) => (val.lt(current) ? val : current), results[0]);
}
export function max(results) {
    if (results.length === 0) {
        throw new Error("Cannot reduce empty array.");
    }
    return results.reduce((val, current) => (val.gt(current) ? val : current), results[0]);
}
// This export function returns the ratio between the max value and the min value.
// If we pull data that may be negative, this information is not entirely relevant.
export function variance(results) {
    if (results?.length === 0) {
        throw new Error("Cannot take variance of empty array");
    }
    const arrSort = results
        .slice()
        .sort((n1, n2) => n1.minus(n2).toNumber());
    const min = arrSort[0];
    const max = arrSort[arrSort.length - 1];
    return max.minus(min);
}
////// BIG.JS UTILS
export function safeDiv(number_, denominator, decimals = 20) {
    const oldDp = Big.DP;
    Big.DP = decimals;
    const result = number_.div(denominator);
    Big.DP = oldDp;
    return result;
}
export function safeMul(...n) {
    if (n.length === 0) {
        throw new Error(`need to provide elements to multiply ${n}`);
    }
    let result = new Big(1);
    for (const x of n) {
        result = result.mul(x);
    }
    return result;
}
export function safeNthRoot(big, nthRoot, decimals = 20) {
    if (nthRoot <= 0) {
        throw new Error(`cannot take the nth root of a negative number`);
    }
    const oldDp = Big.DP;
    Big.DP = decimals;
    const oldPrecision = Decimal.precision;
    Decimal.set({ precision: decimals });
    const decimal = toDecimal(big);
    const frac = new Decimal(1).div(nthRoot);
    const root = big.s === -1
        ? decimal.abs().pow(frac).mul(new Decimal(big.s))
        : decimal.pow(frac);
    const result = fromDecimal(root);
    Decimal.set({ precision: oldPrecision });
    Big.DP = oldDp;
    return result;
}
export function safeSqrt(n, decimals = 20) {
    const oldDp = Big.DP;
    Big.DP = decimals;
    const result = n.sqrt();
    Big.DP = oldDp;
    return result;
}
export function safePow(n, exp, decimals = 20) {
    const oldDp = Big.DP;
    Big.DP = decimals;
    const oldPrecision = Decimal.precision;
    Decimal.set({ precision: decimals });
    const base = toDecimal(n);
    const value = base.pow(exp);
    const result = fromDecimal(value);
    Decimal.set({ precision: oldPrecision });
    Big.DP = oldDp;
    return result;
}
/**
 * Convert a BN.js to a Big.js
 * @param n - the BN.js object to convert
 * @param decimals - the number of decimal places to scale the BN.js
 *
 * @returns Big.js
 */
export function fromBN(n, decimals = 0) {
    let mantissa = new BN(n, 10);
    let s = 1;
    const c = [];
    const ZERO = new BN(0, 10);
    const TEN = new BN(10, 10);
    if (mantissa.lt(ZERO)) {
        s = -1;
        mantissa = mantissa.abs();
    }
    while (mantissa.gt(ZERO)) {
        c.unshift(mantissa.mod(TEN).toNumber());
        mantissa = mantissa.div(TEN);
    }
    const e = c.length - decimals - 1;
    const result = new Big(0);
    if (c.length === 0) {
        return result;
    }
    result.s = s;
    result.c = c;
    result.e = e;
    return result;
}
/**
 * Convert a BigInt to a Big.js
 * @param n - the BigInt to convert
 *
 * @returns Big.js
 */
export function fromBigint(n) {
    const big = new Big(n.toString(10));
    return big;
}
/**
 * Convert a Big.js to a Decimal.js
 * @param big - the Big.js object to convert
 * @param decimals - the number of decimal places
 *
 * @returns Decimal.js
 */
export function toDecimal(big, decimals = 20) {
    const oldPrecision = Decimal.precision;
    Decimal.set({ precision: decimals });
    const decimal = new Decimal(big.toFixed(decimals, 0));
    Decimal.set({ precision: oldPrecision });
    return decimal;
}
/**
 * Convert a Decimal.js to a Big.js
 * @param decimal - the Decimal.js object to convert
 * @param decimals - the number of decimal places
 *
 * @returns Big.js
 */
export function fromDecimal(decimal, decimals = 20) {
    if (decimal.isNaN()) {
        throw new TypeError(`cannot convert NaN decimal.js to Big.js`);
    }
    if (!decimal.isFinite()) {
        throw new TypeError(`cannot convert INF decimal.js to Big.js`);
    }
    const big = new Big(decimal.toFixed(decimals, 0));
    return big;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYmlnLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vc3JjL2JpZy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsR0FBRyxFQUFFLE1BQU0sUUFBUSxDQUFDO0FBQzdCLE9BQU8sRUFBRSxNQUFNLE9BQU8sQ0FBQztBQUN2QixPQUFPLEVBQUUsT0FBTyxFQUFFLE1BQU0sWUFBWSxDQUFDO0FBUXJDLFNBQVMsVUFBVSxDQUFDLENBQU0sRUFBRSxDQUFNO0lBQ2hDLElBQUksQ0FBQyxDQUFDLEVBQUUsQ0FBQyxDQUFDLENBQUM7UUFBRSxPQUFPLENBQUMsQ0FBQztJQUN0QixJQUFJLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQUUsT0FBTyxDQUFDLENBQUMsQ0FBQztJQUN2QixPQUFPLENBQUMsQ0FBQztBQUNYLENBQUM7QUFFRCxNQUFNLFVBQVUsTUFBTSxDQUFDLE9BQW1CO0lBQ3hDLElBQUksQ0FBQyxPQUFPLEVBQUUsTUFBTTtRQUFFLE1BQU0sSUFBSSxLQUFLLENBQUMsb0NBQW9DLENBQUMsQ0FBQztJQUU1RSxNQUFNLE9BQU8sR0FBRyxPQUFPLENBQUMsS0FBSyxFQUFFLENBQUMsSUFBSSxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ2pELE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxJQUFJLENBQUMsT0FBTyxDQUFDLE1BQU0sR0FBRyxDQUFDLENBQUMsQ0FBQztJQUMxQyxJQUFJLE9BQU8sQ0FBQyxNQUFNLEdBQUcsQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDO1FBQzdCLE1BQU0sUUFBUSxHQUFHLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLENBQUMsT0FBTyxDQUFDLEdBQUcsR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3BELE9BQU8sT0FBTyxDQUFDLFFBQVEsRUFBRSxJQUFJLEdBQUcsQ0FBQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0lBQ3pDLENBQUM7SUFDRCxPQUFPLE9BQU8sQ0FB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Q0FBQztRQUNwQixNQUFNLElBQUksU0FBUyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVELElBQUksQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLEVBQUUsQ0FBQztRQUN4QixNQUFNLElBQUksU0FBUyxDQUFDLHlDQUF5QyxDQUFDLENBQUM7SUFDakUsQ0FBQztJQUVELE1BQU0sR0FBRyxHQUFHLElBQUksR0FBRyxDQUFDLE9BQU8sQ0FBQyxPQUFPLENBQUMsUUFBUSxFQUFFLENBQUMsQ0FBQyxDQUFDLENBQUM7SUFDbEQsT0FBTyxHQUFHLENBQUM7QUFDYixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgQmlnIH0gZnJvbSBcImJpZy5qc1wiO1xuaW1wb3J0IEJOIGZyb20gXCJibi5qc1wiO1xuaW1wb3J0IHsgRGVjaW1hbCB9IGZyb20gXCJkZWNpbWFsLmpzXCI7XG5cbmV4cG9ydCBpbnRlcmZhY2UgV2VpZ2h0ZWRWYWx1ZSB7XG4gIGlkeDogbnVtYmVyO1xuICB2YWx1ZTogQmlnO1xuICB3ZWlnaHQ6IG51bWJlcjtcbn1cblxuZnVuY3Rpb24gY29tcGFyYXRvcihhOiBCaWcsIGI6IEJpZyk6IG51bWJlciB7XG4gIGlmIChhLmd0KGIpKSByZXR1cm4gMTtcbiAgaWYgKGEubHQoYikpIHJldHVybiAtMTtcbiAgcmV0dXJuIDA7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtZWRpYW4ocmVzdWx0czogQXJyYXk8QmlnPik6IEJpZyB7XG4gIGlmICghcmVzdWx0cz8ubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgdGFrZSBtZWRpYW4gb2YgZW1wdHkgYXJyYXkuXCIpO1xuXG4gIGNvbnN0IGFyclNvcnQgPSByZXN1bHRzLnNsaWNlKCkuc29ydChjb21wYXJhdG9yKTtcbiAgY29uc3QgbWlkID0gTWF0aC5jZWlsKGFyclNvcnQubGVuZ3RoIC8gMik7XG4gIGlmIChhcnJTb3J0Lmxlbmd0aCAlIDIgPT09IDApIHtcbiAgICBjb25zdCBhZGRpdGlvbiA9IGFyclNvcnRbbWlkXS5hZGQoYXJyU29ydFttaWQgLSAxXSk7XG4gICAgcmV0dXJuIHNhZmVEaXYoYWRkaXRpb24sIG5ldyBCaWcoMi4wKSk7XG4gIH1cbiAgcmV0dXJuIGFyclNvcnRbbWlkIC0gMV07XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3ZWlnaHRlZEF2ZXJhZ2UodjE6IEJpZywgdzE6IEJpZywgdjI6IEJpZywgdzI6IEJpZyk6IEJpZyB7XG4gIHJldHVybiBzYWZlRGl2KHNhZmVNdWwodjEsIHcxKS5hZGQoc2FmZU11bCh2MiwgdzIpKSwgdzEuYWRkKHcyKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiB3ZWlnaHRlZE1lZGlhbihyZXN1bHRzOiBBcnJheTxXZWlnaHRlZFZhbHVlPik6IEJpZyB7XG4gIGlmICghcmVzdWx0cz8ubGVuZ3RoKSB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgdGFrZSBtZWRpYW4gb2YgZW1wdHkgYXJyYXkuXCIpO1xuICBmb3IgKGxldCBpID0gMDsgaSA8IHJlc3VsdHMubGVuZ3RoOyArK2kpIHtcbiAgICBpZiAocmVzdWx0c1tpXS53ZWlnaHQgPT09IDApIHtcbiAgICAgIHJlc3VsdHNbaV0ud2VpZ2h0ID0gMTtcbiAgICB9XG4gIH1cblxuICBjb25zdCBhcnJTb3J0ID0gcmVzdWx0cy5zbGljZSgpLnNvcnQoKGEsIGIpID0+IGNvbXBhcmF0b3IoYS52YWx1ZSwgYi52YWx1ZSkpO1xuICBjb25zdCBoYWxmV2VpZ2h0ID0gYXJyU29ydC5yZWR1Y2UoKHN1bSwgeyB3ZWlnaHQgfSkgPT4gd2VpZ2h0ICsgc3VtLCAwKSAvIDI7XG4gIGxldCBpID0gMDtcbiAgbGV0IHcgPSAwO1xuXG4gIC8vIGdldCB0aGUgaW5kZXggKGkpIGFuZCB0b3RhbCB3ZWlnaHQgKHcpIG9mIGl0ZW0ganVzdCBhYm92ZSBoYWxmXG4gIGZvciAoOyB3IDwgaGFsZldlaWdodDsgKytpKSB7XG4gICAgdyA9IHcgKyBhcnJTb3J0W2ldLndlaWdodDtcbiAgfVxuXG4gIC8vIGlmIGl0IGFjdHVhbGx5IGlzIGV4YWN0bHkgdGhlIGhhbGYsIHdlIG5lZWQgdG8gdGFrZSB0aGUgYXZlcmFnZVxuICBpZiAodyA9PT0gaGFsZldlaWdodCkge1xuICAgIHJldHVybiB3ZWlnaHRlZEF2ZXJhZ2UoXG4gICAgICBhcnJTb3J0W2kgLSAxXS52YWx1ZSxcbiAgICAgIG5ldyBCaWcoYXJyU29ydFtpIC0gMV0ud2VpZ2h0KSxcbiAgICAgIGFyclNvcnRbaV0udmFsdWUsXG4gICAgICBuZXcgQmlnKGFyclNvcnRbaV0ud2VpZ2h0KVxuICAgICk7XG4gIH1cblxuICAvLyBvdGhlcndpc2Ugd2UgcmV0dXJuIHRoZSB2YWx1ZVxuICByZXR1cm4gYXJyU29ydFtpIC0gMV0udmFsdWU7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBtaW4ocmVzdWx0czogQXJyYXk8QmlnPik6IEJpZyB7XG4gIGlmIChyZXN1bHRzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCByZWR1Y2UgZW1wdHkgYXJyYXkuXCIpO1xuICB9XG4gIHJldHVybiByZXN1bHRzLnJlZHVjZShcbiAgICAodmFsLCBjdXJyZW50KSA9PiAodmFsLmx0KGN1cnJlbnQpID8gdmFsIDogY3VycmVudCksXG4gICAgcmVzdWx0c1swXVxuICApO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gbWF4KHJlc3VsdHM6IEFycmF5PEJpZz4pOiBCaWcge1xuICBpZiAocmVzdWx0cy5sZW5ndGggPT09IDApIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW5ub3QgcmVkdWNlIGVtcHR5IGFycmF5LlwiKTtcbiAgfVxuICByZXR1cm4gcmVzdWx0cy5yZWR1Y2UoXG4gICAgKHZhbCwgY3VycmVudCkgPT4gKHZhbC5ndChjdXJyZW50KSA/IHZhbCA6IGN1cnJlbnQpLFxuICAgIHJlc3VsdHNbMF1cbiAgKTtcbn1cblxuLy8gVGhpcyBleHBvcnQgZnVuY3Rpb24gcmV0dXJucyB0aGUgcmF0aW8gYmV0d2VlbiB0aGUgbWF4IHZhbHVlIGFuZCB0aGUgbWluIHZhbHVlLlxuLy8gSWYgd2UgcHVsbCBkYXRhIHRoYXQgbWF5IGJlIG5lZ2F0aXZlLCB0aGlzIGluZm9ybWF0aW9uIGlzIG5vdCBlbnRpcmVseSByZWxldmFudC5cbmV4cG9ydCBmdW5jdGlvbiB2YXJpYW5jZShyZXN1bHRzOiBBcnJheTxCaWc+KTogQmlnIHtcbiAgaWYgKHJlc3VsdHM/Lmxlbmd0aCA9PT0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihcIkNhbm5vdCB0YWtlIHZhcmlhbmNlIG9mIGVtcHR5IGFycmF5XCIpO1xuICB9XG4gIGNvbnN0IGFyclNvcnQgPSByZXN1bHRzXG4gICAgLnNsaWNlKClcbiAgICAuc29ydCgobjE6IEJpZywgbjI6IEJpZykgPT4gbjEubWludXMobjIpLnRvTnVtYmVyKCkpO1xuICBjb25zdCBtaW4gPSBhcnJTb3J0WzBdO1xuICBjb25zdCBtYXggPSBhcnJTb3J0W2FyclNvcnQubGVuZ3RoIC0gMV07XG4gIHJldHVybiBtYXgubWludXMobWluKTtcbn1cblxuLy8vLy8vIEJJRy5KUyBVVElMU1xuXG5leHBvcnQgZnVuY3Rpb24gc2FmZURpdihudW1iZXJfOiBCaWcsIGRlbm9taW5hdG9yOiBCaWcsIGRlY2ltYWxzID0gMjApOiBCaWcge1xuICBjb25zdCBvbGREcCA9IEJpZy5EUDtcbiAgQmlnLkRQID0gZGVjaW1hbHM7XG4gIGNvbnN0IHJlc3VsdCA9IG51bWJlcl8uZGl2KGRlbm9taW5hdG9yKTtcbiAgQmlnLkRQID0gb2xkRHA7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlTXVsKC4uLm46IEJpZ1tdKTogQmlnIHtcbiAgaWYgKG4ubGVuZ3RoID09PSAwKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKGBuZWVkIHRvIHByb3ZpZGUgZWxlbWVudHMgdG8gbXVsdGlwbHkgJHtufWApO1xuICB9XG5cbiAgbGV0IHJlc3VsdCA9IG5ldyBCaWcoMSk7XG4gIGZvciAoY29uc3QgeCBvZiBuKSB7XG4gICAgcmVzdWx0ID0gcmVzdWx0Lm11bCh4KTtcbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlTnRoUm9vdChiaWc6IEJpZywgbnRoUm9vdDogbnVtYmVyLCBkZWNpbWFscyA9IDIwKTogQmlnIHtcbiAgaWYgKG50aFJvb3QgPD0gMCkge1xuICAgIHRocm93IG5ldyBFcnJvcihgY2Fubm90IHRha2UgdGhlIG50aCByb290IG9mIGEgbmVnYXRpdmUgbnVtYmVyYCk7XG4gIH1cblxuICBjb25zdCBvbGREcCA9IEJpZy5EUDtcbiAgQmlnLkRQID0gZGVjaW1hbHM7XG4gIGNvbnN0IG9sZFByZWNpc2lvbiA9IERlY2ltYWwucHJlY2lzaW9uO1xuICBEZWNpbWFsLnNldCh7IHByZWNpc2lvbjogZGVjaW1hbHMgfSk7XG5cbiAgY29uc3QgZGVjaW1hbCA9IHRvRGVjaW1hbChiaWcpO1xuICBjb25zdCBmcmFjID0gbmV3IERlY2ltYWwoMSkuZGl2KG50aFJvb3QpO1xuICBjb25zdCByb290OiBEZWNpbWFsID1cbiAgICBiaWcucyA9PT0gLTFcbiAgICAgID8gZGVjaW1hbC5hYnMoKS5wb3coZnJhYykubXVsKG5ldyBEZWNpbWFsKGJpZy5zKSlcbiAgICAgIDogZGVjaW1hbC5wb3coZnJhYyk7XG5cbiAgY29uc3QgcmVzdWx0OiBCaWcgPSBmcm9tRGVjaW1hbChyb290KTtcblxuICBEZWNpbWFsLnNldCh7IHByZWNpc2lvbjogb2xkUHJlY2lzaW9uIH0pO1xuICBCaWcuRFAgPSBvbGREcDtcblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5leHBvcnQgZnVuY3Rpb24gc2FmZVNxcnQobjogQmlnLCBkZWNpbWFscyA9IDIwKTogQmlnIHtcbiAgY29uc3Qgb2xkRHAgPSBCaWcuRFA7XG4gIEJpZy5EUCA9IGRlY2ltYWxzO1xuICBjb25zdCByZXN1bHQgPSBuLnNxcnQoKTtcbiAgQmlnLkRQID0gb2xkRHA7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBzYWZlUG93KG46IEJpZywgZXhwOiBudW1iZXIsIGRlY2ltYWxzID0gMjApOiBCaWcge1xuICBjb25zdCBvbGREcCA9IEJpZy5EUDtcbiAgQmlnLkRQID0gZGVjaW1hbHM7XG5cbiAgY29uc3Qgb2xkUHJlY2lzaW9uID0gRGVjaW1hbC5wcmVjaXNpb247XG4gIERlY2ltYWwuc2V0KHsgcHJlY2lzaW9uOiBkZWNpbWFscyB9KTtcbiAgY29uc3QgYmFzZSA9IHRvRGVjaW1hbChuKTtcbiAgY29uc3QgdmFsdWUgPSBiYXNlLnBvdyhleHApO1xuICBjb25zdCByZXN1bHQgPSBmcm9tRGVjaW1hbCh2YWx1ZSk7XG5cbiAgRGVjaW1hbC5zZXQoeyBwcmVjaXNpb246IG9sZFByZWNpc2lvbiB9KTtcbiAgQmlnLkRQID0gb2xkRHA7XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxuLyoqXG4gKiBDb252ZXJ0IGEgQk4uanMgdG8gYSBCaWcuanNcbiAqIEBwYXJhbSBuIC0gdGhlIEJOLmpzIG9iamVjdCB0byBjb252ZXJ0XG4gKiBAcGFyYW0gZGVjaW1hbHMgLSB0aGUgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzIHRvIHNjYWxlIHRoZSBCTi5qc1xuICpcbiAqIEByZXR1cm5zIEJpZy5qc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZnJvbUJOKG46IEJOLCBkZWNpbWFscyA9IDApOiBCaWcge1xuICBsZXQgbWFudGlzc2E6IEJOID0gbmV3IEJOKG4sIDEwKTtcbiAgbGV0IHMgPSAxO1xuICBjb25zdCBjOiBBcnJheTxudW1iZXI+ID0gW107XG4gIGNvbnN0IFpFUk8gPSBuZXcgQk4oMCwgMTApO1xuICBjb25zdCBURU4gPSBuZXcgQk4oMTAsIDEwKTtcbiAgaWYgKG1hbnRpc3NhLmx0KFpFUk8pKSB7XG4gICAgcyA9IC0xO1xuICAgIG1hbnRpc3NhID0gbWFudGlzc2EuYWJzKCk7XG4gIH1cbiAgd2hpbGUgKG1hbnRpc3NhLmd0KFpFUk8pKSB7XG4gICAgYy51bnNoaWZ0KG1hbnRpc3NhLm1vZChURU4pLnRvTnVtYmVyKCkpO1xuICAgIG1hbnRpc3NhID0gbWFudGlzc2EuZGl2KFRFTik7XG4gIH1cbiAgY29uc3QgZSA9IGMubGVuZ3RoIC0gZGVjaW1hbHMgLSAxO1xuICBjb25zdCByZXN1bHQgPSBuZXcgQmlnKDApO1xuICBpZiAoYy5sZW5ndGggPT09IDApIHtcbiAgICByZXR1cm4gcmVzdWx0O1xuICB9XG4gIHJlc3VsdC5zID0gcztcbiAgcmVzdWx0LmMgPSBjO1xuICByZXN1bHQuZSA9IGU7XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbi8qKlxuICogQ29udmVydCBhIEJpZ0ludCB0byBhIEJpZy5qc1xuICogQHBhcmFtIG4gLSB0aGUgQmlnSW50IHRvIGNvbnZlcnRcbiAqXG4gKiBAcmV0dXJucyBCaWcuanNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21CaWdpbnQobjogYmlnaW50KTogQmlnIHtcbiAgY29uc3QgYmlnID0gbmV3IEJpZyhuLnRvU3RyaW5nKDEwKSk7XG4gIHJldHVybiBiaWc7XG59XG5cbi8qKlxuICogQ29udmVydCBhIEJpZy5qcyB0byBhIERlY2ltYWwuanNcbiAqIEBwYXJhbSBiaWcgLSB0aGUgQmlnLmpzIG9iamVjdCB0byBjb252ZXJ0XG4gKiBAcGFyYW0gZGVjaW1hbHMgLSB0aGUgbnVtYmVyIG9mIGRlY2ltYWwgcGxhY2VzXG4gKlxuICogQHJldHVybnMgRGVjaW1hbC5qc1xuICovXG5leHBvcnQgZnVuY3Rpb24gdG9EZWNpbWFsKGJpZzogQmlnLCBkZWNpbWFscyA9IDIwKTogRGVjaW1hbCB7XG4gIGNvbnN0IG9sZFByZWNpc2lvbiA9IERlY2ltYWwucHJlY2lzaW9uO1xuXG4gIERlY2ltYWwuc2V0KHsgcHJlY2lzaW9uOiBkZWNpbWFscyB9KTtcbiAgY29uc3QgZGVjaW1hbCA9IG5ldyBEZWNpbWFsKGJpZy50b0ZpeGVkKGRlY2ltYWxzLCAwKSk7XG4gIERlY2ltYWwuc2V0KHsgcHJlY2lzaW9uOiBvbGRQcmVjaXNpb24gfSk7XG5cbiAgcmV0dXJuIGRlY2ltYWw7XG59XG5cbi8qKlxuICogQ29udmVydCBhIERlY2ltYWwuanMgdG8gYSBCaWcuanNcbiAqIEBwYXJhbSBkZWNpbWFsIC0gdGhlIERlY2ltYWwuanMgb2JqZWN0IHRvIGNvbnZlcnRcbiAqIEBwYXJhbSBkZWNpbWFscyAtIHRoZSBudW1iZXIgb2YgZGVjaW1hbCBwbGFjZXNcbiAqXG4gKiBAcmV0dXJucyBCaWcuanNcbiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGZyb21EZWNpbWFsKGRlY2ltYWw6IERlY2ltYWwsIGRlY2ltYWxzID0gMjApOiBCaWcge1xuICBpZiAoZGVjaW1hbC5pc05hTigpKSB7XG4gICAgdGhyb3cgbmV3IFR5cGVFcnJvcihgY2Fubm90IGNvbnZlcnQgTmFOIGRlY2ltYWwuanMgdG8gQmlnLmpzYCk7XG4gIH1cblxuICBpZiAoIWRlY2ltYWwuaXNGaW5pdGUoKSkge1xuICAgIHRocm93IG5ldyBUeXBlRXJyb3IoYGNhbm5vdCBjb252ZXJ0IElORiBkZWNpbWFsLmpzIHRvIEJpZy5qc2ApO1xuICB9XG5cbiAgY29uc3QgYmlnID0gbmV3IEJpZyhkZWNpbWFsLnRvRml4ZWQoZGVjaW1hbHMsIDApKTtcbiAgcmV0dXJuIGJpZztcbn1cbiJdfQ==