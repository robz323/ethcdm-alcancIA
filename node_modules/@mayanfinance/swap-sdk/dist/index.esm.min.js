import z from"cross-fetch";var d={MAYAN_FORWARDER_CONTRACT:"0x0654874eb7F59C6f5b39931FC45dC45337c967c3",MAYAN_PROGRAM_ID:"FC4eXxkyrMPTjiYUpp4EAnkmwMbQyZ6NDCh1kfLn6vsf",AUCTION_PROGRAM_ID:"8QJmxZcEzwuYmCPy6XqgN2sHcYCcFq6AEfBMJZZuLo5a",MCTP_PROGRAM_ID:"Awm2zSgzMGTRraAVjRvshqLehy7mJ2Qr3maURDsoDmwi",SWIFT_PROGRAM_ID:"BLZRi6frs4X4DNLw56V4EXai1b6QVESN1BhHBTYM9VcY",FEE_MANAGER_PROGRAM_ID:"5VtQHnhs2pfVEr68qQsbTRwKh4JV5GTu9mBHgHFxpHeQ",WORMHOLE_PROGRAM_ID:"worm2ZoG2kUd4vFXhvjh93UUH596ayRfgQ2MgjNMTth",CCTP_CORE_PROGRAM_ID:"CCTPmbSD7gX1bxKPAmg77w8oFzNFpaQiQUWD43TKaecd",CCTP_TOKEN_PROGRAM_ID:"CCTPiPYPc6AsJuwueEnWgSgucamXDZwBd53dQ11YiKX3",TOKEN_PROGRAM_ID:"TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA",ASSOCIATED_TOKEN_PROGRAM_ID:"ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL",LOOKUP_TABLE:"75X8YgJPcadksw6Ag3qsYUfi1bsFwDoCKYtqPPqdydAG",EXPLORER_URL:"https://explorer-api.mayan.finance/v3",PRICE_URL:"https://price-api.mayan.finance/v3",RELAYER_URL:"https://relayer-api.mayan.finance/v3"};import{zeroPadValue as tt,parseUnits as fn,formatUnits as bn}from"ethers";import{PublicKey as me,SystemProgram as nt}from"@solana/web3.js";import{Buffer as rt}from"buffer";import*as at from"js-sha3";var gn=at.sha3_256,Tn=e=>/^(0x)?[0-9a-fA-F]+::\w+::\w+$/.test(e);function w(e,t){if(t===1)return tt(new me(e).toBytes(),32);if(t===2||t===4||t===5||t===6||t===23||t===24||t===30)return tt(e,32);if(t===22&&Tn(e))return`0x${gn(e)}`;throw console.log(`Unsupported chain id: ${t}`,e),new Error("Unsupported token chain")}function E(e){return new Uint8Array(rt.from(e.startsWith("0x")?e.substring(2):e,"hex"))}function R(e,t,n=!1,r=new me(d.TOKEN_PROGRAM_ID),a=new me(d.ASSOCIATED_TOKEN_PROGRAM_ID)){if(!n&&!me.isOnCurve(t.toBuffer()))throw new Error("TokenOwnerOffCurveError");let[o]=me.findProgramAddressSync([t.toBuffer(),r.toBuffer(),e.toBuffer()],a);return o}function T(e,t){if(e==null)throw new Error("getAmountOfFractionalAmount: Amount is null or undefined");if(typeof e!="string"&&typeof e!="number")throw new Error("getAmountOfFractionalAmount: Amount is not a string or number");if(typeof e=="string"&&e.length===0)throw new Error("getAmountOfFractionalAmount: Amount is empty");if(!Number.isFinite(Number(e)))throw new Error("getAmountOfFractionalAmount: Amount is not a number");let n=Math.min(8,Number(t)),r=Number(e).toFixed(n+1),a=new RegExp(`^-?\\d+(?:\\.\\d{0,${n}})?`),o=r.match(a);if(!o)throw new Error("getAmountOfFractionalAmount: fixedAmount is null");let i=o[0];return fn(i,Number(t))}function pr(e,t){return Number(bn(e,t))}var it={solana:1,ethereum:2,bsc:4,polygon:5,avalanche:6,arbitrum:23,optimism:24,base:30,aptos:22};function P(e){return it[e]}var Ue={[1]:2,[56]:4,[137]:5,[43114]:6,[42161]:23,[10]:24,[8453]:30};function st(e){let t=it[e],n=Object.keys(Ue);for(let r of n)if(Ue[r]===t)return Number(r);throw new Error(`Unsupported chain: ${e}`)}function Y(e){return Ue[e]}var ae=[9,8,0];function ot(){return ae.join("_")}function pt(e){return ae[0]<e[0]?!1:ae[0]>e[0]?!0:ae[1]<e[1]?!1:ae[1]>e[1]||ae[2]>=e[2]}function _(e){return e==="solana"?9:18}function ut(e){return e==="solana"?9:8}var wn=BigInt(2)**BigInt(64)-BigInt(1);function M(e){if(e<BigInt(0)||e>wn)throw new Error(`Invalid u64: ${e}`);let t=rt.alloc(8);return t.writeBigUInt64LE(e),t}var ie={value:BigInt(0),deadline:0,v:0,r:`0x${nt.programId.toBuffer().toString("hex")}`,s:`0x${nt.programId.toBuffer().toString("hex")}`};function yt(e){return new Promise(t=>{setTimeout(()=>{t()},e)})}function fe(e,t){return!e||!t?null:e.type==="WH"?t?.solana||null:e.type==="MCTP"||e.type==="SWIFT"?e.toChain==="solana"?t?.solana||null:t?.evm||null:null}function Qe(e){return Object.entries(e).filter(([t,n])=>n!=null&&!Array.isArray(n)).map(([t,n])=>`${encodeURIComponent(t)}=${encodeURIComponent(n)}`).join("&")}async function J(e){if(e.status.toString().startsWith("5")){let t;try{let n=await e.json();n.code&&(n?.message||n?.msg)&&(t={code:n.code,message:n?.message||n?.msg})}catch{t=new Error("Internal server error")}throw t}}async function dr(e){let t=e?`?standard=${e.join(",")}`:"",n=await z(`${d.PRICE_URL}/tokens${t}`,{method:"GET",redirect:"follow"});if(await J(n),n.status===200)return await n.json();throw new Error("Cannot fetch Mayan tokens!")}async function mr(e,t=!1,n){let r={chain:e,nonPortal:t,standard:n?n?.join(","):void 0},a=await z(`${d.PRICE_URL}/tokens?${Qe(r)}`);if(await J(a),a.status===200)return(await a.json())[e];throw new Error("Cannot fetch Mayan tokens!")}function An(e,t={swift:!0,mctp:!0,gasless:!1,onlyDirect:!1}){let{gasDrop:n,referrerBps:r}=e,a=e.slippageBps;a!=="auto"&&!Number.isFinite(a)&&(a=e.slippage*100);let i={...{swift:t.swift!==!1,mctp:t.mctp!==!1,gasless:t.gasless===!0,onlyDirect:t.onlyDirect===!0},solanaProgram:d.MAYAN_PROGRAM_ID,forwarderAddress:d.MAYAN_FORWARDER_CONTRACT,amountIn:Number.isFinite(e.amount)?e.amount:void 0,fromToken:e.fromToken,fromChain:e.fromChain,toToken:e.toToken,toChain:e.toChain,slippageBps:a,referrer:e.referrer,referrerBps:Number.isFinite(r)?r:void 0,gasDrop:Number.isFinite(n)?n:void 0,sdkVersion:ot()},s=`${d.PRICE_URL}/quote?`,y=Qe(i);return s+y}async function fr(e,t={swift:!0,mctp:!0,gasless:!1,onlyDirect:!1}){let n=An(e,t),r=await z(n,{method:"GET",redirect:"follow"});await J(r);let a=await r.json();if(r.status!==200&&r.status!==201)throw{code:a?.code||0,message:a?.msg||"Route not found"};if(!pt(a.minimumSdkVersion))throw{code:9999,message:"Swap SDK is outdated!"};return a.quotes}async function br(e){let t=await z(`${d.PRICE_URL}/clock/${e}`,{method:"GET",redirect:"follow"});await J(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return n.clock}async function ct(){let e=await z(`${d.RELAYER_URL}/active-relayers?solanaProgram=${d.MAYAN_PROGRAM_ID}`,{method:"GET",redirect:"follow"});await J(e);let t=await e.json();if(e.status!==200&&e.status!==201)throw t;return t.suggested}async function ke(e){let t=Qe(e),n=await z(`${d.PRICE_URL}/get-swap/solana?${t}`,{method:"GET",redirect:"follow"});await J(n);let r=await n.json();if(n.status!==200&&n.status!==201)throw r;return r}async function lt(e,t){let n=await z(`${d.EXPLORER_URL}/submit/evm`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...e,signature:t},(r,a)=>typeof a=="bigint"?a.toString():a)});await J(n)}async function dt(e){let t=await z(`${d.EXPLORER_URL}/submit/solana`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({signedTx:e})});await J(t);let n=await t.json();if(t.status!==200&&t.status!==201)throw n;return n}import{Contract as Nt,toBeHex as Kt,ZeroAddress as Gt}from"ethers";import{PublicKey as Je,SystemProgram as Kn}from"@solana/web3.js";var mt={_format:"hh-sol-artifact-1",contractName:"MayanSwap",sourceName:"src/MayanSwap.sol",abi:[{inputs:[{internalType:"address",name:"_tokenBridge",type:"address"},{internalType:"address",name:"_weth",type:"address"}],stateMutability:"nonpayable",type:"constructor"},{anonymous:!1,inputs:[{indexed:!0,internalType:"uint16",name:"emitterChainId",type:"uint16"},{indexed:!0,internalType:"bytes32",name:"emitterAddress",type:"bytes32"},{indexed:!0,internalType:"uint64",name:"sequence",type:"uint64"}],name:"Redeemed",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"tokenAddr",type:"bytes32"},{internalType:"uint16",name:"tokenChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"sourceAddr",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint64",name:"sequence",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bool",name:"unwrapRedeem",type:"bool"},{internalType:"bool",name:"unwrapRefund",type:"bool"}],internalType:"struct MayanStructs.Swap",name:"s",type:"tuple"}],name:"encodeSwap",outputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],stateMutability:"pure",type:"function"},{inputs:[],name:"getWeth",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRedeemPayload",outputs:[{components:[{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"uint64",name:"relayerFee",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanStructs.Redeem",name:"r",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeem",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeemAndUnwrap",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"},{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"}],name:"swap",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"sweepEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"sweepToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{components:[{internalType:"uint64",name:"swapFee",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwap.RelayerFees",name:"relayerFees",type:"tuple"},{components:[{internalType:"bytes32",name:"mayanAddr",type:"bytes32"},{internalType:"uint16",name:"mayanChainId",type:"uint16"},{internalType:"bytes32",name:"auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrer",type:"bytes32"},{internalType:"bytes32",name:"refundAddr",type:"bytes32"}],internalType:"struct MayanSwap.Recepient",name:"recipient",type:"tuple"},{internalType:"bytes32",name:"tokenOutAddr",type:"bytes32"},{internalType:"uint16",name:"tokenOutChainId",type:"uint16"},{components:[{internalType:"uint256",name:"transferDeadline",type:"uint256"},{internalType:"uint64",name:"swapDeadline",type:"uint64"},{internalType:"uint64",name:"amountOutMin",type:"uint64"},{internalType:"bool",name:"unwrap",type:"bool"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes",name:"customPayload",type:"bytes"}],internalType:"struct MayanSwap.Criteria",name:"criteria",type:"tuple"}],name:"wrapAndSwapETH",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{stateMutability:"payable",type:"receive"}]};var se={_format:"hh-sol-artifact-1",contractName:"MayanForwarder",sourceName:"src/MayanForwarder.sol",abi:[{inputs:[{internalType:"address",name:"_guardian",type:"address"},{internalType:"address[]",name:"_swapProtocols",type:"address[]"},{internalType:"address[]",name:"_mayanProtocols",type:"address[]"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"UnsupportedProtocol",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"token",type:"address"},{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"protocolData",type:"bytes"}],name:"ForwardedEth",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amount",type:"uint256"}],name:"SwapAndForwarded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"address",name:"tokenIn",type:"address"},{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedERC20",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"uint256",name:"amountIn",type:"uint256"},{indexed:!1,internalType:"address",name:"swapProtocol",type:"address"},{indexed:!1,internalType:"address",name:"middleToken",type:"address"},{indexed:!1,internalType:"uint256",name:"middleAmount",type:"uint256"},{indexed:!1,internalType:"address",name:"mayanProtocol",type:"address"},{indexed:!1,internalType:"bytes",name:"mayanData",type:"bytes"}],name:"SwapAndForwardedEth",type:"event"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"protocolData",type:"bytes"}],name:"forwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"mayanProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setMayanProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bool",name:"enabled",type:"bool"}],name:"setSwapProtocol",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"uint256",name:"value",type:"uint256"},{internalType:"uint256",name:"deadline",type:"uint256"},{internalType:"uint8",name:"v",type:"uint8"},{internalType:"bytes32",name:"r",type:"bytes32"},{internalType:"bytes32",name:"s",type:"bytes32"}],internalType:"struct MayanForwarder.PermitParams",name:"permitParams",type:"tuple"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardERC20",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"},{internalType:"address",name:"middleToken",type:"address"},{internalType:"uint256",name:"minMiddleAmount",type:"uint256"},{internalType:"address",name:"mayanProtocol",type:"address"},{internalType:"bytes",name:"mayanData",type:"bytes"}],name:"swapAndForwardEth",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"",type:"address"}],name:"swapProtocols",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Lt}from"buffer";import{Contract as $e,toBeHex as K,ZeroAddress as Ve}from"ethers";import{PublicKey as Q,SystemProgram as ft}from"@solana/web3.js";var He={_format:"hh-sol-artifact-1",contractName:"MayanCircle",sourceName:"src/MayanCircle.sol",abi:[{inputs:[{internalType:"address",name:"_cctpTokenMessenger",type:"address"},{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"_solanaEmitter",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"CctpReceiveFailed",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidDomain",type:"error"},{inputs:[],name:"InvalidEmitter",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidNonce",type:"error"},{inputs:[],name:"InvalidOrder",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{components:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"},{internalType:"bytes32",name:"callerAddr",type:"bytes32"}],internalType:"struct MayanCircle.CctpRecipient",name:"recipient",type:"tuple"}],name:"bridgeWithFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint256",name:"redeemFee",type:"uint256"},{components:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"},{internalType:"bytes32",name:"callerAddr",type:"bytes32"}],internalType:"struct MayanCircle.CctpRecipient",name:"recipient",type:"tuple"}],name:"bridgeWithLockedFee",outputs:[{internalType:"uint64",name:"cctpNonce",type:"uint64"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"cctpTokenMessenger",outputs:[{internalType:"contract ITokenMessenger",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"params",type:"tuple"},{components:[{internalType:"uint32",name:"destDomain",type:"uint32"},{internalType:"bytes32",name:"mintRecipient",type:"bytes32"},{internalType:"bytes32",name:"callerAddr",type:"bytes32"}],internalType:"struct MayanCircle.CctpRecipient",name:"recipient",type:"tuple"}],name:"createOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint64",name:"",type:"uint64"}],name:"feeStorage",outputs:[{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"redeemFee",type:"uint256"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"address",name:"swapProtocol",type:"address"},{internalType:"bytes",name:"swapData",type:"bytes"}],name:"fulfillOrder",outputs:[],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"isPaused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[],name:"localDomain",outputs:[{internalType:"uint32",name:"",type:"uint32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseFulfillMsg",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"uint8",name:"payloadId",type:"uint8"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"driver",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"uint64",name:"cctpNonce",type:"uint64"}],internalType:"struct MayanCircle.FulfillMsg",name:"fulfillMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"redeemWithFee",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"redeemWithLockedFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint32",name:"cctpNonce",type:"uint32"},{internalType:"uint32",name:"cctpDomain",type:"uint32"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"unlockerAddr",type:"bytes32"}],name:"refineFee",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes",name:"cctpMsg",type:"bytes"},{internalType:"bytes",name:"cctpSigs",type:"bytes"},{components:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChain",type:"uint16"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"uint64",name:"redeemFee",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"}],internalType:"struct MayanCircle.OrderParams",name:"orderParams",type:"tuple"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"uint16",name:"sourceChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"}],internalType:"struct MayanCircle.ExtraParams",name:"extraParams",type:"tuple"}],name:"refund",outputs:[],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address payable",name:"to",type:"address"}],name:"rescueEth",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"token",type:"address"},{internalType:"uint256",name:"amount",type:"uint256"},{internalType:"address",name:"to",type:"address"}],name:"rescueToken",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"solanaEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockFee",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm1",type:"bytes"},{internalType:"bytes",name:"encodedVm2",type:"bytes"}],name:"unlockFeeRefined",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{Buffer as Pe}from"buffer";import{PublicKey as G}from"@solana/web3.js";import{Buffer as $}from"buffer";var N=6;function U(e){switch(e){case"ethereum":return 0;case"avalanche":return 1;case"optimism":return 2;case"arbitrum":return 3;case"solana":return 5;case"base":return 6;case"polygon":return 7;default:throw new Error("unsupported chain for cctp")}}function Ce(e,t){let n=new G(d.CCTP_CORE_PROGRAM_ID),r=new G(d.CCTP_TOKEN_PROGRAM_ID),[a]=G.findProgramAddressSync([$.from("message_transmitter")],n),[o]=G.findProgramAddressSync([$.from("sender_authority")],r),[i]=G.findProgramAddressSync([$.from("local_token"),e.toBytes()],r),[s]=G.findProgramAddressSync([$.from("token_messenger")],r),[y]=G.findProgramAddressSync([$.from("token_minter")],r),p=U(t),[c]=G.findProgramAddressSync([$.from("remote_token_messenger"),$.from(p.toString())],r),[u]=G.findProgramAddressSync([$.from("__event_authority")],n),[l]=G.findProgramAddressSync([$.from("__event_authority")],r);return{messageTransmitter:a,senderAuthority:o,remoteTokenMessengerKey:c,tokenMessenger:s,tokenMinter:y,eventAuthToken:l,eventAuthCore:u,localToken:i}}function In(e,t,n){let r=Y(Number(n)),a=P(e.fromChain),o=P(e.toChain);if(a!==r)throw new Error(`Signer chain id(${Number(n)}) and quote from chain are not same! ${a} !== ${r}`);let i=e.cheaperChain===e.fromChain,s=w(t,o),y=T(e.redeemRelayerFee,N),p=T(e.gasDrop,Math.min(_(e.toChain),8)),c=T(e.effectiveAmountIn,e.fromToken.decimals),u=U(e.toChain);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let l=e.mctpMayanContract,m,f;if(e.toChain==="solana"){if(i)throw new Error("Cannot lock fee for transfer to solana");let[b]=Q.findProgramAddressSync([Pe.from("CALLER")],new Q(d.MCTP_PROGRAM_ID)),[h]=Q.findProgramAddressSync([Pe.from("MAIN")],new Q(d.MCTP_PROGRAM_ID)),I=new Q(e.mctpOutputContract),A=R(I,h,!0);m=w(A.toString(),P("solana")),f=w(b.toString(),P("solana"))}else f=w(l,o),i?m=s:m=f;let g=T(e.bridgeFee,_(e.fromChain));return i&&(g=BigInt(0)),{lockFee:i,tokenIn:e.mctpInputContract,amountIn:c,redeemFee:y,gasDrop:p,destAddr:s,recipient:{destDomain:u,mintRecipient:m,callerAddr:f},bridgeFee:g,contractAddress:l}}function bt(e,t,n){let r=In(e,t,n),{contractAddress:a,tokenIn:o,amountIn:i,destAddr:s,lockFee:y,redeemFee:p,gasDrop:c,recipient:u,bridgeFee:l}=r,m=new $e(a,He.abi),f,g;return y?f=m.interface.encodeFunctionData("bridgeWithLockedFee",[o,i,c,p,u]):f=m.interface.encodeFunctionData("bridgeWithFee",[o,i,p,c,s,u]),g=K(l),{to:a,data:f,value:g,_params:r}}function hn(e,t,n,r){let a=Y(Number(r)),o=P(e.fromChain),i=P(e.toChain);if(o!==a)throw new Error(`Signer chain id(${Number(r)}) and quote from chain are not same! ${o} !== ${a}`);if(!e.mctpMayanContract)throw new Error("MCTP contract address is missing");let s=e.mctpMayanContract,y,p;if(e.toChain==="solana"){let[A]=Q.findProgramAddressSync([Pe.from("CALLER")],new Q(d.MCTP_PROGRAM_ID)),[C]=Q.findProgramAddressSync([Pe.from("MAIN")],new Q(d.MCTP_PROGRAM_ID)),S=new Q(e.mctpOutputContract),O=R(S,C,!0);y=w(O.toString(),P("solana")),p=w(A.toString(),P("solana"))}else y=w(s,i),p=w(s,i);let c=U(e.toChain),u=w(t,i),l;n?l=w(n,i):l=w(ft.programId.toString(),P("solana"));let m=T(e.redeemRelayerFee,N),f=T(e.gasDrop,Math.min(_(e.toChain),8)),g=T(e.effectiveAmountIn,e.fromToken.decimals),b=T(e.minAmountOut,Math.min(8,e.toToken.decimals)),h=BigInt(e.deadline64),I=e.toToken.contract===Ve?w(ft.programId.toString(),P("solana")):w(e.toToken.contract,e.toToken.wChainId);return{params:{tokenIn:e.mctpInputContract,amountIn:g,gasDrop:f,destAddr:u,destChain:i,tokenOut:I,minAmountOut:b,deadline:h,redeemFee:m,referrerAddr:l,referrerBps:e.referrerBps||0},recipient:{destDomain:c,mintRecipient:y,callerAddr:p},bridgeFee:T(e.bridgeFee,_(e.fromChain)),contractAddress:s}}function gt(e,t,n,r){let a=hn(e,t,n,r),{contractAddress:o,params:i,bridgeFee:s,recipient:y}=a,c=new $e(o,He.abi).interface.encodeFunctionData("createOrder",[i,y]),u=K(s);return{to:o,data:c,value:u,_params:a}}function Tt(e,t,n,r,a){if(e.type!=="MCTP")throw new Error("Quote type is not MCTP");if(!Number.isFinite(Number(r)))throw new Error("Invalid signer chain id");r=Number(r);let o=a||ie,i=new $e(d.MAYAN_FORWARDER_CONTRACT,se.abi),s=T(e.bridgeFee,_(e.fromChain)),y=K(s);if(e.fromToken.contract===e.mctpInputContract)if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let p=gt(e,t,n,r),c="forwardERC20",u=[e.fromToken.contract,p._params.params.amountIn,o,p._params.contractAddress,p.data];return{data:i.interface.encodeFunctionData(c,u),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:c,params:u}}}else{let p=bt(e,t,r),c="forwardERC20",u=[e.fromToken.contract,p._params.amountIn,o,p._params.contractAddress,p.data];return{data:i.interface.encodeFunctionData(c,u),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:c,params:u}}}else{let{minMiddleAmount:p,evmSwapRouterAddress:c,evmSwapRouterCalldata:u}=e;if(!p||!c||!u)throw new Error("MCTP swap requires middle amount, router address and calldata");if(e.hasAuction){if(!Number(e.deadline64))throw new Error("MCTP order requires timeout");let l=gt(e,t,n,r),m=T(e.minMiddleAmount,N);if(e.fromToken.contract===Ve){let f=l._params.params.amountIn;if(f<=s)throw new Error("Amount in is less than bridge fee");s!==BigInt(0)&&(f-=s),y=K(l._params.params.amountIn);let g="swapAndForwardEth",b=[f,c,u,e.mctpInputContract,m,l._params.contractAddress,l.data];return{data:i.interface.encodeFunctionData(g,b),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:g,params:b}}}else{let f="swapAndForwardERC20",g=[e.fromToken.contract,l._params.params.amountIn,o,c,u,e.mctpInputContract,m,l._params.contractAddress,l.data];return{data:i.interface.encodeFunctionData(f,g),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:f,params:g}}}}else{let l=bt(e,t,r),m=T(e.minMiddleAmount,N);if(e.fromToken.contract===Ve){let f=l._params.amountIn;if(f<=s)throw new Error("Amount in is less than bridge fee");s!==BigInt(0)&&(f-=s),y=K(l._params.amountIn);let g="swapAndForwardEth",b=[f,c,u,e.mctpInputContract,m,l._params.contractAddress,l.data];return{data:i.interface.encodeFunctionData(g,b),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:g,params:b}}}else{let f="swapAndForwardERC20",g=[e.fromToken.contract,l._params.amountIn,o,c,u,e.mctpInputContract,m,l._params.contractAddress,l.data];return{data:i.interface.encodeFunctionData(f,g),to:d.MAYAN_FORWARDER_CONTRACT,value:K(y),chainId:r,_forwarder:{method:f,params:g}}}}}}import{Contract as Dt,toBeHex as Be,ZeroAddress as We}from"ethers";import{Keypair as Wn,SystemProgram as vt}from"@solana/web3.js";var wt={_format:"hh-sol-artifact-1",contractName:"MayanSwift",sourceName:"src/MayanSwift.sol",abi:[{inputs:[{internalType:"address",name:"_wormhole",type:"address"},{internalType:"address",name:"_feeManager",type:"address"},{internalType:"uint16",name:"_auctionChainId",type:"uint16"},{internalType:"bytes32",name:"_auctionAddr",type:"bytes32"},{internalType:"bytes32",name:"_solanaEmitter",type:"bytes32"},{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],stateMutability:"nonpayable",type:"constructor"},{inputs:[],name:"DeadlineViolation",type:"error"},{inputs:[],name:"DuplicateOrder",type:"error"},{inputs:[],name:"FeesTooHigh",type:"error"},{inputs:[],name:"InvalidAction",type:"error"},{inputs:[],name:"InvalidAmount",type:"error"},{inputs:[],name:"InvalidAuctionMode",type:"error"},{inputs:[],name:"InvalidBpsFee",type:"error"},{inputs:[],name:"InvalidContractSignature",type:"error"},{inputs:[],name:"InvalidDestChain",type:"error"},{inputs:[],name:"InvalidEmitterAddress",type:"error"},{inputs:[],name:"InvalidEmitterChain",type:"error"},{inputs:[],name:"InvalidEvmAddr",type:"error"},{inputs:[],name:"InvalidGasDrop",type:"error"},{inputs:[],name:"InvalidOrderHash",type:"error"},{inputs:[],name:"InvalidOrderStatus",type:"error"},{inputs:[],name:"InvalidSignature",type:"error"},{inputs:[],name:"InvalidSignatureLength",type:"error"},{inputs:[],name:"InvalidSigner",type:"error"},{inputs:[],name:"InvalidSrcChain",type:"error"},{inputs:[],name:"InvalidWormholeFee",type:"error"},{inputs:[],name:"OrderNotExists",type:"error"},{inputs:[],name:"Paused",type:"error"},{inputs:[],name:"SmallAmountIn",type:"error"},{inputs:[],name:"Unauthorized",type:"error"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"}],name:"OrderCanceled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderCreated",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint64",name:"sequence",type:"uint64"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderFulfilled",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"},{indexed:!1,internalType:"uint256",name:"netAmount",type:"uint256"}],name:"OrderRefunded",type:"event"},{anonymous:!1,inputs:[{indexed:!1,internalType:"bytes32",name:"key",type:"bytes32"}],name:"OrderUnlocked",type:"event"},{inputs:[],name:"auctionAddr",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[],name:"auctionChainId",outputs:[{internalType:"uint16",name:"",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"bytes32",name:"canceler",type:"bytes32"}],name:"cancelOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"newGuardian",type:"address"}],name:"changeGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"claimGuardian",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"consistencyLevel",outputs:[{internalType:"uint8",name:"",type:"uint8"}],stateMutability:"view",type:"function"},{inputs:[{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithEth",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes",name:"signedOrderHash",type:"bytes"}],name:"createOrderWithSig",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"tokenIn",type:"address"},{internalType:"uint256",name:"amountIn",type:"uint256"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"}],name:"createOrderWithToken",outputs:[{internalType:"bytes32",name:"orderHash",type:"bytes32"}],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"feeManager",outputs:[{internalType:"contract IFeeManager",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes",name:"encodedVm",type:"bytes"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillOrder",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"uint256",name:"fulfillAmount",type:"uint256"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{components:[{internalType:"bytes32",name:"trader",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"minAmountOut",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"auctionMode",type:"uint8"},{internalType:"bytes32",name:"random",type:"bytes32"}],internalType:"struct MayanSwift.OrderParams",name:"params",type:"tuple"},{internalType:"bytes32",name:"recepient",type:"bytes32"},{internalType:"bool",name:"batch",type:"bool"}],name:"fulfillSimple",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[],name:"guardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[],name:"nextGuardian",outputs:[{internalType:"address",name:"",type:"address"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"orders",outputs:[{internalType:"enum MayanSwift.Status",name:"status",type:"uint8"},{internalType:"uint64",name:"amountIn",type:"uint64"},{internalType:"uint16",name:"destChainId",type:"uint16"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseFulfillPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"destChainId",type:"uint16"},{internalType:"bytes32",name:"destAddr",type:"bytes32"},{internalType:"bytes32",name:"driver",type:"bytes32"},{internalType:"bytes32",name:"tokenOut",type:"bytes32"},{internalType:"uint64",name:"promisedAmount",type:"uint64"},{internalType:"uint64",name:"gasDrop",type:"uint64"},{internalType:"uint64",name:"deadline",type:"uint64"},{internalType:"bytes32",name:"referrerAddr",type:"bytes32"},{internalType:"uint8",name:"referrerBps",type:"uint8"},{internalType:"uint8",name:"protocolBps",type:"uint8"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"}],internalType:"struct MayanSwift.FulfillMsg",name:"fulfillMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseRefundPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"},{internalType:"bytes32",name:"canceler",type:"bytes32"},{internalType:"uint64",name:"cancelFee",type:"uint64"},{internalType:"uint64",name:"refundFee",type:"uint64"}],internalType:"struct MayanSwift.RefundMsg",name:"refundMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[{internalType:"bytes",name:"encoded",type:"bytes"}],name:"parseUnlockPayload",outputs:[{components:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],internalType:"struct MayanSwift.UnlockMsg",name:"unlockMsg",type:"tuple"}],stateMutability:"pure",type:"function"},{inputs:[],name:"paused",outputs:[{internalType:"bool",name:"",type:"bool"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes32[]",name:"orderHashes",type:"bytes32[]"}],name:"postBatch",outputs:[{internalType:"uint64",name:"sequence",type:"uint64"}],stateMutability:"payable",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"refundOrder",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"uint8",name:"_consistencyLevel",type:"uint8"}],name:"setConsistencyLevel",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"address",name:"_feeManager",type:"address"}],name:"setFeeManager",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bool",name:"_pause",type:"bool"}],name:"setPause",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"solanaEmitter",outputs:[{internalType:"bytes32",name:"",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockBatch",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[{internalType:"bytes32",name:"",type:"bytes32"}],name:"unlockMsgs",outputs:[{internalType:"uint8",name:"action",type:"uint8"},{internalType:"bytes32",name:"orderHash",type:"bytes32"},{internalType:"uint16",name:"srcChainId",type:"uint16"},{internalType:"bytes32",name:"tokenIn",type:"bytes32"},{internalType:"bytes32",name:"recipient",type:"bytes32"}],stateMutability:"view",type:"function"},{inputs:[{internalType:"bytes",name:"encodedVm",type:"bytes"}],name:"unlockSingle",outputs:[],stateMutability:"nonpayable",type:"function"},{inputs:[],name:"wormhole",outputs:[{internalType:"contract IWormhole",name:"",type:"address"}],stateMutability:"view",type:"function"},{stateMutability:"payable",type:"receive"}],linkReferences:{},deployedLinkReferences:{}};import{PublicKey as V,Keypair as En,SystemProgram as pe,TransactionInstruction as _n,ComputeBudgetProgram as Fn}from"@solana/web3.js";import{blob as W,struct as Dn,u16 as vn,u8 as xe}from"@solana/buffer-layout";import{Buffer as x}from"buffer";import{ethers as xn,ZeroAddress as ue}from"ethers";import{Connection as Re,Keypair as Sn,PublicKey as F,SystemProgram as Oe,SYSVAR_RENT_PUBKEY as kn,Transaction as Ye,TransactionInstruction as oe,AddressLookupTableAccount as At}from"@solana/web3.js";import{Buffer as ee}from"buffer";import{blob as Ct,struct as Ee,u8 as _e}from"@solana/buffer-layout";import{sha256 as Cn}from"js-sha256";import Pn from"bs58";var Mn={};function Rn(e){return Mn[e]??=new Re(e),new Re(e)}async function Fe({trx:e,connection:t,errorChance:n,extraRpcs:r,options:a,rate:o=8}){let i=null,s=0,y=[t].concat(r.map(Rn));for(let p=0;p<o;p++){if(i)try{let u=await Promise.any(y.map(l=>l.getSignatureStatus(i)));if(u&&u.value){if(u.value.err){if(s>=n)return{signature:i,serializedTrx:e};s++}else if(u.value.confirmationStatus==="confirmed")return{signature:i,serializedTrx:e}}}catch(u){console.error(u)}let c=y.map(u=>u.sendRawTransaction(e,a));if(!i)try{i=await Promise.any(c)}catch(u){console.error("Transaction not submitted, remaining attempts:",o-p-1,u)}await yt(1e3)}if(!i)throw new Error("Failed to send transaction");return{signature:i,serializedTrx:e}}function H(e,t,n,r,a=new F(d.TOKEN_PROGRAM_ID),o=new F(d.ASSOCIATED_TOKEN_PROGRAM_ID)){let i=[{pubkey:e,isSigner:!0,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:Oe.programId,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:kn,isSigner:!1,isWritable:!1}];return new oe({keys:i,programId:o,data:ee.alloc(0)})}var It=Ee([_e("instruction"),Ct(8,"amount")]);function Pt(e,t,n,r,a=new F(d.TOKEN_PROGRAM_ID)){let o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!1}],i=ee.alloc(It.span);return It.encode({instruction:4,amount:M(r)},i),new oe({keys:o,programId:a,data:i})}var ht=Ee([_e("instruction")]);function be(e){let t=[{pubkey:e,isSigner:!1,isWritable:!0}],n=ee.alloc(ht.span);return ht.encode({instruction:17},n),new oe({keys:t,programId:new F(d.TOKEN_PROGRAM_ID),data:n})}var St=Ee([_e("instruction")]);function On(e,t,n,r=new F(d.TOKEN_PROGRAM_ID)){let a=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],o=ee.alloc(St.span);return St.encode({instruction:9},o),new oe({keys:a,programId:r,data:o})}var kt=Ee([_e("instruction"),Ct(8,"amount")]);function ge(e,t,n,r,a=new F(d.TOKEN_PROGRAM_ID)){let o=[{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!0,isWritable:!1}],i=ee.alloc(kt.span);return kt.encode({instruction:3,amount:M(r)},i),new oe({keys:o,programId:a,data:i})}var j=new F("So11111111111111111111111111111111111111112");async function jr(e,t,n,r){let a=r??new Re("https://rpc.ankr.com/solana"),o=R(j,e,!1),{blockhash:i,lastValidBlockHeight:s}=await a.getLatestBlockhash(),y=new Ye({feePayer:e,blockhash:i,lastValidBlockHeight:s}),p=await a.getAccountInfo(o,"finalized");(!p||p.data.length===0)&&y.add(H(e,o,e,j)),y.add(Oe.transfer({fromPubkey:e,toPubkey:o,lamports:T(t,9)})),y.add(be(o));let c=await n(y);return await Fe({trx:c.serialize(),connection:a,errorChance:1,extraRpcs:[]})}async function Zr(e,t,n,r){let a=r??new Re("https://rpc.ankr.com/solana"),o=R(j,e,!1),i=Sn.generate(),{blockhash:s,lastValidBlockHeight:y}=await a.getLatestBlockhash(),p=new Ye({feePayer:e,blockhash:s,lastValidBlockHeight:y}),c=R(j,i.publicKey,!1);p.add(H(e,c,i.publicKey,j)),p.add(ge(o,c,e,T(t,9))),p.add(On(c,e,i.publicKey)),p.partialSign(i);let u=await n(p);return await Fe({trx:u.serialize(),connection:a,errorChance:1,extraRpcs:[]})}function Me(e){return new oe({programId:new F(e.programId),keys:e.accounts.map(t=>({pubkey:new F(t.pubkey),isSigner:t.isSigner,isWritable:t.isWritable})),data:ee.from(e.data,"base64")})}async function De(e,t){return(await t.getMultipleAccountsInfo(e.map(r=>new F(r)))).reduce((r,a,o)=>{let i=e[o];if(a){let s=new At({key:new F(i),state:At.deserialize(a.data)});r.push(s)}return r},new Array)}function ve(e,t){let n=Me(e.swapInstruction),r=e.cleanupInstruction?Me(e.cleanupInstruction):null,a=e.computeBudgetInstructions?e.computeBudgetInstructions.map(Me):[],o=e.setupInstructions?e.setupInstructions.map(Me):[];return{swapInstruction:n,cleanupInstruction:r,computeBudgetInstructions:a,setupInstructions:o,addressLookupTableAddresses:e.addressLookupTableAddresses}}function Mt(e){let t=`global:${e}`;return ee.from(Cn.digest(t)).slice(0,8)}async function Rt(){let e;try{let t=await ct();e=new F(t)}catch{console.log("Relayer not found, using system program"),e=Oe.programId}return e}function Ot(e,t,n,r){let a=r.jitoAccount||"Cw8CFyM9FkoMi7K7Crf6HNQqf4uEMzpKw6QNghXLvLkY";return new Ye({feePayer:new F(e),blockhash:t,lastValidBlockHeight:n}).add(Oe.transfer({fromPubkey:new F(e),toPubkey:new F(a),lamports:r.tipLamports}))}async function Et(e,t){try{let n=[];for(let a of e)n.push(a.serialize());let r={jsonrpc:"2.0",id:1,method:"sendBundle",params:[n.map(a=>Pn.encode(a))]};await fetch(t.jitoSendUrl||"https://mainnet.block-engine.jito.wtf/api/v1/bundles",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),console.log("Send Jito bundle success")}catch(n){console.error("Send Jito bundle failed",n)}}function ze(e,t,n,r,a){let i=x.alloc(239),s=0,y=P(e.fromChain),p=x.from(E(w(t,y)));i.set(p,0),s+=32,i.writeUInt16BE(y,s),s+=2;let c=e.swiftInputContract===ue?w(pe.programId.toString(),P("solana")):w(e.swiftInputContract,y),u=x.from(E(c));i.set(u,s),s+=32;let l=P(e.toChain),m=x.from(E(w(n,l)));i.set(m,s),s+=32,i.writeUInt16BE(l,s),s+=2;let f=e.toToken.contract===ue?w(pe.programId.toString(),P("solana")):w(e.toToken.contract,l),g=x.from(E(f));i.set(g,s),s+=32,i.writeBigUInt64BE(T(e.minAmountOut,Math.min(e.toToken.decimals,8)),s),s+=8,i.writeBigUInt64BE(T(e.gasDrop,Math.min(_(e.toChain),8)),s),s+=8,i.writeBigUInt64BE(BigInt(e.cancelRelayerFee64),s),s+=8,i.writeBigUInt64BE(BigInt(e.refundRelayerFee64),s),s+=8,i.writeBigUInt64BE(BigInt(e.deadline64),s),s+=8;let b=r?x.from(E(w(r,l))):pe.programId.toBuffer();i.set(b,s),s+=32,i.writeUInt8(e.referrerBps,s),s+=1;let h=e.protocolBps;i.writeUInt8(h,s),s+=1,i.writeUInt8(e.swiftAuctionMode,s),s+=1;let I=x.from(E(a));if(i.set(I,s),s+=32,s!==239)throw new Error(`Invalid order data size: ${s}`);let A=xn.keccak256(i);return x.from(E(A))}var _t=Dn([W(8,"instruction"),W(8,"amountInMin"),xe("nativeInput"),W(8,"feeSubmit"),W(32,"destAddress"),vn("destinationChain"),W(32,"tokenOut"),W(8,"amountOutMin"),W(8,"gasDrop"),W(8,"feeCancel"),W(8,"feeRefund"),W(8,"deadline"),W(32,"refAddress"),xe("feeRateRef"),xe("feeRateMayan"),xe("auctionMode"),W(32,"randomKey")]);function Bn(e){let{quote:t}=e,n=t.swiftInputContract===ue?j:new V(t.swiftInputContract),r=P(t.toChain);if(r!==t.toToken.wChainId)throw new Error(`Destination chain ID mismatch: ${r} != ${t.toToken.wChainId}`);let a=[{pubkey:e.trader,isWritable:!1,isSigner:!0},{pubkey:e.relayer,isWritable:!0,isSigner:!0},{pubkey:e.state,isWritable:!0,isSigner:!1},{pubkey:e.stateAccount,isWritable:!0,isSigner:!1},{pubkey:e.relayerAccount,isWritable:!0,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:new V(d.FEE_MANAGER_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:new V(d.TOKEN_PROGRAM_ID),isWritable:!1,isSigner:!1},{pubkey:pe.programId,isWritable:!1,isSigner:!1}],o=x.alloc(_t.span),i=e.referrerAddress?x.from(E(w(e.referrerAddress,r))):pe.programId.toBuffer(),s=t.fromToken.contract===t.swiftInputContract?t.effectiveAmountIn:t.minMiddleAmount;return _t.encode({instruction:Mt("init_order"),amountInMin:M(T(s,t.swiftInputDecimals)),nativeInput:t.swiftInputContract===ue?1:0,feeSubmit:M(BigInt(t.submitRelayerFee64)),destAddress:x.from(E(w(e.destinationAddress,r))),destinationChain:r,tokenOut:x.from(E(w(t.toToken.contract,r))),amountOutMin:M(T(t.minAmountOut,Math.min(t.toToken.decimals,8))),gasDrop:M(T(t.gasDrop,Math.min(_(t.toChain),8))),feeCancel:M(BigInt(t.cancelRelayerFee64)),feeRefund:M(BigInt(t.refundRelayerFee64)),deadline:M(e.deadline),refAddress:i,feeRateRef:t.referrerBps,feeRateMayan:t.protocolBps,auctionMode:t.swiftAuctionMode,randomKey:e.randomKey.toBuffer()},o),new _n({keys:a,data:o,programId:new V(d.SWIFT_PROGRAM_ID)})}async function Ft(e,t,n,r,a,o={}){if(e.type!=="SWIFT")throw new Error("Unsupported quote type for Swift: "+e.type);if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let i=o.allowSwapperOffCurve||!1,s=[],y=[],p=[];p.push(d.LOOKUP_TABLE);let c=new V(d.SWIFT_PROGRAM_ID),u=new V(t),l=En.generate();if(!Number(e.deadline64))throw new Error("Swift mode requires a timeout");let m=BigInt(e.deadline64),f=ze(e,t,n,r,l.publicKey.toBuffer().toString("hex")),[g]=V.findProgramAddressSync([x.from("STATE_SOURCE"),f],c),b=R(new V(e.swiftInputContract),g,!0),h=e.swiftInputContract===ue?j:new V(e.swiftInputContract),I=e.gasless?new V(e.relayer):u,A=R(h,I,!1);if(e.fromToken.contract===e.swiftInputContract)e.suggestedPriorityFee>0&&s.push(Fn.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),s.push(H(I,b,g,h)),e.swiftInputContract===ue?s.push(pe.transfer({fromPubkey:u,toPubkey:b,lamports:T(e.effectiveAmountIn,e.fromToken.decimals)}),be(b)):s.push(ge(R(h,u,i),b,u,T(e.effectiveAmountIn,e.fromToken.decimals)));else{let C=await ke({minMiddleAmount:e.minMiddleAmount,middleToken:e.swiftInputContract,userWallet:t,slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn:e.effectiveAmountIn,depositMode:e.gasless?"SWIFT_GASLESS":"SWIFT",orderHash:`0x${f.toString("hex")}`}),S=ve(C,a);s.push(...S.computeBudgetInstructions),S.setupInstructions&&s.push(...S.setupInstructions),s.push(S.swapInstruction),S.cleanupInstruction&&s.push(S.cleanupInstruction),p.push(...S.addressLookupTableAddresses)}return s.push(Bn({quote:e,state:g,trader:u,stateAccount:b,randomKey:l.publicKey,relayerAccount:A,relayer:I,destinationAddress:n,deadline:m,referrerAddress:r})),y=await De(p,a),{instructions:s,signers:[],lookupTables:y}}function xt(e,t,n,r,a){let o=Y(Number(a)),i=P(e.fromChain),s=P(e.toChain);if(i!==o)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${i} !== ${o}`);if(!e.swiftMayanContract)throw new Error("SWIFT contract address is missing");if(e.toToken.wChainId!==s)throw new Error(`Destination chain ID mismatch: ${s} != ${e.toToken.wChainId}`);let y=e.swiftMayanContract;if(!Number(e.deadline64))throw new Error("Swift order requires timeout");let p=BigInt(e.deadline64),c=e.swiftInputContract,u=T(e.effectiveAmountIn,e.fromToken.decimals),l;r?l=w(r,s):l=w(vt.programId.toString(),1);let m=w(Wn.generate().publicKey.toString(),1),f=e.toToken.contract===We?w(vt.programId.toString(),1):w(e.toToken.contract,s),g=T(e.minAmountOut,Math.min(8,e.toToken.decimals)),b=T(e.gasDrop,Math.min(8,_(e.toChain))),h=w(n,s),I={trader:w(t,i),tokenOut:f,minAmountOut:g,gasDrop:b,cancelFee:BigInt(e.cancelRelayerFee64),refundFee:BigInt(e.refundRelayerFee64),deadline:p,destAddr:h,destChainId:s,referrerAddr:l,referrerBps:e.referrerBps||0,auctionMode:e.swiftAuctionMode,random:m};return{contractAddress:y,tokenIn:c,amountIn:u,order:I}}function Bt(e,t,n,r,a,o){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!Number.isFinite(Number(a)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");a=Number(a);let i=o||ie,s=new Dt(d.MAYAN_FORWARDER_CONTRACT,se.abi),{tokenIn:y,amountIn:p,order:c,contractAddress:u}=xt(e,t,n,r,a),l,m=new Dt(u,wt.abi);e.swiftInputContract===We?l=m.interface.encodeFunctionData("createOrderWithEth",[c]):l=m.interface.encodeFunctionData("createOrderWithToken",[y,p,c]);let f,g,b;if(e.fromToken.contract===e.swiftInputContract)e.fromToken.contract===We?(f="forwardEth",g=[u,l],b=Be(p)):(f="forwardERC20",g=[y,p,i,u,l],b=Be(0));else{let{evmSwapRouterAddress:I,evmSwapRouterCalldata:A}=e;if(!e.minMiddleAmount||!I||!A)throw new Error("Swift swap requires middle amount, router address and calldata");let C=e.fromToken.contract,S=T(e.minMiddleAmount,e.swiftInputDecimals);e.fromToken.contract===We?(f="swapAndForwardEth",g=[p,I,A,e.swiftInputContract,S,u,l],b=Be(p)):(f="swapAndForwardERC20",g=[C,p,i,I,A,e.swiftInputContract,S,u,l],b=Be(0))}return{data:s.interface.encodeFunctionData(f,g),to:d.MAYAN_FORWARDER_CONTRACT,value:b,chainId:a,_forwarder:{method:f,params:g}}}function Nn(e,t,n){if(!Number.isFinite(Number(n)))throw new Error("Invalid signer chain id");let r=T(e.effectiveAmountIn,e.swiftInputDecimals),a=BigInt(e.submitRelayerFee64);return{domain:{name:"Mayan Swift",chainId:Number(n),verifyingContract:e.swiftMayanContract},types:{CreateOrder:[{name:"OrderId",type:"bytes32"},{name:"InputAmount",type:"uint256"},{name:"SubmissionFee",type:"uint256"}]},value:{OrderId:t,InputAmount:r-a,SubmissionFee:a}}}function Wt(e,t,n,r,a,o){if(e.type!=="SWIFT")throw new Error("Quote type is not SWIFT");if(!e.gasless)throw new Error("Quote does not support gasless");if(!Number.isFinite(Number(a)))throw new Error("Invalid signer chain id");if(!Number(e.deadline64))throw new Error("Swift order requires timeout");if(e.fromToken.contract!==e.swiftInputContract)throw new Error("Swift gasless order creation does not support source swap");let{tokenIn:i,amountIn:s,order:y,contractAddress:p}=xt(e,t,n,r,Number(a)),c=P(e.fromChain),l=`0x${ze(e,t,n,r,y.random).toString("hex")}`,m=Nn(e,l,a);return{permitParams:o,orderParams:{...y,sourceChainId:c,amountIn:s,tokenIn:i,submissionFee:BigInt(e.submitRelayerFee64)},orderHash:l,orderTypedData:m}}function Ln(e,t,n,r,a,o){let i=new Je(d.MAYAN_PROGRAM_ID),[s]=Je.findProgramAddressSync([Lt.from("MAIN")],i),y=R(new Je(e.fromToken.mint),s,!0),p=T(e.effectiveAmountIn,e.fromToken.decimals),c=w(y.toString(),1),u=w(d.AUCTION_PROGRAM_ID,1),l;n?l=w(n,1):l=w(Kn.programId.toString(),1);let m=Y(Number(a)),f=P(e.fromChain),g=P(e.toChain);if(f!==m)throw new Error(`Signer chain id(${Number(a)}) and quote from chain are not same! ${f} !== ${m}`);let b=e.whMayanContract,h={mayanAddr:c,mayanChainId:1,destAddr:w(t,g),destChainId:g,auctionAddr:u,referrer:l,refundAddr:w(r,m)},I=e.toToken.contract===Gt,A={transferDeadline:BigInt(e.deadline64),swapDeadline:BigInt(e.deadline64),amountOutMin:T(e.minAmountOut,Math.min(8,e.toToken.decimals)),gasDrop:T(e.gasDrop,Math.min(8,_(e.toChain))),unwrap:I,customPayload:o?`0x${Lt.from(o).toString("hex")}`:"0x"},C={swapFee:T(e.swapRelayerFee,Math.min(8,e.fromToken.decimals)),redeemFee:T(e.redeemRelayerFee,Math.min(8,e.toToken.decimals)),refundFee:T(e.refundRelayerFee,Math.min(8,e.fromToken.decimals))},S=w(e.toToken.realOriginContractAddress,e.toToken.realOriginChainId),O=T(e.bridgeFee,18);return{amountIn:p,tokenIn:e.fromToken.contract,tokenOut:S,tokenOutWChainId:e.toToken.realOriginChainId,criteria:A,recipient:h,relayerFees:C,contractAddress:b,bridgeFee:O}}function je(e,t,n,r,a,o,i,s){let y=Y(Number(o)),p=P(e.fromChain);if(p!==y)throw new Error(`Signer chain id(${Number(o)}) and quote from chain are not same! ${p} !== ${y}`);let c=fe(e,r);if(e.type==="MCTP")return Tt(e,n,c,o,s);if(e.type==="SWIFT")return Bt(e,t,n,c,o,s);if(e.type!="WH")throw new Error("Unsupported quote type");if(!Number(e.deadline64))throw new Error("WH mode requires a timeout");let{relayerFees:u,recipient:l,tokenOut:m,tokenOutWChainId:f,criteria:g,tokenIn:b,amountIn:h,contractAddress:I,bridgeFee:A}=Ln(e,n,c,a,o,i),C=new Nt(d.MAYAN_FORWARDER_CONTRACT,se.abi),S=new Nt(I,mt.abi),O,ne,L,le=s||ie;if(b===Gt){let re=S.interface.encodeFunctionData("wrapAndSwapETH",[u,l,m,f,g]);O="forwardEth",ne=[I,re],L=Kt(h)}else{let re=S.interface.encodeFunctionData("swap",[u,l,m,f,g,b,h]);O="forwardERC20",ne=[b,h,le,I,re],L=Kt(A)}let Se=C.interface.encodeFunctionData(O,ne);return{to:d.MAYAN_FORWARDER_CONTRACT,data:Se,value:L,chainId:o,_forwarder:{method:O,params:ne}}}async function Ba(e,t,n,r,a,o,i,s){if(!a.provider)throw new Error("No provider found for signer");let y=await a.getAddress();if(y.toLowerCase()!==t.toLowerCase())throw new Error("Signer address does not match swapper address");let p=Number((await a.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless){let u=fe(e,r),l=Wt(e,t,n,u,p,o),m=await a.signTypedData(l.orderTypedData.domain,l.orderTypedData.types,l.orderTypedData.value);return await lt(l,m),l.orderHash}let c=je(e,t,n,r,y,p,s,o);if(delete c._forwarder,i?.gasPrice&&(c.gasPrice=i.gasPrice),i?.maxFeePerGas&&(c.maxFeePerGas=i.maxFeePerGas),i?.maxPriorityFeePerGas&&(c.maxPriorityFeePerGas=i.maxPriorityFeePerGas),i?.gasLimit)c.gasLimit=i.gasLimit;else if(e.type==="MCTP"||e.type==="SWIFT"){let u=await a.estimateGas(c);c.gasLimit=String(BigInt(String(u))*BigInt(110)/BigInt(100))}return c.chainId=st(e.fromChain),a.sendTransaction(c)}async function Wa(e,t,n,r,a){let o=await n.getAddress(),i=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",s=Number((await n.provider.getNetwork()).chainId);if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let y=je(e,t,i,null,o,s,a,r);delete y._forwarder;let p=await n.estimateGas(y);return p=BigInt(String(p)),e.type==="MCTP"||e.type==="SWIFT"?p*BigInt(110)/BigInt(100):p}async function Na(e,t,n,r){let a="0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",o=e.toChain==="solana"?"ENsytooJVSZyNHbxvueUeX8Am8gcNqPivVVE8USCBiy5":"0x1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a1a",i=e?.fromToken?.chainId;if(e.type==="SWIFT"&&e.gasless)return BigInt(0);let s=je(e,a,o,null,a,i,r,n);return delete s._forwarder,t.estimateGas(s)}import{Connection as qt,PublicKey as B,Keypair as Ze,SystemProgram as Ke,SYSVAR_CLOCK_PUBKEY as $n,SYSVAR_RENT_PUBKEY as Yn,TransactionInstruction as zn,ComputeBudgetProgram as Jn,MessageV0 as jn,VersionedTransaction as Zn}from"@solana/web3.js";import{blob as X,struct as Xn,u16 as qn,u8 as ce}from"@solana/buffer-layout";import{Buffer as q}from"buffer";import{ZeroAddress as Xe}from"ethers";import{PublicKey as k,Keypair as Te,SystemProgram as te,SYSVAR_CLOCK_PUBKEY as Gn,SYSVAR_RENT_PUBKEY as we,TransactionInstruction as Ae,ComputeBudgetProgram as Un}from"@solana/web3.js";import{blob as D,struct as Ie,u32 as he,u16 as jt,u8 as Z}from"@solana/buffer-layout";import{Buffer as v}from"buffer";import{PublicKey as ye}from"@solana/web3.js";import{Buffer as Ne}from"buffer";function Ut(e){let t=new ye(d.WORMHOLE_PROGRAM_ID),n=new ye(e),[r]=ye.findProgramAddressSync([Ne.from("Bridge")],t),[a]=ye.findProgramAddressSync([Ne.from("emitter")],n),[o]=ye.findProgramAddressSync([Ne.from("Sequence"),a.toBuffer()],t),[i]=ye.findProgramAddressSync([Ne.from("fee_collector")],t);return{bridgeConfig:r,sequenceKey:o,feeCollector:i,emitter:a}}var Qt=Ie([Z("instruction"),he("destinationDomain")]);function Qn(e,t,n,r,a){let o=new k(d.WORMHOLE_PROGRAM_ID),i=new k(d.TOKEN_PROGRAM_ID),s=new k(d.CCTP_CORE_PROGRAM_ID),y=new k(d.CCTP_TOKEN_PROGRAM_ID),p=new k(d.MCTP_PROGRAM_ID),c=new k(r),u=new k(n),l=R(u,e,!0),m;a&&a>BigInt(0)?m=R(u,c,!1):m=e;let f=Ce(u,t),g=Ut(d.MCTP_PROGRAM_ID),b=Te.generate(),h=Te.generate(),I=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:f.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!1},{pubkey:f.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:f.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:f.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:f.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:f.localToken,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!1},{pubkey:b.publicKey,isWritable:!0,isSigner:!0},{pubkey:f.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:g.emitter,isWritable:!1,isSigner:!1},{pubkey:g.sequenceKey,isWritable:!0,isSigner:!1},{pubkey:h.publicKey,isWritable:!0,isSigner:!0},{pubkey:g.bridgeConfig,isWritable:!0,isSigner:!1},{pubkey:g.feeCollector,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:m,isWritable:!0,isSigner:!1},{pubkey:Gn,isWritable:!1,isSigner:!1},{pubkey:we,isWritable:!1,isSigner:!1},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:y,isWritable:!1,isSigner:!1},{pubkey:te.programId,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!1,isSigner:!1}],A=v.alloc(Qt.span);return Qt.encode({instruction:11,destinationDomain:U(t)},A),{instruction:new Ae({keys:I,data:A,programId:p}),signers:[b,h]}}var Ht=Ie([Z("instruction"),he("destinationDomain")]);function Hn(e,t,n,r,a){let o=[],i=new k(d.TOKEN_PROGRAM_ID),s=new k(d.CCTP_CORE_PROGRAM_ID),y=new k(d.CCTP_TOKEN_PROGRAM_ID),p=new k(d.MCTP_PROGRAM_ID),c=new k(r),u=new k(n),l=R(u,e,!0),m=Ce(u,t),f=Te.generate(),[g]=k.findProgramAddressSync([v.from("FEESTATE"),u.toBuffer(),f.publicKey.toBytes()],p),b;a&&a>BigInt(0)?b=R(u,c,!1):b=e;let h=R(u,g,!0);o.push(H(c,h,g,u));let I=[{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:m.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!1},{pubkey:m.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:m.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:m.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:m.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:m.localToken,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!1},{pubkey:f.publicKey,isWritable:!0,isSigner:!0},{pubkey:m.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:g,isWritable:!0,isSigner:!1},{pubkey:h,isWritable:!0,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:b,isWritable:!0,isSigner:!1},{pubkey:we,isWritable:!1,isSigner:!1},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:y,isWritable:!1,isSigner:!1},{pubkey:te.programId,isWritable:!1,isSigner:!1}],A=v.alloc(Ht.span);Ht.encode({instruction:12,destinationDomain:U(t)},A);let C=new Ae({keys:I,data:A,programId:p});return o.push(C),{instructions:o,signer:f}}var Vt=Ie([Z("instruction"),he("destinationDomain")]);function Vn(e,t,n,r,a){let o=new k(d.TOKEN_PROGRAM_ID),i=new k(d.CCTP_CORE_PROGRAM_ID),s=new k(d.CCTP_TOKEN_PROGRAM_ID),y=new k(d.MCTP_PROGRAM_ID),p=new k(d.MAYAN_PROGRAM_ID),c=new k(r),u=new k(n),l=R(u,e,!0),m=Ce(u,t),f=Te.generate(),[g]=k.findProgramAddressSync([v.from("SWAP"),e.toBuffer()],y),[b]=k.findProgramAddressSync([v.from("MAYANFEE")],p),h;a&&a>BigInt(0)?h=R(u,c,!1):h=e;let I=[{pubkey:g,isWritable:!0,isSigner:!1},{pubkey:b,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!0,isSigner:!0},{pubkey:h,isWritable:!0,isSigner:!1},{pubkey:e,isWritable:!1,isSigner:!1},{pubkey:m.senderAuthority,isWritable:!1,isSigner:!1},{pubkey:l,isWritable:!0,isSigner:!1},{pubkey:m.messageTransmitter,isWritable:!0,isSigner:!1},{pubkey:m.tokenMessenger,isWritable:!1,isSigner:!1},{pubkey:m.remoteTokenMessengerKey,isWritable:!1,isSigner:!1},{pubkey:m.tokenMinter,isWritable:!1,isSigner:!1},{pubkey:m.localToken,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!0,isSigner:!1},{pubkey:f.publicKey,isWritable:!0,isSigner:!0},{pubkey:m.eventAuthToken,isWritable:!1,isSigner:!1},{pubkey:we,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!1,isSigner:!1},{pubkey:i,isWritable:!1,isSigner:!1},{pubkey:s,isWritable:!1,isSigner:!1},{pubkey:te.programId,isWritable:!1,isSigner:!1}],A=v.alloc(Vt.span);return Vt.encode({instruction:42,destinationDomain:U(t)},A),{instruction:new Ae({keys:I,data:A,programId:y}),signer:f}}var $t=Ie([Z("instruction"),D(32,"destAddress"),D(8,"amountInMin"),D(8,"gasDrop"),D(8,"feeRedeem"),D(8,"feeSolana"),he("destinationDomain"),jt("destinationChain"),Z("mode")]);function Yt(e){if(e.mode!=="WITH_FEE"&&e.mode!=="LOCK_FEE")throw new Error("Invalid mode: "+e.mode);let t=new k(e.swapperAddress),n=new k(e.mintAddress),r=R(n,e.ledger,!0),a=U(e.toChain),o=P(e.toChain),i=v.from(E(w(e.destinationAddress,o))),s=M(T(e.amountInMin,N)),y=M(T(e.gasDrop,Math.min(_(e.toChain),8))),p=M(T(e.feeRedeem,N)),c=M(e.feeSolana),u=e.referrerAddress?v.from(E(w(e.referrerAddress,o))):te.programId.toBuffer(),l=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:e.randomKey,isWritable:!1,isSigner:!1},{pubkey:we,isWritable:!1,isSigner:!1},{pubkey:te.programId,isWritable:!1,isSigner:!1},{pubkey:new k(u),isWritable:!1,isSigner:!1}],m=v.alloc($t.span);return $t.encode({instruction:40,destAddress:i,amountInMin:s,gasDrop:y,feeRedeem:p,feeSolana:c,destinationDomain:a,destinationChain:o,mode:e.mode==="WITH_FEE"?1:2},m),new Ae({keys:l,data:m,programId:new k(d.MCTP_PROGRAM_ID)})}var zt=Ie([Z("instruction"),D(32,"destAddress"),D(8,"amountInMin"),D(8,"gasDrop"),D(8,"feeRedeem"),D(8,"feeSolana"),he("destinationDomain"),jt("destinationChain"),Z("mode"),D(32,"tokenOut"),D(32,"refAddress"),D(8,"amountOutMin"),D(8,"deadline"),Z("feeRateRef")]);function Jt(e){let t=new k(e.swapperAddress),n=new k(e.mintAddress),r=R(n,e.ledger,!0),a=U(e.toChain),o=P(e.toChain),i=v.from(E(w(e.destinationAddress,o))),s=M(T(e.amountInMin,N)),y=M(T(e.gasDrop,Math.min(_(e.toChain),8))),p=M(T(e.feeRedeem,N)),c=M(e.feeSolana),u=v.from(E(w(e.tokenOut,o))),l=e.referrerAddress?v.from(E(w(e.referrerAddress,o))):te.programId.toBuffer(),m=M(T(e.amountOutMin,Math.min(8,e.tokenOutDecimals))),f=M(e.deadline),g=[{pubkey:t,isWritable:!0,isSigner:!0},{pubkey:e.ledger,isWritable:!0,isSigner:!1},{pubkey:r,isWritable:!1,isSigner:!1},{pubkey:n,isWritable:!1,isSigner:!1},{pubkey:e.randomKey,isWritable:!1,isSigner:!1},{pubkey:we,isWritable:!1,isSigner:!1},{pubkey:te.programId,isWritable:!1,isSigner:!1}],b=v.alloc(zt.span);return zt.encode({instruction:41,destAddress:i,amountInMin:s,gasDrop:y,feeRedeem:p,feeSolana:c,destinationDomain:a,destinationChain:o,mode:3,tokenOut:u,refAddress:l,amountOutMin:m,deadline:f,feeRateRef:e.feeRateRef},b),new Ae({keys:g,data:b,programId:new k(d.MCTP_PROGRAM_ID)})}async function Zt(e,t,n,r,a,o={}){let i=o?.forceSkipCctpInstructions||!1,s=o?.allowSwapperOffCurve||!1;if(e.toChain==="solana")throw new Error("Unsupported destination chain: "+e.toChain);let y=[],p=[],c=[],u=[];y.push(d.LOOKUP_TABLE);let l=new k(d.MCTP_PROGRAM_ID),m=new k(t),f=Te.generate(),g=e.deadline64?BigInt(e.deadline64):BigInt(0);if(e.hasAuction&&!Number(e.deadline64))throw new Error("Swap mode requires a timeout");let[b]=k.findProgramAddressSync([v.from("LEDGER"),m.toBytes(),f.publicKey.toBytes()],l),h=R(new k(e.mctpInputContract),b,!0),I=e.cheaperChain==="solana"?"LOCK_FEE":"WITH_FEE";if(e.fromToken.contract===e.mctpInputContract){let A=BigInt(i?e.solanaRelayerFee64:0);if(e.suggestedPriorityFee>0&&p.push(Un.setComputeUnitPrice({microLamports:e.suggestedPriorityFee})),p.push(H(m,h,b,new k(e.mctpInputContract))),p.push(ge(R(new k(e.mctpInputContract),m,s),h,m,T(e.effectiveAmountIn,N))),e.hasAuction){if(p.push(Jt({ledger:b,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:f.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:A,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin:e.effectiveAmountIn,tokenOut:e.toToken.contract,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:g,feeRateRef:e.referrerBps})),!i){let{instruction:C,signer:S}=Vn(b,e.toChain,e.mctpInputContract,t,A);p.push(C),c.push(S)}}else if(p.push(Yt({ledger:b,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:f.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:A,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin:e.effectiveAmountIn,mode:I,referrerAddress:r})),!i)if(I==="WITH_FEE"){let{instruction:C,signers:S}=Qn(b,e.toChain,e.mctpInputContract,t,A);p.push(C),c.push(...S)}else{let{instructions:C,signer:S}=Hn(b,e.toChain,e.mctpInputContract,t,A);p.push(...C),c.push(S)}}else{let A=BigInt(e.solanaRelayerFee64),C=await ke({minMiddleAmount:e.minMiddleAmount,middleToken:e.mctpInputContract,userWallet:t,userLedger:b.toString(),slippageBps:e.slippageBps,fromToken:e.fromToken.contract,amountIn:e.effectiveAmountIn,depositMode:e.hasAuction?"SWAP":I}),S=ve(C,a);p.push(...S.computeBudgetInstructions),S.setupInstructions&&p.push(...S.setupInstructions),p.push(S.swapInstruction),S.cleanupInstruction&&p.push(S.cleanupInstruction),y.push(...S.addressLookupTableAddresses),e.hasAuction?p.push(Jt({ledger:b,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:f.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:A,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin:e.minMiddleAmount,tokenOut:e.toToken.contract,tokenOutDecimals:e.toToken.decimals,referrerAddress:r,amountOutMin:e.minAmountOut,deadline:g,feeRateRef:e.referrerBps})):p.push(Yt({ledger:b,swapperAddress:t,mintAddress:e.mctpInputContract,randomKey:f.publicKey,toChain:e.toChain,destinationAddress:n,feeSolana:A,feeRedeem:e.redeemRelayerFee,gasDrop:e.gasDrop,amountInMin:e.minMiddleAmount,mode:I,referrerAddress:r}))}return u=await De(y,a),{instructions:p,signers:c,lookupTables:u}}var er=420,Xt=Xn([ce("instruction"),ce("stateNonce"),X(8,"amount"),X(8,"minAmountOut"),X(8,"deadline"),X(8,"feeSwap"),X(8,"feeReturn"),X(8,"feeCancel"),X(8,"gasDrop"),qn("destinationChain"),X(32,"destinationAddress"),ce("unwrapRedeem"),ce("unwrapRefund"),ce("mayanFeeNonce"),ce("referrerFeeNonce")]);async function tr(e,t,n,r,a,o={}){let i=fe(e,r),s=a??new qt("https://rpc.ankr.com/solana");if(e.type==="MCTP")return Zt(e,t,n,i,s,o);if(e.type==="SWIFT")return Ft(e,t,n,i,s,o);let y=[],p=new B(d.MAYAN_PROGRAM_ID),c=new B(d.TOKEN_PROGRAM_ID),u=new B(t),l=new B(d.AUCTION_PROGRAM_ID);e.suggestedPriorityFee>0&&y.push(Jn.setComputeUnitPrice({microLamports:e.suggestedPriorityFee}));let m;i?m=new B(i):m=Ke.programId;let[f,g]=B.findProgramAddressSync([q.from("MAYANFEE")],p),[b,h]=B.findProgramAddressSync([q.from("REFERRERFEE"),m.toBuffer()],p),I=Ze.generate(),A=Ze.generate(),[C,S]=B.findProgramAddressSync([q.from("V2STATE"),q.from(I.publicKey.toBytes()),q.from(A.publicKey.toBytes())],p),O=new B(e.fromToken.mint),ne=new B(e.toToken.mint),L=R(O,u),le=R(O,C,!0),[[Se,re],en,tn]=await Promise.all([s.getMultipleAccountsInfo([L,le],"finalized"),s.getMinimumBalanceForRentExemption(er),Rt()]);(!Se||Se.data.length===0)&&y.push(H(u,L,u,O)),(!re||re.data.length===0)&&y.push(H(u,le,C,O)),e.fromToken.contract===Xe&&(y.push(Ke.transfer({fromPubkey:u,toPubkey:L,lamports:T(e.effectiveAmountIn,9)})),y.push(be(L)));let qe=T(e.effectiveAmountIn,e.mintDecimals.from),de=Ze.generate();y.push(Pt(L,de.publicKey,u,qe)),y.push(Ke.transfer({fromPubkey:u,toPubkey:de.publicKey,lamports:en}));let nn=[{pubkey:de.publicKey,isWritable:!1,isSigner:!0},{pubkey:I.publicKey,isWritable:!1,isSigner:!0},{pubkey:A.publicKey,isWritable:!1,isSigner:!0},{pubkey:C,isWritable:!0,isSigner:!1},{pubkey:L,isWritable:!0,isSigner:!1},{pubkey:u,isWritable:!1,isSigner:!1},{pubkey:le,isWritable:!0,isSigner:!1},{pubkey:O,isWritable:!1,isSigner:!1},{pubkey:ne,isWritable:!1,isSigner:!1},{pubkey:l,isWritable:!1,isSigner:!1},{pubkey:m,isWritable:!1,isSigner:!1},{pubkey:f,isWritable:!1,isSigner:!1},{pubkey:b,isWritable:!1,isSigner:!1},{pubkey:de.publicKey,isWritable:!0,isSigner:!0},{pubkey:tn,isWritable:!1,isSigner:!1},{pubkey:$n,isWritable:!1,isSigner:!1},{pubkey:Yn,isWritable:!1,isSigner:!1},{pubkey:c,isWritable:!1,isSigner:!1},{pubkey:Ke.programId,isWritable:!1,isSigner:!1}],Le=P(e.toChain);if(Le===1){let Ge=await s.getAccountInfo(new B(n));if(Ge&&Ge.owner&&Ge.owner.equals(c))throw new Error("Destination address is not about token account. It should be a owner address")}let rn=q.from(E(w(n,Le))),an=T(e.minAmountOut,e.mintDecimals.to),sn=T(e.swapRelayerFee,e.mintDecimals.from),on=T(e.redeemRelayerFee,e.mintDecimals.to),pn=T(e.refundRelayerFee,e.mintDecimals.from),un=T(e.gasDrop,ut(e.toChain)),yn=e.toToken.contract===Xe,cn=e.fromToken.contract===Xe;if(!Number(e.deadline64))throw new Error("Deadline is not valid");let ln=BigInt(e.deadline64),et=q.alloc(Xt.span),dn={instruction:101,stateNonce:S,amount:M(qe),minAmountOut:M(an),deadline:M(ln),feeSwap:M(sn),feeReturn:M(on),feeCancel:M(pn),gasDrop:M(un),destinationChain:Le,destinationAddress:rn,unwrapRedeem:yn?1:0,unwrapRefund:cn?1:0,mayanFeeNonce:g,referrerFeeNonce:h};Xt.encode(dn,et);let mn=new zn({keys:nn,data:et,programId:p});return y.push(mn),{instructions:y,signers:[de,I,A],lookupTables:[]}}async function Mi(e,t,n,r,a,o,i,s,y,p){let c=o??new qt("https://rpc.ankr.com/solana"),{instructions:u,signers:l,lookupTables:m}=await tr(e,t,n,r,c,p),f=new B(t),g=e.gasless?new B(e.relayer):f,{blockhash:b,lastValidBlockHeight:h}=await o.getLatestBlockhash(),I=jn.compile({instructions:u,payerKey:g,recentBlockhash:b,addressLookupTableAccounts:m}),A=new Zn(I);A.sign(l);let C;if(!e.gasless&&y&&y.tipLamports>0&&y.signAllTransactions){let S=Ot(t,b,h,y),O=await y.signAllTransactions([A,S]);C=O[0],Et(O,y)}else C=await a(A);if(e.gasless){let S=q.from(C.serialize()).toString("base64"),{orderHash:O}=await dt(S);return{signature:O,serializedTrx:null}}return await Fe({trx:C.serialize(),connection:c,extraRpcs:i??[],errorChance:2,options:s})}export{ie as ZeroPermit,d as addresses,pt as checkSdkVersionSupport,Pt as createApproveInstruction,H as createAssociatedTokenAccountInstruction,On as createCloseAccountInstruction,Zt as createMctpFromSolanaInstructions,ge as createSplTransferInstruction,tr as createSwapFromSolanaInstructions,be as createSyncNativeInstruction,ve as decentralizeClientSwapInstructions,Rt as decideRelayer,Me as deserializeInstructionInfo,Wa as estimateQuoteRequiredGas,Na as estimateQuoteRequiredGasAprox,dr as fetchAllTokenList,fr as fetchQuote,mr as fetchTokenList,An as generateFetchQuoteUrl,De as getAddressLookupTableAccounts,T as getAmountOfFractionalAmount,Mt as getAnchorInstructionData,R as getAssociatedTokenAddress,br as getCurrentChainTime,pr as getDisplayAmount,st as getEvmChainIdByName,_ as getGasDecimal,ut as getGasDecimalsInSolana,Ot as getJitoTipTransfer,Tt as getMctpFromEvmTxPayload,fe as getQuoteSuitableReferrerAddress,M as getSafeU64Blob,ot as getSdkVersion,ct as getSuggestedRelayer,je as getSwapFromEvmTxPayload,ke as getSwapSolana,Y as getWormholeChainIdById,P as getWormholeChainIdByName,E as hexToUint8Array,Tn as isValidAptosType,w as nativeAddressToHexString,Et as sendJitoBundle,j as solMint,lt as submitSwiftEvmSwap,dt as submitSwiftSolanaSwap,Fe as submitTransactionWithRetry,Ba as swapFromEvm,Mi as swapFromSolana,Zr as unwrapSol,yt as wait,jr as wrapSol};
