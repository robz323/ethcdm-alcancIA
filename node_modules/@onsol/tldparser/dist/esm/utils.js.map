{"version":3,"file":"utils.js","sourceRoot":"","sources":["../../src/utils.ts"],"names":[],"mappings":"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","sourcesContent":["import { AccountInfo, Connection, PublicKey } from '@solana/web3.js';\nimport { BN } from 'bn.js';\nimport { sha256 } from '@ethersproject/sha2';\n\nimport {\n    ANS_PROGRAM_ID,\n    MAIN_DOMAIN_PREFIX,\n    NAME_HOUSE_PREFIX,\n    NAME_HOUSE_PROGRAM_ID,\n    NFT_RECORD_PREFIX,\n    ORIGIN_TLD,\n    SPL_TOKEN_PROGRAM_ID,\n    TLD_HOUSE_PREFIX,\n    TLD_HOUSE_PROGRAM_ID,\n    TOKEN_METADATA_PROGRAM_ID,\n} from './constants';\nimport { NameRecordHeader } from './state/name-record-header';\nimport { Tag } from './types/tag';\nimport { NftRecord } from './state/nft-record';\n\n/**\n * retrieves raw name account\n *\n * @param hashedName hashed name of the name account\n * @param nameClass defaults to pubkey::default()\n * @param parentName defaults to pubkey::default()\n */\nexport function getNameAccountKeyWithBump(\n    hashedName: Buffer,\n    nameClass?: PublicKey,\n    parentName?: PublicKey,\n): [PublicKey, number] {\n    const seeds = [\n        hashedName,\n        nameClass ? nameClass.toBuffer() : Buffer.alloc(32),\n        parentName ? parentName.toBuffer() : Buffer.alloc(32),\n    ];\n\n    return PublicKey.findProgramAddressSync(seeds, ANS_PROGRAM_ID);\n}\n\n/**\n * retrieves owner of the name account\n *\n * @param connection sol connection\n * @param nameAccountKey nameAccount to get owner of.\n */\nexport async function getNameOwner(\n    connection: Connection,\n    nameAccountKey: PublicKey,\n    tldHouse?: PublicKey,\n): Promise<PublicKey | undefined> {\n    const nameAccount = await NameRecordHeader.fromAccountAddress(connection, nameAccountKey)\n    const owner = nameAccount.owner;\n    if (!nameAccount.isValid) return undefined;\n    if (!tldHouse) return owner;\n    const [nameHouse] = findNameHouse(tldHouse);\n    const [nftRecord] = findNftRecord(nameAccountKey, nameHouse);\n    if (owner?.toBase58() !== nftRecord.toBase58()) return owner;\n    return await getMintOwner(connection, nftRecord);\n}\n\n/**\n * computes hashed name\n *\n * @param name any string or domain name.\n */\nexport async function getHashedName(name: string): Promise<Buffer> {\n    const input = NameRecordHeader.HASH_PREFIX + name;\n    const str = sha256(Buffer.from(input, 'utf8')).slice(2);\n    return Buffer.from(str, 'hex');\n}\n\n/**\n * A constant in tld house.\n *\n * get origin name account should always equal to 3mX9b4AZaQehNoQGfckVcmgmA6bkBoFcbLj9RMmMyNcU\n *\n * @param originTld\n */\nexport async function getOriginNameAccountKey(\n    originTld: string = ORIGIN_TLD,\n): Promise<PublicKey> {\n    const hashed_name = await getHashedName(originTld);\n    const [nameAccountKey] = getNameAccountKeyWithBump(\n        hashed_name,\n        undefined,\n        undefined,\n    );\n    return nameAccountKey;\n}\n\n/**\n * finds list of all name accounts for a particular user.\n *\n * @param connection sol connection\n * @param userAccount user's public key\n * @param parentAccount nameAccount's parentName\n */\nexport async function findOwnedNameAccountsForUser(\n    connection: Connection,\n    userAccount: PublicKey,\n    parentAccount: PublicKey | undefined,\n): Promise<PublicKey[]> {\n    const filters: any = [\n        {\n            memcmp: {\n                offset: 40,\n                bytes: userAccount.toBase58(),\n                encoding: 'base58',\n            },\n        },\n    ];\n\n    if (parentAccount) {\n        filters.push({\n            memcmp: {\n                offset: 8,\n                bytes: parentAccount.toBase58(),\n                encoding: 'base58',\n            },\n        });\n    }\n\n    const accounts = await connection.getProgramAccounts(ANS_PROGRAM_ID, {\n        filters: filters\n    });\n    \n    return accounts.map((a: any) => a.pubkey);\n}\n\nexport function findMainDomain(user: PublicKey) {\n    return PublicKey.findProgramAddressSync(\n        [Buffer.from(MAIN_DOMAIN_PREFIX), user.toBuffer()],\n        TLD_HOUSE_PROGRAM_ID,\n    );\n}\n\n/**\n * finds list of all tld house accounts live.\n *\n * @param connection sol connection\n */\nexport async function getAllTld(connection: Connection): Promise<\n    Array<{\n        tld: String;\n        parentAccount: PublicKey;\n    }>\n> {\n    const filters: any = [\n        {\n            memcmp: {\n                offset: 0,\n                bytes: \"iQgos3SdaVE\",\n            },\n        },\n    ];\n\n    const accounts = await connection.getProgramAccounts(TLD_HOUSE_PROGRAM_ID, {\n        filters: filters,\n    });\n\n    const tldsAndParentAccounts: {\n        tld: String;\n        parentAccount: PublicKey;\n    }[] = [];\n\n    accounts.map(({ account }) => {\n        const parentAccount = getParentAccountFromTldHouseAccountInfo(account);\n        const tld = getTldFromTldHouseAccountInfo(account);\n        tldsAndParentAccounts.push({ tld, parentAccount });\n    });\n    return tldsAndParentAccounts;\n}\n\nexport function getTldFromTldHouseAccountInfo(\n    tldHouseData: AccountInfo<Buffer>,\n) {\n    const tldStart = 8 + 32 + 32 + 32;\n    const tldBuffer = tldHouseData?.data?.subarray(tldStart);\n    const nameLength = new BN(tldBuffer?.subarray(0, 4), 'le').toNumber();\n    return tldBuffer\n        .subarray(4, 4 + nameLength)\n        .toString()\n        .replace(/\\0.*$/g, '');\n}\n\nexport function getParentAccountFromTldHouseAccountInfo(\n    tldHouseData: AccountInfo<Buffer>,\n) {\n    const parentAccountStart = 8 + 32 + 32;\n    const parentAccountBuffer = tldHouseData?.data?.subarray(\n        parentAccountStart,\n        parentAccountStart + 32,\n    );\n\n    return new PublicKey(parentAccountBuffer);\n}\n\n/**\n * finds list of all domains in parent account from tld.\n *\n * @param connection sol connection\n * @param parentAccount nameAccount's parentName\n */\nexport async function findAllDomainsForTld(\n    connection: Connection,\n    parentAccount: PublicKey,\n): Promise<PublicKey[]> {\n    const filters: any = [\n        {\n            memcmp: {\n                offset: 8,\n                bytes: parentAccount.toBase58(),\n                encoding: 'base58',\n            },\n        },\n    ];\n\n    const accounts = await connection.getProgramAccounts(ANS_PROGRAM_ID, {\n        filters: filters,\n    });\n    return accounts.map((a: any) => a.pubkey);\n}\n\nexport async function getMintOwner(\n    connection: Connection,\n    nftRecord: PublicKey,\n) {\n    try {\n        const nftRecordData = await NftRecord.fromAccountAddress(\n            connection,\n            nftRecord,\n        );\n        if (nftRecordData.tag !== Tag.ActiveRecord) return;\n        const largestAccounts = await connection.getTokenLargestAccounts(\n            nftRecordData.nftMintAccount,\n        );\n        const largestAccountInfo = await connection.getParsedAccountInfo(\n            largestAccounts.value[0].address,\n        );\n        if (!largestAccountInfo.value.data) return;\n        // @ts-ignore\n        return new PublicKey(largestAccountInfo.value.data.parsed.info.owner);\n    } catch {\n        return undefined;\n    }\n}\n\nexport function findNftRecord(\n    nameAccount: PublicKey,\n    nameHouseAccount: PublicKey,\n) {\n    return PublicKey.findProgramAddressSync(\n        [\n            Buffer.from(NFT_RECORD_PREFIX),\n            nameHouseAccount.toBuffer(),\n            nameAccount.toBuffer(),\n        ],\n        NAME_HOUSE_PROGRAM_ID,\n    );\n}\n\nexport function findTldHouse(tldString: string) {\n    tldString = tldString.toLowerCase();\n    return PublicKey.findProgramAddressSync(\n        [Buffer.from(TLD_HOUSE_PREFIX), Buffer.from(tldString)],\n        TLD_HOUSE_PROGRAM_ID,\n    );\n}\n\nexport function findNameHouse(tldHouse: PublicKey) {\n    return PublicKey.findProgramAddressSync(\n        [Buffer.from(NAME_HOUSE_PREFIX), tldHouse.toBuffer()],\n        NAME_HOUSE_PROGRAM_ID,\n    );\n}\n\nexport const findMetadataAddress = (mint: PublicKey): PublicKey => {\n    return PublicKey.findProgramAddressSync(\n        [\n            Buffer.from('metadata'),\n            TOKEN_METADATA_PROGRAM_ID.toBuffer(),\n            mint.toBuffer(),\n        ],\n        TOKEN_METADATA_PROGRAM_ID,\n    )[0];\n};\n\nexport async function performReverseLookupBatched(\n    connection: Connection,\n    nameAccounts: PublicKey[],\n    tldHouse: PublicKey,\n): Promise<(string | undefined)[]> {\n    const promises = nameAccounts.map(async nameAccount => {\n        const reverseLookupHashedName = await getHashedName(\n            nameAccount.toBase58(),\n        );\n        const [reverseLookUpAccount] = getNameAccountKeyWithBump(\n            reverseLookupHashedName,\n            tldHouse,\n            undefined,\n        );\n        return reverseLookUpAccount;\n    });\n    const reverseLookUpAccounts: PublicKey[] = await Promise.all(promises);\n    const reverseLookupAccountInfos = await connection.getMultipleAccountsInfo(\n        reverseLookUpAccounts,\n    );\n\n    return reverseLookupAccountInfos.map(reverseLookupAccountInfo => {\n        const domain = reverseLookupAccountInfo?.data\n            .subarray(\n                NameRecordHeader.byteSize,\n                reverseLookupAccountInfo?.data.length,\n            )\n            .toString();\n        return domain;\n    });\n}\n\nexport function delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n\nexport const getParsedAllDomainsNftAccountsByOwner = async (\n    owner: PublicKey,\n    connection: Connection,\n    expectedCreator: PublicKey,\n) => {\n    const { value: splAccounts } =\n        await connection.getParsedTokenAccountsByOwner(owner, {\n            programId: SPL_TOKEN_PROGRAM_ID,\n        });\n\n    const nftAccounts = splAccounts\n        .filter(t => {\n            const amount = t.account?.data?.parsed?.info?.tokenAmount?.uiAmount;\n            const decimals =\n                t.account?.data?.parsed?.info?.tokenAmount?.decimals;\n            return decimals === 0 && amount === 1;\n        })\n        .map(t => {\n            const address = t.account?.data?.parsed?.info?.mint;\n            return address;\n        });\n    const ownerDomains = await getOwnedDomains(\n        nftAccounts,\n        connection,\n        expectedCreator,\n    );\n\n    return ownerDomains;\n};\n\nconst getOwnedDomains = async (\n    nftAddresses: string[],\n    connection: Connection,\n    expectedCreator: PublicKey,\n) => {\n    const ownedDomains: string[] = [];\n    const verifiedCreatorByteOffset = 326;\n    const verifiedCreatorVerfiiedByteOffset = 326;\n\n    if (nftAddresses.length > 100) {\n        while (nftAddresses.length > 0) {\n            let nftMetadataKeys = nftAddresses\n                .splice(0, 100)\n                .map((mint: string) =>\n                    findMetadataAddress(new PublicKey(mint)),\n                );\n            const nftsMetadata = await connection.getMultipleAccountsInfo(\n                nftMetadataKeys,\n            );\n            for (const nftMetadata of nftsMetadata) {\n                if (nftMetadata) {\n                    const verifiedCreatorAddress = new PublicKey(\n                        nftMetadata.data.subarray(\n                            verifiedCreatorByteOffset,\n                            verifiedCreatorByteOffset + 32,\n                        ),\n                    );\n                    const isVerified = Boolean(\n                        nftMetadata.data.subarray(\n                            verifiedCreatorVerfiiedByteOffset,\n                            verifiedCreatorVerfiiedByteOffset + 1,\n                        ),\n                    );\n                    if (\n                        isVerified &&\n                        verifiedCreatorAddress.toString() ===\n                            expectedCreator.toString()\n                    ) {\n                        const domainName = nftMetadata.data\n                            .subarray(66, 101)\n                            .toString()\n                            .replace(/\\u0000/g, '');\n                        ownedDomains.push(domainName);\n                    }\n                }\n            }\n        }\n    } else {\n        let nftMetadataKeys = nftAddresses.map((mint: string) =>\n            findMetadataAddress(new PublicKey(mint)),\n        );\n        const nftsMetadata = await connection.getMultipleAccountsInfo(\n            nftMetadataKeys,\n        );\n        for (const nftMetadata of nftsMetadata) {\n            if (nftMetadata) {\n                const verifiedCreatorAddress = new PublicKey(\n                    nftMetadata.data.subarray(\n                        verifiedCreatorByteOffset,\n                        verifiedCreatorByteOffset + 32,\n                    ),\n                );\n                const isVerified = Boolean(\n                    nftMetadata.data.subarray(\n                        verifiedCreatorVerfiiedByteOffset,\n                        verifiedCreatorVerfiiedByteOffset + 1,\n                    ),\n                );\n                if (\n                    isVerified &&\n                    verifiedCreatorAddress.toString() ===\n                        expectedCreator.toString()\n                ) {\n                    const domainName = nftMetadata.data\n                        .subarray(66, 101)\n                        .toString()\n                        .replace(/\\u0000/g, '');\n                    ownedDomains.push(domainName);\n                }\n            }\n        }\n    }\n\n    return ownedDomains;\n};\n\nexport function splitDomainTld(domain: string) {\n    const parts = domain.split('.');\n    let tld = '',\n        domainName = '',\n        subdomain = '';\n\n    if (parts.length === 1) {\n        domainName = parts[0];\n    } else {\n        tld = '.' + parts[parts.length - 1];\n        domainName = parts[parts.length - 2];\n        subdomain = parts.slice(0, parts.length - 2).join('.');\n    }\n\n    return [tld, domainName, subdomain];\n}\n"]}