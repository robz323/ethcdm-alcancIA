var zi=Object.defineProperty,Hi=Object.defineProperties;var Zi=Object.getOwnPropertyDescriptors;var bt=Object.getOwnPropertySymbols;var Rn=Object.prototype.hasOwnProperty,Mn=Object.prototype.propertyIsEnumerable;var Ln=(n,e,t)=>e in n?zi(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,_=(n,e)=>{for(var t in e||(e={}))Rn.call(e,t)&&Ln(n,t,e[t]);if(bt)for(var t of bt(e))Mn.call(e,t)&&Ln(n,t,e[t]);return n},H=(n,e)=>Hi(n,Zi(e));var Ae=(n,e)=>{var t={};for(var i in n)Rn.call(n,i)&&e.indexOf(i)<0&&(t[i]=n[i]);if(n!=null&&bt)for(var i of bt(n))e.indexOf(i)<0&&Mn.call(n,i)&&(t[i]=n[i]);return t};import{PublicKey as B}from"@solana/web3.js";import{AccountLayout as ds,NATIVE_MINT as Ht,TOKEN_PROGRAM_ID as fe}from"@solana/spl-token";import ke from"bn.js";var De=9e15,Se=1e9,Zt="0123456789abcdef",yt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",wt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Yt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-De,maxE:De,crypto:!1},vn,Pe,L=!0,Pt="[DecimalError] ",Ie=Pt+"Invalid argument: ",Dn=Pt+"Precision limit exceeded",_n=Pt+"crypto unavailable",Vn="[object Decimal]",ie=Math.floor,$=Math.pow,Yi=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ji=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Qi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Wn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,me=1e7,K=7,Ji=9007199254740991,$i=yt.length-1,jt=wt.length-1,w={toStringTag:Vn};w.absoluteValue=w.abs=function(){var n=new this.constructor(this);return n.s<0&&(n.s=1),I(n)};w.ceil=function(){return I(new this.constructor(this),this.e+1,2)};w.clampedTo=w.clamp=function(n,e){var t,i=this,r=i.constructor;if(n=new r(n),e=new r(e),!n.s||!e.s)return new r(NaN);if(n.gt(e))throw Error(Ie+e);return t=i.cmp(n),t<0?n:i.cmp(e)>0?e:new r(i)};w.comparedTo=w.cmp=function(n){var e,t,i,r,o=this,s=o.d,a=(n=new o.constructor(n)).d,u=o.s,c=n.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==n.e)return o.e>n.e^u<0?1:-1;for(i=s.length,r=a.length,e=0,t=i<r?i:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return i===r?0:i>r^u<0?1:-1};w.cosine=w.cos=function(){var n,e,t=this,i=t.constructor;return t.d?t.d[0]?(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+K,i.rounding=1,t=er(i,zn(i,t)),i.precision=n,i.rounding=e,I(Pe==2||Pe==3?t.neg():t,n,e,!0)):new i(1):new i(NaN)};w.cubeRoot=w.cbrt=function(){var n,e,t,i,r,o,s,a,u,c,m=this,l=m.constructor;if(!m.isFinite()||m.isZero())return new l(m);for(L=!1,o=m.s*$(m.s*m,1/3),!o||Math.abs(o)==1/0?(t=ne(m.d),n=m.e,(o=(n-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=$(t,1/3),n=ie((n+1)/3)-(n%3==(n<0?-1:2)),o==1/0?t="5e"+n:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+n),i=new l(t),i.s=m.s):i=new l(o.toString()),s=(n=l.precision)+3;;)if(a=i,u=a.times(a).times(a),c=u.plus(m),i=U(c.plus(m).times(a),c.plus(u),s+2,1),ne(a.d).slice(0,s)===(t=ne(i.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,n+1,0),a.times(a).times(a).eq(m))){i=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(i,n+1,1),e=!i.times(i).times(i).eq(m));break}return L=!0,I(i,n,l.rounding,e)};w.decimalPlaces=w.dp=function(){var n,e=this.d,t=NaN;if(e){if(n=e.length-1,t=(n-ie(this.e/K))*K,n=e[n],n)for(;n%10==0;n/=10)t--;t<0&&(t=0)}return t};w.dividedBy=w.div=function(n){return U(this,new this.constructor(n))};w.dividedToIntegerBy=w.divToInt=function(n){var e=this,t=e.constructor;return I(U(e,new t(n),0,1,1),t.precision,t.rounding)};w.equals=w.eq=function(n){return this.cmp(n)===0};w.floor=function(){return I(new this.constructor(this),this.e+1,3)};w.greaterThan=w.gt=function(n){return this.cmp(n)>0};w.greaterThanOrEqualTo=w.gte=function(n){var e=this.cmp(n);return e==1||e===0};w.hyperbolicCosine=w.cosh=function(){var n,e,t,i,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,i=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(n=Math.ceil(r/3),e=(1/ht(4,n)).toString()):(n=16,e="2.3283064365386962890625e-10"),o=_e(s,1,o.times(e),new s(1),!0);for(var u,c=n,m=new s(8);c--;)u=o.times(o),o=a.minus(u.times(m.minus(u.times(m))));return I(o,s.precision=t,s.rounding=i,!0)};w.hyperbolicSine=w.sinh=function(){var n,e,t,i,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,i=r.d.length,i<3)r=_e(o,2,r,r,!0);else{n=1.4*Math.sqrt(i),n=n>16?16:n|0,r=r.times(1/ht(5,n)),r=_e(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);n--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};w.hyperbolicTangent=w.tanh=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+7,i.rounding=1,U(t.sinh(),t.cosh(),i.precision=n,i.rounding=e)):new i(t.s)};w.inverseCosine=w.acos=function(){var n,e=this,t=e.constructor,i=e.abs().cmp(1),r=t.precision,o=t.rounding;return i!==-1?i===0?e.isNeg()?le(t,r,o):new t(0):new t(NaN):e.isZero()?le(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),n=le(t,r+4,o).times(.5),t.precision=r,t.rounding=o,n.minus(e))};w.inverseHyperbolicCosine=w.acosh=function(){var n,e,t=this,i=t.constructor;return t.lte(1)?new i(t.eq(1)?0:NaN):t.isFinite()?(n=i.precision,e=i.rounding,i.precision=n+Math.max(Math.abs(t.e),t.sd())+4,i.rounding=1,L=!1,t=t.times(t).minus(1).sqrt().plus(t),L=!0,i.precision=n,i.rounding=e,t.ln()):new i(t)};w.inverseHyperbolicSine=w.asinh=function(){var n,e,t=this,i=t.constructor;return!t.isFinite()||t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+2*Math.max(Math.abs(t.e),t.sd())+6,i.rounding=1,L=!1,t=t.times(t).plus(1).sqrt().plus(t),L=!0,i.precision=n,i.rounding=e,t.ln())};w.inverseHyperbolicTangent=w.atanh=function(){var n,e,t,i,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(n=o.precision,e=o.rounding,i=r.sd(),Math.max(i,n)<2*-r.e-1?I(new o(r),n,e,!0):(o.precision=t=i-r.e,r=U(r.plus(1),new o(1).minus(r),t+n,1),o.precision=n+4,o.rounding=1,r=r.ln(),o.precision=n,o.rounding=e,r.times(.5))):new o(NaN)};w.inverseSine=w.asin=function(){var n,e,t,i,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,i=o.rounding,e!==-1?e===0?(n=le(o,t+4,i).times(.5),n.s=r.s,n):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=i,r.times(2)))};w.inverseTangent=w.atan=function(){var n,e,t,i,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding;if(c.isFinite()){if(c.isZero())return new m(c);if(c.abs().eq(1)&&l+4<=jt)return s=le(m,l+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new m(NaN);if(l+4<=jt)return s=le(m,l+4,d).times(.5),s.s=c.s,s}for(m.precision=a=l+10,m.rounding=1,t=Math.min(28,a/K+2|0),n=t;n;--n)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(L=!1,e=Math.ceil(a/K),i=1,u=c.times(c),s=new m(c),r=c;n!==-1;)if(r=r.times(u),o=s.minus(r.div(i+=2)),r=r.times(u),s=o.plus(r.div(i+=2)),s.d[e]!==void 0)for(n=e;s.d[n]===o.d[n]&&n--;);return t&&(s=s.times(2<<t-1)),L=!0,I(s,m.precision=l,m.rounding=d,!0)};w.isFinite=function(){return!!this.d};w.isInteger=w.isInt=function(){return!!this.d&&ie(this.e/K)>this.d.length-2};w.isNaN=function(){return!this.s};w.isNegative=w.isNeg=function(){return this.s<0};w.isPositive=w.isPos=function(){return this.s>0};w.isZero=function(){return!!this.d&&this.d[0]===0};w.lessThan=w.lt=function(n){return this.cmp(n)<0};w.lessThanOrEqualTo=w.lte=function(n){return this.cmp(n)<1};w.logarithm=w.log=function(n){var e,t,i,r,o,s,a,u,c=this,m=c.constructor,l=m.precision,d=m.rounding,p=5;if(n==null)n=new m(10),e=!0;else{if(n=new m(n),t=n.d,n.s<0||!t||!t[0]||n.eq(1))return new m(NaN);e=n.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new m(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(L=!1,a=l+p,s=xe(c,a),i=e?At(m,a+10):xe(n,a),u=U(s,i,a,1),Ze(u.d,r=l,d))do if(a+=10,s=xe(c,a),i=e?At(m,a+10):xe(n,a),u=U(s,i,a,1),!o){+ne(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,l+1,0));break}while(Ze(u.d,r+=10,d));return L=!0,I(u,l,d)};w.minus=w.sub=function(n){var e,t,i,r,o,s,a,u,c,m,l,d,p=this,y=p.constructor;if(n=new y(n),!p.d||!n.d)return!p.s||!n.s?n=new y(NaN):p.d?n.s=-n.s:n=new y(n.d||p.s!==n.s?p:NaN),n;if(p.s!=n.s)return n.s=-n.s,p.plus(n);if(c=p.d,d=n.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])n.s=-n.s;else if(c[0])n=new y(p);else return new y(u===3?-0:0);return L?I(n,a,u):n}if(t=ie(n.e/K),m=ie(p.e/K),c=c.slice(),o=m-t,o){for(l=o<0,l?(e=c,o=-o,s=d.length):(e=d,t=m,s=c.length),i=Math.max(Math.ceil(a/K),s)+2,o>i&&(o=i,e.length=1),e.reverse(),i=o;i--;)e.push(0);e.reverse()}else{for(i=c.length,s=d.length,l=i<s,l&&(s=i),i=0;i<s;i++)if(c[i]!=d[i]){l=c[i]<d[i];break}o=0}for(l&&(e=c,c=d,d=e,n.s=-n.s),s=c.length,i=d.length-s;i>0;--i)c[s++]=0;for(i=d.length;i>o;){if(c[--i]<d[i]){for(r=i;r&&c[--r]===0;)c[r]=me-1;--c[r],c[i]+=me}c[i]-=d[i]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(n.d=c,n.e=kt(c,t),L?I(n,a,u):n):new y(u===3?-0:0)};w.modulo=w.mod=function(n){var e,t=this,i=t.constructor;return n=new i(n),!t.d||!n.s||n.d&&!n.d[0]?new i(NaN):!n.d||t.d&&!t.d[0]?I(new i(t),i.precision,i.rounding):(L=!1,i.modulo==9?(e=U(t,n.abs(),0,3,1),e.s*=n.s):e=U(t,n,0,i.modulo,1),e=e.times(n),L=!0,t.minus(e))};w.naturalExponential=w.exp=function(){return Qt(this)};w.naturalLogarithm=w.ln=function(){return xe(this)};w.negated=w.neg=function(){var n=new this.constructor(this);return n.s=-n.s,I(n)};w.plus=w.add=function(n){var e,t,i,r,o,s,a,u,c,m,l=this,d=l.constructor;if(n=new d(n),!l.d||!n.d)return!l.s||!n.s?n=new d(NaN):l.d||(n=new d(n.d||l.s===n.s?l:NaN)),n;if(l.s!=n.s)return n.s=-n.s,l.minus(n);if(c=l.d,m=n.d,a=d.precision,u=d.rounding,!c[0]||!m[0])return m[0]||(n=new d(l)),L?I(n,a,u):n;if(o=ie(l.e/K),i=ie(n.e/K),c=c.slice(),r=o-i,r){for(r<0?(t=c,r=-r,s=m.length):(t=m,i=o,s=c.length),o=Math.ceil(a/K),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=m.length,s-r<0&&(r=s,t=m,m=c,c=t),e=0;r;)e=(c[--r]=c[r]+m[r]+e)/me|0,c[r]%=me;for(e&&(c.unshift(e),++i),s=c.length;c[--s]==0;)c.pop();return n.d=c,n.e=kt(c,i),L?I(n,a,u):n};w.precision=w.sd=function(n){var e,t=this;if(n!==void 0&&n!==!!n&&n!==1&&n!==0)throw Error(Ie+n);return t.d?(e=qn(t.d),n&&t.e+1>e&&(e=t.e+1)):e=NaN,e};w.round=function(){var n=this,e=n.constructor;return I(new e(n),n.e+1,e.rounding)};w.sine=w.sin=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+Math.max(t.e,t.sd())+K,i.rounding=1,t=nr(i,zn(i,t)),i.precision=n,i.rounding=e,I(Pe>2?t.neg():t,n,e,!0)):new i(NaN)};w.squareRoot=w.sqrt=function(){var n,e,t,i,r,o,s=this,a=s.d,u=s.e,c=s.s,m=s.constructor;if(c!==1||!a||!a[0])return new m(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(L=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ne(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ie((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),i=new m(e)):i=new m(c.toString()),t=(u=m.precision)+3;;)if(o=i,i=o.plus(U(s,o,t+2,1)).times(.5),ne(o.d).slice(0,t)===(e=ne(i.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){i=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(i,u+1,1),n=!i.times(i).eq(s));break}return L=!0,I(i,u,m.rounding,n)};w.tangent=w.tan=function(){var n,e,t=this,i=t.constructor;return t.isFinite()?t.isZero()?new i(t):(n=i.precision,e=i.rounding,i.precision=n+10,i.rounding=1,t=t.sin(),t.s=1,t=U(t,new i(1).minus(t.times(t)).sqrt(),n+10,0),i.precision=n,i.rounding=e,I(Pe==2||Pe==4?t.neg():t,n,e,!0)):new i(NaN)};w.times=w.mul=function(n){var e,t,i,r,o,s,a,u,c,m=this,l=m.constructor,d=m.d,p=(n=new l(n)).d;if(n.s*=m.s,!d||!d[0]||!p||!p[0])return new l(!n.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?n.s/0:n.s*0);for(t=ie(m.e/K)+ie(n.e/K),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,i=s;i--;)o.push(0);for(i=c;--i>=0;){for(e=0,r=u+i;r>i;)a=o[r]+p[i]*d[r-i-1]+e,o[r--]=a%me|0,e=a/me|0;o[r]=(o[r]+e)%me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),n.d=o,n.e=kt(o,t),L?I(n,l.precision,l.rounding):n};w.toBinary=function(n,e){return $t(this,2,n,e)};w.toDecimalPlaces=w.toDP=function(n,e){var t=this,i=t.constructor;return t=new i(t),n===void 0?t:(oe(n,0,Se),e===void 0?e=i.rounding:oe(e,0,8),I(t,n+t.e+1,e))};w.toExponential=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=be(i,!0):(oe(n,0,Se),e===void 0?e=r.rounding:oe(e,0,8),i=I(new r(i),n+1,e),t=be(i,!0,n+1)),i.isNeg()&&!i.isZero()?"-"+t:t};w.toFixed=function(n,e){var t,i,r=this,o=r.constructor;return n===void 0?t=be(r):(oe(n,0,Se),e===void 0?e=o.rounding:oe(e,0,8),i=I(new o(r),n+r.e+1,e),t=be(i,!1,n+i.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};w.toFraction=function(n){var e,t,i,r,o,s,a,u,c,m,l,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),i=u=new f(0),e=new f(i),o=e.e=qn(y)-p.e-1,s=o%K,e.d[0]=$(10,s<0?K+s:s),n==null)n=o>0?e:c;else{if(a=new f(n),!a.isInt()||a.lt(c))throw Error(Ie+a);n=a.gt(e)?o>0?e:c:a}for(L=!1,a=new f(ne(y)),m=f.precision,f.precision=o=y.length*K*2;l=U(a,e,0,1,1),r=t.plus(l.times(i)),r.cmp(n)!=1;)t=i,i=r,r=c,c=u.plus(l.times(r)),u=r,r=e,e=a.minus(l.times(r)),a=r;return r=U(n.minus(t),i,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(i)),u.s=c.s=p.s,d=U(c,i,o,1).minus(p).abs().cmp(U(u,t,o,1).minus(p).abs())<1?[c,i]:[u,t],f.precision=m,L=!0,d};w.toHexadecimal=w.toHex=function(n,e){return $t(this,16,n,e)};w.toNearest=function(n,e){var t=this,i=t.constructor;if(t=new i(t),n==null){if(!t.d)return t;n=new i(1),e=i.rounding}else{if(n=new i(n),e===void 0?e=i.rounding:oe(e,0,8),!t.d)return n.s?t:n;if(!n.d)return n.s&&(n.s=t.s),n}return n.d[0]?(L=!1,t=U(t,n,0,e,1).times(n),L=!0,I(t)):(n.s=t.s,t=n),t};w.toNumber=function(){return+this};w.toOctal=function(n,e){return $t(this,8,n,e)};w.toPower=w.pow=function(n){var e,t,i,r,o,s,a=this,u=a.constructor,c=+(n=new u(n));if(!a.d||!n.d||!a.d[0]||!n.d[0])return new u($(+a,c));if(a=new u(a),a.eq(1))return a;if(i=u.precision,o=u.rounding,n.eq(1))return I(a,i,o);if(e=ie(n.e/K),e>=n.d.length-1&&(t=c<0?-c:c)<=Ji)return r=Gn(u,a,t,i),n.s<0?new u(1).div(r):I(r,i,o);if(s=a.s,s<0){if(e<n.d.length-1)return new u(NaN);if((n.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=$(+a,c),e=t==0||!isFinite(t)?ie(c*(Math.log("0."+ne(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(L=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Qt(n.times(xe(a,i+t)),i),r.d&&(r=I(r,i+5,1),Ze(r.d,i,o)&&(e=i+10,r=I(Qt(n.times(xe(a,e+t)),e),e+5,1),+ne(r.d).slice(i+1,i+15)+1==1e14&&(r=I(r,i+1,0)))),r.s=s,L=!0,u.rounding=o,I(r,i,o))};w.toPrecision=function(n,e){var t,i=this,r=i.constructor;return n===void 0?t=be(i,i.e<=r.toExpNeg||i.e>=r.toExpPos):(oe(n,1,Se),e===void 0?e=r.rounding:oe(e,0,8),i=I(new r(i),n,e),t=be(i,n<=i.e||i.e<=r.toExpNeg,n)),i.isNeg()&&!i.isZero()?"-"+t:t};w.toSignificantDigits=w.toSD=function(n,e){var t=this,i=t.constructor;return n===void 0?(n=i.precision,e=i.rounding):(oe(n,1,Se),e===void 0?e=i.rounding:oe(e,0,8)),I(new i(t),n,e)};w.toString=function(){var n=this,e=n.constructor,t=be(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()&&!n.isZero()?"-"+t:t};w.truncated=w.trunc=function(){return I(new this.constructor(this),this.e+1,1)};w.valueOf=w.toJSON=function(){var n=this,e=n.constructor,t=be(n,n.e<=e.toExpNeg||n.e>=e.toExpPos);return n.isNeg()?"-"+t:t};function ne(n){var e,t,i,r=n.length-1,o="",s=n[0];if(r>0){for(o+=s,e=1;e<r;e++)i=n[e]+"",t=K-i.length,t&&(o+=Be(t)),o+=i;s=n[e],i=s+"",t=K-i.length,t&&(o+=Be(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function oe(n,e,t){if(n!==~~n||n<e||n>t)throw Error(Ie+n)}function Ze(n,e,t,i){var r,o,s,a;for(o=n[0];o>=10;o/=10)--e;return--e<0?(e+=K,r=0):(r=Math.ceil((e+1)/K),e%=K),o=$(10,K-e),a=n[r]%o|0,i==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(n[r+1]/o/100|0)==$(10,e-2)-1||(a==o/2||a==0)&&(n[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(i||t<4)&&a==9999||!i&&t>3&&a==4999):s=((i||t<4)&&a+1==o||!i&&t>3&&a+1==o/2)&&(n[r+1]/o/1e3|0)==$(10,e-3)-1,s}function gt(n,e,t){for(var i,r=[0],o,s=0,a=n.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Zt.indexOf(n.charAt(s++)),i=0;i<r.length;i++)r[i]>t-1&&(r[i+1]===void 0&&(r[i+1]=0),r[i+1]+=r[i]/t|0,r[i]%=t)}return r.reverse()}function er(n,e){var t,i,r;if(e.isZero())return e;i=e.d.length,i<32?(t=Math.ceil(i/3),r=(1/ht(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),n.precision+=t,e=_e(n,1,e.times(r),new n(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return n.precision-=t,e}var U=function(){function n(i,r,o){var s,a=0,u=i.length;for(i=i.slice();u--;)s=i[u]*r+a,i[u]=s%o|0,a=s/o|0;return a&&i.unshift(a),i}function e(i,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(i[a]!=r[a]){u=i[a]>r[a]?1:-1;break}return u}function t(i,r,o,s){for(var a=0;o--;)i[o]-=a,a=i[o]<r[o]?1:0,i[o]=a*s+i[o]-r[o];for(;!i[0]&&i.length>1;)i.shift()}return function(i,r,o,s,a,u){var c,m,l,d,p,y,f,b,P,k,A,g,T,h,N,M,v,F,E,D,W=i.constructor,J=i.s==r.s?1:-1,G=i.d,V=r.d;if(!G||!G[0]||!V||!V[0])return new W(!i.s||!r.s||(G?V&&G[0]==V[0]:!V)?NaN:G&&G[0]==0||!V?J*0:J/0);for(u?(p=1,m=i.e-r.e):(u=me,p=K,m=ie(i.e/p)-ie(r.e/p)),E=V.length,v=G.length,P=new W(J),k=P.d=[],l=0;V[l]==(G[l]||0);l++);if(V[l]>(G[l]||0)&&m--,o==null?(h=o=W.precision,s=W.rounding):a?h=o+(i.e-r.e)+1:h=o,h<0)k.push(1),y=!0;else{if(h=h/p+2|0,l=0,E==1){for(d=0,V=V[0],h++;(l<v||d)&&h--;l++)N=d*u+(G[l]||0),k[l]=N/V|0,d=N%V|0;y=d||l<v}else{for(d=u/(V[0]+1)|0,d>1&&(V=n(V,d,u),G=n(G,d,u),E=V.length,v=G.length),M=E,A=G.slice(0,E),g=A.length;g<E;)A[g++]=0;D=V.slice(),D.unshift(0),F=V[0],V[1]>=u/2&&++F;do d=0,c=e(V,A,E,g),c<0?(T=A[0],E!=g&&(T=T*u+(A[1]||0)),d=T/F|0,d>1?(d>=u&&(d=u-1),f=n(V,d,u),b=f.length,g=A.length,c=e(f,A,b,g),c==1&&(d--,t(f,E<b?D:V,b,u))):(d==0&&(c=d=1),f=V.slice()),b=f.length,b<g&&f.unshift(0),t(A,f,g,u),c==-1&&(g=A.length,c=e(V,A,E,g),c<1&&(d++,t(A,E<g?D:V,g,u))),g=A.length):c===0&&(d++,A=[0]),k[l++]=d,c&&A[0]?A[g++]=G[M]||0:(A=[G[M]],g=1);while((M++<v||A[0]!==void 0)&&h--);y=A[0]!==void 0}k[0]||k.shift()}if(p==1)P.e=m,vn=y;else{for(l=1,d=k[0];d>=10;d/=10)l++;P.e=l+m*p-1,I(P,a?o+P.e+1:o,s,y)}return P}}();function I(n,e,t,i){var r,o,s,a,u,c,m,l,d,p=n.constructor;e:if(e!=null){if(l=n.d,!l)return n;for(r=1,a=l[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=K,s=e,m=l[d=0],u=m/$(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/K),a=l.length,d>=a)if(i){for(;a++<=d;)l.push(0);m=u=0,r=1,o%=K,s=o-K+1}else break e;else{for(m=a=l[d],r=1;a>=10;a/=10)r++;o%=K,s=o-K+r,u=s<0?0:m/$(10,r-s-1)%10|0}if(i=i||e<0||l[d+1]!==void 0||(s<0?m:m%$(10,r-s-1)),c=t<4?(u||i)&&(t==0||t==(n.s<0?3:2)):u>5||u==5&&(t==4||i||t==6&&(o>0?s>0?m/$(10,r-s):0:l[d-1])%10&1||t==(n.s<0?8:7)),e<1||!l[0])return l.length=0,c?(e-=n.e+1,l[0]=$(10,(K-e%K)%K),n.e=-e||0):l[0]=n.e=0,n;if(o==0?(l.length=d,a=1,d--):(l.length=d+1,a=$(10,K-o),l[d]=s>0?(m/$(10,r-s)%$(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=l[0];s>=10;s/=10)o++;for(s=l[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(n.e++,l[0]==me&&(l[0]=1));break}else{if(l[d]+=a,l[d]!=me)break;l[d--]=0,a=1}for(o=l.length;l[--o]===0;)l.pop()}return L&&(n.e>p.maxE?(n.d=null,n.e=NaN):n.e<p.minE&&(n.e=0,n.d=[0])),n}function be(n,e,t){if(!n.isFinite())return Xn(n);var i,r=n.e,o=ne(n.d),s=o.length;return e?(t&&(i=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Be(i):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(n.e<0?"e":"e+")+n.e):r<0?(o="0."+Be(-r-1)+o,t&&(i=t-s)>0&&(o+=Be(i))):r>=s?(o+=Be(r+1-s),t&&(i=t-r-1)>0&&(o=o+"."+Be(i))):((i=r+1)<s&&(o=o.slice(0,i)+"."+o.slice(i)),t&&(i=t-s)>0&&(r+1===s&&(o+="."),o+=Be(i))),o}function kt(n,e){var t=n[0];for(e*=K;t>=10;t/=10)e++;return e}function At(n,e,t){if(e>$i)throw L=!0,t&&(n.precision=t),Error(Dn);return I(new n(yt),e,1,!0)}function le(n,e,t){if(e>jt)throw Error(Dn);return I(new n(wt),e,t,!0)}function qn(n){var e=n.length-1,t=e*K+1;if(e=n[e],e){for(;e%10==0;e/=10)t--;for(e=n[0];e>=10;e/=10)t++}return t}function Be(n){for(var e="";n--;)e+="0";return e}function Gn(n,e,t,i){var r,o=new n(1),s=Math.ceil(i/K+4);for(L=!1;;){if(t%2&&(o=o.times(e),Fn(o.d,s)&&(r=!0)),t=ie(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Fn(e.d,s)}return L=!0,o}function On(n){return n.d[n.d.length-1]&1}function Un(n,e,t){for(var i,r=new n(e[0]),o=0;++o<e.length;)if(i=new n(e[o]),i.s)r[t](i)&&(r=i);else{r=i;break}return r}function Qt(n,e){var t,i,r,o,s,a,u,c=0,m=0,l=0,d=n.constructor,p=d.rounding,y=d.precision;if(!n.d||!n.d[0]||n.e>17)return new d(n.d?n.d[0]?n.s<0?0:1/0:1:n.s?n.s<0?0:n:0/0);for(e==null?(L=!1,u=y):u=e,a=new d(.03125);n.e>-2;)n=n.times(a),l+=5;for(i=Math.log($(2,l))/Math.LN10*2+5|0,u+=i,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(n),u,1),t=t.times(++m),a=s.plus(U(o,t,u,1)),ne(a.d).slice(0,u)===ne(s.d).slice(0,u)){for(r=l;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&Ze(s.d,u-i,p,c))d.precision=u+=10,t=o=a=new d(1),m=0,c++;else return I(s,d.precision=y,p,L=!0);else return d.precision=y,s}s=a}}function xe(n,e){var t,i,r,o,s,a,u,c,m,l,d,p=1,y=10,f=n,b=f.d,P=f.constructor,k=P.rounding,A=P.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new P(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(L=!1,m=A):m=e,P.precision=m+=y,t=ne(b),i=t.charAt(0),Math.abs(o=f.e)<15e14){for(;i<7&&i!=1||i==1&&t.charAt(1)>3;)f=f.times(n),t=ne(f.d),i=t.charAt(0),p++;o=f.e,i>1?(f=new P("0."+t),o++):f=new P(i+"."+t.slice(1))}else return c=At(P,m+2,A).times(o+""),f=xe(new P(i+"."+t.slice(1)),m-y).plus(c),P.precision=A,e==null?I(f,A,k,L=!0):f;for(l=f,u=s=f=U(f.minus(1),f.plus(1),m,1),d=I(f.times(f),m,1),r=3;;){if(s=I(s.times(d),m,1),c=u.plus(U(s,new P(r),m,1)),ne(c.d).slice(0,m)===ne(u.d).slice(0,m))if(u=u.times(2),o!==0&&(u=u.plus(At(P,m+2,A).times(o+""))),u=U(u,new P(p),m,1),e==null)if(Ze(u.d,m-y,k,a))P.precision=m+=y,c=s=f=U(l.minus(1),l.plus(1),m,1),d=I(f.times(f),m,1),r=a=1;else return I(u,P.precision=A,k,L=!0);else return P.precision=A,u;u=c,r+=2}}function Xn(n){return String(n.s*n.s/0)}function Jt(n,e){var t,i,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(i=e.search(/e/i))>0?(t<0&&(t=i),t+=+e.slice(i+1),e=e.substring(0,i)):t<0&&(t=e.length),i=0;e.charCodeAt(i)===48;i++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(i,r),e){if(r-=i,n.e=t=t-i-1,n.d=[],i=(t+1)%K,t<0&&(i+=K),i<r){for(i&&n.d.push(+e.slice(0,i)),r-=K;i<r;)n.d.push(+e.slice(i,i+=K));e=e.slice(i),i=K-e.length}else i-=r;for(;i--;)e+="0";n.d.push(+e),L&&(n.e>n.constructor.maxE?(n.d=null,n.e=NaN):n.e<n.constructor.minE&&(n.e=0,n.d=[0]))}else n.e=0,n.d=[0];return n}function tr(n,e){var t,i,r,o,s,a,u,c,m;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Wn.test(e))return Jt(n,e)}else if(e==="Infinity"||e==="NaN")return+e||(n.s=NaN),n.e=NaN,n.d=null,n;if(ji.test(e))t=16,e=e.toLowerCase();else if(Yi.test(e))t=2;else if(Qi.test(e))t=8;else throw Error(Ie+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,i=n.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Gn(i,new i(t),o,o*2)),c=gt(e,t,me),m=c.length-1,o=m;c[o]===0;--o)c.pop();return o<0?new i(n.s*0):(n.e=kt(c,m),n.d=c,L=!1,s&&(n=U(n,r,a*4)),u&&(n=n.times(Math.abs(u)<54?$(2,u):Ye.pow(2,u))),L=!0,n)}function nr(n,e){var t,i=e.d.length;if(i<3)return e.isZero()?e:_e(n,2,e,e);t=1.4*Math.sqrt(i),t=t>16?16:t|0,e=e.times(1/ht(5,t)),e=_e(n,2,e,e);for(var r,o=new n(5),s=new n(16),a=new n(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function _e(n,e,t,i,r){var o,s,a,u,c=1,m=n.precision,l=Math.ceil(m/K);for(L=!1,u=t.times(t),a=new n(i);;){if(s=U(a.times(u),new n(e++*e++),m,1),a=r?i.plus(s):i.minus(s),i=U(s.times(u),new n(e++*e++),m,1),s=a.plus(i),s.d[l]!==void 0){for(o=l;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=i,i=s,s=o,c++}return L=!0,s.d.length=l+1,s}function ht(n,e){for(var t=n;--e;)t*=n;return t}function zn(n,e){var t,i=e.s<0,r=le(n,n.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Pe=i?4:1,e;if(t=e.divToInt(r),t.isZero())Pe=i?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Pe=On(t)?i?2:3:i?4:1,e;Pe=On(t)?i?1:4:i?3:2}return e.minus(r).abs()}function $t(n,e,t,i){var r,o,s,a,u,c,m,l,d,p=n.constructor,y=t!==void 0;if(y?(oe(t,1,Se),i===void 0?i=p.rounding:oe(i,0,8)):(t=p.precision,i=p.rounding),!n.isFinite())m=Xn(n);else{for(m=be(n),s=m.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(m=m.replace(".",""),d=new p(1),d.e=m.length-s,d.d=gt(be(d),10,r),d.e=d.d.length),l=gt(m,10,r),o=u=l.length;l[--u]==0;)l.pop();if(!l[0])m=y?"0p+0":"0";else{if(s<0?o--:(n=new p(n),n.d=l,n.e=o,n=U(n,d,t,i,0,r),l=n.d,o=n.e,c=vn),s=l[t],a=r/2,c=c||l[t+1]!==void 0,c=i<4?(s!==void 0||c)&&(i===0||i===(n.s<0?3:2)):s>a||s===a&&(i===4||c||i===6&&l[t-1]&1||i===(n.s<0?8:7)),l.length=t,c)for(;++l[--t]>r-1;)l[t]=0,t||(++o,l.unshift(1));for(u=l.length;!l[u-1];--u);for(s=0,m="";s<u;s++)m+=Zt.charAt(l[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)m+="0";for(l=gt(m,r,e),u=l.length;!l[u-1];--u);for(s=1,m="1.";s<u;s++)m+=Zt.charAt(l[s])}else m=m.charAt(0)+"."+m.slice(1);m=m+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)m="0"+m;m="0."+m}else if(++o>u)for(o-=u;o--;)m+="0";else o<u&&(m=m.slice(0,o)+"."+m.slice(o))}m=(e==16?"0x":e==2?"0b":e==8?"0o":"")+m}return n.s<0?"-"+m:m}function Fn(n,e){if(n.length>e)return n.length=e,!0}function ir(n){return new this(n).abs()}function rr(n){return new this(n).acos()}function or(n){return new this(n).acosh()}function sr(n,e){return new this(n).plus(e)}function ar(n){return new this(n).asin()}function ur(n){return new this(n).asinh()}function cr(n){return new this(n).atan()}function lr(n){return new this(n).atanh()}function mr(n,e){n=new this(n),e=new this(e);var t,i=this.precision,r=this.rounding,o=i+4;return!n.s||!e.s?t=new this(NaN):!n.d&&!e.d?(t=le(this,o,1).times(e.s>0?.25:.75),t.s=n.s):!e.d||n.isZero()?(t=e.s<0?le(this,i,r):new this(0),t.s=n.s):!n.d||e.isZero()?(t=le(this,o,1).times(.5),t.s=n.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(U(n,e,o,1)),e=le(this,o,1),this.precision=i,this.rounding=r,t=n.s<0?t.minus(e):t.plus(e)):t=this.atan(U(n,e,o,1)),t}function dr(n){return new this(n).cbrt()}function pr(n){return I(n=new this(n),n.e+1,2)}function fr(n,e,t){return new this(n).clamp(e,t)}function br(n){if(!n||typeof n!="object")throw Error(Pt+"Object expected");var e,t,i,r=n.defaults===!0,o=["precision",1,Se,"rounding",0,8,"toExpNeg",-De,0,"toExpPos",0,De,"maxE",0,De,"minE",-De,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Yt[t]),(i=n[t])!==void 0)if(ie(i)===i&&i>=o[e+1]&&i<=o[e+2])this[t]=i;else throw Error(Ie+t+": "+i);if(t="crypto",r&&(this[t]=Yt[t]),(i=n[t])!==void 0)if(i===!0||i===!1||i===0||i===1)if(i)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(_n);else this[t]=!1;else throw Error(Ie+t+": "+i);return this}function gr(n){return new this(n).cos()}function yr(n){return new this(n).cosh()}function Hn(n){var e,t,i;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,En(o)){c.s=o.s,L?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;L?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return Jt(c,o.toString())}else if(u!=="string")throw Error(Ie+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Wn.test(o)?Jt(c,o):tr(c,o)}if(r.prototype=w,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=br,r.clone=Hn,r.isDecimal=En,r.abs=ir,r.acos=rr,r.acosh=or,r.add=sr,r.asin=ar,r.asinh=ur,r.atan=cr,r.atanh=lr,r.atan2=mr,r.cbrt=dr,r.ceil=pr,r.clamp=fr,r.cos=gr,r.cosh=yr,r.div=wr,r.exp=Ar,r.floor=Pr,r.hypot=kr,r.ln=hr,r.log=Tr,r.log10=xr,r.log2=Br,r.max=Ir,r.min=Sr,r.mod=Cr,r.mul=Kr,r.pow=Nr,r.random=Lr,r.round=Rr,r.sign=Mr,r.sin=Or,r.sinh=Fr,r.sqrt=Er,r.sub=vr,r.sum=Dr,r.tan=_r,r.tanh=Vr,r.trunc=Wr,n===void 0&&(n={}),n&&n.defaults!==!0)for(i=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<i.length;)n.hasOwnProperty(t=i[e++])||(n[t]=this[t]);return r.config(n),r}function wr(n,e){return new this(n).div(e)}function Ar(n){return new this(n).exp()}function Pr(n){return I(n=new this(n),n.e+1,3)}function kr(){var n,e,t=new this(0);for(L=!1,n=0;n<arguments.length;)if(e=new this(arguments[n++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return L=!0,new this(1/0);t=e}return L=!0,t.sqrt()}function En(n){return n instanceof Ye||n&&n.toStringTag===Vn||!1}function hr(n){return new this(n).ln()}function Tr(n,e){return new this(n).log(e)}function Br(n){return new this(n).log(2)}function xr(n){return new this(n).log(10)}function Ir(){return Un(this,arguments,"lt")}function Sr(){return Un(this,arguments,"gt")}function Cr(n,e){return new this(n).mod(e)}function Kr(n,e){return new this(n).mul(e)}function Nr(n,e){return new this(n).pow(e)}function Lr(n){var e,t,i,r,o=0,s=new this(1),a=[];if(n===void 0?n=this.precision:oe(n,1,Se),i=Math.ceil(n/K),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(i));o<i;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(i*=4);o<i;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=i/4}else throw Error(_n);else for(;o<i;)a[o++]=Math.random()*1e7|0;for(i=a[--o],n%=K,i&&n&&(r=$(10,K-n),a[o]=(i/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=K)a.shift();for(i=1,r=a[0];r>=10;r/=10)i++;i<K&&(t-=K-i)}return s.e=t,s.d=a,s}function Rr(n){return I(n=new this(n),n.e+1,this.rounding)}function Mr(n){return n=new this(n),n.d?n.d[0]?n.s:0*n.s:n.s||NaN}function Or(n){return new this(n).sin()}function Fr(n){return new this(n).sinh()}function Er(n){return new this(n).sqrt()}function vr(n,e){return new this(n).sub(e)}function Dr(){var n=0,e=arguments,t=new this(e[n]);for(L=!1;t.s&&++n<e.length;)t=t.plus(e[n]);return L=!0,I(t,this.precision,this.rounding)}function _r(n){return new this(n).tan()}function Vr(n){return new this(n).tanh()}function Wr(n){return I(n=new this(n),n.e+1,1)}w[Symbol.for("nodejs.util.inspect.custom")]=w.toString;w[Symbol.toStringTag]="Decimal";var Ye=w.constructor=Hn(Yt);yt=new Ye(yt);wt=new Ye(wt);var ee=Ye;import xo from"big.js";import mc from"bn.js";import{get as Zn,set as qr}from"lodash";var en=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(i=>typeof i=="object"?JSON.stringify(i):i).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Yn={},Gr={};function te(n){let e=Zn(Yn,n);if(!e){let t=Zn(Gr,n);e=new en({name:n,logLevel:t}),qr(Yn,n,e)}return e}import{PublicKey as jn}from"@solana/web3.js";import{MINT_SIZE as Ur,TOKEN_PROGRAM_ID as Xr,getTransferFeeConfig as zr,unpackMint as Hr}from"@solana/spl-token";var tn=te("Raydium_accountInfo_util");async function je(n,e,t){let{batchRequest:i,commitment:r="confirmed",chunkCount:o=100}=_({batchRequest:!1},t),s=nn(e,o),a=new Array(s.length).fill([]);if(i){let u=s.map(l=>{let d=n._buildArgs([l.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=nn(u,10);a=(await(await Promise.all(c.map(async l=>await n._rpcBatchRequest(l)))).flat()).map(l=>(l.error&&tn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${l.error.message}`),l.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:P}=d;return p.length!==2&&p[1]!=="base64"&&tn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new jn(b),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(u=>n.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&tn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Le(n,e,t){let i=await je(n,e.map(r=>r.pubkey),t);return e.map((r,o)=>H(_({},r),{accountInfo:i[o]}))}async function rn({connection:n,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let i=await Le(n,e.map(u=>({pubkey:Qe(u)})),t),r={};for(let u of i){if(!u.accountInfo||u.accountInfo.data.length<Ur){console.log("invalid mint account",u.pubkey.toBase58());continue}let c=Hr(u.pubkey,u.accountInfo,(o=u.accountInfo)==null?void 0:o.owner);r[u.pubkey.toString()]=H(_({},c),{programId:((s=u.accountInfo)==null?void 0:s.owner)||Xr,feeConfig:(a=zr(c))!=null?a:void 0})}return r[jn.default.toBase58()]=r[ae.toBase58()],r}import Je from"bn.js";var Qn=9007199254740991;function ge(n){let e=te("Raydium_parseBigNumberish");if(n instanceof Je)return n;if(typeof n=="string"){if(n.match(/^-?[0-9]+$/))return new Je(n);e.logWithError(`invalid BigNumberish string: ${n}`)}return typeof n=="number"?(n%1&&e.logWithError(`BigNumberish number underflow: ${n}`),(n>=Qn||n<=-Qn)&&e.logWithError(`BigNumberish number overflow: ${n}`),new Je(String(n))):typeof n=="bigint"?new Je(n.toString()):(e.error(`invalid BigNumberish value: ${n}`),new Je(0))}import{PublicKey as Zr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jn}from"@solana/spl-token";var on={chainId:101,address:Zr.default.toBase58(),programId:Jn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},Ce={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Jn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as un}from"@solana/web3.js";import{PublicKey as Y,SystemProgram as $n,SYSVAR_RENT_PUBKEY as Yr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as jr}from"@solana/spl-token";function sn({pubkey:n,isSigner:e=!1,isWritable:t=!0}){return{pubkey:n,isWritable:t,isSigner:e}}var Es=[sn({pubkey:jr,isWritable:!1}),sn({pubkey:$n.programId,isWritable:!1}),sn({pubkey:Yr,isWritable:!1})];function an({publicKey:n,transformSol:e}){let t=ei(n.toString());if(t instanceof Y)return e&&t.equals($e)?ae:t;if(e&&t.toString()===$e.toBase58())return ae;if(typeof t=="string"){if(t===Y.default.toBase58())return Y.default;try{return new Y(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ei(n){try{return new Y(n)}catch{return n}}var Qr=new Y("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Tt=new Y("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Bt=new Y("SysvarRent111111111111111111111111111111111"),vs=new Y("SysvarC1ock11111111111111111111111111111111"),Ve=new Y("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ds=new Y("Sysvar1nstructions1111111111111111111111111"),ti=$n.programId,_s=new Y("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Vs=new Y("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ws=new Y("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),qs=new Y("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Gs=new Y("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Us=new Y("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Xs=new Y("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),zs=new Y("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Hs=new Y("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Zs=new Y("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ys=new Y("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),ae=new Y("So11111111111111111111111111111111111111112"),$e=Y.default;function Qe(n){return an({publicKey:n,transformSol:!0})}var cn=class{constructor({mint:e,decimals:t,symbol:i,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===$e.toBase58()||e instanceof un&&$e.equals(e)){this.decimals=Ce.decimals,this.symbol=Ce.symbol,this.name=Ce.name,this.mint=new un(Ce.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=i||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?un.default:an({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ke=cn;Ke.WSOL=new cn(H(_({},Ce),{mint:Ce.address}));var ln=class{constructor({decimals:e,symbol:t="UNKNOWN",name:i="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=i}equals(e){return this===e}},xt=ln;xt.SOL=new ln(on);import Jr from"toformat";var $r=Jr,et=$r;import St from"big.js";import to from"bn.js";import no from"decimal.js-light";var It=te("module/fraction"),mn=et(St),tt=et(no),io={[0]:tt.ROUND_DOWN,[1]:tt.ROUND_HALF_UP,[2]:tt.ROUND_UP},ro={[0]:St.roundDown,[1]:St.roundHalfUp,[2]:St.roundUp},z=class{constructor(e,t=new to(1)){this.numerator=ge(e),this.denominator=ge(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new z(this.denominator,this.numerator)}add(e){let t=e instanceof z?e:new z(ge(e));return this.denominator.eq(t.denominator)?new z(this.numerator.add(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof z?e:new z(ge(e));return this.denominator.eq(t.denominator)?new z(this.numerator.sub(t.numerator),this.denominator):new z(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof z?e:new z(ge(e));return new z(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof z?e:new z(ge(e));return new z(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},i=1){Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<=0&&It.logWithError(`${e} is not positive.`),tt.set({precision:e+1,rounding:io[i]});let r=new tt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},i=1){return Number.isInteger(e)||It.logWithError(`${e} is not an integer.`),e<0&&It.logWithError(`${e} is negative.`),mn.DP=e,mn.RM=ro[i]||1,new mn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};import oo from"bn.js";var ni=new z(new oo(100)),ue=class extends z{toSignificant(e=5,t,i){return this.mul(ni).toSignificant(e,t,i)}toFixed(e=2,t,i){return this.mul(ni).toFixed(e,t,i)}};var ha=te("Raydium_price");function nn(n,e=1,t=[]){let i=[...n];if(e<=0)return t;for(;i.length;)t.push(i.splice(0,e));return t}import{PublicKey as po}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fo}from"@solana/spl-token";import{ComputeBudgetProgram as ii,Keypair as oi,PublicKey as so,Transaction as si,TransactionMessage as ao,VersionedTransaction as ai}from"@solana/web3.js";var se={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as uo}from"@solana/spl-token";var ri=te("Raydium_txUtil"),ui=1644;function Kt(n){let e=[],t=[];return n.microLamports&&(e.push(ii.setComputeUnitPrice({microLamports:n.microLamports})),t.push(se.SetComputeUnitPrice)),n.units&&(e.push(ii.setComputeUnitLimit({units:n.units})),t.push(se.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function We(n,e){var i,r;let t=e!=null?e:"confirmed";return(r=await((i=n.getLatestBlockhash)==null?void 0:i.call(n,{commitment:t})))==null?void 0:r.blockhash}async function Nt(n,e){return n.getSignatureStatuses([e]),new Promise((t,i)=>{let r=setTimeout(i,6e4);n.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}i(o.err.toString())},"confirmed")})}function co(n,e){n.length<1&&ri.logWithError(`no instructions provided: ${n.toString()}`),e.length<1&&ri.logWithError(`no signers provided:, ${e.toString()}`);let t=new si;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...n);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<ui}catch{return!1}}function de(n,e){let[t,i]=so.findProgramAddressSync(n,e);return{publicKey:t,nonce:i}}function nt({instructions:n,payer:e,signers:t}){return co(n,[e,...t])}function it({instructions:n,payer:e,lookupTableAddressAccount:t,recentBlockhash:i=oi.generate().publicKey.toString()}){let o=new ao({payerKey:e,recentBlockhash:i,instructions:n}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new ai(o).serialize()).toString("base64").length<ui}catch{return!1}}var lo=n=>Buffer.isBuffer(n)?n:n instanceof Uint8Array?Buffer.from(n.buffer,n.byteOffset,n.byteLength):Buffer.from(n),mo=n=>{let e=n.serialize({requireAllSignatures:!1,verifySignatures:!1});n instanceof ai&&(e=lo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Re(n){let e=[];return n.forEach(t=>{t instanceof si&&(t.recentBlockhash||(t.recentBlockhash=uo.toBase58()),t.feePayer||(t.feePayer=oi.generate().publicKey)),e.push(mo(t))}),console.log("simulate tx string:",e),e}function ye(n,e,t){return de([n.toBuffer(),(t!=null?t:fo).toBuffer(),e.toBuffer()],new po("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as O}from"@solana/web3.js";var nu=new O("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),iu=new O("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ru=new O("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),ou=new O("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),su=new O("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),au=new O("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),uu=new O("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),cu=new O("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),lu=new O("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),mu=new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),bo=new O("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),go=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),yo=new O("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),du=new O("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),pu=new O("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),fu=new O("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bu=new O("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),gu=new O("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),yu=new O("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ci=new O("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),li=new O("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),wu=new O("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),wo=new O("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ao=new O("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Po=new O("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Lt=new O("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ko=new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Rt=new O("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ho=new O("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Au={SERUM_MARKET:O.default,OPENBOOK_MARKET:new O("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:O.default,FarmV3:new O("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new O("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new O("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new O("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new O("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new O("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new O("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new O("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new O("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:wo,CREATE_CPMM_POOL_AUTH:Ao,CREATE_CPMM_POOL_FEE_ACC:Po,FEE_DESTINATION_ID:new O("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ko,LCOK_CPMM_AUTH:ho};import pe from"bn.js";var rt=1e4;function we(n,e,t,i){if(e===void 0)return{amount:n,fee:void 0,expirationTime:void 0};let r=H(_({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new pe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(i)if(o.transferFeeBasisPoints===rt){let u=new pe(o.maximumFee.toString());return{amount:n.add(u),fee:u,expirationTime:a}}else{let u=qe(n.mul(new pe(rt)),new pe(rt-o.transferFeeBasisPoints)),c=new pe(o.maximumFee.toString()),m=u.sub(n).gt(c)?n.add(c):u,l=qe(m.mul(new pe(o.transferFeeBasisPoints)),new pe(rt)),d=l.gt(s)?s:l;return{amount:m,fee:d,expirationTime:a}}else{let u=qe(n.mul(new pe(o.transferFeeBasisPoints)),new pe(rt)),c=u.gt(s)?s:u;return{amount:n,fee:c,expirationTime:a}}}function qe(n,e){let{div:t,mod:i}=n.divmod(e);return i.gt(new pe(0))?t.add(new pe(1)):t}import{PublicKey as mi,AddressLookupTableAccount as Mt}from"@solana/web3.js";async function fn({connection:n,address:e}){let t=await je(n,[...new Set(e.map(r=>r.toString()))].map(r=>new mi(r))),i={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Mt({key:s,state:Mt.deserialize(o.data)});i[s.toString()]=a,Ot[s.toString()]=a}return i}var Ot={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Mt({key:new mi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Mt.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as ot,sendAndConfirmTransaction as bn,Transaction as st,TransactionMessage as at,VersionedTransaction as ut}from"@solana/web3.js";import Bo from"axios";var Ft=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var i;let e=(await Bo.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(i=e==null?void 0:e[15])!=null?i:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:i}=Kt(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...i),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let i=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(i))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:i=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...i),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==ot.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(_({},t||{})):this.build(t)}build(e){var i;let t=new st;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((i=this.owner)==null?void 0:i.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},u=o!=null?o:await We(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Re([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await bn(this.connection,t,this.signers.find(l=>l.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let m=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(m[0].serialize(),{skipPreflight:s}),signedTx:m[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var c;let{extraPreBuildData:t=[],extInfo:i}=e,{transaction:r}=this.build(i),o=t.filter(m=>m.transaction.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],u=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async m=>{var P;let{sequentially:l,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:y,skipPreflight:f=!0}=m||{},b=y!=null?y:await We(this.connection,this.blockhashCommitment);if((P=this.owner)!=null&&P.isKeyPair){if(l){let k=[],A=0;for(let g of s){if(++A,A<=p)continue;let T=await bn(this.connection,g,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});k.push(T)}return{txIds:k,signedTxs:s}}return{txIds:await await Promise.all(s.map(async k=>(k.recentBlockhash=b,await this.connection.sendRawTransaction(k.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let k=s.map((g,T)=>(g.recentBlockhash=b,a[T].length&&g.sign(...a[T]),g));Re(k);let A=await this.signAllTransactions(k);if(l){let g=0,T=[],h=async()=>{if(!A[g])return;let N=await this.connection.sendRawTransaction(A[g].serialize(),{skipPreflight:f});T.push({txId:N,status:"sent",signedTx:A[g]}),d==null||d([...T]),g++,this.connection.onSignature(N,M=>{let v=T.findIndex(F=>F.txId===N);v>-1&&(T[v].status=M.err?"error":"success"),d==null||d([...T]),M.err||h()},"processed"),this.connection.getSignatureStatus(N)};return await h(),{txIds:T.map(N=>N.txId),signedTxs:A}}else{let g=[];for(let T=0;T<A.length;T+=1){let h=await this.connection.sendRawTransaction(A[T].serialize(),{skipPreflight:f});g.push(h)}return{txIds:g,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:i}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:i||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:i})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:i=[],forerunCreate:r,recentBlockhash:o}=y,s=Ae(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=_(_({},this.cluster==="devnet"?{}:Ot),t),u=Array.from(new Set([...i,...this.lookupTableAddress])),c=[];for(let b of u)a[b]===void 0&&c.push(new ot(b));let m=await fn({connection:this.connection,address:c});for(let[b,P]of Object.entries(m))a[b]=P;let l=r?ot.default.toBase58():o!=null?o:await We(this.connection,this.blockhashCommitment),d=new at({payerKey:this.feePayer,recentBlockhash:l,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new ut(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var A;let{skipPreflight:P=!0,sendAndConfirm:k}=b||{};if(Re([p]),(A=this.owner)!=null&&A.isKeyPair){let g=await this.connection.sendTransaction(p,{skipPreflight:P});return k&&await Nt(this.connection,g),{txId:g,signedTx:p}}if(this.signAllTransactions){let g=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(g[0],{skipPreflight:P}),signedTx:g[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var c;let{extraPreBuildData:t=[],buildProps:i}=e,{transaction:r}=await this.buildV0(i),o=t.filter(m=>m.builder.instructions.length>0),s=[r,...o.map(m=>m.transaction)],a=[this.signers,...o.map(m=>m.signers)],u=[...this.instructionTypes,...o.map(m=>m.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(m=>{m.some(l=>l.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(m,l)=>{m.sign(a[l])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:i,execute:async m=>{var f;let{sequentially:l,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=m||{};if(p&&s.forEach(b=>b.message.recentBlockhash=p),Re(s),(f=this.owner)!=null&&f.isKeyPair){if(l){let b=[];for(let P of s){let k=await this.connection.sendTransaction(P,{skipPreflight:y});await Nt(this.connection,k),b.push(k)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(l){let P=0,k=[],A=async()=>{if(!b[P])return;let g=await this.connection.sendTransaction(b[P],{skipPreflight:y});k.push({txId:g,status:"sent",signedTx:b[P]}),d==null||d([...k]),P++,this.connection.onSignature(g,T=>{let h=k.findIndex(N=>N.txId===g);h>-1&&(k[h].status=T.err?"error":"success"),d==null||d([...k]),T.err||A()},"processed"),this.connection.getSignatureStatus(g)};return A(),{txIds:[],signedTxs:b}}else{let P=[];for(let k=0;k<b.length;k+=1){let A=await this.connection.sendTransaction(b[k],{skipPreflight:y});P.push(A)}return{txIds:P,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuild(e){var m;let c=e||{},{computeBudgetConfig:t}=c,i=Ae(c,["computeBudgetConfig"]),r=t?Kt(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((l,d)=>H(_({},l),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(l=>{let d=[...u,l],p=t?[...r.instructions,...d]:d,f=[...new Set(d.map(b=>b.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat()).values()].map(b=>new ot(b));if(u.length<12&&nt({instructions:p,payer:this.feePayer,signers:f})||nt({instructions:d,payer:this.feePayer,signers:f}))u.push(l);else{if(u.length===0)throw Error("item ins too big");nt({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:f})?s.push(new st().add(...r.instructions,...u)):s.push(new st().add(...u)),a.push(Array.from(new Set(u.map(b=>b.keys.filter(P=>P.isSigner).map(P=>P.pubkey.toString())).flat())).map(b=>o[b]).filter(b=>b!==void 0)),u=[l]}}),u.length>0){let d=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);nt({instructions:t?[...r.instructions,...u]:[...u],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new st().add(...r.instructions,...u)):s.push(new st().add(...u)),a.push(d)}return s.forEach(l=>l.feePayer=this.feePayer),(m=this.owner)!=null&&m.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||l.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async l=>{var k;let{sequentially:d,onTxUpdate:p,skipTxCount:y=0,recentBlockHash:f,skipPreflight:b=!0}=l||{},P=f!=null?f:await We(this.connection,this.blockhashCommitment);if(s.forEach(async(A,g)=>{A.recentBlockhash=P,a[g].length&&A.sign(...a[g])}),Re(s),(k=this.owner)!=null&&k.isKeyPair){if(d){let A=0,g=[];for(let T of s){if(++A,A<=y){g.push("tx skipped");continue}let h=await bn(this.connection,T,this.signers.find(N=>N.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});g.push(h)}return{txIds:g,signedTxs:s}}return{txIds:await Promise.all(s.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let A=await this.signAllTransactions(s.slice(y,s.length)),g=[...s.slice(0,y),...A];if(d){let T=0,h=[],N=async()=>{if(!g[T])return;T<y&&(h.push({txId:"",status:"success",signedTx:g[T]}),p==null||p([...h]),T++,N());let M=await this.connection.sendRawTransaction(g[T].serialize(),{skipPreflight:b});h.push({txId:M,status:"sent",signedTx:g[T]}),p==null||p([...h]),T++,this.connection.onSignature(M,v=>{let F=h.findIndex(E=>E.txId===M);F>-1&&(h[F].status=v.err?"error":"success"),p==null||p([...h]),v.err||N()},"processed"),this.connection.getSignatureStatus(M)};return await N(),{txIds:h.map(M=>M.txId),signedTxs:g}}else{let T=[];for(let h=0;h<g.length;h+=1){let N=await this.connection.sendRawTransaction(g[h].serialize(),{skipPreflight:b});T.push(N)}return{txIds:T,signedTxs:g}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:i||{}}}async sizeCheckBuildV0(e){var P;let b=e||{},{computeBudgetConfig:t,lookupTableCache:i={},lookupTableAddress:r=[]}=b,o=Ae(b,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=_(_({},this.cluster==="devnet"?{}:Ot),i),a=Array.from(new Set([...this.lookupTableAddress,...r])),u=[];for(let k of a)s[k]===void 0&&u.push(new ot(k));let c=await fn({connection:this.connection,address:u});for(let[k,A]of Object.entries(c))s[k]=A;let m=t?Kt(t):{instructions:[],instructionTypes:[]},l=await We(this.connection,this.blockhashCommitment),d=this.signers.reduce((k,A)=>H(_({},k),{[A.publicKey.toBase58()]:A}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(k=>{let A=[...f,k],g=t?[...m.instructions,...A]:A;if(f.length<12&&it({instructions:g,payer:this.feePayer,lookupTableAddressAccount:s})||it({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(k);else{if(f.length===0)throw Error("item ins too big");let T={};for(let h of[...new Set(a)])s[h]!==void 0&&(T[h]=s[h]);if(t&&it({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let h=new at({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new ut(h))}else{let h=new at({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new ut(h))}y.push(Array.from(new Set(f.map(h=>h.keys.filter(N=>N.isSigner).map(N=>N.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),f=[k]}}),f.length>0){let A=[...new Set(f.map(g=>g.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(g=>d[g]).filter(g=>g!==void 0);if(t&&it({instructions:[...m.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:l})){let g=new at({payerKey:this.feePayer,recentBlockhash:l,instructions:[...m.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new ut(g))}else{let g=new at({payerKey:this.feePayer,recentBlockhash:l,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new ut(g))}y.push(A)}return(P=this.owner)!=null&&P.signer&&y.forEach(k=>{k.some(A=>A.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async k=>{var M;let{sequentially:A,onTxUpdate:g,skipTxCount:T=0,recentBlockHash:h,skipPreflight:N=!0}=k||{};if(p.map(async(v,F)=>{y[F].length&&v.sign(y[F]),h&&(v.message.recentBlockhash=h)}),Re(p),(M=this.owner)!=null&&M.isKeyPair){if(A){let v=0,F=[];for(let E of p){if(++v,v<=T){console.log("skip tx: ",v),F.push("tx skipped");continue}let D=await this.connection.sendTransaction(E,{skipPreflight:N});await Nt(this.connection,D),F.push(D)}return{txIds:F,signedTxs:p}}return{txIds:await Promise.all(p.map(async v=>await this.connection.sendTransaction(v,{skipPreflight:N}))),signedTxs:p}}if(this.signAllTransactions){let v=await this.signAllTransactions(p.slice(T,p.length)),F=[...p.slice(0,T),...v];if(A){let E=0,D=[],W=async()=>{if(!F[E])return;if(E<T){D.push({txId:"",status:"success",signedTx:F[E]}),g==null||g([...D]),E++,W();return}let J=await this.connection.sendTransaction(F[E],{skipPreflight:N});D.push({txId:J,status:"sent",signedTx:F[E]}),g==null||g([...D]),E++,this.connection.onSignature(J,G=>{let V=D.findIndex(ft=>ft.txId===J);V>-1&&(D[V].status=G.err?"error":"success"),g==null||g([...D]),G.err||W()},"processed"),this.connection.getSignatureStatus(J)};return W(),{txIds:[],signedTxs:F}}else{let E=[];for(let D=0;D<F.length;D+=1){let W=await this.connection.sendTransaction(F[D],{skipPreflight:N});E.push(W)}return{txIds:E,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{PublicKey as _u}from"@solana/web3.js";import Wu from"bn.js";var Pc=te("Raydium_amount"),kc=et(xo);var pn=new ke(0),vc=new ke(1),Dc=new ke(2),_c=new ke(3),Vc=new ke(5),Io=new ke(10),Wc=new ke(100),qc=new ke(1e3),Gc=new ke(1e4);import yn from"bn.js";import _t from"decimal.js-light";import ct from"bn.js";function Et(n,e){if(e.isZero())throw Error("divisor is zero");return n.mod(e)}function So(n,e){if(e.isZero())throw Error("rhs is zero");let t=n.div(e);if(t.isZero())throw Error("quotient is zero");let i=Et(n,e);return i.gt(Ge)&&(t=t.add(new ct(1)),e=n.div(t),i=Et(n,t),i.gt(Ge)&&(e=e.add(new ct(1)))),[t,e]}var Ge=new ct(0),vt=class{static swapWithoutFees(e,t,i){let r=t.mul(i),o=t.add(e),[s,a]=So(r,o),u=a.sub(t),c=i.sub(s);if(c.isZero())throw Error("destinationAmountSwapped is zero");return{sourceAmountSwapped:u,destinationAmountSwapped:c}}static lpTokensToTradingTokens(e,t,i,r,o){let s=e.mul(i).div(t),a=e.mul(r).div(t);if(o===0)return{tokenAmount0:s,tokenAmount1:a};if(o===1)return Et(e.mul(i),t).gt(Ge)&&s.gt(Ge)&&(s=s.add(new ct(1))),Et(e.mul(r),t).gt(Ge)&&a.gt(Ge)&&(a=a.add(new ct(1))),{tokenAmount0:s,tokenAmount1:a};throw Error("roundDirection value error")}};import pi from"bn.js";var gn=new pi(1e6);function Co(n,e,t){return n.mul(e).add(t).sub(new pi(1)).div(t)}function di(n,e,t){return n.mul(e).div(t)}var Dt=class{static tradingFee(e,t){return Co(e,t,gn)}static protocolFee(e,t){return di(e,t,gn)}static fundFee(e,t){return di(e,t,gn)}};var Vt=class{static validate_supply(e,t){if(e.isZero())throw Error("tokenAmount0 is zero");if(t.isZero())throw Error("tokenAmount1 is zero")}static swap(e,t,i,r){let o=Dt.tradingFee(e,r),s=e.sub(o),{sourceAmountSwapped:a,destinationAmountSwapped:u}=vt.swapWithoutFees(s,t,i),c=a.add(o);return{newSwapSourceAmount:t.add(c),newSwapDestinationAmount:i.sub(u),sourceAmountSwapped:c,destinationAmountSwapped:u,tradeFee:o}}static swapBaseOut({poolMintA:e,poolMintB:t,tradeFeeRate:i,baseReserve:r,quoteReserve:o,outputMint:s,outputAmount:a}){let[u,c,m,l,d]=t.address===s.toString()?[r,o,e.decimals,t.decimals,e.address]:[o,r,t.decimals,e.decimals,t.address],p=new _t(c.toString()).div(10**l).div(new _t(u.toString()).div(10**m)),y=a.gte(c)?c.sub(new yn(1)):a,f=c.sub(y),b=qe(u.mul(y),f),P=qe(b.mul(new yn(1e6)),new yn(1e6).sub(i)),k=P.sub(b),A=new _t(y.toString()).div(10**l).div(new _t(P.toString()).div(10**m)),g=p.isZero()?0:A.sub(p).div(p).abs().toNumber();return{amountRealOut:y,amountIn:P,amountInWithoutFee:b,tradeFee:k,priceImpact:g}}};import Q from"bn.js";var wn=(...n)=>n.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ue=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=te(t)}createTxBuilder(e){return this.scope.checkOwner(),new Ft({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(wn(e))}logInfo(...e){this.logger.info(wn(e))}logAndCreateError(...e){let t=wn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{PublicKey as vo}from"@solana/web3.js";import yi,{isBN as wi}from"bn.js";import{bits as ll,BitStructure as ml,blob as Ko,Blob as dl,cstr as pl,f32 as fl,f32be as bl,f64 as gl,f64be as yl,greedy as wl,Layout as No,ns64 as Al,ns64be as Pl,nu64 as kl,nu64be as hl,offset as Tl,s16 as Bl,s16be as xl,s24 as Il,s24be as Sl,s32 as Lo,s32be as Cl,s40 as Kl,s40be as Nl,s48 as Ll,s48be as Rl,s8 as Ml,seq as Ro,struct as Ol,Structure as Mo,u16 as Oo,u16be as Fl,u24 as El,u24be as vl,u32 as Dl,u32be as _l,u40 as Vl,u40be as Wl,u48 as ql,u48be as Gl,u8 as Fo,UInt as Eo,union as Ul,Union as Xl,unionLayoutDiscriminator as zl,utf8 as Hl}from"@solana/buffer-layout";var An=No,fi=Mo;var Pn=Eo;var bi=Fo,Me=Oo;var he=Lo;var gi=Ro;var re=Ko;var Xe=class extends An{constructor(t,i,r){super(t,r);this.blob=re(t),this.signed=i}decode(t,i=0){let r=new yi(this.blob.decode(t,i),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,i,r=0){return typeof t=="number"&&(t=new yi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),i,r)}};function Z(n){return new Pn(1,n)}function Te(n){return new Pn(4,n)}function x(n){return new Xe(8,!1,n)}function j(n){return new Xe(16,!1,n)}function Ai(n){return new Xe(8,!0,n)}function Pi(n){return new Xe(16,!0,n)}var Wt=class extends An{constructor(t,i,r,o){super(t.span,o);this.layout=t,this.decoder=i,this.encoder=r}decode(t,i){return this.decoder(this.layout.decode(t,i))}encode(t,i,r){return this.layout.encode(this.encoder(t),i,r)}getSpan(t,i){return this.layout.getSpan(t,i)}};function R(n){return new Wt(re(32),e=>new vo(e),e=>e.toBuffer(),n)}function Oe(n){return new Wt(bi(),Do,_o,n)}function Do(n){if(n===0)return!1;if(n===1)return!0;throw new Error("Invalid bool: "+n)}function _o(n){return n?1:0}var kn=class extends fi{decode(e,t){return super.decode(e,t)}};function q(n,e,t){return new kn(n,e,t)}function X(n,e,t){let i,r=typeof e=="number"?e:wi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!i){let a=Reflect.get(o,"count");i=wi(a)?a.toNumber():a,Reflect.set(o,"count",i)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(i=a),Reflect.set(o,s,a)}});return gi(n,r,t)}var am=q([Te("mintAuthorityOption"),R("mintAuthority"),x("supply"),Z("decimals"),Z("isInitialized"),Te("freezeAuthorityOption"),R("freezeAuthority")]);import{PublicKey as mm}from"@solana/web3.js";import{MintLayout as pm,TOKEN_PROGRAM_ID as bm}from"@solana/spl-token";var Fe=r=>{var o=r,{address:n,programId:e,decimals:t}=o,i=Ae(o,["address","programId","decimals"]);return _({chainId:101,address:Qe(n).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:i.extensions||{}},i)},ze=n=>n?H(_({},n),{transferFeeConfigAuthority:n.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:n.withdrawWithheldAuthority.toBase58(),withheldAmount:n.withheldAmount.toString(),olderTransferFee:H(_({},n.olderTransferFee),{epoch:n.olderTransferFee.epoch.toString(),maximumFee:n.olderTransferFee.maximumFee.toString()}),newerTransferFee:H(_({},n.newerTransferFee),{epoch:n.newerTransferFee.epoch.toString(),maximumFee:n.newerTransferFee.maximumFee.toString()})}):void 0;import{PublicKey as pt,TransactionInstruction as Ee,Keypair as us,SystemProgram as cs}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Ei,TOKEN_2022_PROGRAM_ID as Kn,TOKEN_PROGRAM_ID as Ne}from"@solana/spl-token";var Vo=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Sm=Buffer.from("amm_config","utf8"),Wo=Buffer.from("pool","utf8"),qo=Buffer.from("pool_lp_mint","utf8"),Go=Buffer.from("pool_vault","utf8"),Uo=Buffer.from("observation","utf8");function qt(n){return de([Vo],n)}function hn(n,e,t,i){return de([Wo,e.toBuffer(),t.toBuffer(),i.toBuffer()],n)}function Xo(n,e){return de([qo,e.toBuffer()],n)}function ki(n,e,t){return de([Go,e.toBuffer(),t.toBuffer()],n)}function Gt(n,e){return de([Uo,e.toBuffer()],n)}function hi({poolId:n,programId:e,configId:t,mintA:i,mintB:r}){let o=qt(e).publicKey,s=n||hn(e,t,i,r).publicKey,a=Xo(e,s).publicKey,u=ki(e,s,i).publicKey,c=ki(e,s,r).publicKey,m=Gt(e,s).publicKey;return{poolId:s,configId:t,authority:o,lpMint:a,vaultA:u,vaultB:c,observationId:m}}var zo=Buffer.from("locked_liquidity","utf8");function Ut(n,e){return de([zo,e.toBuffer()],n)}import{PublicKey as of}from"@solana/web3.js";import af from"bn.js";import{AccountLayout as mf,TOKEN_PROGRAM_ID as df}from"@solana/spl-token";import{Keypair as Op,PublicKey as Fp,SystemProgram as vp,TransactionInstruction as Dp}from"@solana/web3.js";import Vp from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Gp,TOKEN_2022_PROGRAM_ID as Up,TOKEN_PROGRAM_ID as Xp}from"@solana/spl-token";import pp from"bn.js";import ce from"bn.js";var Ti=new ce(0),Bi=new ce(1),xi=new ce(-1),Xt=new ce(1).shln(64),Ii=new ce(1).shln(128),Ho=Xt.sub(Bi);var Zo=Ii.subn(1),He=-443636,lt=-He,Tn=new ce("4295048016"),Bn=new ce("79226673521066979257578248091"),Nm=new ce("4295048017"),Lm=new ce("79226673521066979257578248090");var Yo=new ce(10).pow(new ce(6));var Rm=new ce("18446744073700000000");import $d from"bn.js";var _m=Buffer.from("amm_config","utf8"),Vm=Buffer.from("pool","utf8"),Wm=Buffer.from("pool_vault","utf8"),qm=Buffer.from("pool_reward_vault","utf8"),Gm=Buffer.from("position","utf8"),Um=Buffer.from("tick_array","utf8"),Xm=Buffer.from("operation","utf8"),zm=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Hm=Buffer.from("observation","utf8");function xn(n){return de([Buffer.from("metadata","utf8"),Ve.toBuffer(),n.toBuffer()],Ve)}var Zm=Buffer.from("locked_position","utf8");import{PublicKey as Sd}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Kd}from"@solana/spl-token";import Ld from"bn.js";import Qm from"bn.js";var Cn=14;var zt=60;var $o=q([re(8),Z("bump"),Me("index"),R(""),Te("protocolFeeRate"),Te("tradeFeeRate"),Me("tickSpacing"),X(x(),8,"")]),es=q([Te("blockTimestamp"),Ai("tickCumulative"),X(x(),4)]),Fi=q([re(8),Oe("initialized"),x("recentEpoch"),Me("observationIndex"),R("poolId"),X(es,100,"observations"),X(x(),4)]),ts=q([Z("rewardState"),x("openTime"),x("endTime"),x("lastUpdateTime"),j("emissionsPerSecondX64"),x("rewardTotalEmissioned"),x("rewardClaimed"),R("tokenMint"),R("tokenVault"),R("creator"),j("rewardGrowthGlobalX64")]),Ri=q([re(8),Z("bump"),R("ammConfig"),R("creator"),R("mintA"),R("mintB"),R("vaultA"),R("vaultB"),R("observationId"),Z("mintDecimalsA"),Z("mintDecimalsB"),Me("tickSpacing"),j("liquidity"),j("sqrtPriceX64"),he("tickCurrent"),Te(),j("feeGrowthGlobalX64A"),j("feeGrowthGlobalX64B"),x("protocolFeesTokenA"),x("protocolFeesTokenB"),j("swapInAmountTokenA"),j("swapOutAmountTokenB"),j("swapInAmountTokenB"),j("swapOutAmountTokenA"),Z("status"),X(Z(),7,""),X(ts,3,"rewardInfos"),X(x(),16,"tickArrayBitmap"),x("totalFeesTokenA"),x("totalFeesClaimedTokenA"),x("totalFeesTokenB"),x("totalFeesClaimedTokenB"),x("fundFeesTokenA"),x("fundFeesTokenB"),x("startTime"),X(x(),15*4-3,"padding")]),ns=q([j("growthInsideLastX64"),x("rewardAmountOwed")]),Mi=q([re(8),Z("bump"),R("nftMint"),R("poolId"),he("tickLower"),he("tickUpper"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),x("tokenFeesOwedA"),x("tokenFeesOwedB"),X(ns,3,"rewardInfos"),X(x(),8,"")]),Tp=q([re(8),Z("bump"),R("poolId"),he("tickLowerIndex"),he("tickUpperIndex"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),x("tokenFeesOwedA"),x("tokenFeesOwedB"),X(j(),3,"rewardGrowthInside"),X(x(),8,"")]),is=q([he("tick"),Pi("liquidityNet"),j("liquidityGross"),j("feeGrowthOutsideX64A"),j("feeGrowthOutsideX64B"),X(j(),3,"rewardGrowthsOutsideX64"),X(Te(),13,"")]),Ki=q([re(8),R("poolId"),he("startTickIndex"),X(is,zt,"ticks"),Z("initializedTickCount"),X(Z(),115,"")]),rs=q([re(329),X(R(),100,"whitelistMints")]),Jo=q([re(8),R("poolId"),X(X(x(),8),Cn,"positiveTickArrayBitmap"),X(X(x(),8),Cn,"negativeTickArrayBitmap")]),Bp=q([x(),Z("bump"),R("owner"),R("poolId"),R("positionId"),R("nftAccount"),X(x(),8)]),xp=q([re(8),Z("bump"),R("lockOwner"),R("poolId"),R("positionId"),R("nftAccount"),R("lockNftMint"),x("recentEpoch"),X(x(),8)]);Fi.span;var Jp=te("Raydium_Clmm");var ls=te("Raydium_cpmm"),ve={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function vi(n,e,t,i,r,o,s,a,u,c,m,l,d,p,y,f,b,P,k,A){let g=q([x("amountMaxA"),x("amountMaxB"),x("openTime")]),T=hn(n,t,o,s).publicKey,h=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!r.equals(T),isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:ti,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1}],N=Buffer.alloc(g.span);return g.encode({amountMaxA:P,amountMaxB:k,openTime:A},N),new Ee({keys:h,programId:n,data:Buffer.from([...ve.initialize,...N])})}function Di(n,e,t,i,r,o,s,a,u,c,m,l,d,p,y){let f=q([x("lpAmount"),x("amountMaxA"),x("amountMaxB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0}],P=Buffer.alloc(f.span);return ls.debug("cpmm deposit data",{lpAmount:d.toString(),amountMaxA:p.toString(),amountMaxB:y.toString()}),f.encode({lpAmount:d,amountMaxA:p,amountMaxB:y},P),new Ee({keys:b,programId:n,data:Buffer.from([...ve.deposit,...P])})}function _i(n,e,t,i,r,o,s,a,u,c,m,l,d,p,y){let f=q([x("lpAmount"),x("amountMinA"),x("amountMinB")]),b=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:Tt,isSigner:!1,isWritable:!1}],P=Buffer.alloc(f.span);return f.encode({lpAmount:d,amountMinA:p,amountMinB:y},P),new Ee({keys:b,programId:n,data:Buffer.from([...ve.withdraw,...P])})}function Vi(n,e,t,i,r,o,s,a,u,c,m,l,d,p,y,f){let b=q([x("amountIn"),x("amounOutMin")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],k=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},k),new Ee({keys:P,programId:n,data:Buffer.from([...ve.swapBaseInput,...k])})}function Wi(n,e,t,i,r,o,s,a,u,c,m,l,d,p,y,f){let b=q([x("amountInMax"),x("amountOut")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],k=Buffer.alloc(b.span);return b.encode({amountInMax:y,amountOut:f},k),new Ee({keys:P,programId:n,data:Buffer.from([...ve.swapBaseOutput,...k])})}async function qi(n){var f;let{ownerInfo:e,poolInfo:t,poolKeys:i,getEphemeralSigners:r}=n,o=[],[s,a]=[new pt(t.id),new pt(t.lpMint.address)],u;if(r)u=new pt((await r(1))[0]);else{let b=us.generate();o.push(b),u=b.publicKey}let{publicKey:c}=ye(e.feePayer,u,Ne),{publicKey:m}=xn(u),{publicKey:l}=Ut(n.lockProgram,u),{publicKey:d}=ye(e.feePayer,a,Ne),{publicKey:p}=ye(n.lockAuthProgram,a,Ne),y=ms({programId:n.lockProgram,auth:n.lockAuthProgram,payer:e.feePayer,nftOwner:e.feePayer,liquidityOwner:e.feePayer,nftMint:u,nftAccount:c,poolId:s,lockPda:l,mintLp:a,userLpVault:d,lockLpVault:p,poolVaultA:new pt(i.vault.A),poolVaultB:new pt(i.vault.B),metadataAccount:m,lpAmount:n.lpAmount,withMetadata:(f=n.withMetadata)!=null?f:!0});return{address:{nftMint:u,nftAccount:c,metadataAccount:m,lockPda:l,userLpVault:d,lockLpVault:p},instructions:[y],signers:o,instructionTypes:[se.CpmmLockLp],lookupTableAddress:[]}}function ms({programId:n,auth:e,payer:t,liquidityOwner:i,nftOwner:r,nftMint:o,nftAccount:s,poolId:a,lockPda:u,mintLp:c,userLpVault:m,lockLpVault:l,poolVaultA:d,poolVaultB:p,metadataAccount:y,lpAmount:f,withMetadata:b}){let P=[{pubkey:e,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:cs.programId,isSigner:!1,isWritable:!1},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Ei,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1}],k=q([x("lpAmount"),Oe("withMetadata")]),A=Buffer.alloc(k.span);k.encode({lpAmount:f,withMetadata:b},A);let g=Buffer.from([...ve.lockCpLiquidity,...A]);return new Ee({keys:P,programId:n,data:g})}function Gi({programId:n,nftOwner:e,auth:t,nftAccount:i,lockPda:r,poolId:o,mintLp:s,userVaultA:a,userVaultB:u,poolVaultA:c,poolVaultB:m,mintA:l,mintB:d,lockLpVault:p,lpFeeAmount:y,cpmmProgram:f,cpmmAuthProgram:b}){let P=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:f!=null?f:ci,isSigner:!1,isWritable:!1},{pubkey:b!=null?b:li,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:Ne,isSigner:!1,isWritable:!1},{pubkey:Kn,isSigner:!1,isWritable:!1},{pubkey:Tt,isSigner:!1,isWritable:!1}],k=q([x("lpFeeAmount")]),A=Buffer.alloc(k.span);k.encode({lpFeeAmount:y},A);let g=Buffer.from([...ve.collectCpFee,...A]);return new Ee({keys:P,programId:n,data:g})}var Ui=q([re(8),Z("bump"),Oe("disableCreatePool"),Me("index"),x("tradeFeeRate"),x("protocolFeeRate"),x("fundFeeRate"),x("createPoolFee"),R("protocolOwner"),R("fundOwner"),X(x(),16)]),Xi=q([re(8),R("configId"),R("poolCreator"),R("vaultA"),R("vaultB"),R("mintLp"),R("mintA"),R("mintB"),R("mintProgramA"),R("mintProgramB"),R("observationId"),Z("bump"),Z("status"),Z("lpDecimals"),Z("mintDecimalA"),Z("mintDecimalB"),x("lpAmount"),x("protocolFeesMintA"),x("protocolFeesMintB"),x("fundFeesMintA"),x("fundFeesMintB"),x("openTime"),X(x(),32)]);var Nn=class extends Ue{constructor(e){super(e)}async load(){this.checkDisabled()}async getCpmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async getRpcPoolInfo(e,t){return(await this.getRpcPoolInfos([e],t))[e]}async getRpcPoolInfos(e,t){let i=await Le(this.scope.connection,e.map(l=>({pubkey:new B(l)}))),r={},o=new Set,s=[];for(let l=0;l<e.length;l++){let d=i[l];if(d.accountInfo===null)throw Error("fetch pool info error: "+String(e[l]));let p=Xi.decode(d.accountInfo.data);r[String(e[l])]=H(_({},p),{programId:d.accountInfo.owner}),o.add(String(p.configId)),s.push(p.vaultA,p.vaultB)}let a={};if(t){let l=[...o],d=await Le(this.scope.connection,l.map(p=>({pubkey:new B(p)})));for(let p=0;p<l.length;p++){let y=d[p].accountInfo;if(y===null)throw Error("fetch pool config error: "+l[p]);a[l[p]]=Ui.decode(y.data)}}let u={},c=await Le(this.scope.connection,s.map(l=>({pubkey:new B(l)})));for(let l=0;l<s.length;l++){let d=c[l].accountInfo;if(d===null)throw Error("fetch vault info error: "+s[l]);u[String(s[l])]=new Q(ds.decode(d.data).amount.toString())}let m={};for(let[l,d]of Object.entries(r)){let p=u[d.vaultA.toString()].sub(d.protocolFeesMintA).sub(d.fundFeesMintA),y=u[d.vaultB.toString()].sub(d.protocolFeesMintB).sub(d.fundFeesMintB);m[l]=H(_({},d),{baseReserve:p,quoteReserve:y,vaultAAmount:u[d.vaultA.toString()],vaultBAmount:u[d.vaultB.toString()],configInfo:a[d.configId.toString()],poolPrice:new ee(y.toString()).div(new ee(10).pow(d.mintDecimalB)).div(new ee(p.toString()).div(new ee(10).pow(d.mintDecimalA)))})}return m}toComputePoolInfos({pools:e,mintInfos:t}){return Object.keys(e).reduce((i,r)=>{var u,c,m,l;let o=e[r],[s,a]=[o.mintA.toBase58(),o.mintB.toBase58()];return H(_({},i),{[r]:H(_({},o),{id:new B(r),configInfo:o.configInfo,version:7,authority:qt(o.programId).publicKey,mintA:Fe({address:s,decimals:o.mintDecimalA,programId:o.mintProgramA.toBase58(),extensions:{feeConfig:(u=t[s])!=null&&u.feeConfig?ze((c=t[s])==null?void 0:c.feeConfig):void 0}}),mintB:Fe({address:a,decimals:o.mintDecimalB,programId:o.mintProgramB.toBase58(),extensions:{feeConfig:(m=t[a])!=null&&m.feeConfig?ze((l=t[a])==null?void 0:l.feeConfig):void 0}})})})},{})}async getPoolInfoFromRpc(e){let t=await this.getRpcPoolInfo(e,!0),i=await rn({connection:this.scope.connection,mints:[t.mintA,t.mintB]}),r=Fe({address:t.mintA.toBase58(),decimals:t.mintDecimalA,programId:t.mintProgramA.toBase58(),extensions:{feeConfig:i[t.mintA.toBase58()].feeConfig?ze(i[t.mintA.toBase58()].feeConfig):void 0}}),o=Fe({address:t.mintB.toBase58(),decimals:t.mintDecimalB,programId:t.mintProgramB.toBase58(),extensions:{feeConfig:i[t.mintB.toBase58()].feeConfig?ze(i[t.mintB.toBase58()].feeConfig):void 0}}),s=Fe({address:t.mintLp.toBase58(),decimals:t.lpDecimals,programId:fe.toBase58()}),a={id:t.configId.toBase58(),index:t.configInfo.index,protocolFeeRate:t.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:t.configInfo.tradeFeeRate.toNumber(),fundFeeRate:t.configInfo.fundFeeRate.toNumber(),createPoolFee:t.configInfo.createPoolFee.toString()},u={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};return{poolInfo:{programId:t.programId.toBase58(),id:e,type:"Standard",lpMint:s,lpPrice:0,lpAmount:t.lpAmount.toNumber(),config:a,mintA:r,mintB:o,rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:t.poolPrice.toNumber(),mintAmountA:new ee(t.vaultAAmount.toString()).div(10**r.decimals).toNumber(),mintAmountB:new ee(t.vaultBAmount.toString()).div(10**o.decimals).toNumber(),feeRate:t.configInfo.tradeFeeRate.toNumber(),openTime:t.openTime.toString(),tvl:0,burnPercent:0,day:u,week:u,month:u,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0},poolKeys:{programId:t.programId.toBase58(),id:e,mintA:r,mintB:o,openTime:t.openTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},authority:qt(t.programId).publicKey.toBase58(),mintLp:s,config:a},rpcData:t}}async createPool(d){var p=d,{poolId:e,programId:t,poolFeeAccount:i,startTime:r,ownerInfo:o,associatedOnly:s=!1,checkCreateATAOwner:a=!1,txVersion:u,feeConfig:c,computeBudgetConfig:m}=p,l=Ae(p,["poolId","programId","poolFeeAccount","startTime","ownerInfo","associatedOnly","checkCreateATAOwner","txVersion","feeConfig","computeBudgetConfig"]);var J,G,V;let y=o.feePayer||((J=this.scope.owner)==null?void 0:J.publicKey),f=new Q(new B(l.mintA.address).toBuffer()).lte(new Q(new B(l.mintB.address).toBuffer())),[b,P]=f?[l.mintA,l.mintB]:[l.mintB,l.mintA],[k,A]=f?[l.mintAAmount,l.mintBAmount]:[l.mintBAmount,l.mintAAmount],g=o.useSOLBalance&&b.address===Ht.toBase58(),T=o.useSOLBalance&&P.address===Ht.toBase58(),[h,N]=[new B(b.address),new B(P.address)],M=this.createTxBuilder(),{account:v,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({mint:h,tokenProgram:b.programId,owner:this.scope.ownerPubKey,createInfo:g?{payer:y,amount:k}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:s,checkCreateATAOwner:a});M.addInstruction(F||{});let{account:E,instructionParams:D}=await this.scope.account.getOrCreateTokenAccount({mint:new B(P.address),tokenProgram:P.programId,owner:this.scope.ownerPubKey,createInfo:T?{payer:y,amount:A}:void 0,notUseTokenAccount:T,skipCloseAccount:!T,associatedOnly:T?!1:s,checkCreateATAOwner:a});if(M.addInstruction(D||{}),v===void 0||E===void 0)throw Error("you don't has some token account");let W=hi({poolId:e,programId:t,configId:new B(c.id),mintA:h,mintB:N});return M.addInstruction({instructions:[vi(t,this.scope.ownerPubKey,new B(c.id),W.authority,W.poolId,h,N,W.lpMint,v,E,ye(this.scope.ownerPubKey,W.lpMint).publicKey,W.vaultA,W.vaultB,i,new B((G=b.programId)!=null?G:fe),new B((V=P.programId)!=null?V:fe),W.observationId,k,A,r)],instructionTypes:[se.CpmmCreatePool]}),M.addCustomComputeBudget(m),M.versionBuild({txVersion:u,extInfo:{address:H(_({},W),{mintA:b,mintB:P,programId:t,poolFeeAccount:i,feeConfig:c})}})}async addLiquidity(e){let{poolInfo:t,poolKeys:i,inputAmount:r,baseIn:o,slippage:s,computeResult:a,computeBudgetConfig:u,config:c,txVersion:m}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),r.isZero()&&this.logAndCreateError("amounts must greater than zero","amountInA",{amountInA:r.toString()});let{account:l}=this.scope,{bypassAssociatedCheck:d,checkCreateATAOwner:p}=_({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),y=a?void 0:await this.getRpcPoolInfo(t.id),{liquidity:f,inputAmountFee:b,anotherAmount:P}=a||this.computePairAmount({poolInfo:H(_({},t),{lpAmount:new ee(y.lpAmount.toString()).div(10**t.lpMint.decimals).toNumber()}),baseReserve:y.baseReserve,quoteReserve:y.quoteReserve,slippage:new ue(0),baseIn:o,epochInfo:await this.scope.fetchEpochInfo(),amount:new ee(r.toString()).div(10**(o?t.mintA.decimals:t.mintB.decimals))}),k=P.amount,A=t.mintA.address===Ht.toString(),g=t.mintB.address===Ht.toString(),T=this.createTxBuilder(),[h,N]=[new B(t.mintA.address),new B(t.mintB.address)],{account:M,instructionParams:v}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:A||(o?r:k).isZero()?{payer:this.scope.ownerPubKey,amount:o?r:k}:void 0,skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:!1,checkCreateATAOwner:p});T.addInstruction(v||{});let{account:F,instructionParams:E}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:g||(o?k:r).isZero()?{payer:this.scope.ownerPubKey,amount:o?k:r}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:!1,checkCreateATAOwner:p});T.addInstruction(E||{}),!M&&!F&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",l.tokenAccounts);let D=await l.getCreatedTokenAccount({mint:new B(t.lpMint.address)}),ft=await l.handleTokenAccount({side:"out",amount:0,mint:new B(t.lpMint.address),tokenAccount:D,bypassAssociatedCheck:d,checkCreateATAOwner:p}),{tokenAccount:W}=ft,J=Ae(ft,["tokenAccount"]);T.addInstruction(J);let G=i!=null?i:await this.getCpmmPoolKeys(t.id),V=new ue(new Q(1)).sub(s);return T.addInstruction({instructions:[Di(new B(t.programId),this.scope.ownerPubKey,new B(G.authority),new B(t.id),W,M,F,new B(G.vault.A),new B(G.vault.B),h,N,new B(t.lpMint.address),a?a==null?void 0:a.liquidity:V.mul(f).quotient,o?b.amount:k,o?k:b.amount)],instructionTypes:[se.CpmmAddLiquidity],lookupTableAddress:G.lookupTableAccount?[G.lookupTableAccount]:[]}),T.addCustomComputeBudget(u),T.versionBuild({txVersion:m})}async withdrawLiquidity(e){var W,J;let{poolInfo:t,poolKeys:i,lpAmount:r,slippage:o,computeBudgetConfig:s,txVersion:a}=e;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region");let u=new ue(new Q(1)).sub(o),c=await this.getRpcPoolInfo(t.id),[m,l]=[u.mul(r.mul(c.baseReserve).div(c.lpAmount)).quotient,u.mul(r.mul(c.quoteReserve).div(c.lpAmount)).quotient],d=await this.scope.fetchEpochInfo(),[p,y]=[we(m,t.mintA.extensions.feeConfig,d,!1),we(l,t.mintB.extensions.feeConfig,d,!1)],{account:f}=this.scope,b=this.createTxBuilder(),[P,k]=[new B(t.mintA.address),new B(t.mintB.address)],A=P.equals(ae),g=k.equals(ae),T,h,{account:N,instructionParams:M}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:A,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,associatedOnly:!A,checkCreateATAOwner:!1});T=N,M&&b.addInstruction(M);let{account:v,instructionParams:F}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:!g,checkCreateATAOwner:!1});h=v,F&&b.addInstruction(F),(!T||!h)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",f.tokenAccounts);let E=await f.getCreatedTokenAccount({mint:new B(t.lpMint.address)});E||this.logAndCreateError("cannot found lp token account","tokenAccounts",f.tokenAccounts);let D=i!=null?i:await this.getCpmmPoolKeys(t.id);return b.addInstruction({instructions:[_i(new B(t.programId),this.scope.ownerPubKey,new B(D.authority),new B(t.id),E,T,h,new B(D.vault.A),new B(D.vault.B),P,k,new B(t.lpMint.address),r,m.sub((W=p.fee)!=null?W:new Q(0)),l.sub((J=y.fee)!=null?J:new Q(0)))],instructionTypes:[se.CpmmWithdrawLiquidity],lookupTableAddress:D.lookupTableAccount?[D.lookupTableAccount]:[]}),b.addCustomComputeBudget(s),b.versionBuild({txVersion:a})}async swap(e){var v,F,E,D,W,J;let{poolInfo:t,poolKeys:i,baseIn:r,fixedOut:o,inputAmount:s,swapResult:a,slippage:u=0,config:c,computeBudgetConfig:m,txVersion:l}=e,{bypassAssociatedCheck:d,checkCreateATAOwner:p,associatedOnly:y}=_({bypassAssociatedCheck:!1,checkCreateATAOwner:!1,associatedOnly:!0},c),f=this.createTxBuilder(),[b,P]=[new B(t.mintA.address),new B(t.mintB.address)];o?a.sourceAmountSwapped=a.sourceAmountSwapped.mul(new Q((1+u)*1e4)).div(new Q(1e4)):a.destinationAmountSwapped=a.destinationAmountSwapped.mul(new Q((1-u)*1e4)).div(new Q(1e4));let k=t.mintA.address===ae.toBase58(),A=t.mintB.address===ae.toBase58(),{account:g,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({mint:b,tokenProgram:new B((v=t.mintA.programId)!=null?v:fe),owner:this.scope.ownerPubKey,createInfo:k||!r?{payer:this.scope.ownerPubKey,amount:r?a.sourceAmountSwapped:0}:void 0,notUseTokenAccount:k,skipCloseAccount:!k,associatedOnly:k?!1:y,checkCreateATAOwner:p});T&&f.addInstruction(T);let{account:h,instructionParams:N}=await this.scope.account.getOrCreateTokenAccount({mint:P,tokenProgram:new B((F=t.mintB.programId)!=null?F:fe),owner:this.scope.ownerPubKey,createInfo:A||r?{payer:this.scope.ownerPubKey,amount:r?0:a.sourceAmountSwapped}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:y,checkCreateATAOwner:p});N&&f.addInstruction(N),(!g||!h)&&this.logAndCreateError("user do not have token account",{mintA:t.mintA.symbol||t.mintA.address,mintB:t.mintB.symbol||t.mintB.address,mintATokenAcc:g,mintBTokenAcc:h,mintAUseSOLBalance:k,mintBUseSOLBalance:A,associatedOnly:y});let M=i!=null?i:await this.getCpmmPoolKeys(t.id);return f.addInstruction({instructions:[o?Wi(new B(t.programId),this.scope.ownerPubKey,new B(M.authority),new B(M.config.id),new B(t.id),r?g:h,r?h:g,new B(M.vault[r?"A":"B"]),new B(M.vault[r?"B":"A"]),new B((W=t[r?"mintA":"mintB"].programId)!=null?W:fe),new B((J=t[r?"mintB":"mintA"].programId)!=null?J:fe),r?b:P,r?P:b,Gt(new B(t.programId),new B(t.id)).publicKey,a.sourceAmountSwapped,a.destinationAmountSwapped):Vi(new B(t.programId),this.scope.ownerPubKey,new B(M.authority),new B(M.config.id),new B(t.id),r?g:h,r?h:g,new B(M.vault[r?"A":"B"]),new B(M.vault[r?"B":"A"]),new B((E=t[r?"mintA":"mintB"].programId)!=null?E:fe),new B((D=t[r?"mintB":"mintA"].programId)!=null?D:fe),r?b:P,r?P:b,Gt(new B(t.programId),new B(t.id)).publicKey,s,a.destinationAmountSwapped)],instructionTypes:[o?se.CpmmSwapBaseOut:se.ClmmSwapBaseIn]}),f.addCustomComputeBudget(m),f.versionBuild({txVersion:l})}async lockLp(e){var c,m,l,d,p;let{poolInfo:t,lpAmount:i,computeBudgetConfig:r,txVersion:o}=e;i.isZero()&&this.logAndCreateError("lpAmount must greater than zero",{lpAmount:i.toString()});let s=this.createTxBuilder(),a=(c=e.poolKeys)!=null?c:await this.getCpmmPoolKeys(t.id),u=await qi({poolInfo:t,poolKeys:a,ownerInfo:{wallet:this.scope.ownerPubKey,feePayer:(m=e.feePayer)!=null?m:this.scope.ownerPubKey},lockProgram:(l=e.programId)!=null?l:Lt,lockAuthProgram:(d=e.authProgram)!=null?d:Rt,lpAmount:i,withMetadata:(p=e.withMetadata)!=null?p:!0,getEphemeralSigners:e.getEphemeralSigners});return s.addInstruction(u),s.addCustomComputeBudget(r),s.versionBuild({txVersion:o,extInfo:u.address})}async harvestLockLp(e){var F;let{poolInfo:t,lpFeeAmount:i,nftMint:r,programId:o=Lt,authProgram:s=Rt,cpmmProgram:a,computeBudgetConfig:u,txVersion:c}=e;i.isZero()&&this.logAndCreateError("lpFeeAmount must greater than zero",{lpAmount:i.toString()});let m=e.feePayer||this.scope.ownerPubKey,l=this.createTxBuilder(),[d,p]=[new B(t.mintA.address),new B(t.mintB.address)],y=d.equals(ae),f=p.equals(ae),b,P,{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new B(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:!y,checkCreateATAOwner:!1});b=k,A&&l.addInstruction(A);let{account:g,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new B(t.mintB.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:!f,checkCreateATAOwner:!1});P=g,T&&l.addInstruction(T),(!b||!P)&&this.logAndCreateError("cannot found target token accounts",{tokenAccountA:b,tokenAccountB:P});let h=(F=e.poolKeys)!=null?F:await this.getCpmmPoolKeys(t.id),{publicKey:N}=ye(m,r,fe),{publicKey:M}=Ut(o,r),{publicKey:v}=ye(s,new B(t.lpMint.address),fe);return l.addInstruction({instructions:[Gi({programId:o!=null?o:Lt,nftOwner:this.scope.ownerPubKey,auth:s!=null?s:Rt,nftMint:r,nftAccount:N,lockPda:M,poolId:new B(t.id),mintLp:new B(h.mintLp.address),userVaultA:b,userVaultB:P,poolVaultA:new B(h.vault.A),poolVaultB:new B(h.vault.B),mintA:d,mintB:p,lockLpVault:v,lpFeeAmount:i,cpmmProgram:a==null?void 0:a.programId,cpmmAuthProgram:a==null?void 0:a.authProgram})],instructionTypes:[se.CpmmCollectLockFee]}),l.addCustomComputeBudget(u),l.versionBuild({txVersion:c})}computeSwapAmount({pool:e,amountIn:t,outputMint:i,slippage:r}){let o=i.toString()===e.mintB.address,s=Vt.swap(t,o?e.baseReserve:e.quoteReserve,o?e.quoteReserve:e.baseReserve,e.configInfo.tradeFeeRate),a=new ee(s.destinationAmountSwapped.toString()).div(s.sourceAmountSwapped.toString()),u=s.destinationAmountSwapped.mul(new Q((1-r)*1e4)).div(new Q(1e4));return{allTrade:s.sourceAmountSwapped.eq(t),amountIn:t,amountOut:s.destinationAmountSwapped,minAmountOut:u,executionPrice:a,fee:s.tradeFee,priceImpact:e.poolPrice.sub(a).div(e.poolPrice)}}computePairAmount({poolInfo:e,baseReserve:t,quoteReserve:i,amount:r,slippage:o,epochInfo:s,baseIn:a}){var g,T,h,N,M,v,F,E,D;let u=1-Number(o.toSignificant())/100,c=new Q(new ee(r).mul(10**e[a?"mintA":"mintB"].decimals).mul(u).toFixed(0)),m=we(c,e[a?"mintA":"mintB"].extensions.feeConfig,s,!1),l=c.sub((g=m.fee)!=null?g:new Q(0)),d=new Q(new ee(e.lpAmount).mul(10**e.lpMint.decimals).toFixed(0,ee.ROUND_DOWN));this.logDebug("baseReserve:",t.toString(),"quoteReserve:",i.toString()),this.logDebug("tokenIn:",a?e.mintA.symbol:e.mintB.symbol,"amountIn:",c.toString(),"amountInFee:",(h=(T=m.fee)==null?void 0:T.toString())!=null?h:0,"anotherToken:",a?e.mintB.symbol:e.mintA.symbol,"slippage:",`${o.toSignificant()}%`);let p=a?"base":"quote";this.logDebug("input side:",p);let y=l.mul(d).div(p==="base"?t:i),f={amount:pn,fee:void 0,expirationTime:void 0};if(!l.isZero()){let W=ps(y,t,i,d);this.logDebug("lpAmountData:",{amountA:W.amountA.toString(),amountB:W.amountB.toString()}),f=we(W[a?"amountB":"amountA"],e[a?"mintB":"mintA"].extensions.feeConfig,s,!0)}let b=new ue(new Q(1)).add(o),P=new ue(new Q(1)).sub(o),k=we(b.mul(f.amount.sub((N=f.fee)!=null?N:new Q(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0),A=we(P.mul(f.amount.sub((M=f.fee)!=null?M:new Q(0))).quotient,e[a?"mintB":"mintA"].extensions.feeConfig,s,!0);return this.logDebug("anotherAmount:",f.amount.toString(),"anotherAmountFee:",(F=(v=f.fee)==null?void 0:v.toString())!=null?F:0,"maxAnotherAmount:",k.amount.toString(),"maxAnotherAmountFee:",(D=(E=k.fee)==null?void 0:E.toString())!=null?D:0),{inputAmountFee:m,anotherAmount:f,maxAnotherAmount:k,minAnotherAmount:A,liquidity:y}}};function ps(n,e,t,i){let r=n.mul(e).div(i);!r.isZero()&&!n.mul(e).mod(i).isZero()&&(r=r.add(new Q(1)));let o=n.mul(t).div(i);return!o.isZero()&&!n.mul(t).mod(i).isZero()&&(o=o.add(new Q(1))),{amountA:r,amountB:o}}export{Nn as default};
//# sourceMappingURL=cpmm.mjs.map