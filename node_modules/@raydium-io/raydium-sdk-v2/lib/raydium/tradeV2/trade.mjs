var ho=Object.defineProperty,To=Object.defineProperties;var Bo=Object.getOwnPropertyDescriptors;var an=Object.getOwnPropertySymbols;var qi=Object.prototype.hasOwnProperty,Gi=Object.prototype.propertyIsEnumerable;var Di=(i,e,t)=>e in i?ho(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,V=(i,e)=>{for(var t in e||(e={}))qi.call(e,t)&&Di(i,t,e[t]);if(an)for(var t of an(e))Gi.call(e,t)&&Di(i,t,e[t]);return i},H=(i,e)=>To(i,Bo(e));var gt=(i,e)=>{var t={};for(var n in i)qi.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&an)for(var n of an(i))e.indexOf(n)<0&&Gi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as Ct}from"@solana/web3.js";import{createTransferInstruction as ko,TOKEN_PROGRAM_ID as be,TOKEN_2022_PROGRAM_ID as Wn}from"@solana/spl-token";import Dn from"bn.js";var Lt=9e15,dt=1e9,qn="0123456789abcdef",cn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",ln="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Gn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Lt,maxE:Lt,crypto:!1},Hi,tt,G=!0,dn="[DecimalError] ",mt=dn+"Invalid argument: ",Qi=dn+"Precision limit exceeded",Yi=dn+"crypto unavailable",ji="[object Decimal]",Ie=Math.floor,ke=Math.pow,Io=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,xo=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,So=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Zi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,De=1e7,D=7,Ko=9007199254740991,Co=cn.length-1,Un=ln.length-1,I={toStringTag:ji};I.absoluteValue=I.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),v(i)};I.ceil=function(){return v(new this.constructor(this),this.e+1,2)};I.clampedTo=I.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(mt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};I.comparedTo=I.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};I.cosine=I.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=No(n,nr(n,t)),n.precision=i,n.rounding=e,v(tt==2||tt==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};I.cubeRoot=I.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,d=l.constructor;if(!l.isFinite()||l.isZero())return new d(l);for(G=!1,o=l.s*ke(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Te(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ke(t,1/3),i=Ie((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new d(t),n.s=l.s):n=new d(o.toString()),s=(i=d.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=se(u.plus(l).times(a),u.plus(c),s+2,1),Te(a.d).slice(0,s)===(t=Te(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(v(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(v(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return G=!0,v(n,i,d.rounding,e)};I.decimalPlaces=I.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ie(this.e/D))*D,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};I.dividedBy=I.div=function(i){return se(this,new this.constructor(i))};I.dividedToIntegerBy=I.divToInt=function(i){var e=this,t=e.constructor;return v(se(e,new t(i),0,1,1),t.precision,t.rounding)};I.equals=I.eq=function(i){return this.cmp(i)===0};I.floor=function(){return v(new this.constructor(this),this.e+1,3)};I.greaterThan=I.gt=function(i){return this.cmp(i)>0};I.greaterThanOrEqualTo=I.gte=function(i){var e=this.cmp(i);return e==1||e===0};I.hyperbolicCosine=I.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/fn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Rt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return v(o,s.precision=t,s.rounding=n,!0)};I.hyperbolicSine=I.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Rt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/fn(5,i)),r=Rt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,v(r,e,t,!0)};I.hyperbolicTangent=I.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,se(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};I.inverseCosine=I.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?We(t,r,o):new t(0):new t(NaN):e.isZero()?We(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=We(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};I.inverseHyperbolicCosine=I.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,G=!1,t=t.times(t).minus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};I.inverseHyperbolicSine=I.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,G=!1,t=t.times(t).plus(1).sqrt().plus(t),G=!0,n.precision=i,n.rounding=e,t.ln())};I.inverseHyperbolicTangent=I.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?v(new o(r),i,e,!0):(o.precision=t=n-r.e,r=se(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};I.inverseSine=I.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=We(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};I.inverseTangent=I.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&d+4<=Un)return s=We(l,d+4,m).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(d+4<=Un)return s=We(l,d+4,m).times(.5),s.s=u.s,s}for(l.precision=a=d+10,l.rounding=1,t=Math.min(28,a/D+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(G=!1,e=Math.ceil(a/D),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),G=!0,v(s,l.precision=d,l.rounding=m,!0)};I.isFinite=function(){return!!this.d};I.isInteger=I.isInt=function(){return!!this.d&&Ie(this.e/D)>this.d.length-2};I.isNaN=function(){return!this.s};I.isNegative=I.isNeg=function(){return this.s<0};I.isPositive=I.isPos=function(){return this.s>0};I.isZero=function(){return!!this.d&&this.d[0]===0};I.lessThan=I.lt=function(i){return this.cmp(i)<0};I.lessThanOrEqualTo=I.lte=function(i){return this.cmp(i)<1};I.logarithm=I.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,d=l.precision,m=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(G=!1,a=d+p,s=lt(u,a),n=e?mn(l,a+10):lt(i,a),c=se(s,n,a,1),Vt(c.d,r=d,m))do if(a+=10,s=lt(u,a),n=e?mn(l,a+10):lt(i,a),c=se(s,n,a,1),!o){+Te(c.d).slice(r+1,r+15)+1==1e14&&(c=v(c,d+1,0));break}while(Vt(c.d,r+=10,m));return G=!0,v(c,d,m)};I.minus=I.sub=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,p=this,y=p.constructor;if(i=new y(i),!p.d||!i.d)return!p.s||!i.s?i=new y(NaN):p.d?i.s=-i.s:i=new y(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(u=p.d,m=i.d,a=y.precision,c=y.rounding,!u[0]||!m[0]){if(m[0])i.s=-i.s;else if(u[0])i=new y(p);else return new y(c===3?-0:0);return G?v(i,a,c):i}if(t=Ie(i.e/D),l=Ie(p.e/D),u=u.slice(),o=l-t,o){for(d=o<0,d?(e=u,o=-o,s=m.length):(e=m,t=l,s=u.length),n=Math.max(Math.ceil(a/D),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=m.length,d=n<s,d&&(s=n),n=0;n<s;n++)if(u[n]!=m[n]){d=u[n]<m[n];break}o=0}for(d&&(e=u,u=m,m=e,i.s=-i.s),s=u.length,n=m.length-s;n>0;--n)u[s++]=0;for(n=m.length;n>o;){if(u[--n]<m[n]){for(r=n;r&&u[--r]===0;)u[r]=De-1;--u[r],u[n]+=De}u[n]-=m[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=pn(u,t),G?v(i,a,c):i):new y(c===3?-0:0)};I.modulo=I.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?v(new n(t),n.precision,n.rounding):(G=!1,n.modulo==9?(e=se(t,i.abs(),0,3,1),e.s*=i.s):e=se(t,i,0,n.modulo,1),e=e.times(i),G=!0,t.minus(e))};I.naturalExponential=I.exp=function(){return Xn(this)};I.naturalLogarithm=I.ln=function(){return lt(this)};I.negated=I.neg=function(){var i=new this.constructor(this);return i.s=-i.s,v(i)};I.plus=I.add=function(i){var e,t,n,r,o,s,a,c,u,l,d=this,m=d.constructor;if(i=new m(i),!d.d||!i.d)return!d.s||!i.s?i=new m(NaN):d.d||(i=new m(i.d||d.s===i.s?d:NaN)),i;if(d.s!=i.s)return i.s=-i.s,d.minus(i);if(u=d.d,l=i.d,a=m.precision,c=m.rounding,!u[0]||!l[0])return l[0]||(i=new m(d)),G?v(i,a,c):i;if(o=Ie(d.e/D),n=Ie(i.e/D),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/D),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/De|0,u[r]%=De;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=pn(u,n),G?v(i,a,c):i};I.precision=I.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(mt+i);return t.d?(e=Ji(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};I.round=function(){var i=this,e=i.constructor;return v(new e(i),i.e+1,e.rounding)};I.sine=I.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=Ro(n,nr(n,t)),n.precision=i,n.rounding=e,v(tt>2?t.neg():t,i,e,!0)):new n(NaN)};I.squareRoot=I.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(G=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Te(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Ie((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(se(s,o,t+2,1)).times(.5),Te(o.d).slice(0,t)===(e=Te(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(v(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(v(n,c+1,1),i=!n.times(n).eq(s));break}return G=!0,v(n,c,l.rounding,i)};I.tangent=I.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=se(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,v(tt==2||tt==4?t.neg():t,i,e,!0)):new n(NaN)};I.times=I.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,d=l.constructor,m=l.d,p=(i=new d(i)).d;if(i.s*=l.s,!m||!m[0]||!p||!p[0])return new d(!i.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:!m||!p?i.s/0:i.s*0);for(t=Ie(l.e/D)+Ie(i.e/D),c=m.length,u=p.length,c<u&&(o=m,m=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+p[n]*m[r-n-1]+e,o[r--]=a%De|0,e=a/De|0;o[r]=(o[r]+e)%De|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=pn(o,t),G?v(i,d.precision,d.rounding):i};I.toBinary=function(i,e){return Hn(this,2,i,e)};I.toDecimalPlaces=I.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Le(i,0,dt),e===void 0?e=n.rounding:Le(e,0,8),v(t,i+t.e+1,e))};I.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,!0):(Le(i,0,dt),e===void 0?e=r.rounding:Le(e,0,8),n=v(new r(n),i+1,e),t=Qe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Qe(r):(Le(i,0,dt),e===void 0?e=o.rounding:Le(e,0,8),n=v(new o(r),i+r.e+1,e),t=Qe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};I.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,d,m,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(u=t=new f(1),n=c=new f(0),e=new f(n),o=e.e=Ji(y)-p.e-1,s=o%D,e.d[0]=ke(10,s<0?D+s:s),i==null)i=o>0?e:u;else{if(a=new f(i),!a.isInt()||a.lt(u))throw Error(mt+a);i=a.gt(e)?o>0?e:u:a}for(G=!1,a=new f(Te(y)),l=f.precision,f.precision=o=y.length*D*2;d=se(a,e,0,1,1),r=t.plus(d.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(d.times(r)),c=r,r=e,e=a.minus(d.times(r)),a=r;return r=se(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=p.s,m=se(u,n,o,1).minus(p).abs().cmp(se(c,t,o,1).minus(p).abs())<1?[u,n]:[c,t],f.precision=l,G=!0,m};I.toHexadecimal=I.toHex=function(i,e){return Hn(this,16,i,e)};I.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Le(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(G=!1,t=se(t,i,0,e,1).times(i),G=!0,v(t)):(i.s=t.s,t=i),t};I.toNumber=function(){return+this};I.toOctal=function(i,e){return Hn(this,8,i,e)};I.toPower=I.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ke(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return v(a,n,o);if(e=Ie(i.e/D),e>=i.d.length-1&&(t=u<0?-u:u)<=Ko)return r=$i(c,a,t,n),i.s<0?new c(1).div(r):v(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ke(+a,u),e=t==0||!isFinite(t)?Ie(u*(Math.log("0."+Te(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(G=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Xn(i.times(lt(a,n+t)),n),r.d&&(r=v(r,n+5,1),Vt(r.d,n,o)&&(e=n+10,r=v(Xn(i.times(lt(a,e+t)),e),e+5,1),+Te(r.d).slice(n+1,n+15)+1==1e14&&(r=v(r,n+1,0)))),r.s=s,G=!0,c.rounding=o,v(r,n,o))};I.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Qe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Le(i,1,dt),e===void 0?e=r.rounding:Le(e,0,8),n=v(new r(n),i,e),t=Qe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};I.toSignificantDigits=I.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Le(i,1,dt),e===void 0?e=n.rounding:Le(e,0,8)),v(new n(t),i,e)};I.toString=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};I.truncated=I.trunc=function(){return v(new this.constructor(this),this.e+1,1)};I.valueOf=I.toJSON=function(){var i=this,e=i.constructor,t=Qe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Te(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=D-n.length,t&&(o+=ct(t)),o+=n;s=i[e],n=s+"",t=D-n.length,t&&(o+=ct(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Le(i,e,t){if(i!==~~i||i<e||i>t)throw Error(mt+i)}function Vt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=D,r=0):(r=Math.ceil((e+1)/D),e%=D),o=ke(10,D-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ke(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ke(10,e-3)-1,s}function un(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=qn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function No(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/fn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Rt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var se=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,d,m,p,y,f,b,g,w,A,k,B,h,K,R,W,T,O,$,z=n.constructor,ye=n.s==r.s?1:-1,J=n.d,_=r.d;if(!J||!J[0]||!_||!_[0])return new z(!n.s||!r.s||(J?_&&J[0]==_[0]:!_)?NaN:J&&J[0]==0||!_?ye*0:ye/0);for(c?(p=1,l=n.e-r.e):(c=De,p=D,l=Ie(n.e/p)-Ie(r.e/p)),O=_.length,W=J.length,g=new z(ye),w=g.d=[],d=0;_[d]==(J[d]||0);d++);if(_[d]>(J[d]||0)&&l--,o==null?(h=o=z.precision,s=z.rounding):a?h=o+(n.e-r.e)+1:h=o,h<0)w.push(1),y=!0;else{if(h=h/p+2|0,d=0,O==1){for(m=0,_=_[0],h++;(d<W||m)&&h--;d++)K=m*c+(J[d]||0),w[d]=K/_|0,m=K%_|0;y=m||d<W}else{for(m=c/(_[0]+1)|0,m>1&&(_=i(_,m,c),J=i(J,m,c),O=_.length,W=J.length),R=O,A=J.slice(0,O),k=A.length;k<O;)A[k++]=0;$=_.slice(),$.unshift(0),T=_[0],_[1]>=c/2&&++T;do m=0,u=e(_,A,O,k),u<0?(B=A[0],O!=k&&(B=B*c+(A[1]||0)),m=B/T|0,m>1?(m>=c&&(m=c-1),f=i(_,m,c),b=f.length,k=A.length,u=e(f,A,b,k),u==1&&(m--,t(f,O<b?$:_,b,c))):(m==0&&(u=m=1),f=_.slice()),b=f.length,b<k&&f.unshift(0),t(A,f,k,c),u==-1&&(k=A.length,u=e(_,A,O,k),u<1&&(m++,t(A,O<k?$:_,k,c))),k=A.length):u===0&&(m++,A=[0]),w[d++]=m,u&&A[0]?A[k++]=J[R]||0:(A=[J[R]],k=1);while((R++<W||A[0]!==void 0)&&h--);y=A[0]!==void 0}w[0]||w.shift()}if(p==1)g.e=l,Hi=y;else{for(d=1,m=w[0];m>=10;m/=10)d++;g.e=d+l*p-1,v(g,a?o+g.e+1:o,s,y)}return g}}();function v(i,e,t,n){var r,o,s,a,c,u,l,d,m,p=i.constructor;e:if(e!=null){if(d=i.d,!d)return i;for(r=1,a=d[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=D,s=e,l=d[m=0],c=l/ke(10,r-s-1)%10|0;else if(m=Math.ceil((o+1)/D),a=d.length,m>=a)if(n){for(;a++<=m;)d.push(0);l=c=0,r=1,o%=D,s=o-D+1}else break e;else{for(l=a=d[m],r=1;a>=10;a/=10)r++;o%=D,s=o-D+r,c=s<0?0:l/ke(10,r-s-1)%10|0}if(n=n||e<0||d[m+1]!==void 0||(s<0?l:l%ke(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ke(10,r-s):0:d[m-1])%10&1||t==(i.s<0?8:7)),e<1||!d[0])return d.length=0,u?(e-=i.e+1,d[0]=ke(10,(D-e%D)%D),i.e=-e||0):d[0]=i.e=0,i;if(o==0?(d.length=m,a=1,m--):(d.length=m+1,a=ke(10,D-o),d[m]=s>0?(l/ke(10,r-s)%ke(10,s)|0)*a:0),u)for(;;)if(m==0){for(o=1,s=d[0];s>=10;s/=10)o++;for(s=d[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,d[0]==De&&(d[0]=1));break}else{if(d[m]+=a,d[m]!=De)break;d[m--]=0,a=1}for(o=d.length;d[--o]===0;)d.pop()}return G&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Qe(i,e,t){if(!i.isFinite())return tr(i);var n,r=i.e,o=Te(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ct(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+ct(-r-1)+o,t&&(n=t-s)>0&&(o+=ct(n))):r>=s?(o+=ct(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+ct(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=ct(n))),o}function pn(i,e){var t=i[0];for(e*=D;t>=10;t/=10)e++;return e}function mn(i,e,t){if(e>Co)throw G=!0,t&&(i.precision=t),Error(Qi);return v(new i(cn),e,1,!0)}function We(i,e,t){if(e>Un)throw Error(Qi);return v(new i(ln),e,t,!0)}function Ji(i){var e=i.length-1,t=e*D+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function ct(i){for(var e="";i--;)e+="0";return e}function $i(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/D+4);for(G=!1;;){if(t%2&&(o=o.times(e),Xi(o.d,s)&&(r=!0)),t=Ie(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Xi(e.d,s)}return G=!0,o}function Ui(i){return i.d[i.d.length-1]&1}function er(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Xn(i,e){var t,n,r,o,s,a,c,u=0,l=0,d=0,m=i.constructor,p=m.rounding,y=m.precision;if(!i.d||!i.d[0]||i.e>17)return new m(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(G=!1,c=y):c=e,a=new m(.03125);i.e>-2;)i=i.times(a),d+=5;for(n=Math.log(ke(2,d))/Math.LN10*2+5|0,c+=n,t=o=s=new m(1),m.precision=c;;){if(o=v(o.times(i),c,1),t=t.times(++l),a=s.plus(se(o,t,c,1)),Te(a.d).slice(0,c)===Te(s.d).slice(0,c)){for(r=d;r--;)s=v(s.times(s),c,1);if(e==null)if(u<3&&Vt(s.d,c-n,p,u))m.precision=c+=10,t=o=a=new m(1),l=0,u++;else return v(s,m.precision=y,p,G=!0);else return m.precision=y,s}s=a}}function lt(i,e){var t,n,r,o,s,a,c,u,l,d,m,p=1,y=10,f=i,b=f.d,g=f.constructor,w=g.rounding,A=g.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new g(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(G=!1,l=A):l=e,g.precision=l+=y,t=Te(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Te(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return u=mn(g,l+2,A).times(o+""),f=lt(new g(n+"."+t.slice(1)),l-y).plus(u),g.precision=A,e==null?v(f,A,w,G=!0):f;for(d=f,c=s=f=se(f.minus(1),f.plus(1),l,1),m=v(f.times(f),l,1),r=3;;){if(s=v(s.times(m),l,1),u=c.plus(se(s,new g(r),l,1)),Te(u.d).slice(0,l)===Te(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(mn(g,l+2,A).times(o+""))),c=se(c,new g(p),l,1),e==null)if(Vt(c.d,l-y,w,a))g.precision=l+=y,u=s=f=se(d.minus(1),d.plus(1),l,1),m=v(f.times(f),l,1),r=a=1;else return v(c,g.precision=A,w,G=!0);else return g.precision=A,c;c=u,r+=2}}function tr(i){return String(i.s*i.s/0)}function zn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%D,t<0&&(n+=D),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=D;n<r;)i.d.push(+e.slice(n,n+=D));e=e.slice(n),n=D-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),G&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Lo(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Zi.test(e))return zn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(xo.test(e))t=16,e=e.toLowerCase();else if(Io.test(e))t=2;else if(So.test(e))t=8;else throw Error(mt+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=$i(n,new n(t),o,o*2)),u=un(e,t,De),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=pn(u,l),i.d=u,G=!1,s&&(i=se(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ke(2,c):Wt.pow(2,c))),G=!0,i)}function Ro(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Rt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/fn(5,t)),e=Rt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Rt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,d=Math.ceil(l/D);for(G=!1,c=t.times(t),a=new i(n);;){if(s=se(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=se(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[d]!==void 0){for(o=d;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return G=!0,s.d.length=d+1,s}function fn(i,e){for(var t=i;--e;)t*=i;return t}function nr(i,e){var t,n=e.s<0,r=We(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return tt=n?4:1,e;if(t=e.divToInt(r),t.isZero())tt=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return tt=Ui(t)?n?2:3:n?4:1,e;tt=Ui(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Hn(i,e,t,n){var r,o,s,a,c,u,l,d,m,p=i.constructor,y=t!==void 0;if(y?(Le(t,1,dt),n===void 0?n=p.rounding:Le(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=tr(i);else{for(l=Qe(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),m=new p(1),m.e=l.length-s,m.d=un(Qe(m),10,r),m.e=m.d.length),d=un(l,10,r),o=c=d.length;d[--c]==0;)d.pop();if(!d[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=d,i.e=o,i=se(i,m,t,n,0,r),d=i.d,o=i.e,u=Hi),s=d[t],a=r/2,u=u||d[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&d[t-1]&1||n===(i.s<0?8:7)),d.length=t,u)for(;++d[--t]>r-1;)d[t]=0,t||(++o,d.unshift(1));for(c=d.length;!d[c-1];--c);for(s=0,l="";s<c;s++)l+=qn.charAt(d[s]);if(y){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(d=un(l,r,e),c=d.length;!d[c-1];--c);for(s=1,l="1.";s<c;s++)l+=qn.charAt(d[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Xi(i,e){if(i.length>e)return i.length=e,!0}function Oo(i){return new this(i).abs()}function Mo(i){return new this(i).acos()}function Eo(i){return new this(i).acosh()}function Fo(i,e){return new this(i).plus(e)}function _o(i){return new this(i).asin()}function vo(i){return new this(i).asinh()}function Vo(i){return new this(i).atan()}function Wo(i){return new this(i).atanh()}function Do(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=We(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?We(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=We(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(se(i,e,o,1)),e=We(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(se(i,e,o,1)),t}function qo(i){return new this(i).cbrt()}function Go(i){return v(i=new this(i),i.e+1,2)}function Uo(i,e,t){return new this(i).clamp(e,t)}function Xo(i){if(!i||typeof i!="object")throw Error(dn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,dt,"rounding",0,8,"toExpNeg",-Lt,0,"toExpPos",0,Lt,"maxE",0,Lt,"minE",-Lt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Gn[t]),(n=i[t])!==void 0)if(Ie(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(mt+t+": "+n);if(t="crypto",r&&(this[t]=Gn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Yi);else this[t]=!1;else throw Error(mt+t+": "+n);return this}function zo(i){return new this(i).cos()}function Ho(i){return new this(i).cosh()}function ir(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,zi(o)){u.s=o.s,G?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;G?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return zn(u,o.toString())}else if(c!=="string")throw Error(mt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Zi.test(o)?zn(u,o):Lo(u,o)}if(r.prototype=I,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Xo,r.clone=ir,r.isDecimal=zi,r.abs=Oo,r.acos=Mo,r.acosh=Eo,r.add=Fo,r.asin=_o,r.asinh=vo,r.atan=Vo,r.atanh=Wo,r.atan2=Do,r.cbrt=qo,r.ceil=Go,r.clamp=Uo,r.cos=zo,r.cosh=Ho,r.div=Qo,r.exp=Yo,r.floor=jo,r.hypot=Zo,r.ln=Jo,r.log=$o,r.log10=ts,r.log2=es,r.max=ns,r.min=is,r.mod=rs,r.mul=os,r.pow=ss,r.random=as,r.round=us,r.sign=cs,r.sin=ls,r.sinh=ms,r.sqrt=ds,r.sub=ps,r.sum=fs,r.tan=bs,r.tanh=ys,r.trunc=gs,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Qo(i,e){return new this(i).div(e)}function Yo(i){return new this(i).exp()}function jo(i){return v(i=new this(i),i.e+1,3)}function Zo(){var i,e,t=new this(0);for(G=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return G=!0,new this(1/0);t=e}return G=!0,t.sqrt()}function zi(i){return i instanceof Wt||i&&i.toStringTag===ji||!1}function Jo(i){return new this(i).ln()}function $o(i,e){return new this(i).log(e)}function es(i){return new this(i).log(2)}function ts(i){return new this(i).log(10)}function ns(){return er(this,arguments,"lt")}function is(){return er(this,arguments,"gt")}function rs(i,e){return new this(i).mod(e)}function os(i,e){return new this(i).mul(e)}function ss(i,e){return new this(i).pow(e)}function as(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Le(i,1,dt),n=Math.ceil(i/D),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Yi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=D,n&&i&&(r=ke(10,D-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=D)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<D&&(t-=D-n)}return s.e=t,s.d=a,s}function us(i){return v(i=new this(i),i.e+1,this.rounding)}function cs(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function ls(i){return new this(i).sin()}function ms(i){return new this(i).sinh()}function ds(i){return new this(i).sqrt()}function ps(i,e){return new this(i).sub(e)}function fs(){var i=0,e=arguments,t=new this(e[i]);for(G=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return G=!0,v(t,this.precision,this.rounding)}function bs(i){return new this(i).tan()}function ys(i){return new this(i).tanh()}function gs(i){return v(i=new this(i),i.e+1,1)}I[Symbol.for("nodejs.util.inspect.custom")]=I.toString;I[Symbol.toStringTag]="Decimal";var Wt=I.constructor=ir(Gn);cn=new Wt(cn);ln=new Wt(ln);var M=Wt;import{PublicKey as sr}from"@solana/web3.js";import{get as rr,set as Ps}from"lodash";var Qn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},or={},As={};function ae(i){let e=rr(or,i);if(!e){let t=rr(As,i);e=new Qn({name:i,logLevel:t}),Ps(or,i,e)}return e}import{MINT_SIZE as ks,TOKEN_PROGRAM_ID as ws,getTransferFeeConfig as hs,unpackMint as Ts}from"@solana/spl-token";var Yn=ae("Raydium_accountInfo_util");async function nt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=V({batchRequest:!1},t),s=jn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(d=>{let m=i._buildArgs([d.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:m}}),u=jn(c,10);a=(await(await Promise.all(u.map(async d=>await i._rpcBatchRequest(d)))).flat()).map(d=>(d.error&&Yn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${d.error.message}`),d.result.value.map(m=>{if(m){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:g}=m;return p.length!==2&&p[1]!=="base64"&&Yn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new sr(b),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&Yn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function Pt(i,e,t){let n=await nt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>H(V({},r),{accountInfo:n[o]}))}async function Zn({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await Pt(i,e.map(c=>({pubkey:Ye(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<ks){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Ts(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=H(V({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||ws,feeConfig:(a=hs(u))!=null?a:void 0})}return r[sr.default.toBase58()]=r[qe.toBase58()],r}import rt from"bn.js";import Ls from"big.js";import gn from"bn.js";import Bs from"toformat";var Is=Bs,Dt=Is;import yn from"big.js";import Ss from"bn.js";import Ks from"decimal.js-light";import qt from"bn.js";var ar=9007199254740991;function ue(i){let e=ae("Raydium_parseBigNumberish");if(i instanceof qt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new qt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ar||i<=-ar)&&e.logWithError(`BigNumberish number overflow: ${i}`),new qt(String(i))):typeof i=="bigint"?new qt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new qt(0))}var bn=ae("module/fraction"),Jn=Dt(yn),Gt=Dt(Ks),Cs={[0]:Gt.ROUND_DOWN,[1]:Gt.ROUND_HALF_UP,[2]:Gt.ROUND_UP},Ns={[0]:yn.roundDown,[1]:yn.roundHalfUp,[2]:yn.roundUp},re=class{constructor(e,t=new Ss(1)){this.numerator=ue(e),this.denominator=ue(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new re(this.denominator,this.numerator)}add(e){let t=e instanceof re?e:new re(ue(e));return this.denominator.eq(t.denominator)?new re(this.numerator.add(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof re?e:new re(ue(e));return this.denominator.eq(t.denominator)?new re(this.numerator.sub(t.numerator),this.denominator):new re(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof re?e:new re(ue(e));return new re(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof re?e:new re(ue(e));return new re(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||bn.logWithError(`${e} is not an integer.`),e<=0&&bn.logWithError(`${e} is not positive.`),Gt.set({precision:e+1,rounding:Cs[n]});let r=new Gt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||bn.logWithError(`${e} is not an integer.`),e<0&&bn.logWithError(`${e} is negative.`),Jn.DP=e,Jn.RM=Ns[n]||1,new Jn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Rs=ae("Raydium_amount"),ur=Dt(Ls);function Os(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Rs.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ce=class extends re{constructor(t,n,r=!0,o){let s=new gn(0),a=$n.pow(new gn(t.decimals));if(r)s=ue(n);else{let c=new gn(0),u=new gn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,d]=Os(n.toString(),t.decimals);c=ue(l),u=ue(d)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ce(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ce(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return ur.DP=this.token.decimals,new ur(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Ms}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as cr}from"@solana/spl-token";var ei={chainId:101,address:Ms.default.toBase58(),programId:cr.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:cr.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as ii}from"@solana/web3.js";import{PublicKey as de,SystemProgram as lr,SYSVAR_RENT_PUBKEY as Es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fs}from"@solana/spl-token";function x({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ic=[x({pubkey:Fs,isWritable:!1}),x({pubkey:lr.programId,isWritable:!1}),x({pubkey:Es,isWritable:!1})];function ti({publicKey:i,transformSol:e}){let t=ni(i.toString());if(t instanceof de)return e&&t.equals(Ut)?qe:t;if(e&&t.toString()===Ut.toBase58())return qe;if(typeof t=="string"){if(t===de.default.toBase58())return de.default;try{return new de(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function ni(i){try{return new de(i)}catch{return i}}var Pn=new de("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ot=new de("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),pt=new de("SysvarRent111111111111111111111111111111111"),rc=new de("SysvarC1ock11111111111111111111111111111111"),ft=new de("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),oc=new de("Sysvar1nstructions1111111111111111111111111"),_s=lr.programId,sc=new de("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ac=new de("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),uc=new de("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),cc=new de("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),lc=new de("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),mc=new de("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),dc=new de("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),pc=new de("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),fc=new de("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),bc=new de("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),yc=new de("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),qe=new de("So11111111111111111111111111111111111111112"),Ut=de.default;function Ye(i){return ti({publicKey:i,transformSol:!0})}var ri=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ut.toBase58()||e instanceof ii&&Ut.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new ii(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?ii.default:ti({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ee=ri;Ee.WSOL=new ri(H(V({},je),{mint:je.address}));var oi=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},An=oi;An.SOL=new oi(ei);import vs from"bn.js";var mr=new re(new vs(100)),it=class extends re{toSignificant(e=5,t,n){return this.mul(mr).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(mr).toFixed(e,t,n)}};var Vs=ae("Raydium_price"),Re=class extends re{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new re(si(n.decimals),si(r.decimals))}get raw(){return new re(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Re({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Vs.logWithError("mul token not equals");let n=super.mul(t);return new Re({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as Ws}from"@solana/web3.js";import Ds from"bn.js";function pr(i){return typeof i=="object"&&i!==null&&![Ee,ce,Ws,re,Ds,Re,it].some(e=>typeof e=="object"&&i instanceof e)}function At(i){return typeof i=="string"?ni(i):Array.isArray(i)?i.map(e=>At(e)):pr(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,At(t)])):i}var dr=new rt(0),qs=new rt(1),ml=new rt(2),dl=new rt(3),pl=new rt(5),$n=new rt(10),fl=new rt(100),bl=new rt(1e3),yl=new rt(1e4);function si(i){return $n.pow(ue(i))}function jn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Ys}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as js}from"@solana/spl-token";import{ComputeBudgetProgram as fr,Keypair as yr,PublicKey as Gs,Transaction as gr,TransactionMessage as Us,VersionedTransaction as Pr}from"@solana/web3.js";var ee={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Xs}from"@solana/spl-token";var br=ae("Raydium_txUtil"),Ar=1644;function kn(i){let e=[],t=[];return i.microLamports&&(e.push(fr.setComputeUnitPrice({microLamports:i.microLamports})),t.push(ee.SetComputeUnitPrice)),i.units&&(e.push(fr.setComputeUnitLimit({units:i.units})),t.push(ee.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Mt(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function wn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function zs(i,e){i.length<1&&br.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&br.logWithError(`no signers provided:, ${e.toString()}`);let t=new gr;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ar}catch{return!1}}function ge(i,e){let[t,n]=Gs.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Xt({instructions:i,payer:e,signers:t}){return zs(i,[e,...t])}function zt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=yr.generate().publicKey.toString()}){let o=new Us({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Pr(o).serialize()).toString("base64").length<Ar}catch{return!1}}var Hs=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),Qs=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Pr&&(e=Hs(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function kt(i){let e=[];return i.forEach(t=>{t instanceof gr&&(t.recentBlockhash||(t.recentBlockhash=Xs.toBase58()),t.feePayer||(t.feePayer=yr.generate().publicKey)),e.push(Qs(t))}),console.log("simulate tx string:",e),e}function Se(i,e,t){return ge([i.toBuffer(),(t!=null?t:js).toBuffer(),e.toBuffer()],new Ys("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as j}from"@solana/web3.js";var _l=new j("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),vl=new j("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Vl=new j("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Wl=new j("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Dl=new j("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ql=new j("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ai=new j("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),kr=new j("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Gl=new j("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),wr=new j("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ui=new j("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Zs=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Js=new j("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Ul=new j("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Xl=new j("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),zl=new j("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Hl=new j("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ql=new j("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Yl=new j("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ci=new j("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),$s=new j("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),jl=new j("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),ea=new j("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),ta=new j("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),na=new j("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Zl=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ia=new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Jl=new j("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ra=new j("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var $l={SERUM_MARKET:j.default,OPENBOOK_MARKET:new j("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:j.default,FarmV3:new j("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new j("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new j("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new j("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new j("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new j("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new j("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new j("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:ea,CREATE_CPMM_POOL_AUTH:ta,CREATE_CPMM_POOL_FEE_ACC:na,FEE_DESTINATION_ID:new j("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ia,LCOK_CPMM_AUTH:ra};import Ge from"bn.js";var Ht=1e4;function pe(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=H(V({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new Ge(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ht){let c=new Ge(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=hn(i.mul(new Ge(Ht)),new Ge(Ht-o.transferFeeBasisPoints)),u=new Ge(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,d=hn(l.mul(new Ge(o.transferFeeBasisPoints)),new Ge(Ht)),m=d.gt(s)?s:d;return{amount:l,fee:m,expirationTime:a}}else{let c=hn(i.mul(new Ge(o.transferFeeBasisPoints)),new Ge(Ht)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function Ue(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function hn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new Ge(0))?t.add(new Ge(1)):t}import{PublicKey as hr,AddressLookupTableAccount as Tn}from"@solana/web3.js";async function li({connection:i,address:e}){let t=await nt(i,[...new Set(e.map(r=>r.toString()))].map(r=>new hr(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new Tn({key:s,state:Tn.deserialize(o.data)});n[s.toString()]=a,Bn[s.toString()]=a}return n}var Bn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Tn({key:new hr("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Tn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Qt,sendAndConfirmTransaction as mi,Transaction as Yt,TransactionMessage as jt,VersionedTransaction as Zt}from"@solana/web3.js";import oa from"axios";var In=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await oa.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=kn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Qt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(V({},t||{})):this.build(t)}build(e){var n;let t=new Yt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await Mt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),kt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await mi(this.connection,t,this.signers.find(d=>d.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var g;let{sequentially:d,onTxUpdate:m,skipTxCount:p=0,recentBlockHash:y,skipPreflight:f=!0}=l||{},b=y!=null?y:await Mt(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(d){let w=[],A=0;for(let k of s){if(++A,A<=p)continue;let B=await mi(this.connection,k,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});w.push(B)}return{txIds:w,signedTxs:s}}return{txIds:await await Promise.all(s.map(async w=>(w.recentBlockhash=b,await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let w=s.map((k,B)=>(k.recentBlockhash=b,a[B].length&&k.sign(...a[B]),k));kt(w);let A=await this.signAllTransactions(w);if(d){let k=0,B=[],h=async()=>{if(!A[k])return;let K=await this.connection.sendRawTransaction(A[k].serialize(),{skipPreflight:f});B.push({txId:K,status:"sent",signedTx:A[k]}),m==null||m([...B]),k++,this.connection.onSignature(K,R=>{let W=B.findIndex(T=>T.txId===K);W>-1&&(B[W].status=R.err?"error":"success"),m==null||m([...B]),R.err||h()},"processed"),this.connection.getSignatureStatus(K)};return await h(),{txIds:B.map(K=>K.txId),signedTxs:A}}else{let k=[];for(let B=0;B<A.length;B+=1){let h=await this.connection.sendRawTransaction(A[B].serialize(),{skipPreflight:f});k.push(h)}return{txIds:k,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=y,s=gt(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=V(V({},this.cluster==="devnet"?{}:Bn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let b of c)a[b]===void 0&&u.push(new Qt(b));let l=await li({connection:this.connection,address:u});for(let[b,g]of Object.entries(l))a[b]=g;let d=r?Qt.default.toBase58():o!=null?o:await Mt(this.connection,this.blockhashCommitment),m=new jt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(b=>b.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Zt(m);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async b=>{var A;let{skipPreflight:g=!0,sendAndConfirm:w}=b||{};if(kt([p]),(A=this.owner)!=null&&A.isKeyPair){let k=await this.connection.sendTransaction(p,{skipPreflight:g});return w&&await wn(this.connection,k),{txId:k,signedTx:p}}if(this.signAllTransactions){let k=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(k[0],{skipPreflight:g}),signedTx:k[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(d=>d.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,d)=>{l.sign(a[d])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var f;let{sequentially:d,onTxUpdate:m,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(b=>b.message.recentBlockhash=p),kt(s),(f=this.owner)!=null&&f.isKeyPair){if(d){let b=[];for(let g of s){let w=await this.connection.sendTransaction(g,{skipPreflight:y});await wn(this.connection,w),b.push(w)}return{txIds:b,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendTransaction(b,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s);if(d){let g=0,w=[],A=async()=>{if(!b[g])return;let k=await this.connection.sendTransaction(b[g],{skipPreflight:y});w.push({txId:k,status:"sent",signedTx:b[g]}),m==null||m([...w]),g++,this.connection.onSignature(k,B=>{let h=w.findIndex(K=>K.txId===k);h>-1&&(w[h].status=B.err?"error":"success"),m==null||m([...w]),B.err||A()},"processed"),this.connection.getSignatureStatus(k)};return A(),{txIds:[],signedTxs:b}}else{let g=[];for(let w=0;w<b.length;w+=1){let A=await this.connection.sendTransaction(b[w],{skipPreflight:y});g.push(A)}return{txIds:g,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=gt(u,["computeBudgetConfig"]),r=t?kn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((d,m)=>H(V({},d),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(d=>{let m=[...c,d],p=t?[...r.instructions,...m]:m,f=[...new Set(m.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(b=>new Qt(b));if(c.length<12&&Xt({instructions:p,payer:this.feePayer,signers:f})||Xt({instructions:m,payer:this.feePayer,signers:f}))c.push(d);else{if(c.length===0)throw Error("item ins too big");Xt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:f})?s.push(new Yt().add(...r.instructions,...c)):s.push(new Yt().add(...c)),a.push(Array.from(new Set(c.map(b=>b.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(b=>o[b]).filter(b=>b!==void 0)),c=[d]}}),c.length>0){let m=[...new Set(c.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Xt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:m.map(p=>p.publicKey)})?s.push(new Yt().add(...r.instructions,...c)):s.push(new Yt().add(...c)),a.push(m)}return s.forEach(d=>d.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(d=>{d.some(m=>m.publicKey.equals(this.owner.publicKey))||d.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async d=>{var w;let{sequentially:m,onTxUpdate:p,skipTxCount:y=0,recentBlockHash:f,skipPreflight:b=!0}=d||{},g=f!=null?f:await Mt(this.connection,this.blockhashCommitment);if(s.forEach(async(A,k)=>{A.recentBlockhash=g,a[k].length&&A.sign(...a[k])}),kt(s),(w=this.owner)!=null&&w.isKeyPair){if(m){let A=0,k=[];for(let B of s){if(++A,A<=y){k.push("tx skipped");continue}let h=await mi(this.connection,B,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:b});k.push(h)}return{txIds:k,signedTxs:s}}return{txIds:await Promise.all(s.map(async A=>await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:b}))),signedTxs:s}}if(this.signAllTransactions){let A=await this.signAllTransactions(s.slice(y,s.length)),k=[...s.slice(0,y),...A];if(m){let B=0,h=[],K=async()=>{if(!k[B])return;B<y&&(h.push({txId:"",status:"success",signedTx:k[B]}),p==null||p([...h]),B++,K());let R=await this.connection.sendRawTransaction(k[B].serialize(),{skipPreflight:b});h.push({txId:R,status:"sent",signedTx:k[B]}),p==null||p([...h]),B++,this.connection.onSignature(R,W=>{let T=h.findIndex(O=>O.txId===R);T>-1&&(h[T].status=W.err?"error":"success"),p==null||p([...h]),W.err||K()},"processed"),this.connection.getSignatureStatus(R)};return await K(),{txIds:h.map(R=>R.txId),signedTxs:k}}else{let B=[];for(let h=0;h<k.length;h+=1){let K=await this.connection.sendRawTransaction(k[h].serialize(),{skipPreflight:b});B.push(K)}return{txIds:B,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var g;let b=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=b,o=gt(b,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=V(V({},this.cluster==="devnet"?{}:Bn),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let w of a)s[w]===void 0&&c.push(new Qt(w));let u=await li({connection:this.connection,address:c});for(let[w,A]of Object.entries(u))s[w]=A;let l=t?kn(t):{instructions:[],instructionTypes:[]},d=await Mt(this.connection,this.blockhashCommitment),m=this.signers.reduce((w,A)=>H(V({},w),{[A.publicKey.toBase58()]:A}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(w=>{let A=[...f,w],k=t?[...l.instructions,...A]:A;if(f.length<12&&zt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||zt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(w);else{if(f.length===0)throw Error("item ins too big");let B={};for(let h of[...new Set(a)])s[h]!==void 0&&(B[h]=s[h]);if(t&&zt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let h=new jt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Zt(h))}else{let h=new jt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Zt(h))}y.push(Array.from(new Set(f.map(h=>h.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(h=>m[h]).filter(h=>h!==void 0)),f=[w]}}),f.length>0){let A=[...new Set(f.map(k=>k.keys.filter(B=>B.isSigner).map(B=>B.pubkey.toString())).flat()).values()].map(k=>m[k]).filter(k=>k!==void 0);if(t&&zt({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:d})){let k=new jt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new Zt(k))}else{let k=new jt({payerKey:this.feePayer,recentBlockhash:d,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new Zt(k))}y.push(A)}return(g=this.owner)!=null&&g.signer&&y.forEach(w=>{w.some(A=>A.publicKey.equals(this.owner.publicKey))||w.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async w=>{var R;let{sequentially:A,onTxUpdate:k,skipTxCount:B=0,recentBlockHash:h,skipPreflight:K=!0}=w||{};if(p.map(async(W,T)=>{y[T].length&&W.sign(y[T]),h&&(W.message.recentBlockhash=h)}),kt(p),(R=this.owner)!=null&&R.isKeyPair){if(A){let W=0,T=[];for(let O of p){if(++W,W<=B){console.log("skip tx: ",W),T.push("tx skipped");continue}let $=await this.connection.sendTransaction(O,{skipPreflight:K});await wn(this.connection,$),T.push($)}return{txIds:T,signedTxs:p}}return{txIds:await Promise.all(p.map(async W=>await this.connection.sendTransaction(W,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let W=await this.signAllTransactions(p.slice(B,p.length)),T=[...p.slice(0,B),...W];if(A){let O=0,$=[],z=async()=>{if(!T[O])return;if(O<B){$.push({txId:"",status:"success",signedTx:T[O]}),k==null||k([...$]),O++,z();return}let ye=await this.connection.sendTransaction(T[O],{skipPreflight:K});$.push({txId:ye,status:"sent",signedTx:T[O]}),k==null||k([...$]),O++,this.connection.onSignature(ye,J=>{let _=$.findIndex(Nt=>Nt.txId===ye);_>-1&&($[_].status=J.err?"error":"success"),k==null||k([...$]),J.err||z()},"processed"),this.connection.getSignatureStatus(ye)};return z(),{txIds:[],signedTxs:T}}else{let O=[];for(let $=0;$<T.length;$+=1){let z=await this.connection.sendTransaction(T[$],{skipPreflight:K});O.push(z)}return{txIds:O,signedTxs:T}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{PublicKey as fa}from"@solana/web3.js";import Sr,{isBN as Kr}from"bn.js";import{bits as _m,BitStructure as vm,blob as sa,Blob as Vm,cstr as Wm,f32 as Dm,f32be as qm,f64 as Gm,f64be as Um,greedy as Xm,Layout as aa,ns64 as zm,ns64be as Hm,nu64 as Qm,nu64be as Ym,offset as jm,s16 as Zm,s16be as Jm,s24 as $m,s24be as ed,s32 as ua,s32be as td,s40 as nd,s40be as id,s48 as rd,s48be as od,s8 as sd,seq as ca,struct as ad,Structure as la,u16 as ma,u16be as ud,u24 as cd,u24be as ld,u32 as md,u32be as dd,u40 as pd,u40be as fd,u48 as bd,u48be as yd,u8 as da,UInt as pa,union as gd,Union as Pd,unionLayoutDiscriminator as Ad,utf8 as kd}from"@solana/buffer-layout";var di=aa,Br=la;var pi=pa;var Ir=da,wt=ma;var Be=ua;var xr=ca;var Pe=sa;var Et=class extends di{constructor(t,n,r){super(t,r);this.blob=Pe(t),this.signed=n}decode(t,n=0){let r=new Sr(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Sr(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function U(i){return new pi(1,i)}function Fe(i){return new pi(4,i)}function P(i){return new Et(8,!1,i)}function Q(i){return new Et(16,!1,i)}function Cr(i){return new Et(8,!0,i)}function Nr(i){return new Et(16,!0,i)}var xn=class extends di{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new xn(Pe(32),e=>new fa(e),e=>e.toBuffer(),i)}function Oe(i){return new xn(Ir(),ba,ya,i)}function ba(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function ya(i){return i?1:0}var fi=class extends Br{decode(e,t){return super.decode(e,t)}};function F(i,e,t){return new fi(i,e,t)}function te(i,e,t){let n,r=typeof e=="number"?e:Kr(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=Kr(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return xr(i,r,t)}import{PublicKey as Rf}from"@solana/web3.js";import Mf from"bn.js";import{AccountLayout as vf,TOKEN_PROGRAM_ID as Vf}from"@solana/spl-token";import{PublicKey as Ed}from"@solana/web3.js";import{MintLayout as _d,TOKEN_PROGRAM_ID as Vd}from"@solana/spl-token";var Lr=i=>new Ee({mint:i.address,decimals:i.decimals,symbol:i.symbol,name:i.name}),Jt=r=>{var o=r,{amount:i,isRaw:e,name:t}=o,n=gt(o,["amount","isRaw","name"]);return new ce(new Ee({mint:Ye(n.address).toBase58(),decimals:n.decimals,symbol:n.symbol,name:t}),i,e,t)};var ht=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=gt(o,["address","programId","decimals"]);return V({chainId:101,address:Ye(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};var bi=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Ft=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new In({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(bi(e))}logInfo(...e){this.logger.info(bi(e))}logAndCreateError(...e){let t=bi(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as On,PublicKey as C,SystemProgram as xt,TransactionInstruction as Ne}from"@solana/web3.js";import Hr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Ii,TOKEN_2022_PROGRAM_ID as et,TOKEN_PROGRAM_ID as me}from"@solana/spl-token";import xa from"bn.js";import Ve from"bn.js";var fe=new Ve(0),_e=new Ve(1),ot=new Ve(-1),ve=new Ve(1).shln(64),Sn=new Ve(1).shln(128),yi=ve.sub(_e),$t=64,Rr=Sn.subn(1),xe=-443636,Ke=-xe,Ze=new Ve("4295048016"),Je=new Ve("79226673521066979257578248091"),Kn=new Ve("4295048017"),Cn=new Ve("79226673521066979257578248090"),Or=16,Mr="59543866431248",Er="184467440737095516",Fr="15793534762490258745",Nn=new Ve(10).pow(new Ve(6));var jd=new Ve("18446744073700000000");import Z from"bn.js";function Ln(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function gi(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Pi(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function en(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function _r(i,e){return en(i,e)?null:gi(i,e)}function vr(i,e){return en(i,e)?null:Pi(i,e)}var np=Buffer.from("amm_config","utf8"),ga=Buffer.from("pool","utf8"),Pa=Buffer.from("pool_vault","utf8"),Aa=Buffer.from("pool_reward_vault","utf8"),Vr=Buffer.from("position","utf8"),ka=Buffer.from("tick_array","utf8"),wa=Buffer.from("operation","utf8"),ha=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Ta=Buffer.from("observation","utf8");function Wr(i,e,t,n){return ge([ga,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Ai(i,e,t){return ge([Pa,e.toBuffer(),t.toBuffer()],i)}function Dr(i,e,t){return ge([Aa,e.toBuffer(),t.toBuffer()],i)}function oe(i,e,t){return ge([ka,e.toBuffer(),Ln(t)],i)}function st(i,e,t,n){return ge([Vr,e.toBuffer(),Ln(t),Ln(n)],i)}function Me(i,e){return ge([Vr,e.toBuffer()],i)}function _t(i){return ge([Buffer.from("metadata","utf8"),ft.toBuffer(),i.toBuffer()],ft)}function Rn(i){return ge([wa],i)}function Ce(i,e){return ge([ha,e.toBuffer()],i)}function qr(i,e){return ge([Ta,e.toBuffer()],i)}var Gr=Buffer.from("locked_position","utf8");function ki(i,e){return ge([Gr,e.toBuffer()],i)}function wi(i,e){return ge([Gr,e.toBuffer()],i)}import{PublicKey as Xe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Ur}from"@solana/spl-token";import le from"bn.js";import $e from"bn.js";var tn=class{static getfeeGrowthInside(e,t,n){let r=new $e(0),o=new $e(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new $e(0),a=new $e(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=Y.wrappingSubU128(Y.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=Y.wrappingSubU128(Y.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=Y.mulDivFloor(Y.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),c=t.tokenFeesOwedA.add(a),u=Y.mulDivFloor(Y.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=Y.mulDivFloor(Y.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),c=t.tokenFeesOwedA.add(a),u=Y.mulDivFloor(Y.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=Y.wrappingSubU128(c,u.growthInsideLastX64),d=Y.mulDivFloor(l,t.liquidity,ve),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=Y.wrappingSubU128(c,u.growthInsideLastX64),d=Y.mulDivFloor(l,t.liquidity,ve),m=u.rewardAmountOwed.add(d);o.push(m)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new $e(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new $e(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Y.wrappingSubU128(Y.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new $e(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new $e(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Y.wrappingSubU128(Y.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,g,w,A;let a=X.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),c=X.getSqrtPriceX64FromTick(t.tickLower),u=X.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,d=ie.getAmountsFromLiquidity(a,c,u,n,o),[m,p]=[pe(d.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),pe(d.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[pe(new $e(new M(d.amountA.toString()).mul(l).toFixed(0)),(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),pe(new $e(new M(d.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:m,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Ue(m.expirationTime,p.expirationTime)}}};var Ba=15,ne=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=E.getTickArrayStartIndexByTick(r,o),l=E.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Ba/2));for(let p=0;p<l.length;p++){let{publicKey:y}=oe(t,n,l[p]);c.push(y)}let d=(await nt(e,c)).map(p=>p!==null?nn.decode(p.data):null),m={};for(let p=0;p<c.length;p++){let y=d[p];y!==null&&(m[y.startTickIndex]=H(V({},y),{address:c[p]}))}return m}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=E.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:d,tickArrayAddress:m,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[d,m,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/ne.tickCount(t)),a=n?E.searchLowBitFromStart(r,o,s-1,1,t):E.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=we-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<we;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=oe(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=E.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c-1}else for(c=c+1;c<we;){let m=u.ticks[c];if(m.liquidityGross.gtn(0)){l=m;break}c=c+1}let{publicKey:d}=oe(e,t,a);return{initializedTick:l,tickArrayAddress:d,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(E.checkIsOutOfBoundary(e)){if(e>Ke)return!1;let n=E.getTickArrayStartIndexByTick(xe,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return we*e}};var hi=14,at=class{static maxTickInTickarrayBitmap(e){return e*we*Tt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!ne.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-ne.tickCount(n):t+ne.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*we,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),d=_r(1024,l);if(d!==null){let m=(u-d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),d=vr(1024,l);if(d!==null){let m=(u+d-512)*a;return{isInit:!0,tickIndex:m}}else return{isInit:!1,tickIndex:o-ne.tickCount(n)}}}},rn=class{static getBitmapOffset(e,t){if(!ne.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=at.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=at.maxTickInTickarrayBitmap(e),n=-t;if(Ke<=t)throw Error(`extensionTickBoundary check error: ${Ke}, ${t}`);if(n<=xe)throw Error(`extensionTickBoundary check error: ${n}, ${xe}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:E.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=ne.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=at.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=E.mergeTickArrayBitmap(e).shln(Tt-1-a),u=en(512,c)?null:gi(512,c);if(u!==null){let l=t-u*ne.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=E.mergeTickArrayBitmap(e).shrn(a),u=en(512,c)?null:Pi(512,c);if(u!==null){let l=t+u*ne.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ne.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%at.maxTickInTickarrayBitmap(t),r=Math.floor(n/ne.tickCount(t));return e<0&&n!=0&&(r=Tt-r),r}};var Ae=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:d}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!d)throw new Error("Invalid tick array");c.push(d);let{allTrade:m,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:b}=Bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...y),{allTrade:m,expectedAmountOut:p.mul(ot),remainingAccounts:c,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=oe(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:d,accounts:m,sqrtPriceX64:p,feeAmount:y}=Bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ot),u,o);return a.push(...m),{expectedAmountIn:d,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=Ae.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?rn.checkTickArrayIsInit(ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):E.checkTickArrayIsInitialized(E.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=oe(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=oe(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ne.tickCount(e.tickSpacing)),r=t?E.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):E.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=at.nextInitializedTickArrayStartIndex(E.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=rn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<xe||t>Ke)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let d=o[l],m=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(d.tokenMint))==null?void 0:c.owner;if(m===void 0)throw Error("get new reward mint info error");let p=H(V({},d),{perSecond:Y.x64ToDecimal(d.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Xe(m)});if(p.tokenMint.equals(Xe.default))continue;if(n<=p.openTime.toNumber()||r.eq(fe)){s.push(p);continue}let y=new le(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=Y.mulDivFloor(f,p.emissionsPerSecondX64,r),g=p.rewardGrowthGlobalX64.add(b),w=Y.mulDivFloor(f,p.emissionsPerSecondX64,ve),A=p.rewardTotalEmissioned.add(w);s.push(H(V({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:A,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=E.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=at.maxTickInTickarrayBitmap(e),n=-t;return t>Ke&&(t=ne.getArrayStartIndex(Ke,e)+ne.tickCount(e)),n<xe&&(n=ne.getArrayStartIndex(xe,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ne.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ne.tickCount(t)*Tt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Pt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=Xr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=E.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=E.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let d of l){let{publicKey:m}=oe(c.programId,c.id,d);o.push({pubkey:m}),r[m.toString()]=c.id}}let s=await Pt(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=nn.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=H(V({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(m=>m.accountInfo.mint),u=[];for(let m of c)for(let p of s)u.push(Me(p,m).publicKey);let l=await nt(t,u,{batchRequest:r}),d={};for(let m of l){if(m===null)continue;let p=Ti.decode(m.data),y=p.poolId.toString(),f=e.find(R=>R.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,g=E._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),w=E._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:A,amountB:k}=ie.getAmountsFromLiquidity(b.sqrtPriceX64,g.tickSqrtPriceX64,w.tickSqrtPriceX64,p.liquidity,!1),B=1/(1-Math.sqrt(Math.sqrt(g.price.div(w.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:w.price,amountA:A,amountB:k,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(R=>H(V({},R),{pendingReward:new le(0)})),leverage:B,tokenFeeAmountA:new le(0),tokenFeeAmountB:new le(0)}];let h=await E.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),K=await E.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);d[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=h,d[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=K}if(o){let m=Object.values(d),p=await nt(t,m,{batchRequest:r}),y={};for(let f=0;f<m.length;f++){let b=p[f];if(b===null)continue;let g=m[f].toString();y[g]=nn.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let g of b){let w=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,k=y[d[w].toString()],B=y[d[A].toString()],h=k.ticks[E.getTickOffsetInArray(g.tickLower,f.tickSpacing)],K=B.ticks[E.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:R,tokenFeeAmountB:W}=await tn.GetPositionFees(f,g,h,K),T=await tn.GetPositionRewards(f,g,h,K);g.tokenFeeAmountA=R.gte(new le(0))?R:new le(0),g.tokenFeeAmountB=W.gte(new le(0))?W:new le(0);for(let O=0;O<T.length;O++)g.rewardInfos[O].pendingReward=T[O].gte(new le(0))?T[O]:new le(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new M(0),catchLiquidityInsufficient:c=!1}){var $;let u,l=n.toBase58()===e.mintA.address,[d,m]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new M(0))?u=l?Ze.add(new le(1)):Je.sub(new le(1)):u=X.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=pe(o,d,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:g,feeAmount:w}=Ae.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub(($=p.fee)!=null?$:fe),u,c),A=pe(f,m,r,!1),k=X.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),B=l?k:new M(1).div(k),h=f.mul(new le(Math.floor((1-s)*1e10))).div(new le(1e10)),K=pe(h,m,r,!1),R=l?e.currentPrice:new M(1).div(e.currentPrice),W=new M(B).sub(R).abs(),T=R,O=new it(new M(W).mul(10**15).toFixed(0),new M(T).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:A,minAmountOut:K,expirationTime:Ue(p.expirationTime,A.expirationTime),currentPrice:e.currentPrice,executionPrice:B,priceImpact:O,fee:w,remainingAccounts:b,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[d,m]=[new Ee(H(V({},u),{mint:u.address,isToken2022:u.programId===Ur.toBase58()})),new Ee(H(V({},l),{mint:l.address,isToken2022:l.programId===Ur.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:g,currentPrice:w,executionPrice:A,priceImpact:k,fee:B,remainingAccounts:h,executionPriceX64:K}=Ae.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Xe(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),R=H(V({},y),{amount:new ce(d,y.amount),fee:y.fee===void 0?void 0:new ce(d,y.fee)}),W=H(V({},f),{amount:new ce(m,f.amount),fee:f.fee===void 0?void 0:new ce(m,f.fee)}),T=H(V({},b),{amount:new ce(m,b.amount),fee:b.fee===void 0?void 0:new ce(m,b.fee)}),O=new Re({baseToken:d,denominator:new le(10).pow(new le(20+d.decimals)),quoteToken:m,numerator:w.mul(new M(10**(20+m.decimals))).toFixed(0)}),$=new Re({baseToken:d,denominator:new le(10).pow(new le(20+d.decimals)),quoteToken:m,numerator:A.mul(new M(10**(20+m.decimals))).toFixed(0)}),z=new ce(d,B);return{allTrade:p,realAmountIn:R,amountOut:W,minAmountOut:T,expirationTime:g,currentPrice:O,executionPrice:$,priceImpact:k,fee:z,remainingAccounts:h,executionPriceX64:K}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new M(0)}){var T;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new M(0))?l=c?Je.sub(new le(1)):Ze.add(new le(1)):l=X.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let d=pe(o,u[n.toString()],r,!0),{expectedAmountIn:m,remainingAccounts:p,executionPrice:y,feeAmount:f}=Ae.getInputAmountAndRemainAccounts(e,t,n,d.amount.sub((T=d.fee)!=null?T:fe),l),b=c?e.mintB.address:e.mintA.address,g=pe(m,u[b],r,!1),w=X.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),A=c?w:new M(1).div(w),k=m.mul(new le(Math.floor((1+s)*1e10))).div(new le(1e10)),B=pe(k,u[b],r,!0),h=c?e.currentPrice:new M(1).div(e.currentPrice),K=new M(A).sub(h).abs(),R=h,W=new it(new M(K).mul(10**15).toFixed(0),new M(R).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:B,realAmountOut:d,expirationTime:Ue(g.expirationTime,d.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:W,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=E.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=E.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,d=a-s,m=o.priceMax-o.priceMin,p;return l<=0?p=0:d===l?p=m/l:m===l?p=l/d:p=l/m*(l/d),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((b=o.rewardApr[2])!=null?b:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],d=r[Ye(e.mintA.address).toString()],m=r[Ye(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!d||!m)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=X.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),b=X.getSqrtPriceX64FromTick(s),g=X.getSqrtPriceX64FromTick(a),{amountSlippageA:w,amountSlippageB:A}=ie.getAmountsFromLiquidityWithSlippage(f,b,g,t,!1,!1,0),{amountSlippageA:k,amountSlippageB:B}=ie.getAmountsFromLiquidityWithSlippage(f,b,g,o,!1,!1,0),h=new M(w.toString()).div(new M(10).pow(p)).mul(d.value).add(new M(A.toString()).div(new M(10).pow(y)).mul(m.value)),K=new M(k.toString()).div(new M(10).pow(p)).mul(d.value).add(new M(B.toString()).div(new M(10).pow(y)).mul(m.value)),R=new M(1).div(h.add(K)),T=new M(l.volumeFee).mul(365).div(u).mul(R).mul(100).toNumber(),O=3600*24*365,$=e.rewardDefaultInfos.map(z=>{var _,Nt;let ye=z.mint.decimals,J=r[z.mint.address];return c<((_=z.startTime)!=null?_:0)||c>((Nt=z.endTime)!=null?Nt:0)||!z.perSecond||!J||ye===void 0?0:new M(J.value).mul(new M(z.perSecond).mul(O)).div(new M(10).pow(ye)).mul(R).mul(100).toNumber()});return{feeApr:T,rewardsApr:$,apr:T+$.reduce((z,ye)=>z+ye,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var g,w;let l=X.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),d=X.getSqrtPriceX64FromTick(n),m=X.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=pe(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,c,!u),f=new le(new M(y.amount.sub((w=y.fee)!=null?w:fe).toString()).mul(p).toFixed(0)),b;if(l.lte(d))b=t?ie.getLiquidityFromTokenAmountA(d,m,f,!a):new le(0);else if(l.lte(m)){let A=ie.getLiquidityFromTokenAmountA(l,m,f,!a),k=ie.getLiquidityFromTokenAmountB(d,l,f);b=t?A:k}else b=t?new le(0):ie.getLiquidityFromTokenAmountB(d,m,f);return Ae.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,g,w,A;let c=X.getSqrtPriceX64FromTick(n),u=X.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,d=ie.getAmountsFromLiquidity(X.priceToSqrtPriceX64(new M(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[m,p]=[pe(d.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),pe(d.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[pe(d.amountA.muln(l),(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),pe(d.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:m,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:Ue(m.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Xe(c.id));(await nt(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=vt.decode(c.data))});let s=t.map(c=>Ce(new Xe(c.programId),new Xe(c.id)).publicKey),a=await Ae.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>H(V({},c),{[u.id]:H(V({},n[u.id]),{id:new Xe(u.id),version:6,programId:new Xe(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:H(V({},u.config),{id:new Xe(u.config.id),fundOwner:""}),currentPrice:new M(u.price),exBitmapInfo:a[Ce(new Xe(u.programId),new Xe(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var Y=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(fe)||(o=o.add(_e)),o}static mulDivFloor(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(fe))throw new Error("division by 0");return e.mul(t).add(n.sub(_e)).div(n)}static x64ToDecimal(e,t){return new M(e.toString()).div(M.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new Z(e.mul(M.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Sn).sub(t).mod(Sn)}};function he(i,e){return Bi(i.mul(e),64,256)}function Ia(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Bi(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var X=class{static sqrtPriceX64ToPrice(e,t,n){return Y.x64ToDecimal(e).pow(2).mul(M.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return Y.decimalToX64(e.mul(M.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(fe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(fe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(fe))return e;let o=t.shln($t);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?Y.mulDivCeil(s,e,a):Y.mulDivRoundingUp(s,_e,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return Y.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln($t);if(r)return e.add(o.div(t));{let s=Y.mulDivRoundingUp(o,_e,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<xe||e>Ke)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new Z("18445821805675395072"):new Z("18446744073709551616");return(t&2)!=0&&(n=he(n,new Z("18444899583751176192"))),(t&4)!=0&&(n=he(n,new Z("18443055278223355904"))),(t&8)!=0&&(n=he(n,new Z("18439367220385607680"))),(t&16)!=0&&(n=he(n,new Z("18431993317065453568"))),(t&32)!=0&&(n=he(n,new Z("18417254355718170624"))),(t&64)!=0&&(n=he(n,new Z("18387811781193609216"))),(t&128)!=0&&(n=he(n,new Z("18329067761203558400"))),(t&256)!=0&&(n=he(n,new Z("18212142134806163456"))),(t&512)!=0&&(n=he(n,new Z("17980523815641700352"))),(t&1024)!=0&&(n=he(n,new Z("17526086738831433728"))),(t&2048)!=0&&(n=he(n,new Z("16651378430235570176"))),(t&4096)!=0&&(n=he(n,new Z("15030750278694412288"))),(t&8192)!=0&&(n=he(n,new Z("12247334978884435968"))),(t&16384)!=0&&(n=he(n,new Z("8131365268886854656"))),(t&32768)!=0&&(n=he(n,new Z("3584323654725218816"))),(t&65536)!=0&&(n=he(n,new Z("696457651848324352"))),(t&131072)!=0&&(n=he(n,new Z("26294789957507116"))),(t&262144)!=0&&(n=he(n,new Z("37481735321082"))),e>0&&(n=Rr.div(n)),n}static getTickFromPrice(e,t,n){return X.getTickFromSqrtPriceX64(X.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Je)||e.lt(Ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new Z(t-64),r=Ia(n,32,128),o=new Z("8000000000000000","hex"),s=0,a=new Z(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new Z(0))&&s<Or;){c=c.mul(c);let y=c.shrn(127);c=c.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let u=a.shrn(32),d=r.add(u).mul(new Z(Mr)),m=Bi(d.sub(new Z(Er)),64,128).toNumber(),p=Bi(d.add(new Z(Fr)),64,128).toNumber();return m==p?m:X.getSqrtPriceX64FromTick(p).lte(e)?p:m}},It=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=X.getTickFromSqrtPriceX64(X.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=It.getTickWithPriceAndTickspacing(e,t,n,r),s=X.getSqrtPriceX64FromTick(o);return X.sqrtPriceX64ToPrice(s,n,r)}},ie=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln($t),s=t.sub(e);return r?Y.mulDivRoundingUp(Y.mulDivCeil(o,s,t),_e,e):Y.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(fe))throw new Error("sqrtPriceX64A must greater than 0");return r?Y.mulDivCeil(n,t.sub(e),ve):Y.mulDivFloor(n,t.sub(e),ve)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?Y.mulDivRoundingUp(a,_e,yi):a.shrn($t)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),Y.mulDivFloor(n,yi,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return ie.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=ie.getLiquidityFromTokenAmountA(e,n,r,!1),a=ie.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return ie.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:ie.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new Z(0)};if(e.lt(n)){let s=ie.getTokenAmountAFromLiquidity(e,n,r,o),a=ie.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new Z(0),amountB:ie.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=ie.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,d=new Z(new M(c.toString()).mul(l).toFixed(0)),m=new Z(new M(u.toString()).mul(l).toFixed(0));return{amountSlippageA:d,amountSlippageB:m}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var w,A,k,B;let u=X.priceToSqrtPriceX64(new M(e.price),e.mintA.decimals,e.mintB.decimals),l=X.getSqrtPriceX64FromTick(t),d=X.getSqrtPriceX64FromTick(n),m=s?1+o:1-o,p=ie.getAmountsFromLiquidity(u,l,d,r,s),[y,f]=[pe(p.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,a,c),pe(p.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,c)],[b,g]=[pe(new Z(new M(p.amountA.toString()).mul(m).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,c),pe(new Z(new M(p.amountB.toString()).mul(m).toFixed(0)),(B=e.mintB.extensions)==null?void 0:B.feeConfig,a,c)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:g,expirationTime:Ue(y.expirationTime,f.expirationTime)}}},Bt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f=!1){if(m.eq(fe))throw new Error("amountSpecified must not be 0");if(y||(y=s?Ze.add(_e):Je.sub(_e)),s){if(y.lt(Ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(d))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Je))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(d))throw new Error("sqrtPriceX64 must greater than current")}let b=m.gt(fe),g={amountSpecifiedRemaining:m,amountCalculated:fe,sqrtPriceX64:d,tick:u>p?Math.min(p+ne.tickCount(l)-1,u):p,accounts:[],liquidity:c,feeAmount:new Z(0)},w=p,A=n[p],k=0,B=!s&&A.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(fe)&&!g.sqrtPriceX64.eq(y);){k>10;let h={};h.sqrtPriceStartX64=g.sqrtPriceX64;let K=E.nextInitTick(A,g.tick,l,s,B),R=K||null,W=null;if(!(R!=null&&R.liquidityGross.gtn(0))){let O=Ae.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},w,s);if(!O.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}w=O.nextStartIndex;let{publicKey:$}=oe(e,t,w);W=$,A=n[w];try{R=E.firstInitializedTick(A,s)}catch{throw Error("not found next tick info")}}h.tickNext=R.tick,h.initialized=R.liquidityGross.gtn(0),p!==w&&W&&(g.accounts.push(W),p=w),h.tickNext<xe?h.tickNext=xe:h.tickNext>Ke&&(h.tickNext=Ke),h.sqrtPriceNextX64=X.getSqrtPriceX64FromTick(h.tickNext);let T;if(s&&h.sqrtPriceNextX64.lt(y)||!s&&h.sqrtPriceNextX64.gt(y)?T=y:T=h.sqrtPriceNextX64,[g.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=Bt.swapStepCompute(g.sqrtPriceX64,T,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(h.feeAmount),b?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),g.amountCalculated=g.amountCalculated.sub(h.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(h.amountOut),g.amountCalculated=g.amountCalculated.add(h.amountIn.add(h.feeAmount))),g.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let O=R.liquidityNet;s&&(O=O.mul(ot)),g.liquidity=ie.addDelta(g.liquidity,O)}B=h.tickNext!=g.tick&&!s&&A.startTickIndex===h.tickNext,g.tick=s?h.tickNext-1:h.tickNext}else if(g.sqrtPriceX64!=h.sqrtPriceStartX64){let O=X.getTickFromSqrtPriceX64(g.sqrtPriceX64);B=O!=g.tick&&!s&&A.startTickIndex===O,g.tick=O}++k}try{let{nextStartIndex:h,isExist:K}=ne.nextInitializedTickArray(g.tick,l,s,r,o);K&&p!==h&&(g.accounts.push(oe(e,t,h).publicKey),p=h)}catch{}return{allTrade:!0,amountSpecifiedRemaining:fe,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new Z(0),amountIn:new Z(0),amountOut:new Z(0),feeAmount:new Z(0)},a=e.gte(t),c=r.gte(fe);if(c){let l=Y.mulDivFloor(r,Nn.sub(new Z(o.toString())),Nn);s.amountIn=a?ie.getTokenAmountAFromLiquidity(t,e,n,!0):ie.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=X.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?ie.getTokenAmountBFromLiquidity(t,e,n,!1):ie.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ot).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=X.getNextSqrtPriceX64FromOutput(e,n,r.mul(ot),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=ie.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=ie.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:ie.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:ie.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(ot))&&(s.amountOut=r.mul(ot)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=Y.mulDivCeil(s.amountIn,new Z(o),Nn.sub(new Z(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var we=60,Tt=512,E=class{static getTickArrayAddressByTick(e,t,n,r){let o=E.getTickArrayStartIndexByTick(n,r),{publicKey:s}=oe(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=E.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=we)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=ne.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ne.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*we,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*we,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*we:e+t*we}static mergeTickArrayBitmap(e){let t=new xa(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*we));return[...E.searchLowBitFromStart(e,t,s-1,o,n),...E.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return E.searchHightBitFromStart(e,t,0,Tt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=E.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=oe(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>E.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=ne.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>E.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=ne.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<xe||e>Ke}static nextInitTick(e,t,n,r,o){if(ne.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<we;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=we-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<we;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=X.getSqrtPriceX64FromTick(t),o=X.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=It.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=X.getSqrtPriceX64FromTick(o),a=X.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=X.getSqrtPriceX64FromTick(t),o=X.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new M(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new M(1).div(t),o=It.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=X.getSqrtPriceX64FromTick(o),a=X.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new M(1).div(a)}}};var Sa=F([Pe(8),U("bump"),wt("index"),S(""),Fe("protocolFeeRate"),Fe("tradeFeeRate"),wt("tickSpacing"),te(P(),8,"")]),Ka=F([Fe("blockTimestamp"),Cr("tickCumulative"),te(P(),4)]),zr=F([Pe(8),Oe("initialized"),P("recentEpoch"),wt("observationIndex"),S("poolId"),te(Ka,100,"observations"),te(P(),4)]),Ca=F([U("rewardState"),P("openTime"),P("endTime"),P("lastUpdateTime"),Q("emissionsPerSecondX64"),P("rewardTotalEmissioned"),P("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),Q("rewardGrowthGlobalX64")]),vt=F([Pe(8),U("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),U("mintDecimalsA"),U("mintDecimalsB"),wt("tickSpacing"),Q("liquidity"),Q("sqrtPriceX64"),Be("tickCurrent"),Fe(),Q("feeGrowthGlobalX64A"),Q("feeGrowthGlobalX64B"),P("protocolFeesTokenA"),P("protocolFeesTokenB"),Q("swapInAmountTokenA"),Q("swapOutAmountTokenB"),Q("swapInAmountTokenB"),Q("swapOutAmountTokenA"),U("status"),te(U(),7,""),te(Ca,3,"rewardInfos"),te(P(),16,"tickArrayBitmap"),P("totalFeesTokenA"),P("totalFeesClaimedTokenA"),P("totalFeesTokenB"),P("totalFeesClaimedTokenB"),P("fundFeesTokenA"),P("fundFeesTokenB"),P("startTime"),te(P(),15*4-3,"padding")]),Na=F([Q("growthInsideLastX64"),P("rewardAmountOwed")]),Ti=F([Pe(8),U("bump"),S("nftMint"),S("poolId"),Be("tickLower"),Be("tickUpper"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),te(Na,3,"rewardInfos"),te(P(),8,"")]),mf=F([Pe(8),U("bump"),S("poolId"),Be("tickLowerIndex"),Be("tickUpperIndex"),Q("liquidity"),Q("feeGrowthInsideLastX64A"),Q("feeGrowthInsideLastX64B"),P("tokenFeesOwedA"),P("tokenFeesOwedB"),te(Q(),3,"rewardGrowthInside"),te(P(),8,"")]),La=F([Be("tick"),Nr("liquidityNet"),Q("liquidityGross"),Q("feeGrowthOutsideX64A"),Q("feeGrowthOutsideX64B"),te(Q(),3,"rewardGrowthsOutsideX64"),te(Fe(),13,"")]),nn=F([Pe(8),S("poolId"),Be("startTickIndex"),te(La,we,"ticks"),U("initializedTickCount"),te(U(),115,"")]),Ra=F([Pe(329),te(S(),100,"whitelistMints")]),Xr=F([Pe(8),S("poolId"),te(te(P(),8),hi,"positiveTickArrayBitmap"),te(te(P(),8),hi,"negativeTickArrayBitmap")]),df=F([P(),U("bump"),S("owner"),S("poolId"),S("positionId"),S("nftAccount"),te(P(),8)]),pf=F([Pe(8),U("bump"),S("lockOwner"),S("poolId"),S("positionId"),S("nftAccount"),S("lockNftMint"),P("recentEpoch"),te(P(),8)]);zr.span;var Qr=ae("Raydium_Clmm"),ze={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Yr=[188,37,179,131,82,150,84,73],jr=[16,72,250,198,14,162,212,19],St=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y){let f=F([Q("sqrtPriceX64"),P("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},g);let w=Buffer.from([...ze.createPool,...g]);return new Ne({keys:b,programId:e,data:w})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new C(r.address),new C(o.address)],{publicKey:d}=Wr(t,s,u,l),{publicKey:m}=qr(t,d),{publicKey:p}=Ai(t,d,u),{publicKey:y}=Ai(t,d,l),f=[this.createPoolInstruction(t,d,n,s,m,u,p,new C(r.programId||me),l,y,new C(o.programId||me),Ce(t,d).publicKey,a,c)];return{signers:[],instructions:f,instructionTypes:[ee.CreateAccount,ee.ClmmCreatePool],address:{poolId:d,observationId:m,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g,w,A,k,B,h,K,R,W,T){let O=F([Be("tickLowerIndex"),Be("tickUpperIndex"),Be("tickArrayLowerStartIndex"),Be("tickArrayUpperStartIndex"),Q("liquidity"),P("amountMaxA"),P("amountMaxB"),Oe("withMetadata"),U("optionBaseFlag"),Oe("baseFlag")]),$=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],z=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Ii,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...$],ye=Buffer.alloc(O.span);O.encode({tickLowerIndex:w,tickUpperIndex:A,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:B,liquidity:h,amountMaxA:K,amountMaxB:R,withMetadata:W==="create",baseFlag:!1,optionBaseFlag:0},ye);let J=Buffer.from([...ze.openPosition,...ye]);return new Ne({keys:z,programId:e,data:J})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,p]=[new C(e.programId),new C(e.id)],y;if(l)y=new C((await l(1))[0]);else{let R=On.generate();d.push(R),y=R.publicKey}let f=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(m,p,f),{publicKey:w}=oe(m,p,b),{publicKey:A}=Se(n.wallet,y,me),{publicKey:k}=_t(y),{publicKey:B}=Me(m,y),{publicKey:h}=st(m,p,r,o),K=this.openPositionFromLiquidityInstruction(m,n.feePayer,p,n.wallet,y,A,k,h,g,w,B,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,f,b,s,a,c,u);return{signers:d,instructions:[K],instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:g,tickArrayUpper:w,positionNftAccount:A,metadataAccount:k,personalPosition:B,protocolPosition:h}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let d=[],[m,p]=[new C(e.programId),new C(e.id)],y;if(l)y=new C((await l(1))[0]);else{let R=On.generate();d.push(R),y=R.publicKey}let f=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(m,p,f),{publicKey:w}=oe(m,p,b),{publicKey:A}=Se(n.wallet,y,me),{publicKey:k}=_t(y),{publicKey:B}=Me(m,y),{publicKey:h}=st(m,p,r,o),K=this.openPositionFromBaseInstruction(m,n.feePayer,p,n.wallet,y,A,k,h,g,w,B,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),r,o,f,b,u,s,a,c,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Ce(m,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:g,tickArrayUpper:w,positionNftAccount:A,metadataAccount:k,personalPosition:B,protocolPosition:h},instructions:[K],signers:d,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g,w,A,k,B,h,K,R,W,T){let O=F([Be("tickLowerIndex"),Be("tickUpperIndex"),Be("tickArrayLowerStartIndex"),Be("tickArrayUpperStartIndex"),Q("liquidity"),P("amountMaxA"),P("amountMaxB"),Oe("withMetadata"),U("optionBaseFlag"),Oe("baseFlag")]),$=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],z=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:Ii,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...$],ye=Buffer.alloc(O.span);O.encode({tickLowerIndex:w,tickUpperIndex:A,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:B,liquidity:new Hr(0),amountMaxA:K==="MintA"?R:W,amountMaxB:K==="MintA"?W:R,withMetadata:h==="create",baseFlag:K==="MintA",optionBaseFlag:1},ye);let J=Buffer.from([...ze.openPosition,...ye]);return new Ne({keys:z,programId:e,data:J})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let d,m=[];if(l)d=new C((await l(1))[0]);else{let R=On.generate();m.push(R),d=R.publicKey}let[p,y]=[new C(e.programId),new C(e.id)],f=E.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=E.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=oe(p,y,f),{publicKey:w}=oe(p,y,b),{publicKey:A}=Se(n.wallet,d,me),{publicKey:k}=_t(d),{publicKey:B}=Me(p,d),{publicKey:h}=st(p,y,r,o),K=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,d,A,k,h,g,w,B,n.tokenAccountA,n.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(t.mintA.address),new C(t.mintB.address),r,o,f,b,s,a,c,u,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?Ce(p,y).publicKey:void 0);return{address:{nftMint:d,tickArrayLower:g,tickArrayUpper:w,positionNftAccount:A,metadataAccount:k,personalPosition:B,protocolPosition:h},instructions:[K],signers:m,instructionTypes:[ee.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=F([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...ze.closePosition,...c]);return new Ne({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new C(e.programId),{publicKey:s}=Se(n.wallet,r.nftMint,me),{publicKey:a}=Me(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[ee.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g,w){let A=F([Q("liquidity"),P("amountMaxA"),P("amountMaxB"),U("optionBaseFlag"),Oe("baseFlag")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],h=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:b,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},h);let K=Buffer.from([...ze.increaseLiquidity,...h]);return new Ne({keys:B,programId:e,data:K})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new C(e.programId),new C(e.id)],l=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=oe(c,u,l),{publicKey:p}=oe(c,u,d),{publicKey:y}=Se(r.wallet,n.nftMint,me),{publicKey:f}=Me(c,n.nftMint),{publicKey:b}=st(c,u,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(c,r.wallet,y,f,u,b,m,p,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Ce(c,u).publicKey:void 0);return{address:{tickArrayLower:m,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[g],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new C(e.programId),new C(e.id)],l=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:m}=oe(c,u,l),{publicKey:p}=oe(c,u,d),{publicKey:y}=Se(r.wallet,n.nftMint,me),{publicKey:f}=Me(c,n.nftMint),{publicKey:b}=st(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:m,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,y,f,u,b,m,p,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,d])?Ce(c,u).publicKey:void 0)],signers:[],instructionTypes:[ee.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g,w){let A=F([Q("liquidity"),P("amountMaxA"),P("amountMaxB"),U("optionBaseFlag"),Oe("baseFlag")]),k=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[]],B=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],h=Buffer.alloc(A.span);A.encode({liquidity:new Hr(0),amountMaxA:f==="MintA"?b:g,amountMaxB:f==="MintA"?g:b,baseFlag:f==="MintA",optionBaseFlag:1},h);let K=Buffer.from([...ze.increaseLiquidity,...h]);return new Ne({keys:B,programId:e,data:K})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g,w,A){let k=F([Q("liquidity"),P("amountMinA"),P("amountMinB")]),B=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(W=>[{pubkey:W.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:W.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:W.rewardMint,isSigner:!1,isWritable:!1}]).flat()],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Pn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...B],K=Buffer.alloc(k.span);k.encode({liquidity:b,amountMinA:g,amountMinB:w},K);let R=Buffer.from([...ze.decreaseLiquidity,...K]);return new Ne({keys:h,programId:e,data:R})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new C(e.programId),new C(e.id)],d=E.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=E.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=oe(u,l,d),{publicKey:y}=oe(u,l,m),{publicKey:f}=Se(r.wallet,n.nftMint,c),{publicKey:b}=Me(u,n.nftMint),{publicKey:g}=st(u,l,n.tickLower,n.tickUpper),w=[];for(let B=0;B<e.rewardDefaultInfos.length;B++)w.push({poolRewardVault:new C(t.rewardInfos[B].vault),ownerRewardVault:r.rewardAccounts[B],rewardMint:new C(e.rewardDefaultInfos[B].mint.address)});let A=[],k=this.decreaseLiquidityInstruction(u,r.wallet,f,b,l,g,p,y,r.tokenAccountA,r.tokenAccountB,new C(t.vault.A),new C(t.vault.B),new C(e.mintA.address),new C(e.mintB.address),w,o,s,a,Ae.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[d,m])?Ce(u,l).publicKey:void 0);return A.push(k),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:g},signers:[],instructions:A,instructionTypes:[ee.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,d,m,p,y,f,b,g){let w=F([P("amount"),P("otherAmountThreshold"),Q("sqrtPriceLimitX64"),Oe("isBaseInput")]),A=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...d.map(K=>({pubkey:K,isSigner:!1,isWritable:!0}))],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Pn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],B=Buffer.alloc(w.span);w.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},B);let h=Buffer.from([...ze.swap,...B]);return new Ne({keys:k,programId:e,data:h})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,d]=[new C(e.programId),new C(e.id)],[m,p]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,d,new C(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?m:p,b?p:m,b?y:f,b?f:y,u,n,s,a,c,!0,Ce(l,d).publicKey)];return{signers:[],instructions:g,instructionTypes:[ee.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,d]=[new C(e.programId),new C(e.id)],[m,p]=[new C(t.vault.A),new C(t.vault.B)],[y,f]=[new C(e.mintA.address),new C(e.mintB.address)],b=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,d,new C(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?p:m,b?m:p,b?f:y,b?y:f,u,n,s,a,c,!1,Ce(l,d).publicKey)];return{signers:[],instructions:g,instructionTypes:[ee.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let p=F([P("openTime"),P("endTime"),Q("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ue(l),endTime:ue(d),emissionsPerSecondX64:m},f);let b=Buffer.from([...ze.initReward,...f]);return new Ne({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a=Dr(o,s,r.mint).publicKey,c=Rn(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new C(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[ee.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,d,m){let p=F([U("rewardIndex"),Q("emissionsPerSecondX64"),P("openTime"),P("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:u,emissionsPerSecondX64:m,openTime:ue(l),endTime:ue(d)},f);let b=Buffer.from([...ze.setRewardEmissions,...f]);return new Ne({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c,u;for(let m=0;m<e.rewardDefaultInfos.length;m++)e.rewardDefaultInfos[m].mint.address===r.mint.toString()&&(a=m,c=new C(t.rewardInfos[m].vault),u=new C(t.rewardInfos[m].mint.address));(a===void 0||c===void 0)&&Qr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Rn(o).publicKey,d=[this.setRewardInstruction(o,n.wallet,s,l,new C(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:d,instructionTypes:[ee.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=F([U("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Pn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let d=Buffer.from([...ze.collectReward,...l]);return new Ne({keys:u,programId:e,data:d})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new C(e.programId),new C(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new C(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&Qr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[ee.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let c=[],u;if(a)u=new C((await a(1))[0]);else{let b=On.generate();c.push(b),u=b.publicKey}let{publicKey:l}=Se(o,s,me),{publicKey:d}=Me(n,s),m=wi(e,u).publicKey,p=Se(o,u,me).publicKey,y=_t(u).publicKey,f=St.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:d,lockPositionId:m,lockNftMint:u,lockNftAccount:p,metadataAccount:y,withMetadata:!0});return{address:{positionId:d,lockPositionId:m,lockNftAccount:p,lockNftMint:u,positionNftAccount:l,metadataAccount:y},instructions:[f],signers:c,instructionTypes:[ee.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:c,lockNftMint:u,lockNftAccount:l,metadataAccount:d,withMetadata:m}){let p=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:Ii,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1}],y=F([Oe("withMetadata")]),f=Buffer.alloc(y.span);y.encode({withMetadata:m},f);let b=Buffer.from([...Yr,...f]);return new Ne({keys:p,programId:e,data:b})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Se(r,o,me),{publicKey:a}=Me(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ki(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:xt.programId,isSigner:!1,isWritable:!1}];return new Ne({keys:c,programId:e,data:Buffer.from(Yr)})}static harvestLockPositionInstruction(e){let[t,n]=[new C(e.poolKeys.programId),new C(e.poolKeys.id)],r=E.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=E.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=oe(t,n,r),{publicKey:a}=oe(t,n,o),{publicKey:c}=Se(e.owner,e.ownerPosition.nftMint,me),{publicKey:u}=Me(t,e.ownerPosition.nftMint),{publicKey:l}=st(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),d=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)d.push({poolRewardVault:new C(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new C(e.poolKeys.rewardInfos[y].mint.address)});let m=[...d.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:ki(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new C(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new C(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...m];return new Ne({keys:p,programId:e.programId,data:Buffer.from(jr)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:d,vaultA:m,vaultB:p,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:g,mintA:w,mintB:A,rewardAccounts:k,exTickArrayBitmap:B}){let h=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[],...k.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],K=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:me,isSigner:!1,isWritable:!1},{pubkey:et,isSigner:!1,isWritable:!1},{pubkey:Ot,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...h];return new Ne({keys:K,programId:e,data:Buffer.from(jr)})}};var hb=F([Pe(8),U("bump"),Oe("disableCreatePool"),wt("index"),P("tradeFeeRate"),P("protocolFeeRate"),P("fundFeeRate"),P("createPoolFee"),S("protocolOwner"),S("fundOwner"),te(P(),16)]),Zr=F([Pe(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),U("bump"),U("status"),U("lpDecimals"),U("mintDecimalA"),U("mintDecimalB"),P("lpAmount"),P("protocolFeesMintA"),P("protocolFeesMintB"),P("fundFeesMintA"),P("fundFeesMintB"),P("openTime"),te(P(),32)]);import{PublicKey as Fb,TransactionInstruction as Ma,Keypair as vb,SystemProgram as Vb}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Db,TOKEN_2022_PROGRAM_ID as qb,TOKEN_PROGRAM_ID as Gb}from"@solana/spl-token";var Oa=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Ib=Buffer.from("amm_config","utf8"),xb=Buffer.from("pool","utf8"),Sb=Buffer.from("pool_lp_mint","utf8"),Kb=Buffer.from("pool_vault","utf8"),Cb=Buffer.from("observation","utf8");function Jr(i){return ge([Oa],i)}var Nb=Buffer.from("locked_liquidity","utf8");var Yb=ae("Raydium_cpmm"),Ea={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function $r(i,e,t,n,r,o,s,a,c,u,l,d,m,p,y,f){let b=F([P("amountIn"),P("amounOutMin")]),g=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],w=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},w),new Ma({keys:g,programId:i,data:Buffer.from([...Ea.swapBaseInput,...w])})}import ly from"bn.js";import dy from"decimal.js-light";import Fa from"bn.js";var ty=new Fa(0);import _a from"bn.js";var oy=new _a(1e6);import eo from"bn.js";var Sy=new eo(25),Ky=new eo(1e4);var xi=F([U("instruction"),P("amountIn"),P("minAmountOut")]),Si=F([U("instruction"),P("maxAmountIn"),P("amountOut")]),Ry=F([U("instruction"),U("nonce")]),va=F([U("instruction"),U("nonce"),P("startTime")]),to=F([P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalValue"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),P("swapBase2QuoteFee"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),P("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),P("lpReserve"),te(P(),3,"padding")]),Oy=F([P("accountType"),P("status"),P("nonce"),P("maxOrder"),P("depth"),P("baseDecimal"),P("quoteDecimal"),P("state"),P("resetFlag"),P("minSize"),P("volMaxCutRatio"),P("amountWaveRatio"),P("baseLotSize"),P("quoteLotSize"),P("minPriceMultiplier"),P("maxPriceMultiplier"),P("systemDecimalsValue"),P("abortTradeFactor"),P("priceTickMultiplier"),P("priceTick"),P("minSeparateNumerator"),P("minSeparateDenominator"),P("tradeFeeNumerator"),P("tradeFeeDenominator"),P("pnlNumerator"),P("pnlDenominator"),P("swapFeeNumerator"),P("swapFeeDenominator"),P("baseNeedTakePnl"),P("quoteNeedTakePnl"),P("quoteTotalPnl"),P("baseTotalPnl"),P("poolOpenTime"),P("punishPcAmount"),P("punishCoinAmount"),P("orderbookToInitTime"),Q("swapBaseInAmount"),Q("swapQuoteOutAmount"),Q("swapQuoteInAmount"),Q("swapBaseOutAmount"),P("swapQuote2BaseFee"),P("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),te(P(),64,"padding")]),Va=F([U("instruction"),P("baseAmountIn"),P("quoteAmountIn"),P("fixedSide"),P("otherAmountMin")]),Wa=F([U("instruction"),P("lpAmount"),P("baseAmountMin"),P("quoteAmountMin")]);var My=F([P("fee")]);import{PublicKey as gg}from"@solana/web3.js";import Ag from"bn.js";import{TOKEN_PROGRAM_ID as za}from"@solana/spl-token";import{PublicKey as qy,SystemProgram as Gy,SYSVAR_RENT_PUBKEY as Uy,TransactionInstruction as io}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as zy,TOKEN_PROGRAM_ID as ro}from"@solana/spl-token";import{PublicKey as Da}from"@solana/web3.js";var Ki=new Da("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),qa=5e4,Ga=F([P("x"),P("y"),P("price")]),Vy=F([P("accountType"),P("status"),P("multiplier"),P("validDataCount"),te(Ga,qa,"DataElement")]);var no=ae("Raydium_liquidity_instruction");function Ua({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=At(i),s=Buffer.alloc(xi.span);xi.encode({instruction:9,amountIn:ue(t),minAmountOut:ue(n)},s);let a=[x({pubkey:ro,isWritable:!1}),x({pubkey:o.id}),x({pubkey:o.authority,isWritable:!1}),x({pubkey:o.openOrders})];return r===4&&a.push(x({pubkey:o.targetOrders})),a.push(x({pubkey:o.vault.A}),x({pubkey:o.vault.B})),r===5&&a.push(x({pubkey:Ki})),a.push(x({pubkey:o.marketProgramId,isWritable:!1}),x({pubkey:o.marketId}),x({pubkey:o.marketBids}),x({pubkey:o.marketAsks}),x({pubkey:o.marketEventQueue}),x({pubkey:o.marketBaseVault}),x({pubkey:o.marketQuoteVault}),x({pubkey:o.marketAuthority,isWritable:!1}),x({pubkey:e.tokenAccountIn}),x({pubkey:e.tokenAccountOut}),x({pubkey:e.owner,isWritable:!1})),new io({programId:o.programId,keys:a,data:s})}function Xa({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=At(i),s=Buffer.alloc(Si.span);Si.encode({instruction:11,maxAmountIn:ue(t),amountOut:ue(n)},s);let a=[x({pubkey:ro,isWritable:!1}),x({pubkey:o.id}),x({pubkey:o.authority,isWritable:!1}),x({pubkey:o.openOrders}),x({pubkey:o.targetOrders}),x({pubkey:o.vault.A}),x({pubkey:o.vault.B})];return r===5&&a.push(x({pubkey:Ki})),a.push(x({pubkey:o.marketProgramId,isWritable:!1}),x({pubkey:o.marketId}),x({pubkey:o.marketBids}),x({pubkey:o.marketAsks}),x({pubkey:o.marketEventQueue}),x({pubkey:o.marketBaseVault}),x({pubkey:o.marketQuoteVault}),x({pubkey:o.marketAuthority,isWritable:!1}),x({pubkey:e.tokenAccountIn}),x({pubkey:e.tokenAccountOut}),x({pubkey:e.owner,isWritable:!1,isSigner:!0})),new io({programId:o.programId,keys:a,data:s})}function oo(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Ua(H(V({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return Xa(H(V({},a),{maxAmountIn:r,amountOut:o}),t);no.logWithError("invalid params","params",i)}throw no.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as rg}from"@solana/web3.js";var ag=ae("Raydium_liquidity_serum");function Ha({programId:i}){let{publicKey:e}=ge([Buffer.from("amm_config_account_seed","utf-8")],i);return e}function so({programId:i}){return ge([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],i)}var Ci={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},ao=i=>{let e={},t=za.toBase58();return Object.keys(i).map(n=>{let r=i[n],[o,s]=[r.baseMint.toBase58(),r.quoteMint.toBase58()];e[n]={id:n,version:4,status:r.status.toNumber(),programId:r.programId.toBase58(),mintA:ht({address:o,programId:t,decimals:r.baseDecimal.toNumber()}),mintB:ht({address:s,programId:t,decimals:r.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:r.poolPrice.toNumber(),mintAmountA:new M(r.mintAAmount.toString()).div(10**r.baseDecimal.toNumber()).toNumber(),mintAmountB:new M(r.mintBAmount.toString()).div(10**r.quoteDecimal.toNumber()).toNumber(),baseReserve:r.baseReserve,quoteReserve:r.quoteReserve,feeRate:new M(r.tradeFeeNumerator.toString()).div(r.tradeFeeDenominator.toString()).toNumber(),openTime:r.poolOpenTime.toString(),tvl:0,day:Ci,week:Ci,month:Ci,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:r.marketId.toBase58(),configId:Ha({programId:r.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:ht({address:r.lpMint.toBase58(),programId:t,decimals:Math.min(r.baseDecimal.toNumber(),r.quoteDecimal.toNumber())}),burnPercent:0}}),e};import{PublicKey as nu,SystemProgram as iu}from"@solana/web3.js";import ru from"bn.js";import{createCloseAccountInstruction as ou,createInitializeAccountInstruction as su,createTransferInstruction as bP,TOKEN_PROGRAM_ID as on}from"@solana/spl-token";import{Keypair as Ja,PublicKey as $a}from"@solana/web3.js";import $g from"bn.js";import{TOKEN_PROGRAM_ID as eu}from"@solana/spl-token";function Qa(i){return i instanceof Uint8Array||i!=null&&typeof i=="object"&&i.constructor.name==="Uint8Array"}function Ni(i,...e){if(!Qa(i))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(i.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${i.length}`)}function Li(i,e=!0){if(i.destroyed)throw new Error("Hash instance has been destroyed");if(e&&i.finished)throw new Error("Hash#digest() has already been called")}function uo(i,e){Ni(i);let t=e.outputLen;if(i.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var En=i=>new DataView(i.buffer,i.byteOffset,i.byteLength),He=(i,e)=>i<<32-e|i>>>e;var _g=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function Ya(i){if(typeof i!="string")throw new Error(`utf8ToBytes expected string, got ${typeof i}`);return new Uint8Array(new TextEncoder().encode(i))}function Ri(i){return typeof i=="string"&&(i=Ya(i)),Ni(i),i}var Mn=class{clone(){return this._cloneInto()}},vg={}.toString;function co(i){let e=n=>i().update(Ri(n)).digest(),t=i();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>i(),e}function ja(i,e,t,n){if(typeof i.setBigUint64=="function")return i.setBigUint64(e,t,n);let r=BigInt(32),o=BigInt(4294967295),s=Number(t>>r&o),a=Number(t&o),c=n?4:0,u=n?0:4;i.setUint32(e+c,s,n),i.setUint32(e+u,a,n)}var lo=(i,e,t)=>i&e^~i&t,mo=(i,e,t)=>i&e^i&t^e&t,Fn=class extends Mn{constructor(e,t,n,r){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=r,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=En(this.buffer)}update(e){Li(this);let{view:t,buffer:n,blockLen:r}=this;e=Ri(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(r-this.pos,o-s);if(a===r){let c=En(e);for(;r<=o-s;s+=r)this.process(c,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===r&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Li(this),uo(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:r,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>r-s&&(this.process(n,0),s=0);for(let d=s;d<r;d++)t[d]=0;ja(n,r-8,BigInt(this.length*8),o),this.process(n,0);let a=En(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let u=c/4,l=this.get();if(u>l.length)throw new Error("_sha2: outputLen bigger than state");for(let d=0;d<u;d++)a.setUint32(4*d,l[d],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:r,finished:o,destroyed:s,pos:a}=this;return e.length=r,e.pos=a,e.finished=o,e.destroyed=s,r%t&&e.buffer.set(n),e}};var Za=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),bt=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),yt=new Uint32Array(64),Oi=class extends Fn{constructor(){super(64,32,8,!1),this.A=bt[0]|0,this.B=bt[1]|0,this.C=bt[2]|0,this.D=bt[3]|0,this.E=bt[4]|0,this.F=bt[5]|0,this.G=bt[6]|0,this.H=bt[7]|0}get(){let{A:e,B:t,C:n,D:r,E:o,F:s,G:a,H:c}=this;return[e,t,n,r,o,s,a,c]}set(e,t,n,r,o,s,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=r|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=c|0}process(e,t){for(let d=0;d<16;d++,t+=4)yt[d]=e.getUint32(t,!1);for(let d=16;d<64;d++){let m=yt[d-15],p=yt[d-2],y=He(m,7)^He(m,18)^m>>>3,f=He(p,17)^He(p,19)^p>>>10;yt[d]=f+yt[d-7]+y+yt[d-16]|0}let{A:n,B:r,C:o,D:s,E:a,F:c,G:u,H:l}=this;for(let d=0;d<64;d++){let m=He(a,6)^He(a,11)^He(a,25),p=l+m+lo(a,c,u)+Za[d]+yt[d]|0,f=(He(n,2)^He(n,13)^He(n,22))+mo(n,r,o)|0;l=u,u=c,c=a,a=s+p|0,s=o,o=r,r=n,n=p+f|0}n=n+this.A|0,r=r+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,c=c+this.F|0,u=u+this.G|0,l=l+this.H|0,this.set(n,r,o,s,a,c,u,l)}roundClean(){yt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var po=co(()=>new Oi);var _n=F([S("mint"),S("owner"),P("amount"),Fe("delegateOption"),S("delegate"),U("state"),Fe("isNativeOption"),P("isNative"),P("delegatedAmount"),Fe("closeAuthorityOption"),S("closeAuthority")]);var rP=ae("Raydium_Util");function fo({fromPublicKey:i,programId:e=eu,assignSeed:t}){let n=t?btoa(t).slice(0,32):Ja.generate().publicKey.toBase58().slice(0,32);return{publicKey:tu(i,n,e),seed:n}}function tu(i,e,t){let n=Buffer.concat([i.toBuffer(),Buffer.from(e),t.toBuffer()]),r=po(n);return new $a(r)}function au(i){let{mint:e,tokenAccount:t,owner:n,programId:r=on}=i;return su(t,e,n,r)}function sn(i){let{tokenAccount:e,payer:t,multiSigners:n=[],owner:r,programId:o=on}=i;return ou(e,t,r,n,o)}async function Mi(i){let{connection:e,amount:t,commitment:n,payer:r,owner:o,skipCloseAccount:s}=i,a=await e.getMinimumBalanceForRentExemption(_n.span,n),c=ue(t).add(new ru(a)),u=fo({fromPublicKey:r,programId:on});return{addresses:{newAccount:u.publicKey},signers:[],instructions:[iu.createAccountWithSeed({fromPubkey:r,basePubkey:r,seed:u.seed,newAccountPubkey:u.publicKey,lamports:c.toNumber(),space:_n.span,programId:on}),au({mint:new nu(je.address),tokenAccount:u.publicKey,owner:o,programId:on})],instructionTypes:[ee.CreateAccount,ee.InitAccount],endInstructionTypes:s?[]:[ee.CloseAccount],endInstructions:s?[]:[sn({tokenAccount:u.publicKey,payer:r,owner:o})]}}var bo={[ai.toBase58()]:3},yo={3:ai};var Ei=F([Pe(5),Pe(8),S("ownAddress"),P("vaultSignerNonce"),S("baseMint"),S("quoteMint"),S("baseVault"),P("baseDepositsTotal"),P("baseFeesAccrued"),S("quoteVault"),P("quoteDepositsTotal"),P("quoteFeesAccrued"),P("quoteDustThreshold"),S("requestQueue"),S("eventQueue"),S("bids"),S("asks"),P("baseLotSize"),P("quoteLotSize"),P("feeRateBps"),P("referrerRebatesAccrued"),Pe(7)]),go={3:Ei};import{PublicKey as Po}from"@solana/web3.js";var vn=ae("Serum"),Vn=class{static getProgramId(e){let t=yo[e];return t||vn.logWithError("invalid version","version",e),t}static getVersion(e){let t=e.toBase58(),n=bo[t];return n||vn.logWithError("invalid program id","programId",t),n}static getStateLayout(e){let t=go[e];return t||vn.logWithError(!!t,"invalid version","version",e),t}static getLayouts(e){return{state:this.getStateLayout(e)}}static getAssociatedAuthority({programId:e,marketId:t}){let n=[t.toBuffer()],r=0,o;for(;r<100;){try{let s=n.concat(Buffer.from([r]),Buffer.alloc(7));o=Po.createProgramAddressSync(s,e)}catch(s){if(s instanceof TypeError)throw s;r++;continue}return{publicKey:o,nonce:r}}return vn.logWithError("unable to find a viable program address nonce","params",{programId:e,marketId:t}),{publicKey:Po.default,nonce:r}}};var vP=F([Fe("mintAuthorityOption"),S("mintAuthority"),P("supply"),U("decimals"),U("isInitialized"),Fe("freezeAuthorityOption"),S("freezeAuthority")]);import{PublicKey as q,SystemProgram as uu,TransactionInstruction as cu}from"@solana/web3.js";import Kt from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as lu,TOKEN_2022_PROGRAM_ID as mu,TOKEN_PROGRAM_ID as du}from"@solana/spl-token";function pu(i,e,t,n,r,o,s,a,c,u,l,d,m,p,y){var h;let f=[],b=[x({pubkey:du,isWritable:!1}),x({pubkey:mu,isWritable:!1}),x({pubkey:lu,isWritable:!1}),x({pubkey:uu.programId,isWritable:!1}),x({pubkey:e,isSigner:!0})];b.push(x({pubkey:t})),b.push(x({pubkey:r}));let g=[c,u],w=[l,d],A=[o,s,a];for(let K=0;K<g.length;K++){let R=g[K],W=A[K]===R.mintA.address;if(b.push(x({pubkey:new q(R.programId),isWritable:!1})),K===g.length-1?b.push(x({pubkey:r})):b.push(x({pubkey:n})),b.push(x({pubkey:new q(A[K])})),b.push(x({pubkey:new q(A[K+1])})),R.version===6){let T=w[K];b.push(x({pubkey:new q(T.config.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(W?T.vault.A:T.vault.B)})),b.push(x({pubkey:new q(W?T.vault.B:T.vault.A)})),b.push(x({pubkey:new q(R.observationId)})),b.push(x({pubkey:Ot})),b.push(x({pubkey:Ce(new q(R.programId),new q(R.id)).publicKey})),f.push(fu(R.sqrtPriceX64.toString(),W));for(let O of(h=y[K])!=null?h:[])b.push(x({pubkey:new q(O)}))}else if(R.version===5){let T=w[K];b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.authority),isWritable:!1})),b.push(x({pubkey:new q(T.marketProgramId)})),b.push(x({pubkey:new q(T.marketAuthority)})),b.push(x({pubkey:wr,isWritable:!1})),b.push(x({pubkey:new q(T.openOrders)})),b.push(x({pubkey:new q(T.vault.A)})),b.push(x({pubkey:new q(T.vault.B)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.marketId)})),b.push(x({pubkey:new q(T.marketBids)})),b.push(x({pubkey:new q(T.marketAsks)})),b.push(x({pubkey:new q(T.marketEventQueue)})),b.push(x({pubkey:new q(T.marketBaseVault)})),b.push(x({pubkey:new q(T.marketQuoteVault)}))}else if(R.version===4){let T=w[K],O=R.status!==1;b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(T.authority),isWritable:!1})),b.push(x({pubkey:new q(O?T.id:T.marketProgramId)})),b.push(x({pubkey:new q(O?T.id:T.marketAuthority)})),b.push(x({pubkey:new q(O?T.id:T.openOrders)})),b.push(x({pubkey:new q(T.vault.A)})),b.push(x({pubkey:new q(T.vault.B)})),b.push(x({pubkey:new q(O?T.id:T.marketId)})),b.push(x({pubkey:new q(O?T.id:T.marketBids)})),b.push(x({pubkey:new q(O?T.id:T.marketAsks)})),b.push(x({pubkey:new q(O?T.id:T.marketEventQueue)})),b.push(x({pubkey:new q(O?T.id:T.marketBaseVault)})),b.push(x({pubkey:new q(O?T.id:T.marketQuoteVault)}))}else if(R.version===7){let T=w[K];b.push(x({pubkey:new q(T.authority)})),b.push(x({pubkey:new q(T.config.id)})),b.push(x({pubkey:new q(T.id)})),b.push(x({pubkey:new q(W?T.vault.A:T.vault.B)})),b.push(x({pubkey:new q(W?T.vault.B:T.vault.A)})),b.push(x({pubkey:new q(R.observationId)}))}else throw Error("pool type error")}let k=F([U("insId"),P("amountIn"),P("amountOut"),te(Q(),f.length,"clmmPriceLimit")]),B=Buffer.alloc(k.span);return k.encode({insId:0,amountIn:m,amountOut:p,clmmPriceLimit:f},B),new cu({keys:b,programId:i,data:B})}function fu(i,e){if(i)if(e){let t=new Kt(i).div(new Kt(25));return t.gt(Kn)?t:Kn}else{let t=new Kt(i).mul(new Kt(25));return t.lt(Cn)?t:Cn}else return e?Kn:Cn}function Ao({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,c,u,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let d=n.poolKey[0],m=At(d),p=t.equals(m.mintA.address)?Ze.add(_e):Je.sub(_e);return St.makeSwapBaseInInstructions({poolInfo:d,poolKeys:d,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:m.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:m.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new Kt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let d=n.poolInfo[0],m=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[$r(d.programId,e.wallet,d.authority,d.configId,d.id,e.sourceToken,e.destinationToken,m?d.vaultA:d.vaultB,m?d.vaultB:d.vaultA,m?d.mintProgramA:d.mintProgramB,m?d.mintProgramB:d.mintProgramA,new q(d[m?"mintA":"mintB"].address),new q(d[m?"mintB":"mintA"].address),d.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[m?ee.CpmmSwapBaseIn:ee.CpmmSwapBaseOut],address:{}}}else{let d=n.poolKey[0];return{signers:[],instructions:[oo({poolKeys:d,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((c=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?c:new Kt(0)),fixedSide:"in"})],lookupTableAddress:d.lookupTableAccount?[d.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ee.AmmV5SwapBaseIn:ee.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let d=n.poolInfo[0],m=n.poolInfo[1],p=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[pu(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),d,m,p,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(u=n.minAmountOut.fee)==null?void 0:u.raw)!=null?l:new Kt(0)),n.remainingAccounts)],instructionTypes:[ee.RouteSwap],lookupTableAddress:[p.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var ut=new Dn(0),Fi=class extends Ft{constructor(e){super(e)}async getWSolAccounts(){this.scope.checkOwner(),await this.scope.account.fetchWalletTokenAccounts();let e=this.scope.account.tokenAccounts.filter(t=>t.mint.equals(qe));return e.sort((t,n)=>t.isAssociated?1:n.isAssociated||t.amount.lt(n.amount)?-1:1),e}async unWrapWSol(e){let{amount:t,tokenProgram:n,txVersion:r=1}=e,o=await this.getWSolAccounts(),s=this.createTxBuilder();s.addCustomComputeBudget(e.computeBudgetConfig);let a=await Mi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:0});s.addInstruction(a);let c=ue(t);for(let u=0;u<o.length;u++)c.gte(o[u].amount)?(s.addInstruction({instructions:[sn({tokenAccount:o[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]}),c.sub(o[u].amount)):s.addInstruction({instructions:[sn({tokenAccount:o[u].publicKey,payer:this.scope.ownerPubKey,owner:this.scope.ownerPubKey,programId:n})]});return s.versionBuild({txVersion:r})}async wrapWSol(e,t,n){let r=this.createTxBuilder(),o=await Mi({connection:this.scope.connection,owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,amount:e,skipCloseAccount:!0});return r.addInstruction(o),r.versionBuild({txVersion:n!=null?n:1})}async swap({swapInfo:e,swapPoolKeys:t,ownerInfo:n,computeBudgetConfig:r,routeProgram:o,txVersion:s}){let a=this.createTxBuilder(),c=e.amountIn,u=e.amountOut,l=c.amount.token.mint.equals(qe),d=u.amount.token.mint.equals(qe),m=c.amount.token.mint,p=u.amount.token.mint,{account:y,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:c.amount.token.isToken2022?Wn:be,mint:m,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:l?{payer:this.scope.ownerPubKey,amount:c.amount.raw}:void 0,associatedOnly:l?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});if(f&&a.addInstruction(f),y===void 0)throw Error("input account check error");let b;if(e.routeType==="route")b=this.scope.account.getAssociatedTokenAccount(p,u.amount.token.isToken2022?Wn:be);else{let{account:k,instructionParams:B}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.amount.token.isToken2022?Wn:be,mint:p,notUseTokenAccount:d,owner:this.scope.ownerPubKey,skipCloseAccount:!0,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:d?!1:n.associatedOnly,checkCreateATAOwner:n.checkCreateATAOwner});b=k,B&&a.addInstruction(B)}d&&a.addInstruction({endInstructions:[sn({owner:this.scope.ownerPubKey,payer:this.scope.ownerPubKey,tokenAccount:b,programId:be})],endInstructionTypes:[ee.CloseAccount]});let g;if(e.routeType==="route"){let k=e.middleToken;g=this.scope.account.getAssociatedTokenAccount(k.mint,k.isToken2022?Wn:be)}let w=t||await this.computePoolToPoolKeys({pools:e.poolInfoList}),A=Ao({routeProgram:o,inputMint:m,swapInfo:H(V({},e),{poolInfo:[...e.poolInfoList],poolKey:w,outputMint:p}),ownerInfo:{wallet:this.scope.ownerPubKey,sourceToken:y,routeToken:g,destinationToken:b}});if(e.feeConfig!==void 0){let k=this.createTxBuilder();k.addInstruction({instructions:[ko(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[ee.TransferAmount]}),k.addInstruction(A);let{transactions:B}=s===0?await k.sizeCheckBuildV0():await k.sizeCheckBuild();B.length<2&&a.addInstruction({instructions:[ko(y,e.feeConfig.feeAccount,this.scope.ownerPubKey,e.feeConfig.feeAmount.toNumber())],instructionTypes:[ee.TransferAmount]})}return a.addInstruction(A),s===0?a.sizeCheckBuildV0({computeBudgetConfig:r,address:A.address}):a.sizeCheckBuild({computeBudgetConfig:r,address:A.address})}async fetchRoutePoolBasicInfo(e){let{amm:t=kr,clmm:n=ui,cpmm:r=ci}=e||{},o=await this.scope.connection.getProgramAccounts(t,{dataSlice:{offset:to.offsetOf("baseMint"),length:64}}),s=F([S("baseMint"),S("quoteMint")]),a=o.map(p=>({id:p.pubkey,version:4,mintA:s.decode(p.account.data).baseMint,mintB:s.decode(p.account.data).quoteMint})),c=F([S("mintA"),S("mintB")]),l=(await this.scope.connection.getProgramAccounts(n,{filters:[{dataSize:vt.span}],dataSlice:{offset:vt.offsetOf("mintA"),length:64}})).map(p=>{let y=c.decode(p.account.data);return{id:p.pubkey,version:6,mintA:y.mintA,mintB:y.mintB}}),m=(await this.scope.connection.getProgramAccounts(r,{dataSlice:{offset:Zr.offsetOf("mintA"),length:64}})).map(p=>{let y=c.decode(p.account.data);return{id:p.pubkey,version:7,mintA:y.mintA,mintB:y.mintB}});return{clmmPools:l,ammPools:a,cpmmPools:m}}getAllRoute({inputMint:e,outputMint:t,clmmPools:n,ammPools:r,cpmmPools:o}){e=e.toString()===Ct.default.toString()?qe:e,t=t.toString()===Ct.default.toString()?qe:t;let s={},a={},c={},u=[],l={};for(let m of n!=null?n:[]){if((m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),a[m.id.toString()]=m),m.mintA.equals(e)){let p=m.mintB.toString();l[p]===void 0&&(l[p]={mintProgram:be,in:[],out:[],mDecimals:0}),l[p].in.push(m)}if(m.mintB.equals(e)){let p=m.mintA.toString();l[p]===void 0&&(l[p]={mintProgram:be,in:[],out:[],mDecimals:0}),l[p].in.push(m)}if(m.mintA.equals(t)){let p=m.mintB.toString();l[p]===void 0&&(l[p]={mintProgram:be,in:[],out:[],mDecimals:0}),l[p].out.push(m)}if(m.mintB.equals(t)){let p=m.mintA.toString();l[p]===void 0&&(l[p]={mintProgram:be,in:[],out:[],mDecimals:0}),l[p].out.push(m)}}let d=[];for(let m of r)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),s[m.id.toBase58()]=m,d.push(m)),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of o)(m.mintA.equals(e)&&m.mintB.equals(t)||m.mintA.equals(t)&&m.mintB.equals(e))&&(u.push(m),c[m.id.toBase58()]=m),m.mintA.equals(e)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].in.push(m)),m.mintB.equals(e)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].in.push(m)),m.mintA.equals(t)&&(l[m.mintB.toBase58()]===void 0&&(l[m.mintB.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintB.toBase58()].out.push(m)),m.mintB.equals(t)&&(l[m.mintA.toBase58()]===void 0&&(l[m.mintA.toBase58()]={mintProgram:be,in:[],out:[],mDecimals:0}),l[m.mintA.toBase58()].out.push(m));for(let m of Object.keys(l)){if(l[m].in.length===1&&l[m].out.length===1&&l[m].in[0].id.equals(l[m].out[0].id)){delete l[m];continue}if(l[m].in.length===0||l[m].out.length===0){delete l[m];continue}let p=l[m];for(let y of p.in)for(let f of p.out)y.version===6&&a[y.id.toString()]===void 0?a[y.id.toString()]=y:y.version===7&&c[y.id.toString()]===void 0?c[y.id.toString()]=y:(y.version===4||y.version===5)&&s[y.id.toString()]===void 0&&(s[y.id.toString()]=y),f.version===6&&a[f.id.toString()]===void 0?a[f.id.toString()]=f:f.version===7&&c[f.id.toString()]===void 0?c[f.id.toString()]=f:(f.version===4||f.version===5)&&s[f.id.toString()]===void 0&&(s[f.id.toString()]=f)}return{directPath:u,addLiquidityPools:d,routePathDict:l,needSimulate:Object.values(s),needTickArray:Object.values(a),cpmmPoolList:Object.values(c)}}async fetchSwapRoutesData({routes:e,inputMint:t,outputMint:n}){let r=new Set([...e.needTickArray.map(f=>[f.mintA.toBase58(),f.mintB.toBase58()]).flat(),t.toString(),n.toString()]);console.log("fetching amm pools info, total: ",e.needSimulate.length);let o=await this.scope.liquidity.getRpcPoolInfos(e.needSimulate.map(f=>f.id)),s=ao(o),a={};Object.values(s).forEach(f=>{r.delete(f.mintA.address),a[f.mintA.address]={address:new Ct(f.mintA.address),programId:be,mintAuthority:null,supply:BigInt(0),decimals:f.mintA.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0},r.delete(f.mintB.address),a[f.mintB.address]={address:new Ct(f.mintB.address),programId:be,mintAuthority:null,supply:BigInt(0),decimals:f.mintB.decimals,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}}),console.log("fetching cpmm pools info, total: ",e.cpmmPoolList.length);let c=await this.scope.cpmm.getRpcPoolInfos(e.cpmmPoolList.map(f=>f.id.toBase58()),!0);Object.values(c).forEach(f=>{let[b,g]=[f.mintA.toBase58(),f.mintB.toBase58()];f.mintProgramA.equals(be)?(r.delete(b),a[b]={address:f.mintA,programId:f.mintProgramA,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalA,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(b),f.mintProgramB.equals(be)?(r.delete(g),a[g]={address:f.mintB,programId:f.mintProgramB,mintAuthority:null,supply:BigInt(0),decimals:f.mintDecimalB,isInitialized:!0,freezeAuthority:null,tlvData:Buffer.from("0","hex"),feeConfig:void 0}):r.add(g)}),console.log("fetching mints info, total: ",r.size);let u=await Zn({connection:this.scope.connection,mints:Array.from(r).map(f=>new Ct(f))});a=V(V({},a),u);let l=this.scope.cpmm.toComputePoolInfos({pools:c,mintInfos:a});console.log("fetching clmm pools info, total:",e.needTickArray.length);let d=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:e.needTickArray.map(f=>f.id)}),{computeClmmPoolInfo:m,computePoolTickData:p}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:d,mintInfos:a}),y=Object.keys(e.routePathDict).reduce((f,b)=>H(V({},f),{[b]:H(V({},e.routePathDict[b]),{mintProgram:a[b].programId,mDecimals:a[b].decimals,in:e.routePathDict[b].in.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()]),out:e.routePathDict[b].out.map(g=>s[g.id.toBase58()]||m[g.id.toBase58()]||l[g.id.toBase58()])})}),{});return{mintInfos:a,ammPoolsRpcInfo:o,ammSimulateCache:s,clmmPoolsRpcInfo:d,computeClmmPoolInfo:m,computePoolTickData:p,computeCpmmData:l,routePathDict:y}}getAllRouteComputeAmountOut({inputTokenAmount:e,outputToken:t,directPath:n,routePathDict:r,simulateCache:o,tickCache:s,slippage:a,chainTime:c,epochInfo:u,feeConfig:l}){var g,w,A,k,B,h,K,R,W;let d=l===void 0?new Dn(0):e.raw.mul(new Dn(l.feeBps.toNumber())).div(new Dn(1e4)),m=e.raw.sub(d),p=new ce(e.token,m),y=l===void 0?void 0:{feeAmount:d,feeAccount:l.feeAccount},f=H(V({},t),{address:Ye(t.address).toString()}),b=[];for(let T of n)try{b.push(H(V({},this.computeAmountOut({itemPool:T,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:p})),{feeConfig:y}))}catch(O){this.logDebug("direct error",T.version,T.id.toString(),O.message)}this.logDebug("direct done");for(let[T,O]of Object.entries(r)){let $={chainId:101,address:T,programId:O.mintProgram.toBase58(),logoURI:"",symbol:"",name:"",decimals:O.mDecimals,tags:[],extensions:{}},z=O.in.map(J=>{try{return{pool:J,data:this.computeAmountOut({itemPool:J,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:$,amountIn:p})}}catch(_){this.logDebug("route in error",J.version,J.id.toString(),_.message);return}}).sort((J,_)=>{var _i,vi,Vi,Wi;let Nt=J===void 0?ut:J.data.amountOut.amount.raw.sub((vi=(_i=J.data.amountOut.fee)==null?void 0:_i.raw)!=null?vi:ut),wo=_===void 0?ut:_.data.amountOut.amount.raw.sub((Wi=(Vi=_.data.amountOut.fee)==null?void 0:Vi.raw)!=null?Wi:ut);return Nt.lt(wo)?1:-1})[0];if(z===void 0)continue;let ye=new ce(Lr($),z.data.amountOut.amount.raw.sub((w=(g=z.data.amountOut.fee)==null?void 0:g.raw)!=null?w:ut));for(let J of O.out)try{let _=this.computeAmountOut({itemPool:J,tickCache:s,simulateCache:o,chainTime:c,epochInfo:u,slippage:a,outputToken:f,amountIn:ye});b.push(H(V({},_),{allTrade:!!(z.data.allTrade&&_.allTrade),amountIn:z.data.amountIn,amountOut:_.amountOut,minAmountOut:_.minAmountOut,currentPrice:void 0,executionPrice:new M(new Re({baseToken:z.data.amountIn.amount.token,denominator:z.data.amountIn.amount.raw,quoteToken:_.amountOut.amount.token,numerator:_.amountOut.amount.raw.sub((k=(A=_.amountOut.fee)==null?void 0:A.raw)!=null?k:ut)}).toFixed()),priceImpact:new M(z.data.priceImpact.add(_.priceImpact).toFixed()),fee:[z.data.fee[0],_.fee[0]],routeType:"route",poolInfoList:[z.pool,J],remainingAccounts:[z.data.remainingAccounts[0],_.remainingAccounts[0]],minMiddleAmountFee:(B=_.amountOut.fee)!=null&&B.raw?new ce(z.data.amountOut.amount.token,((K=(h=z.data.amountOut.fee)==null?void 0:h.raw)!=null?K:ut).add((W=(R=_.amountOut.fee)==null?void 0:R.raw)!=null?W:ut)):void 0,middleToken:z.data.amountOut.amount.token,poolReady:z.data.poolReady&&_.poolReady,poolType:[z.data.poolType,_.poolType],feeConfig:y,expirationTime:Ue(z.data.expirationTime,_.expirationTime)}))}catch(_){this.logDebug("route out error",J.version,J.id.toString(),_.message)}}return b.filter(T=>(T.allTrade||this.logDebug(`pool ${T.poolInfoList.map(O=>O.id.toString()).join(",")} filter out since not all trade`),T.allTrade)).sort((T,O)=>T.amountOut.amount.raw.sub(O.amountOut.amount.raw).gt(ut)?-1:1)}computeAmountOut({itemPool:e,tickCache:t,simulateCache:n,chainTime:r,epochInfo:o,slippage:s,outputToken:a,amountIn:c}){if(e.version===6){let{allTrade:u,realAmountIn:l,amountOut:d,minAmountOut:m,expirationTime:p,currentPrice:y,executionPrice:f,priceImpact:b,fee:g,remainingAccounts:w,executionPriceX64:A}=Ae.computeAmountOutFormat({poolInfo:e,tickArrayCache:t[e.id.toString()],amountIn:c.raw,tokenOut:a,slippage:s,epochInfo:o,catchLiquidityInsufficient:!0});return{allTrade:u,amountIn:l,amountOut:d,minAmountOut:m,currentPrice:new M(y.toFixed()),executionPrice:new M(f.toFixed()),priceImpact:new M(b.toFixed()),fee:[g],remainingAccounts:[w],routeType:"amm",poolInfoList:[e],poolReady:e.startTime<r,poolType:"CLMM",slippage:s,clmmExPriceX64:[A],expirationTime:Ue(l.expirationTime,p)}}else if(e.version===7){let{allTrade:u,executionPrice:l,amountOut:d,minAmountOut:m,priceImpact:p,fee:y}=this.scope.cpmm.computeSwapAmount({pool:e,outputMint:a.address,amountIn:c.raw,slippage:s});return{allTrade:u,amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:Jt(H(V({},a),{amount:d})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:Jt(H(V({},a),{amount:m})),fee:void 0,expirationTime:void 0},currentPrice:e.poolPrice,executionPrice:l,priceImpact:p,fee:[new ce(c.token,y)],remainingAccounts:[],routeType:"amm",poolInfoList:[e],poolReady:e.openTime.toNumber()<r,poolType:"CPMM",slippage:s,clmmExPriceX64:[void 0],expirationTime:void 0}}else{if(![1,6,7].includes(n[e.id.toString()].status))throw Error("swap error");let{amountOut:u,minAmountOut:l,currentPrice:d,executionPrice:m,priceImpact:p,fee:y}=this.scope.liquidity.computeAmountOut({poolInfo:n[e.id.toString()],amountIn:c.raw,mintIn:c.token.mint,mintOut:a.address,slippage:s});return{amountIn:{amount:c,fee:void 0,expirationTime:void 0},amountOut:{amount:Jt(H(V({},a),{amount:u})),fee:void 0,expirationTime:void 0},minAmountOut:{amount:Jt(H(V({},a),{amount:l})),fee:void 0,expirationTime:void 0},currentPrice:d,executionPrice:m,priceImpact:p,fee:[new ce(c.token,y)],routeType:"amm",poolInfoList:[e],remainingAccounts:[],poolReady:Number(n[e.id].openTime)<r,poolType:e.version===5?"STABLE":void 0,expirationTime:void 0,allTrade:!0,slippage:s,clmmExPriceX64:[void 0]}}}async computePoolToPoolKeys({pools:e,clmmRpcData:t={},ammRpcData:n={}}){let r=new Set(e.filter(u=>u.version===6&&!t[u.id.toString()]).map(u=>u.id.toString()));if(r.size>0){let u=await this.scope.clmm.getRpcClmmPoolInfos({poolIds:Array.from(r)});Object.keys(u).forEach(l=>{t[l]=u[l]})}if(new Set(e.filter(u=>u.version===4&&!n[u.id.toString()]).map(u=>u.id.toString())).size>0){let u=await this.scope.liquidity.getRpcPoolInfos(Array.from(r));Object.keys(u).forEach(l=>{n[l]=u[l]})}let s=new Set(e.filter(u=>u.version===4).map(u=>u.marketId)),a={};s.size>0&&(await Pt(this.scope.connection,Array.from(s).map(l=>({pubkey:new Ct(l)})))).forEach(l=>{if(!l.accountInfo)return;let d=Ei.decode(l.accountInfo.data);a[l.pubkey.toBase58()]={marketId:l.pubkey.toString(),marketProgramId:l.accountInfo.owner.toString(),marketAuthority:Vn.getAssociatedAuthority({programId:l.accountInfo.owner,marketId:l.pubkey}).publicKey.toString(),marketBaseVault:d.baseVault.toString(),marketQuoteVault:d.quoteVault.toString(),marketBids:d.bids.toString(),marketAsks:d.asks.toString(),marketEventQueue:d.eventQueue.toString()}});let c=[];return e.forEach(u=>{if(u.version===6){let l=t[u.id.toString()],d={programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.startTime),vault:{A:l.vaultA.toBase58(),B:l.vaultB.toBase58()},config:H(V({},u.ammConfig),{id:u.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]}),rewardInfos:[]};c.push(d)}else if(u.version===4){let l=n[u.id.toString()],d=V({programId:u.programId,id:u.id,mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),vault:{A:l.baseVault.toBase58(),B:l.quoteVault.toBase58()},authority:so({programId:new Ct(u.programId)}).publicKey.toString(),openOrders:l.openOrders.toBase58(),targetOrders:l.targetOrders.toBase58(),mintLp:u.lpMint},a[u.marketId]);c.push(d)}else u.version===7&&c.push({programId:u.programId.toBase58(),id:u.id.toBase58(),mintA:u.mintA,mintB:u.mintB,openTime:String(u.openTime),authority:Jr(u.programId).publicKey.toBase58(),vault:{A:u.vaultA.toBase58(),B:u.vaultB.toBase58()},mintLp:ht({address:u.mintLp.toBase58(),programId:be.toBase58(),decimals:u.lpDecimals}),config:H(V({id:u.configId.toBase58()},u.configInfo),{protocolFeeRate:u.configInfo.protocolFeeRate.toNumber(),tradeFeeRate:u.configInfo.tradeFeeRate.toNumber(),fundFeeRate:u.configInfo.fundFeeRate.toNumber(),createPoolFee:u.configInfo.createPoolFee.toString()})})}),c}};export{Fi as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=trade.mjs.map