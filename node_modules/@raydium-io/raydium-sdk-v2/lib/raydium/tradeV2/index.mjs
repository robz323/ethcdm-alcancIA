var nr=Object.defineProperty,ir=Object.defineProperties;var rr=Object.getOwnPropertyDescriptors;var Xn=Object.getOwnPropertySymbols;var or=Object.prototype.hasOwnProperty,sr=Object.prototype.propertyIsEnumerable;var zn=(i,e,t)=>e in i?nr(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,j=(i,e)=>{for(var t in e||(e={}))or.call(e,t)&&zn(i,t,e[t]);if(Xn)for(var t of Xn(e))sr.call(e,t)&&zn(i,t,e[t]);return i},te=(i,e)=>ir(i,rr(e));import{PublicKey as aP}from"@solana/web3.js";import{createTransferInstruction as cP,TOKEN_PROGRAM_ID as lP,TOKEN_2022_PROGRAM_ID as mP}from"@solana/spl-token";import Ms from"bn.js";var Pt=9e15,at=1e9,an="0123456789abcdef",_t="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Dt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",un={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Pt,maxE:Pt,crypto:!1},Zn,Ze,W=!0,qt="[DecimalError] ",st=qt+"Invalid argument: ",jn=qt+"Precision limit exceeded",Jn=qt+"crypto unavailable",$n="[object Decimal]",he=Math.floor,fe=Math.pow,ar=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ur=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,cr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ei=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,De=1e7,_=7,lr=9007199254740991,mr=_t.length-1,cn=Dt.length-1,A={toStringTag:$n};A.absoluteValue=A.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),v(i)};A.ceil=function(){return v(new this.constructor(this),this.e+1,2)};A.clampedTo=A.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(st+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};A.comparedTo=A.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};A.cosine=A.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+_,n.rounding=1,t=dr(n,oi(n,t)),n.precision=i,n.rounding=e,v(Ze==2||Ze==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};A.cubeRoot=A.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(W=!1,o=l.s*fe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=ke(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=fe(t,1/3),i=he((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ie(c.plus(l).times(a),c.plus(u),s+2,1),ke(a.d).slice(0,s)===(t=ke(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(v(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(v(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return W=!0,v(n,i,m.rounding,e)};A.decimalPlaces=A.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-he(this.e/_))*_,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};A.dividedBy=A.div=function(i){return ie(this,new this.constructor(i))};A.dividedToIntegerBy=A.divToInt=function(i){var e=this,t=e.constructor;return v(ie(e,new t(i),0,1,1),t.precision,t.rounding)};A.equals=A.eq=function(i){return this.cmp(i)===0};A.floor=function(){return v(new this.constructor(this),this.e+1,3)};A.greaterThan=A.gt=function(i){return this.cmp(i)>0};A.greaterThanOrEqualTo=A.gte=function(i){var e=this.cmp(i);return e==1||e===0};A.hyperbolicCosine=A.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ut(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=At(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return v(o,s.precision=t,s.rounding=n,!0)};A.hyperbolicSine=A.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=At(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ut(5,i)),r=At(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,v(r,e,t,!0)};A.hyperbolicTangent=A.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ie(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};A.inverseCosine=A.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?_e(t,r,o):new t(0):new t(NaN):e.isZero()?_e(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=_e(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};A.inverseHyperbolicCosine=A.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,W=!1,t=t.times(t).minus(1).sqrt().plus(t),W=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};A.inverseHyperbolicSine=A.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,W=!1,t=t.times(t).plus(1).sqrt().plus(t),W=!0,n.precision=i,n.rounding=e,t.ln())};A.inverseHyperbolicTangent=A.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?v(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ie(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};A.inverseSine=A.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=_e(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};A.inverseTangent=A.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=cn)return s=_e(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=cn)return s=_e(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/_+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(W=!1,e=Math.ceil(a/_),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),W=!0,v(s,l.precision=m,l.rounding=d,!0)};A.isFinite=function(){return!!this.d};A.isInteger=A.isInt=function(){return!!this.d&&he(this.e/_)>this.d.length-2};A.isNaN=function(){return!this.s};A.isNegative=A.isNeg=function(){return this.s<0};A.isPositive=A.isPos=function(){return this.s>0};A.isZero=function(){return!!this.d&&this.d[0]===0};A.lessThan=A.lt=function(i){return this.cmp(i)<0};A.lessThanOrEqualTo=A.lte=function(i){return this.cmp(i)<1};A.logarithm=A.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(W=!1,a=m+p,s=ot(c,a),n=e?Wt(l,a+10):ot(i,a),u=ie(s,n,a,1),Bt(u.d,r=m,d))do if(a+=10,s=ot(c,a),n=e?Wt(l,a+10):ot(i,a),u=ie(s,n,a,1),!o){+ke(u.d).slice(r+1,r+15)+1==1e14&&(u=v(u,m+1,0));break}while(Bt(u.d,r+=10,d));return W=!0,v(u,m,d)};A.minus=A.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,g=p.constructor;if(i=new g(i),!p.d||!i.d)return!p.s||!i.s?i=new g(NaN):p.d?i.s=-i.s:i=new g(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=g.precision,u=g.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new g(p);else return new g(u===3?-0:0);return W?v(i,a,u):i}if(t=he(i.e/_),l=he(p.e/_),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/_),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=De-1;--c[r],c[n]+=De}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Gt(c,t),W?v(i,a,u):i):new g(u===3?-0:0)};A.modulo=A.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?v(new n(t),n.precision,n.rounding):(W=!1,n.modulo==9?(e=ie(t,i.abs(),0,3,1),e.s*=i.s):e=ie(t,i,0,n.modulo,1),e=e.times(i),W=!0,t.minus(e))};A.naturalExponential=A.exp=function(){return ln(this)};A.naturalLogarithm=A.ln=function(){return ot(this)};A.negated=A.neg=function(){var i=new this.constructor(this);return i.s=-i.s,v(i)};A.plus=A.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),W?v(i,a,u):i;if(o=he(m.e/_),n=he(i.e/_),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/_),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/De|0,c[r]%=De;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Gt(c,n),W?v(i,a,u):i};A.precision=A.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(st+i);return t.d?(e=ti(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};A.round=function(){var i=this,e=i.constructor;return v(new e(i),i.e+1,e.rounding)};A.sine=A.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+_,n.rounding=1,t=fr(n,oi(n,t)),n.precision=i,n.rounding=e,v(Ze>2?t.neg():t,i,e,!0)):new n(NaN)};A.squareRoot=A.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(W=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=ke(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=he((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ie(s,o,t+2,1)).times(.5),ke(o.d).slice(0,t)===(e=ke(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(v(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(v(n,u+1,1),i=!n.times(n).eq(s));break}return W=!0,v(n,u,l.rounding,i)};A.tangent=A.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ie(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,v(Ze==2||Ze==4?t.neg():t,i,e,!0)):new n(NaN)};A.times=A.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=he(l.e/_)+he(i.e/_),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%De|0,e=a/De|0;o[r]=(o[r]+e)%De|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Gt(o,t),W?v(i,m.precision,m.rounding):i};A.toBinary=function(i,e){return dn(this,2,i,e)};A.toDecimalPlaces=A.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ne(i,0,at),e===void 0?e=n.rounding:Ne(e,0,8),v(t,i+t.e+1,e))};A.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Ne(i,0,at),e===void 0?e=r.rounding:Ne(e,0,8),n=v(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};A.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Ne(i,0,at),e===void 0?e=o.rounding:Ne(e,0,8),n=v(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};A.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,g=p.d,f=p.constructor;if(!g)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ti(g)-p.e-1,s=o%_,e.d[0]=fe(10,s<0?_+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(st+a);i=a.gt(e)?o>0?e:c:a}for(W=!1,a=new f(ke(g)),l=f.precision,f.precision=o=g.length*_*2;m=ie(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=ie(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ie(c,n,o,1).minus(p).abs().cmp(ie(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,W=!0,d};A.toHexadecimal=A.toHex=function(i,e){return dn(this,16,i,e)};A.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ne(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(W=!1,t=ie(t,i,0,e,1).times(i),W=!0,v(t)):(i.s=t.s,t=i),t};A.toNumber=function(){return+this};A.toOctal=function(i,e){return dn(this,8,i,e)};A.toPower=A.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(fe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return v(a,n,o);if(e=he(i.e/_),e>=i.d.length-1&&(t=c<0?-c:c)<=lr)return r=ni(u,a,t,n),i.s<0?new u(1).div(r):v(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=fe(+a,c),e=t==0||!isFinite(t)?he(c*(Math.log("0."+ke(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(W=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=ln(i.times(ot(a,n+t)),n),r.d&&(r=v(r,n+5,1),Bt(r.d,n,o)&&(e=n+10,r=v(ln(i.times(ot(a,e+t)),e),e+5,1),+ke(r.d).slice(n+1,n+15)+1==1e14&&(r=v(r,n+1,0)))),r.s=s,W=!0,u.rounding=o,v(r,n,o))};A.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ne(i,1,at),e===void 0?e=r.rounding:Ne(e,0,8),n=v(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};A.toSignificantDigits=A.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ne(i,1,at),e===void 0?e=n.rounding:Ne(e,0,8)),v(new n(t),i,e)};A.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};A.truncated=A.trunc=function(){return v(new this.constructor(this),this.e+1,1)};A.valueOf=A.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function ke(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=_-n.length,t&&(o+=rt(t)),o+=n;s=i[e],n=s+"",t=_-n.length,t&&(o+=rt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ne(i,e,t){if(i!==~~i||i<e||i>t)throw Error(st+i)}function Bt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=_,r=0):(r=Math.ceil((e+1)/_),e%=_),o=fe(10,_-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==fe(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==fe(10,e-3)-1,s}function Vt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=an.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function dr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ut(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=At(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ie=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,g,f,y,P,T,w,C,M,h,F,N,Q,B,V,Pe,de=n.constructor,Ce=n.s==r.s?1:-1,ce=n.d,ee=r.d;if(!ce||!ce[0]||!ee||!ee[0])return new de(!n.s||!r.s||(ce?ee&&ce[0]==ee[0]:!ee)?NaN:ce&&ce[0]==0||!ee?Ce*0:Ce/0);for(u?(p=1,l=n.e-r.e):(u=De,p=_,l=he(n.e/p)-he(r.e/p)),V=ee.length,Q=ce.length,P=new de(Ce),T=P.d=[],m=0;ee[m]==(ce[m]||0);m++);if(ee[m]>(ce[m]||0)&&l--,o==null?(h=o=de.precision,s=de.rounding):a?h=o+(n.e-r.e)+1:h=o,h<0)T.push(1),g=!0;else{if(h=h/p+2|0,m=0,V==1){for(d=0,ee=ee[0],h++;(m<Q||d)&&h--;m++)F=d*u+(ce[m]||0),T[m]=F/ee|0,d=F%ee|0;g=d||m<Q}else{for(d=u/(ee[0]+1)|0,d>1&&(ee=i(ee,d,u),ce=i(ce,d,u),V=ee.length,Q=ce.length),N=V,w=ce.slice(0,V),C=w.length;C<V;)w[C++]=0;Pe=ee.slice(),Pe.unshift(0),B=ee[0],ee[1]>=u/2&&++B;do d=0,c=e(ee,w,V,C),c<0?(M=w[0],V!=C&&(M=M*u+(w[1]||0)),d=M/B|0,d>1?(d>=u&&(d=u-1),f=i(ee,d,u),y=f.length,C=w.length,c=e(f,w,y,C),c==1&&(d--,t(f,V<y?Pe:ee,y,u))):(d==0&&(c=d=1),f=ee.slice()),y=f.length,y<C&&f.unshift(0),t(w,f,C,u),c==-1&&(C=w.length,c=e(ee,w,V,C),c<1&&(d++,t(w,V<C?Pe:ee,C,u))),C=w.length):c===0&&(d++,w=[0]),T[m++]=d,c&&w[0]?w[C++]=ce[N]||0:(w=[ce[N]],C=1);while((N++<Q||w[0]!==void 0)&&h--);g=w[0]!==void 0}T[0]||T.shift()}if(p==1)P.e=l,Zn=g;else{for(m=1,d=T[0];d>=10;d/=10)m++;P.e=m+l*p-1,v(P,a?o+P.e+1:o,s,g)}return P}}();function v(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=_,s=e,l=m[d=0],u=l/fe(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/_),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=_,s=o-_+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=_,s=o-_+r,u=s<0?0:l/fe(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%fe(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/fe(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=fe(10,(_-e%_)%_),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=fe(10,_-o),m[d]=s>0?(l/fe(10,r-s)%fe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==De&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=De)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return W&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return ri(i);var n,r=i.e,o=ke(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+rt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+rt(-r-1)+o,t&&(n=t-s)>0&&(o+=rt(n))):r>=s?(o+=rt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+rt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=rt(n))),o}function Gt(i,e){var t=i[0];for(e*=_;t>=10;t/=10)e++;return e}function Wt(i,e,t){if(e>mr)throw W=!0,t&&(i.precision=t),Error(jn);return v(new i(_t),e,1,!0)}function _e(i,e,t){if(e>cn)throw Error(jn);return v(new i(Dt),e,t,!0)}function ti(i){var e=i.length-1,t=e*_+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function rt(i){for(var e="";i--;)e+="0";return e}function ni(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/_+4);for(W=!1;;){if(t%2&&(o=o.times(e),Hn(o.d,s)&&(r=!0)),t=he(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Hn(e.d,s)}return W=!0,o}function Qn(i){return i.d[i.d.length-1]&1}function ii(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function ln(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,g=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(W=!1,u=g):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(fe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=v(o.times(i),u,1),t=t.times(++l),a=s.plus(ie(o,t,u,1)),ke(a.d).slice(0,u)===ke(s.d).slice(0,u)){for(r=m;r--;)s=v(s.times(s),u,1);if(e==null)if(c<3&&Bt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return v(s,d.precision=g,p,W=!0);else return d.precision=g,s}s=a}}function ot(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,g=10,f=i,y=f.d,P=f.constructor,T=P.rounding,w=P.precision;if(f.s<0||!y||!y[0]||!f.e&&y[0]==1&&y.length==1)return new P(y&&!y[0]?-1/0:f.s!=1?NaN:y?0:f);if(e==null?(W=!1,l=w):l=e,P.precision=l+=g,t=ke(y),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=ke(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new P("0."+t),o++):f=new P(n+"."+t.slice(1))}else return c=Wt(P,l+2,w).times(o+""),f=ot(new P(n+"."+t.slice(1)),l-g).plus(c),P.precision=w,e==null?v(f,w,T,W=!0):f;for(m=f,u=s=f=ie(f.minus(1),f.plus(1),l,1),d=v(f.times(f),l,1),r=3;;){if(s=v(s.times(d),l,1),c=u.plus(ie(s,new P(r),l,1)),ke(c.d).slice(0,l)===ke(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Wt(P,l+2,w).times(o+""))),u=ie(u,new P(p),l,1),e==null)if(Bt(u.d,l-g,T,a))P.precision=l+=g,c=s=f=ie(m.minus(1),m.plus(1),l,1),d=v(f.times(f),l,1),r=a=1;else return v(u,P.precision=w,T,W=!0);else return P.precision=w,u;u=c,r+=2}}function ri(i){return String(i.s*i.s/0)}function mn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%_,t<0&&(n+=_),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=_;n<r;)i.d.push(+e.slice(n,n+=_));e=e.slice(n),n=_-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),W&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function pr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ei.test(e))return mn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(ur.test(e))t=16,e=e.toLowerCase();else if(ar.test(e))t=2;else if(cr.test(e))t=8;else throw Error(st+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ni(n,new n(t),o,o*2)),c=Vt(e,t,De),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Gt(c,l),i.d=c,W=!1,s&&(i=ie(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?fe(2,u):It.pow(2,u))),W=!0,i)}function fr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:At(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ut(5,t)),e=At(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function At(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/_);for(W=!1,u=t.times(t),a=new i(n);;){if(s=ie(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ie(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return W=!0,s.d.length=m+1,s}function Ut(i,e){for(var t=i;--e;)t*=i;return t}function oi(i,e){var t,n=e.s<0,r=_e(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ze=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ze=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ze=Qn(t)?n?2:3:n?4:1,e;Ze=Qn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function dn(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,g=t!==void 0;if(g?(Ne(t,1,at),n===void 0?n=p.rounding:Ne(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=ri(i);else{for(l=Xe(i),s=l.indexOf("."),g?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Vt(Xe(d),10,r),d.e=d.d.length),m=Vt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=g?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ie(i,d,t,n,0,r),m=i.d,o=i.e,c=Zn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=an.charAt(m[s]);if(g){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Vt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=an.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Hn(i,e){if(i.length>e)return i.length=e,!0}function br(i){return new this(i).abs()}function yr(i){return new this(i).acos()}function gr(i){return new this(i).acosh()}function Pr(i,e){return new this(i).plus(e)}function Ar(i){return new this(i).asin()}function kr(i){return new this(i).asinh()}function wr(i){return new this(i).atan()}function Tr(i){return new this(i).atanh()}function hr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=_e(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?_e(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=_e(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ie(i,e,o,1)),e=_e(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ie(i,e,o,1)),t}function Br(i){return new this(i).cbrt()}function Ir(i){return v(i=new this(i),i.e+1,2)}function xr(i,e,t){return new this(i).clamp(e,t)}function Sr(i){if(!i||typeof i!="object")throw Error(qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,at,"rounding",0,8,"toExpNeg",-Pt,0,"toExpPos",0,Pt,"maxE",0,Pt,"minE",-Pt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=un[t]),(n=i[t])!==void 0)if(he(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(st+t+": "+n);if(t="crypto",r&&(this[t]=un[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Jn);else this[t]=!1;else throw Error(st+t+": "+n);return this}function Kr(i){return new this(i).cos()}function Cr(i){return new this(i).cosh()}function si(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,Yn(o)){c.s=o.s,W?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;W?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return mn(c,o.toString())}else if(u!=="string")throw Error(st+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ei.test(o)?mn(c,o):pr(c,o)}if(r.prototype=A,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Sr,r.clone=si,r.isDecimal=Yn,r.abs=br,r.acos=yr,r.acosh=gr,r.add=Pr,r.asin=Ar,r.asinh=kr,r.atan=wr,r.atanh=Tr,r.atan2=hr,r.cbrt=Br,r.ceil=Ir,r.clamp=xr,r.cos=Kr,r.cosh=Cr,r.div=Nr,r.exp=Rr,r.floor=Lr,r.hypot=Or,r.ln=Mr,r.log=Er,r.log10=vr,r.log2=Fr,r.max=Vr,r.min=_r,r.mod=Dr,r.mul=Wr,r.pow=qr,r.random=Gr,r.round=Ur,r.sign=Xr,r.sin=zr,r.sinh=Qr,r.sqrt=Hr,r.sub=Yr,r.sum=Zr,r.tan=jr,r.tanh=Jr,r.trunc=$r,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Nr(i,e){return new this(i).div(e)}function Rr(i){return new this(i).exp()}function Lr(i){return v(i=new this(i),i.e+1,3)}function Or(){var i,e,t=new this(0);for(W=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return W=!0,new this(1/0);t=e}return W=!0,t.sqrt()}function Yn(i){return i instanceof It||i&&i.toStringTag===$n||!1}function Mr(i){return new this(i).ln()}function Er(i,e){return new this(i).log(e)}function Fr(i){return new this(i).log(2)}function vr(i){return new this(i).log(10)}function Vr(){return ii(this,arguments,"lt")}function _r(){return ii(this,arguments,"gt")}function Dr(i,e){return new this(i).mod(e)}function Wr(i,e){return new this(i).mul(e)}function qr(i,e){return new this(i).pow(e)}function Gr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ne(i,1,at),n=Math.ceil(i/_),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Jn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=_,n&&i&&(r=fe(10,_-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=_)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<_&&(t-=_-n)}return s.e=t,s.d=a,s}function Ur(i){return v(i=new this(i),i.e+1,this.rounding)}function Xr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function zr(i){return new this(i).sin()}function Qr(i){return new this(i).sinh()}function Hr(i){return new this(i).sqrt()}function Yr(i,e){return new this(i).sub(e)}function Zr(){var i=0,e=arguments,t=new this(e[i]);for(W=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return W=!0,v(t,this.precision,this.rounding)}function jr(i){return new this(i).tan()}function Jr(i){return new this(i).tanh()}function $r(i){return v(i=new this(i),i.e+1,1)}A[Symbol.for("nodejs.util.inspect.custom")]=A.toString;A[Symbol.toStringTag]="Decimal";var It=A.constructor=si(un);_t=new It(_t);Dt=new It(Dt);var R=It;import{PublicKey as no}from"@solana/web3.js";import{get as ai,set as eo}from"lodash";var pn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},ui={},to={};function re(i){let e=ai(ui,i);if(!e){let t=ai(to,i);e=new pn({name:i,logLevel:t}),eo(ui,i,e)}return e}import{MINT_SIZE as zs,TOKEN_PROGRAM_ID as Qs,getTransferFeeConfig as Hs,unpackMint as Ys}from"@solana/spl-token";var fn=re("Raydium_accountInfo_util");async function ut(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=j({batchRequest:!1},t),s=bn(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=bn(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:g,lamports:f,owner:y,rentEpoch:P}=d;return p.length!==2&&p[1]!=="base64"&&fn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:g,lamports:f,owner:new no(y),rentEpoch:P}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function xt(i,e,t){let n=await ut(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>te(j({},r),{accountInfo:n[o]}))}import $e from"bn.js";import lo from"big.js";import Qt from"bn.js";import io from"toformat";var ro=io,Kt=ro;import zt from"big.js";import so from"bn.js";import ao from"decimal.js-light";import Ct from"bn.js";var ci=9007199254740991;function oe(i){let e=re("Raydium_parseBigNumberish");if(i instanceof Ct)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Ct(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ci||i<=-ci)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Ct(String(i))):typeof i=="bigint"?new Ct(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Ct(0))}var Xt=re("module/fraction"),yn=Kt(zt),Nt=Kt(ao),uo={[0]:Nt.ROUND_DOWN,[1]:Nt.ROUND_HALF_UP,[2]:Nt.ROUND_UP},co={[0]:zt.roundDown,[1]:zt.roundHalfUp,[2]:zt.roundUp},J=class{constructor(e,t=new so(1)){this.numerator=oe(e),this.denominator=oe(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new J(this.denominator,this.numerator)}add(e){let t=e instanceof J?e:new J(oe(e));return this.denominator.eq(t.denominator)?new J(this.numerator.add(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof J?e:new J(oe(e));return this.denominator.eq(t.denominator)?new J(this.numerator.sub(t.numerator),this.denominator):new J(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof J?e:new J(oe(e));return new J(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof J?e:new J(oe(e));return new J(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<=0&&Xt.logWithError(`${e} is not positive.`),Nt.set({precision:e+1,rounding:uo[n]});let r=new Nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<0&&Xt.logWithError(`${e} is negative.`),yn.DP=e,yn.RM=co[n]||1,new yn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var mo=re("Raydium_amount"),li=Kt(lo);function po(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):mo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var be=class extends J{constructor(t,n,r=!0,o){let s=new Qt(0),a=gn.pow(new Qt(t.decimals));if(r)s=oe(n);else{let u=new Qt(0),c=new Qt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=po(n.toString(),t.decimals);u=oe(l),c=oe(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=re(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new be(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new be(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return li.DP=this.token.decimals,new li(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as fo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mi}from"@solana/spl-token";var Pn={chainId:101,address:fo.default.toBase58(),programId:mi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},je={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as wn}from"@solana/web3.js";import{PublicKey as ue,SystemProgram as di,SYSVAR_RENT_PUBKEY as bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as yo}from"@solana/spl-token";function k({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Sa=[k({pubkey:yo,isWritable:!1}),k({pubkey:di.programId,isWritable:!1}),k({pubkey:bo,isWritable:!1})];function An({publicKey:i,transformSol:e}){let t=kn(i.toString());if(t instanceof ue)return e&&t.equals(Rt)?St:t;if(e&&t.toString()===Rt.toBase58())return St;if(typeof t=="string"){if(t===ue.default.toBase58())return ue.default;try{return new ue(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function kn(i){try{return new ue(i)}catch{return i}}var Ht=new ue("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),wt=new ue("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ct=new ue("SysvarRent111111111111111111111111111111111"),Ka=new ue("SysvarC1ock11111111111111111111111111111111"),lt=new ue("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ca=new ue("Sysvar1nstructions1111111111111111111111111"),go=di.programId,Na=new ue("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ra=new ue("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),La=new ue("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Oa=new ue("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ma=new ue("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ea=new ue("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Fa=new ue("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),va=new ue("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Va=new ue("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),_a=new ue("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Da=new ue("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),St=new ue("So11111111111111111111111111111111111111112"),Rt=ue.default;function kt(i){return An({publicKey:i,transformSol:!0})}var Tn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Rt.toBase58()||e instanceof wn&&Rt.equals(e)){this.decimals=je.decimals,this.symbol=je.symbol,this.name=je.name,this.mint=new wn(je.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?wn.default:An({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},We=Tn;We.WSOL=new Tn(te(j({},je),{mint:je.address}));var hn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Yt=hn;Yt.SOL=new hn(Pn);import Po from"bn.js";var pi=new J(new Po(100)),Je=class extends J{toSignificant(e=5,t,n){return this.mul(pi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(pi).toFixed(e,t,n)}};var Ao=re("Raydium_price"),Oe=class extends J{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new J(Bn(n.decimals),Bn(r.decimals))}get raw(){return new J(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Oe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ao.logWithError("mul token not equals");let n=super.mul(t);return new Oe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as ko}from"@solana/web3.js";import wo from"bn.js";function bi(i){return typeof i=="object"&&i!==null&&![We,be,ko,J,wo,Oe,Je].some(e=>typeof e=="object"&&i instanceof e)}function Me(i){return typeof i=="string"?kn(i):Array.isArray(i)?i.map(e=>Me(e)):bi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Me(t)])):i}var fi=new $e(0),To=new $e(1),Eu=new $e(2),Fu=new $e(3),vu=new $e(5),gn=new $e(10),Vu=new $e(100),_u=new $e(1e3),Du=new $e(1e4);function Bn(i){return gn.pow(oe(i))}function bn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Bo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Io}from"@solana/spl-token";import{ComputeBudgetProgram as Hu,Keypair as ju,PublicKey as ho,Transaction as $u,TransactionMessage as tc,VersionedTransaction as nc}from"@solana/web3.js";var ne={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as sc}from"@solana/spl-token";var ac=re("Raydium_txUtil");function we(i,e){let[t,n]=ho.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Ie(i,e,t){return we([i.toBuffer(),(t!=null?t:Io).toBuffer(),e.toBuffer()],new Bo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as X}from"@solana/web3.js";var fc=new X("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),bc=new X("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),yc=new X("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),gc=new X("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Pc=new X("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Ac=new X("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),yi=new X("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),xo=new X("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),kc=new X("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),gi=new X("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Pi=new X("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),So=new X("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ko=new X("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),wc=new X("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Tc=new X("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),hc=new X("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Bc=new X("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ic=new X("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),xc=new X("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ai=new X("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Co=new X("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Sc=new X("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),No=new X("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Ro=new X("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Lo=new X("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Kc=new X("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Oo=new X("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Cc=new X("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Mo=new X("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Nc={SERUM_MARKET:X.default,OPENBOOK_MARKET:new X("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:X.default,FarmV3:new X("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new X("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new X("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new X("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new X("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new X("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new X("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new X("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new X("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:No,CREATE_CPMM_POOL_AUTH:Ro,CREATE_CPMM_POOL_FEE_ACC:Lo,FEE_DESTINATION_ID:new X("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Oo,LCOK_CPMM_AUTH:Mo};import qe from"bn.js";var Lt=1e4;function le(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=te(j({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new qe(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Lt){let u=new qe(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Zt(i.mul(new qe(Lt)),new qe(Lt-o.transferFeeBasisPoints)),c=new qe(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Zt(l.mul(new qe(o.transferFeeBasisPoints)),new qe(Lt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Zt(i.mul(new qe(o.transferFeeBasisPoints)),new qe(Lt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function et(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Zt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new qe(0))?t.add(new qe(1)):t}import{PublicKey as Eo,AddressLookupTableAccount as ki}from"@solana/web3.js";var Fo={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new ki({key:new Eo("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:ki.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Hc,sendAndConfirmTransaction as Yc,Transaction as jc,TransactionMessage as $c,VersionedTransaction as el}from"@solana/web3.js";import nl from"axios";import{PublicKey as zo}from"@solana/web3.js";import Ii,{isBN as xi}from"bn.js";import{bits as Sl,BitStructure as Kl,blob as Vo,Blob as Cl,cstr as Nl,f32 as Rl,f32be as Ll,f64 as Ol,f64be as Ml,greedy as El,Layout as _o,ns64 as Fl,ns64be as vl,nu64 as Vl,nu64be as _l,offset as Dl,s16 as Wl,s16be as ql,s24 as Gl,s24be as Ul,s32 as Do,s32be as Xl,s40 as zl,s40be as Ql,s48 as Hl,s48be as Yl,s8 as Zl,seq as Wo,struct as jl,Structure as qo,u16 as Go,u16be as Jl,u24 as $l,u24be as em,u32 as tm,u32be as nm,u40 as im,u40be as rm,u48 as om,u48be as sm,u8 as Uo,UInt as Xo,union as am,Union as um,unionLayoutDiscriminator as cm,utf8 as lm}from"@solana/buffer-layout";var In=_o,Ti=qo;var xn=Xo;var hi=Uo,mt=Go;var Te=Do;var Bi=Wo;var pe=Vo;var Tt=class extends In{constructor(t,n,r){super(t,r);this.blob=pe(t),this.signed=n}decode(t,n=0){let r=new Ii(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ii(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function D(i){return new xn(1,i)}function Ee(i){return new xn(4,i)}function b(i){return new Tt(8,!1,i)}function G(i){return new Tt(16,!1,i)}function Si(i){return new Tt(8,!0,i)}function Ki(i){return new Tt(16,!0,i)}var jt=class extends In{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function I(i){return new jt(pe(32),e=>new zo(e),e=>e.toBuffer(),i)}function Re(i){return new jt(hi(),Qo,Ho,i)}function Qo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Ho(i){return i?1:0}var Sn=class extends Ti{decode(e,t){return super.decode(e,t)}};function E(i,e,t){return new Sn(i,e,t)}function H(i,e,t){let n,r=typeof e=="number"?e:xi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=xi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Bi(i,r,t)}import{PublicKey as Tp}from"@solana/web3.js";import Bp from"bn.js";import{AccountLayout as Kp,TOKEN_PROGRAM_ID as Cp}from"@solana/spl-token";import{PublicKey as Im}from"@solana/web3.js";import{MintLayout as Sm,TOKEN_PROGRAM_ID as Cm}from"@solana/spl-token";import{Keypair as sn,PublicKey as x,SystemProgram as bt,TransactionInstruction as Ke}from"@solana/web3.js";import Ui from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as vn,TOKEN_2022_PROGRAM_ID as Ye,TOKEN_PROGRAM_ID as ae}from"@solana/spl-token";import rs from"bn.js";import Ve from"bn.js";var me=new Ve(0),Fe=new Ve(1),tt=new Ve(-1),ve=new Ve(1).shln(64),Jt=new Ve(1).shln(128),Kn=ve.sub(Fe),Ot=64,Ci=Jt.subn(1),Be=-443636,xe=-Be,ze=new Ve("4295048016"),Qe=new Ve("79226673521066979257578248091"),$t=new Ve("4295048017"),en=new Ve("79226673521066979257578248090"),Ni=16,Ri="59543866431248",Li="184467440737095516",Oi="15793534762490258745",tn=new Ve(10).pow(new Ve(6));var Wm=new Ve("18446744073700000000");import z from"bn.js";function nn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Cn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Nn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Mt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Mi(i,e){return Mt(i,e)?null:Cn(i,e)}function Ei(i,e){return Mt(i,e)?null:Nn(i,e)}var Qm=Buffer.from("amm_config","utf8"),Yo=Buffer.from("pool","utf8"),Zo=Buffer.from("pool_vault","utf8"),jo=Buffer.from("pool_reward_vault","utf8"),Fi=Buffer.from("position","utf8"),Jo=Buffer.from("tick_array","utf8"),$o=Buffer.from("operation","utf8"),es=Buffer.from("pool_tick_array_bitmap_extension","utf8"),ts=Buffer.from("observation","utf8");function vi(i,e,t,n){return we([Yo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Rn(i,e,t){return we([Zo,e.toBuffer(),t.toBuffer()],i)}function Vi(i,e,t){return we([jo,e.toBuffer(),t.toBuffer()],i)}function $(i,e,t){return we([Jo,e.toBuffer(),nn(t)],i)}function nt(i,e,t,n){return we([Fi,e.toBuffer(),nn(t),nn(n)],i)}function Le(i,e){return we([Fi,e.toBuffer()],i)}function ht(i){return we([Buffer.from("metadata","utf8"),lt.toBuffer(),i.toBuffer()],lt)}function rn(i){return we([$o],i)}function Se(i,e){return we([es,e.toBuffer()],i)}function _i(i,e){return we([ts,e.toBuffer()],i)}var Di=Buffer.from("locked_position","utf8");function Ln(i,e){return we([Di,e.toBuffer()],i)}function On(i,e){return we([Di,e.toBuffer()],i)}import{PublicKey as Ge}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Wi}from"@solana/spl-token";import se from"bn.js";import He from"bn.js";var Et=class{static getfeeGrowthInside(e,t,n){let r=new He(0),o=new He(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=U.wrappingSubU128(U.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=U.mulDivFloor(U.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,ve),u=t.tokenFeesOwedA.add(a),c=U.mulDivFloor(U.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,ve),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=U.wrappingSubU128(u,c.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=U.wrappingSubU128(u,c.growthInsideLastX64),m=U.mulDivFloor(l,t.liquidity,ve),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(U.wrappingSubU128(U.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,P,T,w;let a=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),u=q.getSqrtPriceX64FromTick(t.tickLower),c=q.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[le(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),le(m.amountB,(P=e.mintB.extensions)==null?void 0:P.feeConfig,s,!0)],[g,f]=[le(new He(new R(m.amountA.toString()).mul(l).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,s,!0),le(new He(new R(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:et(d.expirationTime,p.expirationTime)}}};var ns=15,Y=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=L.getTickArrayStartIndexByTick(r,o),l=L.getInitializedTickArrayInRange(s,a,o,c,Math.floor(ns/2));for(let p=0;p<l.length;p++){let{publicKey:g}=$(t,n,l[p]);u.push(g)}let m=(await ut(e,u)).map(p=>p!==null?Ft.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let g=m[p];g!==null&&(d[g.startTickIndex]=te(j({},g),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=L.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Y.tickCount(t)),a=n?L.searchLowBitFromStart(r,o,s-1,1,t):L.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ye-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ye;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=$(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=L.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ye;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=$(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>xe)return!1;let n=L.getTickArrayStartIndexByTick(Be,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ye*e}};var Mn=14,it=class{static maxTickInTickarrayBitmap(e){return e*ye*dt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Y.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Y.tickCount(n):t+Y.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ye,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Mi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Ei(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Y.tickCount(n)}}}},vt=class{static getBitmapOffset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=it.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=it.maxTickInTickarrayBitmap(e),n=-t;if(xe<=t)throw Error(`extensionTickBoundary check error: ${xe}, ${t}`);if(n<=Be)throw Error(`extensionTickBoundary check error: ${n}, ${Be}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Y.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=it.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=L.mergeTickArrayBitmap(e).shln(dt-1-a),c=Mt(512,u)?null:Cn(512,u);if(c!==null){let l=t-c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=L.mergeTickArrayBitmap(e).shrn(a),c=Mt(512,u)?null:Nn(512,u);if(c!==null){let l=t+c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Y.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%it.maxTickInTickarrayBitmap(t),r=Math.floor(n/Y.tickCount(t));return e<0&&n!=0&&(r=dt-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:g,sqrtPriceX64:f,feeAmount:y}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...g),{allTrade:d,expectedAmountOut:p.mul(tt),remainingAccounts:u,executionPrice:f,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:y}=$(e.programId,e.id,f.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:g}=pt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(tt),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:g}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?vt.checkTickArrayIsInit(Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=$(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=$(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Y.tickCount(e.tickSpacing)),r=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=it.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=vt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Be||t>xe)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te(j({},m),{perSecond:U.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ge(d)});if(p.tokenMint.equals(Ge.default))continue;if(n<=p.openTime.toNumber()||r.eq(me)){s.push(p);continue}let g=new se(Math.min(p.endTime.toNumber(),n)),f=g.sub(p.lastUpdateTime),y=U.mulDivFloor(f,p.emissionsPerSecondX64,r),P=p.rewardGrowthGlobalX64.add(y),T=U.mulDivFloor(f,p.emissionsPerSecondX64,ve),w=p.rewardTotalEmissioned.add(T);s.push(te(j({},p),{rewardGrowthGlobalX64:P,rewardTotalEmissioned:w,lastUpdateTime:g}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=L.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=it.maxTickInTickarrayBitmap(e),n=-t;return t>xe&&(t=Y.getArrayStartIndex(xe,e)+Y.tickCount(e)),n<Be&&(n=Y.getArrayStartIndex(Be,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Y.tickCount(t)*dt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await xt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=qi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=L.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=L.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=$(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await xt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Ft.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te(j({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Le(p,d).publicKey);let l=await ut(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=En.decode(d.data),g=p.poolId.toString(),f=e.find(N=>N.state.id.toBase58()===g);if(f===void 0)continue;let y=f.state,P=L._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),T=L._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:C}=Z.getAmountsFromLiquidity(y.sqrtPriceX64,P.tickSqrtPriceX64,T.tickSqrtPriceX64,p.liquidity,!1),M=1/(1-Math.sqrt(Math.sqrt(P.price.div(T.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:P.price,priceUpper:T.price,amountA:w,amountB:C,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(N=>te(j({},N),{pendingReward:new se(0)})),leverage:M,tokenFeeAmountA:new se(0),tokenFeeAmountB:new se(0)}];let h=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),F=await L.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=h,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=F}if(o){let d=Object.values(m),p=await ut(t,d,{batchRequest:r}),g={};for(let f=0;f<d.length;f++){let y=p[f];if(y===null)continue;let P=d[f].toString();g[P]=Ft.decode(y.data)}for(let{state:f,positionAccount:y}of e)if(!!y)for(let P of y){let T=`${f.programId.toString()}-${f.id.toString()}-${P.tickLower}`,w=`${f.programId.toString()}-${f.id.toString()}-${P.tickUpper}`,C=g[m[T].toString()],M=g[m[w].toString()],h=C.ticks[L.getTickOffsetInArray(P.tickLower,f.tickSpacing)],F=M.ticks[L.getTickOffsetInArray(P.tickUpper,f.tickSpacing)],{tokenFeeAmountA:N,tokenFeeAmountB:Q}=await Et.GetPositionFees(f,P,h,F),B=await Et.GetPositionRewards(f,P,h,F);P.tokenFeeAmountA=N.gte(new se(0))?N:new se(0),P.tokenFeeAmountB=Q.gte(new se(0))?Q:new se(0);for(let V=0;V<B.length;V++)P.rewardInfos[V].pendingReward=B[V].gte(new se(0))?B[V]:new se(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new R(0),catchLiquidityInsufficient:u=!1}){var Pe;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new R(0))?c=l?ze.add(new se(1)):Qe.sub(new se(1)):c=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=le(o,m,r,!1),{allTrade:g,expectedAmountOut:f,remainingAccounts:y,executionPrice:P,feeAmount:T}=ge.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((Pe=p.fee)!=null?Pe:me),c,u),w=le(f,d,r,!1),C=q.sqrtPriceX64ToPrice(P,e.mintA.decimals,e.mintB.decimals),M=l?C:new R(1).div(C),h=f.mul(new se(Math.floor((1-s)*1e10))).div(new se(1e10)),F=le(h,d,r,!1),N=l?e.currentPrice:new R(1).div(e.currentPrice),Q=new R(M).sub(N).abs(),B=N,V=new Je(new R(Q).mul(10**15).toFixed(0),new R(B).mul(10**15).toFixed(0));return{allTrade:g,realAmountIn:p,amountOut:w,minAmountOut:F,expirationTime:et(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:M,priceImpact:V,fee:T,remainingAccounts:y,executionPriceX64:P}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new We(te(j({},c),{mint:c.address,isToken2022:c.programId===Wi.toBase58()})),new We(te(j({},l),{mint:l.address,isToken2022:l.programId===Wi.toBase58()}))],{allTrade:p,realAmountIn:g,amountOut:f,minAmountOut:y,expirationTime:P,currentPrice:T,executionPrice:w,priceImpact:C,fee:M,remainingAccounts:h,executionPriceX64:F}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ge(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),N=te(j({},g),{amount:new be(m,g.amount),fee:g.fee===void 0?void 0:new be(m,g.fee)}),Q=te(j({},f),{amount:new be(d,f.amount),fee:f.fee===void 0?void 0:new be(d,f.fee)}),B=te(j({},y),{amount:new be(d,y.amount),fee:y.fee===void 0?void 0:new be(d,y.fee)}),V=new Oe({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:T.mul(new R(10**(20+d.decimals))).toFixed(0)}),Pe=new Oe({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:w.mul(new R(10**(20+d.decimals))).toFixed(0)}),de=new be(m,M);return{allTrade:p,realAmountIn:N,amountOut:Q,minAmountOut:B,expirationTime:P,currentPrice:V,executionPrice:Pe,priceImpact:C,fee:de,remainingAccounts:h,executionPriceX64:F}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new R(0)}){var B;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new R(0))?l=u?Qe.sub(new se(1)):ze.add(new se(1)):l=q.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=le(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:g,feeAmount:f}=ge.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((B=m.fee)!=null?B:me),l),y=u?e.mintB.address:e.mintA.address,P=le(d,c[y],r,!1),T=q.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),w=u?T:new R(1).div(T),C=d.mul(new se(Math.floor((1+s)*1e10))).div(new se(1e10)),M=le(C,c[y],r,!0),h=u?e.currentPrice:new R(1).div(e.currentPrice),F=new R(w).sub(h).abs(),N=h,Q=new Je(new R(F).mul(10**15).toFixed(0),new R(N).mul(10**15).toFixed(0));return{amountIn:P,maxAmountIn:M,realAmountOut:m,expirationTime:et(P.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:Q,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var g,f,y;let o=e[t],s=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=L.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((g=o.rewardApr[0])!=null?g:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[kt(e.mintA.address).toString()],d=r[kt(e.mintB.address).toString()],p=e.mintA.decimals,g=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),y=q.getSqrtPriceX64FromTick(s),P=q.getSqrtPriceX64FromTick(a),{amountSlippageA:T,amountSlippageB:w}=Z.getAmountsFromLiquidityWithSlippage(f,y,P,t,!1,!1,0),{amountSlippageA:C,amountSlippageB:M}=Z.getAmountsFromLiquidityWithSlippage(f,y,P,o,!1,!1,0),h=new R(T.toString()).div(new R(10).pow(p)).mul(m.value).add(new R(w.toString()).div(new R(10).pow(g)).mul(d.value)),F=new R(C.toString()).div(new R(10).pow(p)).mul(m.value).add(new R(M.toString()).div(new R(10).pow(g)).mul(d.value)),N=new R(1).div(h.add(F)),B=new R(l.volumeFee).mul(365).div(c).mul(N).mul(100).toNumber(),V=3600*24*365,Pe=e.rewardDefaultInfos.map(de=>{var ee,Un;let Ce=de.mint.decimals,ce=r[de.mint.address];return u<((ee=de.startTime)!=null?ee:0)||u>((Un=de.endTime)!=null?Un:0)||!de.perSecond||!ce||Ce===void 0?0:new R(ce.value).mul(new R(de.perSecond).mul(V)).div(new R(10).pow(Ce)).mul(N).mul(100).toNumber()});return{feeApr:B,rewardsApr:Pe,apr:B+Pe.reduce((de,Ce)=>de+Ce,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var P,T;let l=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),m=q.getSqrtPriceX64FromTick(n),d=q.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,g=le(o,(P=e[t?"mintA":"mintB"].extensions)==null?void 0:P.feeConfig,u,!c),f=new se(new R(g.amount.sub((T=g.fee)!=null?T:me).toString()).mul(p).toFixed(0)),y;if(l.lte(m))y=t?Z.getLiquidityFromTokenAmountA(m,d,f,!a):new se(0);else if(l.lte(d)){let w=Z.getLiquidityFromTokenAmountA(l,d,f,!a),C=Z.getLiquidityFromTokenAmountB(m,l,f);y=t?w:C}else y=t?new se(0):Z.getLiquidityFromTokenAmountB(m,d,f);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,P,T,w;let u=q.getSqrtPriceX64FromTick(n),c=q.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(q.priceToSqrtPriceX64(new R(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[le(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),le(m.amountB,(P=t.mintB.extensions)==null?void 0:P.feeConfig,e,!0)],[g,f]=[le(m.amountA.muln(l),(T=t.mintA.extensions)==null?void 0:T.feeConfig,e,!0),le(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:g,amountSlippageB:f,expirationTime:et(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Ge(u.id));(await ut(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=on.decode(u.data))});let s=t.map(u=>Se(new Ge(u.programId),new Ge(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>te(j({},u),{[c.id]:te(j({},n[c.id]),{id:new Ge(c.id),version:6,programId:new Ge(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te(j({},c.config),{id:new Ge(c.config.id),fundOwner:""}),currentPrice:new R(c.price),exBitmapInfo:a[Se(new Ge(c.programId),new Ge(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var U=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(me)||(o=o.add(Fe)),o}static mulDivFloor(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(me))throw new Error("division by 0");return e.mul(t).add(n.sub(Fe)).div(n)}static x64ToDecimal(e,t){return new R(e.toString()).div(R.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new z(e.mul(R.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Jt).sub(t).mod(Jt)}};function Ae(i,e){return Fn(i.mul(e),64,256)}function is(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Fn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var q=class{static sqrtPriceX64ToPrice(e,t,n){return U.x64ToDecimal(e).pow(2).mul(R.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return U.decimalToX64(e.mul(R.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(me))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(me))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(me))return e;let o=t.shln(Ot);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?U.mulDivCeil(s,e,a):U.mulDivRoundingUp(s,Fe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return U.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ot);if(r)return e.add(o.div(t));{let s=U.mulDivRoundingUp(o,Fe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Be||e>xe)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new z("18445821805675395072"):new z("18446744073709551616");return(t&2)!=0&&(n=Ae(n,new z("18444899583751176192"))),(t&4)!=0&&(n=Ae(n,new z("18443055278223355904"))),(t&8)!=0&&(n=Ae(n,new z("18439367220385607680"))),(t&16)!=0&&(n=Ae(n,new z("18431993317065453568"))),(t&32)!=0&&(n=Ae(n,new z("18417254355718170624"))),(t&64)!=0&&(n=Ae(n,new z("18387811781193609216"))),(t&128)!=0&&(n=Ae(n,new z("18329067761203558400"))),(t&256)!=0&&(n=Ae(n,new z("18212142134806163456"))),(t&512)!=0&&(n=Ae(n,new z("17980523815641700352"))),(t&1024)!=0&&(n=Ae(n,new z("17526086738831433728"))),(t&2048)!=0&&(n=Ae(n,new z("16651378430235570176"))),(t&4096)!=0&&(n=Ae(n,new z("15030750278694412288"))),(t&8192)!=0&&(n=Ae(n,new z("12247334978884435968"))),(t&16384)!=0&&(n=Ae(n,new z("8131365268886854656"))),(t&32768)!=0&&(n=Ae(n,new z("3584323654725218816"))),(t&65536)!=0&&(n=Ae(n,new z("696457651848324352"))),(t&131072)!=0&&(n=Ae(n,new z("26294789957507116"))),(t&262144)!=0&&(n=Ae(n,new z("37481735321082"))),e>0&&(n=Ci.div(n)),n}static getTickFromPrice(e,t,n){return q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Qe)||e.lt(ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new z(t-64),r=is(n,32,128),o=new z("8000000000000000","hex"),s=0,a=new z(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new z(0))&&s<Ni;){u=u.mul(u);let g=u.shrn(127);u=u.shrn(63+g.toNumber()),a=a.add(o.mul(g)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new z(Ri)),d=Fn(m.sub(new z(Li)),64,128).toNumber(),p=Fn(m.add(new z(Oi)),64,128).toNumber();return d==p?d:q.getSqrtPriceX64FromTick(p).lte(e)?p:d}},ft=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=q.getTickFromSqrtPriceX64(q.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ft.getTickWithPriceAndTickspacing(e,t,n,r),s=q.getSqrtPriceX64FromTick(o);return q.sqrtPriceX64ToPrice(s,n,r)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ot),s=t.sub(e);return r?U.mulDivRoundingUp(U.mulDivCeil(o,s,t),Fe,e):U.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(me))throw new Error("sqrtPriceX64A must greater than 0");return r?U.mulDivCeil(n,t.sub(e),ve):U.mulDivFloor(n,t.sub(e),ve)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?U.mulDivRoundingUp(a,Fe,Kn):a.shrn(Ot)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),U.mulDivFloor(n,Kn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,r,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new z(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,r,o),a=Z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new z(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new z(new R(u.toString()).mul(l).toFixed(0)),d=new z(new R(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var T,w,C,M;let c=q.priceToSqrtPriceX64(new R(e.price),e.mintA.decimals,e.mintB.decimals),l=q.getSqrtPriceX64FromTick(t),m=q.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Z.getAmountsFromLiquidity(c,l,m,r,s),[g,f]=[le(p.amountA,(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),le(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,P]=[le(new z(new R(p.amountA.toString()).mul(d).toFixed(0)),(C=e.mintA.extensions)==null?void 0:C.feeConfig,a,u),le(new z(new R(p.amountB.toString()).mul(d).toFixed(0)),(M=e.mintB.extensions)==null?void 0:M.feeConfig,a,u)];return{liquidity:r,amountA:g,amountB:f,amountSlippageA:y,amountSlippageB:P,expirationTime:et(g.expirationTime,f.expirationTime)}}},pt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f=!1){if(d.eq(me))throw new Error("amountSpecified must not be 0");if(g||(g=s?ze.add(Fe):Qe.sub(Fe)),s){if(g.lt(ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(g.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(g.gt(Qe))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(g.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(me),P={amountSpecifiedRemaining:d,amountCalculated:me,sqrtPriceX64:m,tick:c>p?Math.min(p+Y.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new z(0)},T=p,w=n[p],C=0,M=!s&&w.startTickIndex===P.tick;for(;!P.amountSpecifiedRemaining.eq(me)&&!P.sqrtPriceX64.eq(g);){C>10;let h={};h.sqrtPriceStartX64=P.sqrtPriceX64;let F=L.nextInitTick(w,P.tick,l,s,M),N=F||null,Q=null;if(!(N!=null&&N.liquidityGross.gtn(0))){let V=ge.nextInitializedTickArrayStartIndex({tickCurrent:P.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},T,s);if(!V.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:P.amountSpecifiedRemaining,amountCalculated:P.amountCalculated,feeAmount:P.feeAmount,sqrtPriceX64:P.sqrtPriceX64,liquidity:P.liquidity,tickCurrent:P.tick,accounts:P.accounts};throw Error("swapCompute LiquidityInsufficient")}T=V.nextStartIndex;let{publicKey:Pe}=$(e,t,T);Q=Pe,w=n[T];try{N=L.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}h.tickNext=N.tick,h.initialized=N.liquidityGross.gtn(0),p!==T&&Q&&(P.accounts.push(Q),p=T),h.tickNext<Be?h.tickNext=Be:h.tickNext>xe&&(h.tickNext=xe),h.sqrtPriceNextX64=q.getSqrtPriceX64FromTick(h.tickNext);let B;if(s&&h.sqrtPriceNextX64.lt(g)||!s&&h.sqrtPriceNextX64.gt(g)?B=g:B=h.sqrtPriceNextX64,[P.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=pt.swapStepCompute(P.sqrtPriceX64,B,P.liquidity,P.amountSpecifiedRemaining,a),P.feeAmount=P.feeAmount.add(h.feeAmount),y?(P.amountSpecifiedRemaining=P.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),P.amountCalculated=P.amountCalculated.sub(h.amountOut)):(P.amountSpecifiedRemaining=P.amountSpecifiedRemaining.add(h.amountOut),P.amountCalculated=P.amountCalculated.add(h.amountIn.add(h.feeAmount))),P.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let V=N.liquidityNet;s&&(V=V.mul(tt)),P.liquidity=Z.addDelta(P.liquidity,V)}M=h.tickNext!=P.tick&&!s&&w.startTickIndex===h.tickNext,P.tick=s?h.tickNext-1:h.tickNext}else if(P.sqrtPriceX64!=h.sqrtPriceStartX64){let V=q.getTickFromSqrtPriceX64(P.sqrtPriceX64);M=V!=P.tick&&!s&&w.startTickIndex===V,P.tick=V}++C}try{let{nextStartIndex:h,isExist:F}=Y.nextInitializedTickArray(P.tick,l,s,r,o);F&&p!==h&&(P.accounts.push($(e,t,h).publicKey),p=h)}catch{}return{allTrade:!0,amountSpecifiedRemaining:me,amountCalculated:P.amountCalculated,feeAmount:P.feeAmount,sqrtPriceX64:P.sqrtPriceX64,liquidity:P.liquidity,tickCurrent:P.tick,accounts:P.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new z(0),amountIn:new z(0),amountOut:new z(0),feeAmount:new z(0)},a=e.gte(t),u=r.gte(me);if(u){let l=U.mulDivFloor(r,tn.sub(new z(o.toString())),tn);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(tt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=q.getNextSqrtPriceX64FromOutput(e,n,r.mul(tt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(tt))&&(s.amountOut=r.mul(tt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=U.mulDivCeil(s.amountIn,new z(o),tn.sub(new z(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ye=60,dt=512,L=class{static getTickArrayAddressByTick(e,t,n,r){let o=L.getTickArrayStartIndexByTick(n,r),{publicKey:s}=$(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ye)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Y.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Y.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ye,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ye,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ye:e+t*ye}static mergeTickArrayBitmap(e){let t=new rs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ye));return[...L.searchLowBitFromStart(e,t,s-1,o,n),...L.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,0,dt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=L.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=$(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>L.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Be||e>xe}static nextInitTick(e,t,n,r,o){if(Y.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ye;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ye-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ye;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=q.getSqrtPriceX64FromTick(t),o=q.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new R(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new R(1).div(t),o=ft.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=q.getSqrtPriceX64FromTick(o),a=q.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new R(1).div(a)}}};var os=E([pe(8),D("bump"),mt("index"),I(""),Ee("protocolFeeRate"),Ee("tradeFeeRate"),mt("tickSpacing"),H(b(),8,"")]),ss=E([Ee("blockTimestamp"),Si("tickCumulative"),H(b(),4)]),Gi=E([pe(8),Re("initialized"),b("recentEpoch"),mt("observationIndex"),I("poolId"),H(ss,100,"observations"),H(b(),4)]),as=E([D("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),G("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),I("tokenMint"),I("tokenVault"),I("creator"),G("rewardGrowthGlobalX64")]),on=E([pe(8),D("bump"),I("ammConfig"),I("creator"),I("mintA"),I("mintB"),I("vaultA"),I("vaultB"),I("observationId"),D("mintDecimalsA"),D("mintDecimalsB"),mt("tickSpacing"),G("liquidity"),G("sqrtPriceX64"),Te("tickCurrent"),Ee(),G("feeGrowthGlobalX64A"),G("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),G("swapInAmountTokenA"),G("swapOutAmountTokenB"),G("swapInAmountTokenB"),G("swapOutAmountTokenA"),D("status"),H(D(),7,""),H(as,3,"rewardInfos"),H(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),H(b(),15*4-3,"padding")]),us=E([G("growthInsideLastX64"),b("rewardAmountOwed")]),En=E([pe(8),D("bump"),I("nftMint"),I("poolId"),Te("tickLower"),Te("tickUpper"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),H(us,3,"rewardInfos"),H(b(),8,"")]),tp=E([pe(8),D("bump"),I("poolId"),Te("tickLowerIndex"),Te("tickUpperIndex"),G("liquidity"),G("feeGrowthInsideLastX64A"),G("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),H(G(),3,"rewardGrowthInside"),H(b(),8,"")]),cs=E([Te("tick"),Ki("liquidityNet"),G("liquidityGross"),G("feeGrowthOutsideX64A"),G("feeGrowthOutsideX64B"),H(G(),3,"rewardGrowthsOutsideX64"),H(Ee(),13,"")]),Ft=E([pe(8),I("poolId"),Te("startTickIndex"),H(cs,ye,"ticks"),D("initializedTickCount"),H(D(),115,"")]),ls=E([pe(329),H(I(),100,"whitelistMints")]),qi=E([pe(8),I("poolId"),H(H(b(),8),Mn,"positiveTickArrayBitmap"),H(H(b(),8),Mn,"negativeTickArrayBitmap")]),np=E([b(),D("bump"),I("owner"),I("poolId"),I("positionId"),I("nftAccount"),H(b(),8)]),ip=E([pe(8),D("bump"),I("lockOwner"),I("poolId"),I("positionId"),I("nftAccount"),I("lockNftMint"),b("recentEpoch"),H(b(),8)]);Gi.span;var Xi=re("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},zi=[188,37,179,131,82,150,84,73],Qi=[16,72,250,198,14,162,212,19],yt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g){let f=E([G("sqrtPriceX64"),b("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],P=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:g},P);let T=Buffer.from([...Ue.createPool,...P]);return new Ke({keys:y,programId:e,data:T})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new x(r.address),new x(o.address)],{publicKey:m}=vi(t,s,c,l),{publicKey:d}=_i(t,m),{publicKey:p}=Rn(t,m,c),{publicKey:g}=Rn(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new x(r.programId||ae),l,g,new x(o.programId||ae),Se(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[ne.CreateAccount,ne.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:g},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P,T,w,C,M,h,F,N,Q,B){let V=E([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Re("withMetadata"),D("optionBaseFlag"),Re("baseFlag")]),Pe=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},...Pe],Ce=Buffer.alloc(V.span);V.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:M,liquidity:h,amountMaxA:F,amountMaxB:N,withMetadata:Q==="create",baseFlag:!1,optionBaseFlag:0},Ce);let ce=Buffer.from([...Ue.openPosition,...Ce]);return new Ke({keys:de,programId:e,data:ce})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let N=sn.generate();m.push(N),g=N.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=$(d,p,f),{publicKey:T}=$(d,p,y),{publicKey:w}=Ie(n.wallet,g,ae),{publicKey:C}=ht(g),{publicKey:M}=Le(d,g),{publicKey:h}=nt(d,p,r,o),F=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,g,w,C,h,P,T,M,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,s,a,u,c);return{signers:m,instructions:[F],instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:g,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:M,protocolPosition:h}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new x(e.programId),new x(e.id)],g;if(l)g=new x((await l(1))[0]);else{let N=sn.generate();m.push(N),g=N.publicKey}let f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=$(d,p,f),{publicKey:T}=$(d,p,y),{publicKey:w}=Ie(n.wallet,g,ae),{publicKey:C}=ht(g),{publicKey:M}=Le(d,g),{publicKey:h}=nt(d,p,r,o),F=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,g,w,C,h,P,T,M,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),r,o,f,y,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Se(d,p).publicKey:void 0);return{address:{nftMint:g,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:M,protocolPosition:h},instructions:[F],signers:m,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P,T,w,C,M,h,F,N,Q,B){let V=E([Te("tickLowerIndex"),Te("tickUpperIndex"),Te("tickArrayLowerStartIndex"),Te("tickArrayUpperStartIndex"),G("liquidity"),b("amountMaxA"),b("amountMaxB"),Re("withMetadata"),D("optionBaseFlag"),Re("baseFlag")]),Pe=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],de=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},...Pe],Ce=Buffer.alloc(V.span);V.encode({tickLowerIndex:T,tickUpperIndex:w,tickArrayLowerStartIndex:C,tickArrayUpperStartIndex:M,liquidity:new Ui(0),amountMaxA:F==="MintA"?N:Q,amountMaxB:F==="MintA"?Q:N,withMetadata:h==="create",baseFlag:F==="MintA",optionBaseFlag:1},Ce);let ce=Buffer.from([...Ue.openPosition,...Ce]);return new Ke({keys:de,programId:e,data:ce})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new x((await l(1))[0]);else{let N=sn.generate();d.push(N),m=N.publicKey}let[p,g]=[new x(e.programId),new x(e.id)],f=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:P}=$(p,g,f),{publicKey:T}=$(p,g,y),{publicKey:w}=Ie(n.wallet,m,ae),{publicKey:C}=ht(m),{publicKey:M}=Le(p,m),{publicKey:h}=nt(p,g,r,o),F=this.openPositionFromLiquidityInstruction(p,n.wallet,g,n.wallet,m,w,C,h,P,T,M,n.tokenAccountA,n.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(t.mintA.address),new x(t.mintB.address),r,o,f,y,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,y])?Se(p,g).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:P,tickArrayUpper:T,positionNftAccount:w,metadataAccount:C,personalPosition:M,protocolPosition:h},instructions:[F],signers:d,instructionTypes:[ne.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=E([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ue.closePosition,...u]);return new Ke({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new x(e.programId),{publicKey:s}=Ie(n.wallet,r.nftMint,ae),{publicKey:a}=Le(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ne.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P,T){let w=E([G("liquidity"),b("amountMaxA"),b("amountMaxB"),D("optionBaseFlag"),Re("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],h=Buffer.alloc(w.span);w.encode({liquidity:f,amountMaxA:y,amountMaxB:P,optionBaseFlag:0,baseFlag:!1},h);let F=Buffer.from([...Ue.increaseLiquidity,...h]);return new Ke({keys:M,programId:e,data:F})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:g}=Ie(r.wallet,n.nftMint,ae),{publicKey:f}=Le(u,n.nftMint),{publicKey:y}=nt(u,c,n.tickLower,n.tickUpper),P=this.increasePositionFromLiquidityInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Se(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},signers:[],instructions:[P],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new x(e.programId),new x(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=$(u,c,l),{publicKey:p}=$(u,c,m),{publicKey:g}=Ie(r.wallet,n.nftMint,ae),{publicKey:f}=Le(u,n.nftMint),{publicKey:y}=nt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:g,personalPosition:f,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,g,f,c,y,d,p,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Se(u,c).publicKey:void 0)],signers:[],instructionTypes:[ne.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P,T){let w=E([G("liquidity"),b("amountMaxA"),b("amountMaxB"),D("optionBaseFlag"),Re("baseFlag")]),C=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[]],M=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...C],h=Buffer.alloc(w.span);w.encode({liquidity:new Ui(0),amountMaxA:f==="MintA"?y:P,amountMaxB:f==="MintA"?P:y,baseFlag:f==="MintA",optionBaseFlag:1},h);let F=Buffer.from([...Ue.increaseLiquidity,...h]);return new Ke({keys:M,programId:e,data:F})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P,T,w){let C=E([G("liquidity"),b("amountMinA"),b("amountMinB")]),M=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...f.map(Q=>[{pubkey:Q.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:Q.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:Q.rewardMint,isSigner:!1,isWritable:!1}]).flat()],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:Ht,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...M],F=Buffer.alloc(C.span);C.encode({liquidity:y,amountMinA:P,amountMinB:T},F);let N=Buffer.from([...Ue.decreaseLiquidity,...F]);return new Ke({keys:h,programId:e,data:N})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new x(e.programId),new x(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=$(c,l,m),{publicKey:g}=$(c,l,d),{publicKey:f}=Ie(r.wallet,n.nftMint,u),{publicKey:y}=Le(c,n.nftMint),{publicKey:P}=nt(c,l,n.tickLower,n.tickUpper),T=[];for(let M=0;M<e.rewardDefaultInfos.length;M++)T.push({poolRewardVault:new x(t.rewardInfos[M].vault),ownerRewardVault:r.rewardAccounts[M],rewardMint:new x(e.rewardDefaultInfos[M].mint.address)});let w=[],C=this.decreaseLiquidityInstruction(c,r.wallet,f,y,l,P,p,g,r.tokenAccountA,r.tokenAccountB,new x(t.vault.A),new x(t.vault.B),new x(e.mintA.address),new x(e.mintB.address),T,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Se(c,l).publicKey:void 0);return w.push(C),{address:{tickArrayLower:p,tickArrayUpper:g,positionNftAccount:f,personalPosition:y,protocolPosition:P},signers:[],instructions:w,instructionTypes:[ne.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,g,f,y,P){let T=E([b("amount"),b("otherAmountThreshold"),G("sqrtPriceLimitX64"),Re("isBaseInput")]),w=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[],...m.map(F=>({pubkey:F,isSigner:!1,isWritable:!0}))],C=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:Ht,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],M=Buffer.alloc(T.span);T.encode({amount:p,otherAmountThreshold:g,sqrtPriceLimitX64:f,isBaseInput:y},M);let h=Buffer.from([...Ue.swap,...M]);return new Ke({keys:C,programId:e,data:h})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[g,f]=[new x(e.mintA.address),new x(e.mintB.address)],y=e.mintA.address===o.toString(),P=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?g:f,y?f:g,c,n,s,a,u,!0,Se(l,m).publicKey)];return{signers:[],instructions:P,instructionTypes:[ne.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new x(e.programId),new x(e.id)],[d,p]=[new x(t.vault.A),new x(t.vault.B)],[g,f]=[new x(e.mintA.address),new x(e.mintB.address)],y=e.mintA.address===o.toBase58(),P=[this.swapInstruction(l,r.wallet,m,new x(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?p:d,y?d:p,y?f:g,y?g:f,c,n,s,a,u,!1,Se(l,m).publicKey)];return{signers:[],instructions:P,instructionTypes:[ne.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=E([b("openTime"),b("endTime"),G("emissionsPerSecondX64")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:oe(l),endTime:oe(m),emissionsPerSecondX64:d},f);let y=Buffer.from([...Ue.initReward,...f]);return new Ke({keys:g,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a=Vi(o,s,r.mint).publicKey,u=rn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new x(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ne.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=E([D("rewardIndex"),G("emissionsPerSecondX64"),b("openTime"),b("endTime")]),g=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:oe(l),endTime:oe(m)},f);let y=Buffer.from([...Ue.setRewardEmissions,...f]);return new Ke({keys:g,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new x(t.rewardInfos[d].vault),c=new x(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=rn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new x(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ne.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=E([D("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:Ht,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Ue.collectReward,...l]);return new Ke({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new x(e.programId),new x(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new x(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Xi.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ne.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let u=[],c;if(a)c=new x((await a(1))[0]);else{let y=sn.generate();u.push(y),c=y.publicKey}let{publicKey:l}=Ie(o,s,ae),{publicKey:m}=Le(n,s),d=On(e,c).publicKey,p=Ie(o,c,ae).publicKey,g=ht(c).publicKey,f=yt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:c,lockNftAccount:p,metadataAccount:g,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:p,lockNftMint:c,positionNftAccount:l,metadataAccount:g},instructions:[f],signers:u,instructionTypes:[ne.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:u,lockNftMint:c,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let p=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:lt,isSigner:!1,isWritable:!1},{pubkey:vn,isSigner:!1,isWritable:!1},{pubkey:ct,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1}],g=E([Re("withMetadata")]),f=Buffer.alloc(g.span);g.encode({withMetadata:d},f);let y=Buffer.from([...zi,...f]);return new Ke({keys:p,programId:e,data:y})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Ie(r,o,ae),{publicKey:a}=Le(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Ln(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:bt.programId,isSigner:!1,isWritable:!1}];return new Ke({keys:u,programId:e,data:Buffer.from(zi)})}static harvestLockPositionInstruction(e){let[t,n]=[new x(e.poolKeys.programId),new x(e.poolKeys.id)],r=L.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=L.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=$(t,n,r),{publicKey:a}=$(t,n,o),{publicKey:u}=Ie(e.owner,e.ownerPosition.nftMint,ae),{publicKey:c}=Le(t,e.ownerPosition.nftMint),{publicKey:l}=nt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let g=0;g<e.poolKeys.rewardInfos.length;g++)m.push({poolRewardVault:new x(e.poolKeys.rewardInfos[g].vault),ownerRewardVault:e.ownerRewardAccounts[g],rewardMint:new x(e.poolKeys.rewardInfos[g].mint.address)});let d=[...m.map(g=>[{pubkey:g.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:g.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Ln(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new x(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new x(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:new x(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new x(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ke({keys:p,programId:e.programId,data:Buffer.from(Qi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:g,tickArrayUpper:f,userVaultA:y,userVaultB:P,mintA:T,mintB:w,rewardAccounts:C,exTickArrayBitmap:M}){let h=[...M?[{pubkey:M,isSigner:!1,isWritable:!0}]:[],...C.map(N=>[{pubkey:N.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:N.rewardMint,isSigner:!1,isWritable:!1}]).flat()],F=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:P,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Ye,isSigner:!1,isWritable:!1},{pubkey:wt,isSigner:!1,isWritable:!1},{pubkey:T,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...h];return new Ke({keys:F,programId:e,data:Buffer.from(Qi)})}};var pf=E([pe(8),D("bump"),Re("disableCreatePool"),mt("index"),b("tradeFeeRate"),b("protocolFeeRate"),b("fundFeeRate"),b("createPoolFee"),I("protocolOwner"),I("fundOwner"),H(b(),16)]),ps=E([pe(8),I("configId"),I("poolCreator"),I("vaultA"),I("vaultB"),I("mintLp"),I("mintA"),I("mintB"),I("mintProgramA"),I("mintProgramB"),I("observationId"),D("bump"),D("status"),D("lpDecimals"),D("mintDecimalA"),D("mintDecimalB"),b("lpAmount"),b("protocolFeesMintA"),b("protocolFeesMintB"),b("fundFeesMintA"),b("fundFeesMintB"),b("openTime"),H(b(),32)]);import{PublicKey as Kf,TransactionInstruction as fs,Keypair as Nf,SystemProgram as Rf}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Of,TOKEN_2022_PROGRAM_ID as Mf,TOKEN_PROGRAM_ID as Ef}from"@solana/spl-token";var yf=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),gf=Buffer.from("amm_config","utf8"),Pf=Buffer.from("pool","utf8"),Af=Buffer.from("pool_lp_mint","utf8"),kf=Buffer.from("pool_vault","utf8"),wf=Buffer.from("observation","utf8");var Tf=Buffer.from("locked_liquidity","utf8");var Wf=re("Raydium_cpmm"),bs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Yi(i,e,t,n,r,o,s,a,u,c,l,m,d,p,g,f){let y=E([b("amountIn"),b("amounOutMin")]),P=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],T=Buffer.alloc(y.span);return y.encode({amountIn:g,amounOutMin:f},T),new fs({keys:P,programId:i,data:Buffer.from([...bs.swapBaseInput,...T])})}import nb from"bn.js";import rb from"decimal.js-light";import ys from"bn.js";var Qf=new ys(0);import gs from"bn.js";var jf=new gs(1e6);import Zi from"bn.js";var Ab=new Zi(25),kb=new Zi(1e4);var Vn=E([D("instruction"),b("amountIn"),b("minAmountOut")]),_n=E([D("instruction"),b("maxAmountIn"),b("amountOut")]),Bb=E([D("instruction"),D("nonce")]),Ps=E([D("instruction"),D("nonce"),b("startTime")]),As=E([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),b("swapBase2QuoteFee"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("withdrawQueue"),I("lpVault"),I("owner"),b("lpReserve"),H(b(),3,"padding")]),Ib=E([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),G("swapBaseInAmount"),G("swapQuoteOutAmount"),G("swapQuoteInAmount"),G("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("modelDataAccount"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("owner"),H(b(),64,"padding")]),ks=E([D("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide"),b("otherAmountMin")]),ws=E([D("instruction"),b("lpAmount"),b("baseAmountMin"),b("quoteAmountMin")]);var xb=E([b("fee")]);import{PublicKey as cy}from"@solana/web3.js";import my from"bn.js";import{TOKEN_PROGRAM_ID as fy}from"@solana/spl-token";import{PublicKey as Mb,SystemProgram as Eb,SYSVAR_RENT_PUBKEY as Fb,TransactionInstruction as Ji}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Vb,TOKEN_PROGRAM_ID as $i}from"@solana/spl-token";import{PublicKey as Ts}from"@solana/web3.js";var Dn=new Ts("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),hs=5e4,Bs=E([b("x"),b("y"),b("price")]),Rb=E([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),H(Bs,hs,"DataElement")]);var ji=re("Raydium_liquidity_instruction");function Is({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Me(i),s=Buffer.alloc(Vn.span);Vn.encode({instruction:9,amountIn:oe(t),minAmountOut:oe(n)},s);let a=[k({pubkey:$i,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders})];return r===4&&a.push(k({pubkey:o.targetOrders})),a.push(k({pubkey:o.vault.A}),k({pubkey:o.vault.B})),r===5&&a.push(k({pubkey:Dn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1})),new Ji({programId:o.programId,keys:a,data:s})}function xs({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Me(i),s=Buffer.alloc(_n.span);_n.encode({instruction:11,maxAmountIn:oe(t),amountOut:oe(n)},s);let a=[k({pubkey:$i,isWritable:!1}),k({pubkey:o.id}),k({pubkey:o.authority,isWritable:!1}),k({pubkey:o.openOrders}),k({pubkey:o.targetOrders}),k({pubkey:o.vault.A}),k({pubkey:o.vault.B})];return r===5&&a.push(k({pubkey:Dn})),a.push(k({pubkey:o.marketProgramId,isWritable:!1}),k({pubkey:o.marketId}),k({pubkey:o.marketBids}),k({pubkey:o.marketAsks}),k({pubkey:o.marketEventQueue}),k({pubkey:o.marketBaseVault}),k({pubkey:o.marketQuoteVault}),k({pubkey:o.marketAuthority,isWritable:!1}),k({pubkey:e.tokenAccountIn}),k({pubkey:e.tokenAccountOut}),k({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Ji({programId:o.programId,keys:a,data:s})}function er(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Is(te(j({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return xs(te(j({},a),{maxAmountIn:r,amountOut:o}),t);ji.logWithError("invalid params","params",i)}throw ji.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as Zb}from"@solana/web3.js";var $b=re("Raydium_liquidity_serum");import{PublicKey as Hy,SystemProgram as Zy}from"@solana/web3.js";import $y from"bn.js";import{createCloseAccountInstruction as ig,createInitializeAccountInstruction as rg,createTransferInstruction as og,TOKEN_PROGRAM_ID as sg}from"@solana/spl-token";import{Keypair as Oy,PublicKey as My}from"@solana/web3.js";import vy from"bn.js";import{TOKEN_PROGRAM_ID as Dy}from"@solana/spl-token";var tr=E([I("mint"),I("owner"),b("amount"),Ee("delegateOption"),I("delegate"),D("state"),Ee("isNativeOption"),b("isNative"),b("delegatedAmount"),Ee("closeAuthorityOption"),I("closeAuthority")]);var qy=re("Raydium_Util");var Ss={[yi.toBase58()]:3};var Ks=E([pe(5),pe(8),I("ownAddress"),b("vaultSignerNonce"),I("baseMint"),I("quoteMint"),I("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),I("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),I("requestQueue"),I("eventQueue"),I("bids"),I("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),pe(7)]);import{PublicKey as kg}from"@solana/web3.js";var Ig=re("Serum");var Og=E([Ee("mintAuthorityOption"),I("mintAuthority"),b("supply"),D("decimals"),D("isInitialized"),Ee("freezeAuthorityOption"),I("freezeAuthority")]);import{PublicKey as O,SystemProgram as Wn,TransactionInstruction as qn}from"@solana/web3.js";import gt from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Cs,TOKEN_2022_PROGRAM_ID as Ns,TOKEN_PROGRAM_ID as Gn}from"@solana/spl-token";function Hg(i,e,t,n,r,o,s,a,u,c,l,m){let d=E([D("instruction"),b("amountIn"),b("amountOut")]),p=[{pubkey:Wn.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new O(t.programId),isSigner:!1,isWritable:!1},{pubkey:new O(t.id),isSigner:!1,isWritable:!0},{pubkey:new O(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Me(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Me(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Me(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let g=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:l},g),new qn({keys:p,programId:i,data:g})}function Yg(i,e,t,n,r,o,s,a,u,c){let l=E([D("instruction")]),m=[{pubkey:Wn.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new O(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new O(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new O(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Me(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(g=>({pubkey:g,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Me(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new O("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Me(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new qn({keys:m,programId:i,data:d})}function Rs(i,e,t,n,r,o,s,a,u,c,l,m,d,p,g){var h;let f=[],y=[k({pubkey:Gn,isWritable:!1}),k({pubkey:Ns,isWritable:!1}),k({pubkey:Cs,isWritable:!1}),k({pubkey:Wn.programId,isWritable:!1}),k({pubkey:e,isSigner:!0})];y.push(k({pubkey:t})),y.push(k({pubkey:r}));let P=[u,c],T=[l,m],w=[o,s,a];for(let F=0;F<P.length;F++){let N=P[F],Q=w[F]===N.mintA.address;if(y.push(k({pubkey:new O(N.programId),isWritable:!1})),F===P.length-1?y.push(k({pubkey:r})):y.push(k({pubkey:n})),y.push(k({pubkey:new O(w[F])})),y.push(k({pubkey:new O(w[F+1])})),N.version===6){let B=T[F];y.push(k({pubkey:new O(B.config.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(Q?B.vault.A:B.vault.B)})),y.push(k({pubkey:new O(Q?B.vault.B:B.vault.A)})),y.push(k({pubkey:new O(N.observationId)})),y.push(k({pubkey:wt})),y.push(k({pubkey:Se(new O(N.programId),new O(N.id)).publicKey})),f.push(Ls(N.sqrtPriceX64.toString(),Q));for(let V of(h=g[F])!=null?h:[])y.push(k({pubkey:new O(V)}))}else if(N.version===5){let B=T[F];y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.authority),isWritable:!1})),y.push(k({pubkey:new O(B.marketProgramId)})),y.push(k({pubkey:new O(B.marketAuthority)})),y.push(k({pubkey:gi,isWritable:!1})),y.push(k({pubkey:new O(B.openOrders)})),y.push(k({pubkey:new O(B.vault.A)})),y.push(k({pubkey:new O(B.vault.B)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.marketId)})),y.push(k({pubkey:new O(B.marketBids)})),y.push(k({pubkey:new O(B.marketAsks)})),y.push(k({pubkey:new O(B.marketEventQueue)})),y.push(k({pubkey:new O(B.marketBaseVault)})),y.push(k({pubkey:new O(B.marketQuoteVault)}))}else if(N.version===4){let B=T[F],V=N.status!==1;y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(B.authority),isWritable:!1})),y.push(k({pubkey:new O(V?B.id:B.marketProgramId)})),y.push(k({pubkey:new O(V?B.id:B.marketAuthority)})),y.push(k({pubkey:new O(V?B.id:B.openOrders)})),y.push(k({pubkey:new O(B.vault.A)})),y.push(k({pubkey:new O(B.vault.B)})),y.push(k({pubkey:new O(V?B.id:B.marketId)})),y.push(k({pubkey:new O(V?B.id:B.marketBids)})),y.push(k({pubkey:new O(V?B.id:B.marketAsks)})),y.push(k({pubkey:new O(V?B.id:B.marketEventQueue)})),y.push(k({pubkey:new O(V?B.id:B.marketBaseVault)})),y.push(k({pubkey:new O(V?B.id:B.marketQuoteVault)}))}else if(N.version===7){let B=T[F];y.push(k({pubkey:new O(B.authority)})),y.push(k({pubkey:new O(B.config.id)})),y.push(k({pubkey:new O(B.id)})),y.push(k({pubkey:new O(Q?B.vault.A:B.vault.B)})),y.push(k({pubkey:new O(Q?B.vault.B:B.vault.A)})),y.push(k({pubkey:new O(N.observationId)}))}else throw Error("pool type error")}let C=E([D("insId"),b("amountIn"),b("amountOut"),H(G(),f.length,"clmmPriceLimit")]),M=Buffer.alloc(C.span);return C.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},M),new qn({keys:y,programId:i,data:M})}function Ls(i,e){if(i)if(e){let t=new gt(i).div(new gt(25));return t.gt($t)?t:$t}else{let t=new gt(i).mul(new gt(25));return t.lt(en)?t:en}else return e?$t:en}function Os({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=Me(m),p=t.equals(d.mintA.address)?ze.add(Fe):Qe.sub(Fe);return yt.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new gt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Yi(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new O(m[d?"mintA":"mintB"].address),new O(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?ne.CpmmSwapBaseIn:ne.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[er({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new gt(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ne.AmmV5SwapBaseIn:ne.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],g=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[Rs(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,g,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new gt(0)),n.remainingAccounts)],instructionTypes:[ne.RouteSwap],lookupTableAddress:[p.lookupTableAccount,g.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}var OP=new Ms(0);export{Os as makeSwapInstruction,Hg as route1Instruction,Yg as route2Instruction,Rs as routeInstruction};
//# sourceMappingURL=index.mjs.map