var Yi=Object.defineProperty,Zi=Object.defineProperties;var ji=Object.getOwnPropertyDescriptors;var Xn=Object.getOwnPropertySymbols;var Ji=Object.prototype.hasOwnProperty,$i=Object.prototype.propertyIsEnumerable;var zn=(i,e,t)=>e in i?Yi(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,$=(i,e)=>{for(var t in e||(e={}))Ji.call(e,t)&&zn(i,t,e[t]);if(Xn)for(var t of Xn(e))$i.call(e,t)&&zn(i,t,e[t]);return i},te=(i,e)=>Zi(i,ji(e));import{PublicKey as L,SystemProgram as Dn,TransactionInstruction as qn}from"@solana/web3.js";import yt from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ks,TOKEN_2022_PROGRAM_ID as Ps,TOKEN_PROGRAM_ID as Gn}from"@solana/spl-token";import{PublicKey as nr}from"@solana/web3.js";import{get as Hn,set as er}from"lodash";var sn=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Qn={},tr={};function de(i){let e=Hn(Qn,i);if(!e){let t=Hn(tr,i);e=new sn({name:i,logLevel:t}),er(Qn,i,e)}return e}import{MINT_SIZE as Rs,TOKEN_PROGRAM_ID as Ms,getTransferFeeConfig as Os,unpackMint as Es}from"@solana/spl-token";var an=de("Raydium_accountInfo_util");async function tt(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=$({batchRequest:!1},t),s=un(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=un(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:b,rentEpoch:k}=d;return p.length!==2&&p[1]!=="base64"&&an.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new nr(b),rentEpoch:k}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&an.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Ft(i,e,t){let n=await tt(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>te($({},r),{accountInfo:n[o]}))}import je from"bn.js";var gt=9e15,ot=1e9,cn="0123456789abcdef",Vt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_t="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",ln={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-gt,maxE:gt,crypto:!1},Jn,Ye,_=!0,qt="[DecimalError] ",rt=qt+"Invalid argument: ",$n=qt+"Precision limit exceeded",ei=qt+"crypto unavailable",ti="[object Decimal]",Ae=Math.floor,pe=Math.pow,ir=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,rr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,or=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,ni=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Ve=1e7,v=7,sr=9007199254740991,ar=Vt.length-1,mn=_t.length-1,P={toStringTag:ti};P.absoluteValue=P.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),F(i)};P.ceil=function(){return F(new this.constructor(this),this.e+1,2)};P.clampedTo=P.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(rt+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};P.comparedTo=P.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};P.cosine=P.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=ur(n,ai(n,t)),n.precision=i,n.rounding=e,F(Ye==2||Ye==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};P.cubeRoot=P.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(_=!1,o=l.s*pe(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Pe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=pe(t,1/3),i=Ae((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ne(c.plus(l).times(a),c.plus(u),s+2,1),Pe(a.d).slice(0,s)===(t=Pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(F(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return _=!0,F(n,i,m.rounding,e)};P.decimalPlaces=P.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Ae(this.e/v))*v,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};P.dividedBy=P.div=function(i){return ne(this,new this.constructor(i))};P.dividedToIntegerBy=P.divToInt=function(i){var e=this,t=e.constructor;return F(ne(e,new t(i),0,1,1),t.precision,t.rounding)};P.equals=P.eq=function(i){return this.cmp(i)===0};P.floor=function(){return F(new this.constructor(this),this.e+1,3)};P.greaterThan=P.gt=function(i){return this.cmp(i)>0};P.greaterThanOrEqualTo=P.gte=function(i){var e=this.cmp(i);return e==1||e===0};P.hyperbolicCosine=P.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ut(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=kt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};P.hyperbolicSine=P.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=kt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ut(5,i)),r=kt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,F(r,e,t,!0)};P.hyperbolicTangent=P.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ne(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};P.inverseCosine=P.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?ve(t,r,o):new t(0):new t(NaN):e.isZero()?ve(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=ve(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};P.inverseHyperbolicCosine=P.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,_=!1,t=t.times(t).minus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};P.inverseHyperbolicSine=P.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,_=!1,t=t.times(t).plus(1).sqrt().plus(t),_=!0,n.precision=i,n.rounding=e,t.ln())};P.inverseHyperbolicTangent=P.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?F(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ne(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};P.inverseSine=P.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=ve(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};P.inverseTangent=P.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=mn)return s=ve(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=mn)return s=ve(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/v+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(_=!1,e=Math.ceil(a/v),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),_=!0,F(s,l.precision=m,l.rounding=d,!0)};P.isFinite=function(){return!!this.d};P.isInteger=P.isInt=function(){return!!this.d&&Ae(this.e/v)>this.d.length-2};P.isNaN=function(){return!this.s};P.isNegative=P.isNeg=function(){return this.s<0};P.isPositive=P.isPos=function(){return this.s>0};P.isZero=function(){return!!this.d&&this.d[0]===0};P.lessThan=P.lt=function(i){return this.cmp(i)<0};P.lessThanOrEqualTo=P.lte=function(i){return this.cmp(i)<1};P.logarithm=P.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(_=!1,a=m+p,s=it(c,a),n=e?Dt(l,a+10):it(i,a),u=ne(s,n,a,1),Bt(u.d,r=m,d))do if(a+=10,s=it(c,a),n=e?Dt(l,a+10):it(i,a),u=ne(s,n,a,1),!o){+Pe(u.d).slice(r+1,r+15)+1==1e14&&(u=F(u,m+1,0));break}while(Bt(u.d,r+=10,d));return _=!0,F(u,m,d)};P.minus=P.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(i=new y(i),!p.d||!i.d)return!p.s||!i.s?i=new y(NaN):p.d?i.s=-i.s:i=new y(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(c=p.d,d=i.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new y(p);else return new y(u===3?-0:0);return _?F(i,a,u):i}if(t=Ae(i.e/v),l=Ae(p.e/v),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/v),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Ve-1;--c[r],c[n]+=Ve}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=Gt(c,t),_?F(i,a,u):i):new y(u===3?-0:0)};P.modulo=P.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(_=!1,n.modulo==9?(e=ne(t,i.abs(),0,3,1),e.s*=i.s):e=ne(t,i,0,n.modulo,1),e=e.times(i),_=!0,t.minus(e))};P.naturalExponential=P.exp=function(){return dn(this)};P.naturalLogarithm=P.ln=function(){return it(this)};P.negated=P.neg=function(){var i=new this.constructor(this);return i.s=-i.s,F(i)};P.plus=P.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),_?F(i,a,u):i;if(o=Ae(m.e/v),n=Ae(i.e/v),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/v),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Ve|0,c[r]%=Ve;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=Gt(c,n),_?F(i,a,u):i};P.precision=P.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(rt+i);return t.d?(e=ii(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};P.round=function(){var i=this,e=i.constructor;return F(new e(i),i.e+1,e.rounding)};P.sine=P.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+v,n.rounding=1,t=lr(n,ai(n,t)),n.precision=i,n.rounding=e,F(Ye>2?t.neg():t,i,e,!0)):new n(NaN)};P.squareRoot=P.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(_=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=Pe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ae((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ne(s,o,t+2,1)).times(.5),Pe(o.d).slice(0,t)===(e=Pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(F(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,u+1,1),i=!n.times(n).eq(s));break}return _=!0,F(n,u,l.rounding,i)};P.tangent=P.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ne(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,F(Ye==2||Ye==4?t.neg():t,i,e,!0)):new n(NaN)};P.times=P.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Ae(l.e/v)+Ae(i.e/v),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%Ve|0,e=a/Ve|0;o[r]=(o[r]+e)%Ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=Gt(o,t),_?F(i,m.precision,m.rounding):i};P.toBinary=function(i,e){return fn(this,2,i,e)};P.toDecimalPlaces=P.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Ce(i,0,ot),e===void 0?e=n.rounding:Ce(e,0,8),F(t,i+t.e+1,e))};P.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,!0):(Ce(i,0,ot),e===void 0?e=r.rounding:Ce(e,0,8),n=F(new r(n),i+1,e),t=Ue(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Ue(r):(Ce(i,0,ot),e===void 0?e=o.rounding:Ce(e,0,8),n=F(new o(r),i+r.e+1,e),t=Ue(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};P.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=ii(y)-p.e-1,s=o%v,e.d[0]=pe(10,s<0?v+s:s),i==null)i=o>0?e:c;else{if(a=new f(i),!a.isInt()||a.lt(c))throw Error(rt+a);i=a.gt(e)?o>0?e:c:a}for(_=!1,a=new f(Pe(y)),l=f.precision,f.precision=o=y.length*v*2;m=ne(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=ne(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=p.s,d=ne(c,n,o,1).minus(p).abs().cmp(ne(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,_=!0,d};P.toHexadecimal=P.toHex=function(i,e){return fn(this,16,i,e)};P.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Ce(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(_=!1,t=ne(t,i,0,e,1).times(i),_=!0,F(t)):(i.s=t.s,t=i),t};P.toNumber=function(){return+this};P.toOctal=function(i,e){return fn(this,8,i,e)};P.toPower=P.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(pe(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return F(a,n,o);if(e=Ae(i.e/v),e>=i.d.length-1&&(t=c<0?-c:c)<=sr)return r=ri(u,a,t,n),i.s<0?new u(1).div(r):F(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=pe(+a,c),e=t==0||!isFinite(t)?Ae(c*(Math.log("0."+Pe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(_=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=dn(i.times(it(a,n+t)),n),r.d&&(r=F(r,n+5,1),Bt(r.d,n,o)&&(e=n+10,r=F(dn(i.times(it(a,e+t)),e),e+5,1),+Pe(r.d).slice(n+1,n+15)+1==1e14&&(r=F(r,n+1,0)))),r.s=s,_=!0,u.rounding=o,F(r,n,o))};P.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Ue(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Ce(i,1,ot),e===void 0?e=r.rounding:Ce(e,0,8),n=F(new r(n),i,e),t=Ue(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};P.toSignificantDigits=P.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Ce(i,1,ot),e===void 0?e=n.rounding:Ce(e,0,8)),F(new n(t),i,e)};P.toString=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};P.truncated=P.trunc=function(){return F(new this.constructor(this),this.e+1,1)};P.valueOf=P.toJSON=function(){var i=this,e=i.constructor,t=Ue(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=v-n.length,t&&(o+=nt(t)),o+=n;s=i[e],n=s+"",t=v-n.length,t&&(o+=nt(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Ce(i,e,t){if(i!==~~i||i<e||i>t)throw Error(rt+i)}function Bt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=v,r=0):(r=Math.ceil((e+1)/v),e%=v),o=pe(10,v-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==pe(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==pe(10,e-3)-1,s}function vt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=cn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function ur(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ut(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=kt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ne=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,p,y,f,b,k,h,A,x,R,T,E,K,H,B,W,be,me=n.constructor,Ke=n.s==r.s?1:-1,ae=n.d,ee=r.d;if(!ae||!ae[0]||!ee||!ee[0])return new me(!n.s||!r.s||(ae?ee&&ae[0]==ee[0]:!ee)?NaN:ae&&ae[0]==0||!ee?Ke*0:Ke/0);for(u?(p=1,l=n.e-r.e):(u=Ve,p=v,l=Ae(n.e/p)-Ae(r.e/p)),W=ee.length,H=ae.length,k=new me(Ke),h=k.d=[],m=0;ee[m]==(ae[m]||0);m++);if(ee[m]>(ae[m]||0)&&l--,o==null?(T=o=me.precision,s=me.rounding):a?T=o+(n.e-r.e)+1:T=o,T<0)h.push(1),y=!0;else{if(T=T/p+2|0,m=0,W==1){for(d=0,ee=ee[0],T++;(m<H||d)&&T--;m++)E=d*u+(ae[m]||0),h[m]=E/ee|0,d=E%ee|0;y=d||m<H}else{for(d=u/(ee[0]+1)|0,d>1&&(ee=i(ee,d,u),ae=i(ae,d,u),W=ee.length,H=ae.length),K=W,A=ae.slice(0,W),x=A.length;x<W;)A[x++]=0;be=ee.slice(),be.unshift(0),B=ee[0],ee[1]>=u/2&&++B;do d=0,c=e(ee,A,W,x),c<0?(R=A[0],W!=x&&(R=R*u+(A[1]||0)),d=R/B|0,d>1?(d>=u&&(d=u-1),f=i(ee,d,u),b=f.length,x=A.length,c=e(f,A,b,x),c==1&&(d--,t(f,W<b?be:ee,b,u))):(d==0&&(c=d=1),f=ee.slice()),b=f.length,b<x&&f.unshift(0),t(A,f,x,u),c==-1&&(x=A.length,c=e(ee,A,W,x),c<1&&(d++,t(A,W<x?be:ee,x,u))),x=A.length):c===0&&(d++,A=[0]),h[m++]=d,c&&A[0]?A[x++]=ae[K]||0:(A=[ae[K]],x=1);while((K++<H||A[0]!==void 0)&&T--);y=A[0]!==void 0}h[0]||h.shift()}if(p==1)k.e=l,Jn=y;else{for(m=1,d=h[0];d>=10;d/=10)m++;k.e=m+l*p-1,F(k,a?o+k.e+1:o,s,y)}return k}}();function F(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=v,s=e,l=m[d=0],u=l/pe(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/v),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=v,s=o-v+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=v,s=o-v+r,u=s<0?0:l/pe(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%pe(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/pe(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=pe(10,(v-e%v)%v),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=pe(10,v-o),m[d]=s>0?(l/pe(10,r-s)%pe(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return _&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Ue(i,e,t){if(!i.isFinite())return si(i);var n,r=i.e,o=Pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+nt(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+nt(-r-1)+o,t&&(n=t-s)>0&&(o+=nt(n))):r>=s?(o+=nt(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+nt(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=nt(n))),o}function Gt(i,e){var t=i[0];for(e*=v;t>=10;t/=10)e++;return e}function Dt(i,e,t){if(e>ar)throw _=!0,t&&(i.precision=t),Error($n);return F(new i(Vt),e,1,!0)}function ve(i,e,t){if(e>mn)throw Error($n);return F(new i(_t),e,t,!0)}function ii(i){var e=i.length-1,t=e*v+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function nt(i){for(var e="";i--;)e+="0";return e}function ri(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/v+4);for(_=!1;;){if(t%2&&(o=o.times(e),Zn(o.d,s)&&(r=!0)),t=Ae(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),Zn(e.d,s)}return _=!0,o}function Yn(i){return i.d[i.d.length-1]&1}function oi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function dn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,p=d.rounding,y=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(_=!1,u=y):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(pe(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=F(o.times(i),u,1),t=t.times(++l),a=s.plus(ne(o,t,u,1)),Pe(a.d).slice(0,u)===Pe(s.d).slice(0,u)){for(r=m;r--;)s=F(s.times(s),u,1);if(e==null)if(c<3&&Bt(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return F(s,d.precision=y,p,_=!0);else return d.precision=y,s}s=a}}function it(i,e){var t,n,r,o,s,a,u,c,l,m,d,p=1,y=10,f=i,b=f.d,k=f.constructor,h=k.rounding,A=k.precision;if(f.s<0||!b||!b[0]||!f.e&&b[0]==1&&b.length==1)return new k(b&&!b[0]?-1/0:f.s!=1?NaN:b?0:f);if(e==null?(_=!1,l=A):l=e,k.precision=l+=y,t=Pe(b),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(i),t=Pe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new k("0."+t),o++):f=new k(n+"."+t.slice(1))}else return c=Dt(k,l+2,A).times(o+""),f=it(new k(n+"."+t.slice(1)),l-y).plus(c),k.precision=A,e==null?F(f,A,h,_=!0):f;for(m=f,u=s=f=ne(f.minus(1),f.plus(1),l,1),d=F(f.times(f),l,1),r=3;;){if(s=F(s.times(d),l,1),c=u.plus(ne(s,new k(r),l,1)),Pe(c.d).slice(0,l)===Pe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Dt(k,l+2,A).times(o+""))),u=ne(u,new k(p),l,1),e==null)if(Bt(u.d,l-y,h,a))k.precision=l+=y,c=s=f=ne(m.minus(1),m.plus(1),l,1),d=F(f.times(f),l,1),r=a=1;else return F(u,k.precision=A,h,_=!0);else return k.precision=A,u;u=c,r+=2}}function si(i){return String(i.s*i.s/0)}function pn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%v,t<0&&(n+=v),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=v;n<r;)i.d.push(+e.slice(n,n+=v));e=e.slice(n),n=v-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),_&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function cr(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),ni.test(e))return pn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(rr.test(e))t=16,e=e.toLowerCase();else if(ir.test(e))t=2;else if(or.test(e))t=8;else throw Error(rt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=ri(n,new n(t),o,o*2)),c=vt(e,t,Ve),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=Gt(c,l),i.d=c,_=!1,s&&(i=ne(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?pe(2,u):It.pow(2,u))),_=!0,i)}function lr(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:kt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ut(5,t)),e=kt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function kt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/v);for(_=!1,u=t.times(t),a=new i(n);;){if(s=ne(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ne(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return _=!0,s.d.length=m+1,s}function Ut(i,e){for(var t=i;--e;)t*=i;return t}function ai(i,e){var t,n=e.s<0,r=ve(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ye=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ye=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ye=Yn(t)?n?2:3:n?4:1,e;Ye=Yn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function fn(i,e,t,n){var r,o,s,a,u,c,l,m,d,p=i.constructor,y=t!==void 0;if(y?(Ce(t,1,ot),n===void 0?n=p.rounding:Ce(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=si(i);else{for(l=Ue(i),s=l.indexOf("."),y?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=vt(Ue(d),10,r),d.e=d.d.length),m=vt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=ne(i,d,t,n,0,r),m=i.d,o=i.e,c=Jn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=cn.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=vt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=cn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function Zn(i,e){if(i.length>e)return i.length=e,!0}function mr(i){return new this(i).abs()}function dr(i){return new this(i).acos()}function pr(i){return new this(i).acosh()}function fr(i,e){return new this(i).plus(e)}function br(i){return new this(i).asin()}function yr(i){return new this(i).asinh()}function gr(i){return new this(i).atan()}function kr(i){return new this(i).atanh()}function Pr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=ve(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?ve(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=ve(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ne(i,e,o,1)),e=ve(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ne(i,e,o,1)),t}function wr(i){return new this(i).cbrt()}function Ar(i){return F(i=new this(i),i.e+1,2)}function hr(i,e,t){return new this(i).clamp(e,t)}function Tr(i){if(!i||typeof i!="object")throw Error(qt+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,ot,"rounding",0,8,"toExpNeg",-gt,0,"toExpPos",0,gt,"maxE",0,gt,"minE",-gt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=ln[t]),(n=i[t])!==void 0)if(Ae(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(rt+t+": "+n);if(t="crypto",r&&(this[t]=ln[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(ei);else this[t]=!1;else throw Error(rt+t+": "+n);return this}function Br(i){return new this(i).cos()}function Ir(i){return new this(i).cosh()}function ui(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,jn(o)){c.s=o.s,_?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;_?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return pn(c,o.toString())}else if(u!=="string")throw Error(rt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),ni.test(o)?pn(c,o):cr(c,o)}if(r.prototype=P,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Tr,r.clone=ui,r.isDecimal=jn,r.abs=mr,r.acos=dr,r.acosh=pr,r.add=fr,r.asin=br,r.asinh=yr,r.atan=gr,r.atanh=kr,r.atan2=Pr,r.cbrt=wr,r.ceil=Ar,r.clamp=hr,r.cos=Br,r.cosh=Ir,r.div=xr,r.exp=Sr,r.floor=Kr,r.hypot=Cr,r.ln=Nr,r.log=Lr,r.log10=Mr,r.log2=Rr,r.max=Or,r.min=Er,r.mod=Fr,r.mul=Wr,r.pow=vr,r.random=Vr,r.round=_r,r.sign=Dr,r.sin=qr,r.sinh=Gr,r.sqrt=Ur,r.sub=Xr,r.sum=zr,r.tan=Hr,r.tanh=Qr,r.trunc=Yr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function xr(i,e){return new this(i).div(e)}function Sr(i){return new this(i).exp()}function Kr(i){return F(i=new this(i),i.e+1,3)}function Cr(){var i,e,t=new this(0);for(_=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return _=!0,new this(1/0);t=e}return _=!0,t.sqrt()}function jn(i){return i instanceof It||i&&i.toStringTag===ti||!1}function Nr(i){return new this(i).ln()}function Lr(i,e){return new this(i).log(e)}function Rr(i){return new this(i).log(2)}function Mr(i){return new this(i).log(10)}function Or(){return oi(this,arguments,"lt")}function Er(){return oi(this,arguments,"gt")}function Fr(i,e){return new this(i).mod(e)}function Wr(i,e){return new this(i).mul(e)}function vr(i,e){return new this(i).pow(e)}function Vr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Ce(i,1,ot),n=Math.ceil(i/v),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(ei);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=v,n&&i&&(r=pe(10,v-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=v)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<v&&(t-=v-n)}return s.e=t,s.d=a,s}function _r(i){return F(i=new this(i),i.e+1,this.rounding)}function Dr(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function qr(i){return new this(i).sin()}function Gr(i){return new this(i).sinh()}function Ur(i){return new this(i).sqrt()}function Xr(i,e){return new this(i).sub(e)}function zr(){var i=0,e=arguments,t=new this(e[i]);for(_=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return _=!0,F(t,this.precision,this.rounding)}function Hr(i){return new this(i).tan()}function Qr(i){return new this(i).tanh()}function Yr(i){return F(i=new this(i),i.e+1,1)}P[Symbol.for("nodejs.util.inspect.custom")]=P.toString;P[Symbol.toStringTag]="Decimal";var It=P.constructor=ui(ln);Vt=new It(Vt);_t=new It(_t);var N=It;import io from"big.js";import Ht from"bn.js";import Zr from"toformat";var jr=Zr,xt=jr;import zt from"big.js";import $r from"bn.js";import eo from"decimal.js-light";import St from"bn.js";var ci=9007199254740991;function ue(i){let e=de("Raydium_parseBigNumberish");if(i instanceof St)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new St(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=ci||i<=-ci)&&e.logWithError(`BigNumberish number overflow: ${i}`),new St(String(i))):typeof i=="bigint"?new St(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new St(0))}var Xt=de("module/fraction"),bn=xt(zt),Kt=xt(eo),to={[0]:Kt.ROUND_DOWN,[1]:Kt.ROUND_HALF_UP,[2]:Kt.ROUND_UP},no={[0]:zt.roundDown,[1]:zt.roundHalfUp,[2]:zt.roundUp},j=class{constructor(e,t=new $r(1)){this.numerator=ue(e),this.denominator=ue(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new j(this.denominator,this.numerator)}add(e){let t=e instanceof j?e:new j(ue(e));return this.denominator.eq(t.denominator)?new j(this.numerator.add(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof j?e:new j(ue(e));return this.denominator.eq(t.denominator)?new j(this.numerator.sub(t.numerator),this.denominator):new j(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof j?e:new j(ue(e));return new j(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof j?e:new j(ue(e));return new j(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<=0&&Xt.logWithError(`${e} is not positive.`),Kt.set({precision:e+1,rounding:to[n]});let r=new Kt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Xt.logWithError(`${e} is not an integer.`),e<0&&Xt.logWithError(`${e} is negative.`),bn.DP=e,bn.RM=no[n]||1,new bn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var ro=de("Raydium_amount"),li=xt(io);function oo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):ro.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ye=class extends j{constructor(t,n,r=!0,o){let s=new Ht(0),a=yn.pow(new Ht(t.decimals));if(r)s=ue(n);else{let u=new Ht(0),c=new Ht(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=oo(n.toString(),t.decimals);u=ue(l),c=ue(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=de(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ye(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ye(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return li.DP=this.token.decimals,new li(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as so}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as mi}from"@solana/spl-token";var gn={chainId:101,address:so.default.toBase58(),programId:mi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:mi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as wn}from"@solana/web3.js";import{PublicKey as se,SystemProgram as di,SYSVAR_RENT_PUBKEY as ao}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as uo}from"@solana/spl-token";function w({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var fa=[w({pubkey:uo,isWritable:!1}),w({pubkey:di.programId,isWritable:!1}),w({pubkey:ao,isWritable:!1})];function kn({publicKey:i,transformSol:e}){let t=Pn(i.toString());if(t instanceof se)return e&&t.equals(Ct)?Wt:t;if(e&&t.toString()===Ct.toBase58())return Wt;if(typeof t=="string"){if(t===se.default.toBase58())return se.default;try{return new se(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Pn(i){try{return new se(i)}catch{return i}}var Qt=new se("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pt=new se("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),at=new se("SysvarRent111111111111111111111111111111111"),ba=new se("SysvarC1ock11111111111111111111111111111111"),ut=new se("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ya=new se("Sysvar1nstructions1111111111111111111111111"),co=di.programId,ga=new se("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),ka=new se("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Pa=new se("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),wa=new se("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Aa=new se("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),ha=new se("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ta=new se("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ba=new se("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ia=new se("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),xa=new se("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Sa=new se("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Wt=new se("So11111111111111111111111111111111111111112"),Ct=se.default;function Tt(i){return kn({publicKey:i,transformSol:!0})}var An=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Ct.toBase58()||e instanceof wn&&Ct.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new wn(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?wn.default:kn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},_e=An;_e.WSOL=new An(te($({},st),{mint:st.address}));var hn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Yt=hn;Yt.SOL=new hn(gn);import lo from"bn.js";var pi=new j(new lo(100)),Ze=class extends j{toSignificant(e=5,t,n){return this.mul(pi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(pi).toFixed(e,t,n)}};var mo=de("Raydium_price"),Fe=class extends j{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new j(Tn(n.decimals),Tn(r.decimals))}get raw(){return new j(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Fe({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&mo.logWithError("mul token not equals");let n=super.mul(t);return new Fe({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as po}from"@solana/web3.js";import fo from"bn.js";function bi(i){return typeof i=="object"&&i!==null&&![_e,ye,po,j,fo,Fe,Ze].some(e=>typeof e=="object"&&i instanceof e)}function Me(i){return typeof i=="string"?Pn(i):Array.isArray(i)?i.map(e=>Me(e)):bi(i)?Object.fromEntries(Object.entries(i).map(([e,t])=>[e,Me(t)])):i}var fi=new je(0),bo=new je(1),hu=new je(2),Tu=new je(3),Bu=new je(5),yn=new je(10),Iu=new je(100),xu=new je(1e3),Su=new je(1e4);function Tn(i){return yn.pow(ue(i))}function un(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as go}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as ko}from"@solana/spl-token";import{ComputeBudgetProgram as Eu,Keypair as vu,PublicKey as yo,Transaction as _u,TransactionMessage as qu,VersionedTransaction as Gu}from"@solana/web3.js";var ie={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Hu}from"@solana/spl-token";var Qu=de("Raydium_txUtil");function he(i,e){let[t,n]=yo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Ne(i,e,t){return he([i.toBuffer(),(t!=null?t:ko).toBuffer(),e.toBuffer()],new go("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as U}from"@solana/web3.js";var tc=new U("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),nc=new U("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ic=new U("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),rc=new U("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),oc=new U("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),sc=new U("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ac=new U("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),uc=new U("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),cc=new U("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),yi=new U("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Po=new U("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),wo=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Ao=new U("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),lc=new U("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),mc=new U("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),dc=new U("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),pc=new U("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),fc=new U("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),bc=new U("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),ho=new U("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),To=new U("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),yc=new U("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Bo=new U("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Io=new U("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),xo=new U("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),gc=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),So=new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),kc=new U("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Ko=new U("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Pc={SERUM_MARKET:U.default,OPENBOOK_MARKET:new U("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:U.default,FarmV3:new U("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new U("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new U("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new U("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new U("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new U("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new U("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new U("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Bo,CREATE_CPMM_POOL_AUTH:Io,CREATE_CPMM_POOL_FEE_ACC:xo,FEE_DESTINATION_ID:new U("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:So,LCOK_CPMM_AUTH:Ko};import De from"bn.js";var Nt=1e4;function ce(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=te($({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new De(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Nt){let u=new De(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=Zt(i.mul(new De(Nt)),new De(Nt-o.transferFeeBasisPoints)),c=new De(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=Zt(l.mul(new De(o.transferFeeBasisPoints)),new De(Nt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=Zt(i.mul(new De(o.transferFeeBasisPoints)),new De(Nt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function ct(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Zt(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new De(0))?t.add(new De(1)):t}import{PublicKey as Co,AddressLookupTableAccount as gi}from"@solana/web3.js";var No={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new gi({key:new Co("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:gi.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Wc,sendAndConfirmTransaction as vc,Transaction as _c,TransactionMessage as qc,VersionedTransaction as Gc}from"@solana/web3.js";import Xc from"axios";import{PublicKey as Do}from"@solana/web3.js";import Ai,{isBN as hi}from"bn.js";import{bits as yl,BitStructure as gl,blob as Mo,Blob as kl,cstr as Pl,f32 as wl,f32be as Al,f64 as hl,f64be as Tl,greedy as Bl,Layout as Oo,ns64 as Il,ns64be as xl,nu64 as Sl,nu64be as Kl,offset as Cl,s16 as Nl,s16be as Ll,s24 as Rl,s24be as Ml,s32 as Eo,s32be as Ol,s40 as El,s40be as Fl,s48 as Wl,s48be as vl,s8 as Vl,seq as Fo,struct as _l,Structure as Wo,u16 as vo,u16be as Dl,u24 as ql,u24be as Gl,u32 as Ul,u32be as Xl,u40 as zl,u40be as Hl,u48 as Ql,u48be as Yl,u8 as Vo,UInt as _o,union as Zl,Union as jl,unionLayoutDiscriminator as Jl,utf8 as $l}from"@solana/buffer-layout";var Bn=Oo,ki=Wo;var In=_o;var Pi=Vo,lt=vo;var we=Eo;var wi=Fo;var Te=Mo;var wt=class extends Bn{constructor(t,n,r){super(t,r);this.blob=Te(t),this.signed=n}decode(t,n=0){let r=new Ai(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Ai(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function X(i){return new In(1,i)}function At(i){return new In(4,i)}function g(i){return new wt(8,!1,i)}function q(i){return new wt(16,!1,i)}function Ti(i){return new wt(8,!0,i)}function Bi(i){return new wt(16,!0,i)}var jt=class extends Bn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function S(i){return new jt(Te(32),e=>new Do(e),e=>e.toBuffer(),i)}function Le(i){return new jt(Pi(),qo,Go,i)}function qo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function Go(i){return i?1:0}var xn=class extends ki{decode(e,t){return super.decode(e,t)}};function V(i,e,t){return new xn(i,e,t)}function Q(i,e,t){let n,r=typeof e=="number"?e:hi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=hi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return wi(i,r,t)}import{PublicKey as fp}from"@solana/web3.js";import yp from"bn.js";import{AccountLayout as wp,TOKEN_PROGRAM_ID as Ap}from"@solana/spl-token";import{PublicKey as fm}from"@solana/web3.js";import{MintLayout as ym,TOKEN_PROGRAM_ID as km}from"@solana/spl-token";import{Keypair as on,PublicKey as I,SystemProgram as ft,TransactionInstruction as Se}from"@solana/web3.js";import _i from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Wn,TOKEN_2022_PROGRAM_ID as Qe,TOKEN_PROGRAM_ID as oe}from"@solana/spl-token";import $o from"bn.js";import We from"bn.js";var le=new We(0),Oe=new We(1),Je=new We(-1),Ee=new We(1).shln(64),Jt=new We(1).shln(128),Sn=Ee.sub(Oe),Lt=64,Ii=Jt.subn(1),Be=-443636,Ie=-Be,Xe=new We("4295048016"),ze=new We("79226673521066979257578248091"),$t=new We("4295048017"),en=new We("79226673521066979257578248090"),xi=16,Si="59543866431248",Ki="184467440737095516",Ci="15793534762490258745",tn=new We(10).pow(new We(6));var Nm=new We("18446744073700000000");import z from"bn.js";function nn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function Kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Cn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Rt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function Ni(i,e){return Rt(i,e)?null:Kn(i,e)}function Li(i,e){return Rt(i,e)?null:Cn(i,e)}var Fm=Buffer.from("amm_config","utf8"),Uo=Buffer.from("pool","utf8"),Xo=Buffer.from("pool_vault","utf8"),zo=Buffer.from("pool_reward_vault","utf8"),Ri=Buffer.from("position","utf8"),Ho=Buffer.from("tick_array","utf8"),Qo=Buffer.from("operation","utf8"),Yo=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Zo=Buffer.from("observation","utf8");function Mi(i,e,t,n){return he([Uo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function Nn(i,e,t){return he([Xo,e.toBuffer(),t.toBuffer()],i)}function Oi(i,e,t){return he([zo,e.toBuffer(),t.toBuffer()],i)}function J(i,e,t){return he([Ho,e.toBuffer(),nn(t)],i)}function $e(i,e,t,n){return he([Ri,e.toBuffer(),nn(t),nn(n)],i)}function Re(i,e){return he([Ri,e.toBuffer()],i)}function ht(i){return he([Buffer.from("metadata","utf8"),ut.toBuffer(),i.toBuffer()],ut)}function rn(i){return he([Qo],i)}function xe(i,e){return he([Yo,e.toBuffer()],i)}function Ei(i,e){return he([Zo,e.toBuffer()],i)}var Fi=Buffer.from("locked_position","utf8");function Ln(i,e){return he([Fi,e.toBuffer()],i)}function Rn(i,e){return he([Fi,e.toBuffer()],i)}import{PublicKey as qe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Wi}from"@solana/spl-token";import re from"bn.js";import He from"bn.js";var Mt=class{static getfeeGrowthInside(e,t,n){let r=new He(0),o=new He(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new He(0),a=new He(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=G.wrappingSubU128(G.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ee),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ee),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=G.mulDivFloor(G.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Ee),u=t.tokenFeesOwedA.add(a),c=G.mulDivFloor(G.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Ee),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Ee),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=G.wrappingSubU128(u,c.growthInsideLastX64),m=G.mulDivFloor(l,t.liquidity,Ee),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new He(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new He(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(G.wrappingSubU128(G.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var b,k,h,A;let a=D.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),u=D.getSqrtPriceX64FromTick(t.tickLower),c=D.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Z.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[ce(m.amountA,(b=e.mintA.extensions)==null?void 0:b.feeConfig,s,!0),ce(m.amountB,(k=e.mintB.extensions)==null?void 0:k.feeConfig,s,!0)],[y,f]=[ce(new He(new N(m.amountA.toString()).mul(l).toFixed(0)),(h=e.mintA.extensions)==null?void 0:h.feeConfig,s,!0),ce(new He(new N(m.amountB.toString()).mul(l).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ct(d.expirationTime,p.expirationTime)}}};var jo=15,Y=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=C.getTickArrayStartIndexByTick(r,o),l=C.getInitializedTickArrayInRange(s,a,o,c,Math.floor(jo/2));for(let p=0;p<l.length;p++){let{publicKey:y}=J(t,n,l[p]);u.push(y)}let m=(await tt(e,u)).map(p=>p!==null?Ot.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=te($({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=C.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Y.tickCount(t)),a=n?C.searchLowBitFromStart(r,o,s-1,1,t):C.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=fe-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<fe;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=J(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=C.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<fe;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=J(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(C.checkIsOutOfBoundary(e)){if(e>Ie)return!1;let n=C.getTickArrayStartIndexByTick(Be,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return fe*e}};var Mn=14,et=class{static maxTickInTickarrayBitmap(e){return e*fe*mt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Y.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Y.tickCount(n):t+Y.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*fe,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=Ni(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=Li(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Y.tickCount(n)}}}},Et=class{static getBitmapOffset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=et.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;if(Ie<=t)throw Error(`extensionTickBoundary check error: ${Ie}, ${t}`);if(n<=Be)throw Error(`extensionTickBoundary check error: ${n}, ${Be}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:C.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Y.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=et.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=C.mergeTickArrayBitmap(e).shln(mt-1-a),c=Rt(512,u)?null:Kn(512,u);if(c!==null){let l=t-c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=C.mergeTickArrayBitmap(e).shrn(a),c=Rt(512,u)?null:Cn(512,u);if(c!==null){let l=t+c*Y.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Y.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%et.maxTickInTickarrayBitmap(t),r=Math.floor(n/Y.tickCount(t));return e<0&&n!=0&&(r=mt-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:b}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...y),{allTrade:d,expectedAmountOut:p.mul(Je),remainingAccounts:u,executionPrice:f,feeAmount:b}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:b}=J(e.programId,e.id,f.nextStartIndex);a.push(b)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=dt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(Je),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Et.checkTickArrayIsInit(Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):C.checkTickArrayIsInitialized(C.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=J(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=J(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Y.tickCount(e.tickSpacing)),r=t?C.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):C.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Y.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=et.nextInitializedTickArrayStartIndex(C.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Et.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Be||t>Ie)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=te($({},m),{perSecond:G.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new qe(d)});if(p.tokenMint.equals(qe.default))continue;if(n<=p.openTime.toNumber()||r.eq(le)){s.push(p);continue}let y=new re(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),b=G.mulDivFloor(f,p.emissionsPerSecondX64,r),k=p.rewardGrowthGlobalX64.add(b),h=G.mulDivFloor(f,p.emissionsPerSecondX64,Ee),A=p.rewardTotalEmissioned.add(h);s.push(te($({},p),{rewardGrowthGlobalX64:k,rewardTotalEmissioned:A,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=C.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=et.maxTickInTickarrayBitmap(e),n=-t;return t>Ie&&(t=Y.getArrayStartIndex(Ie,e)+Y.tickCount(e)),n<Be&&(n=Y.getArrayStartIndex(Be,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Y.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Y.tickCount(t)*mt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Ft(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=vi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=C.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=C.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=J(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Ft(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Ot.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=te($({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Re(p,d).publicKey);let l=await tt(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=En.decode(d.data),y=p.poolId.toString(),f=e.find(K=>K.state.id.toBase58()===y);if(f===void 0)continue;let b=f.state,k=C._getTickPriceLegacy({poolInfo:b,tick:p.tickLower,baseIn:!0}),h=C._getTickPriceLegacy({poolInfo:b,tick:p.tickUpper,baseIn:!0}),{amountA:A,amountB:x}=Z.getAmountsFromLiquidity(b.sqrtPriceX64,k.tickSqrtPriceX64,h.tickSqrtPriceX64,p.liquidity,!1),R=1/(1-Math.sqrt(Math.sqrt(k.price.div(h.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:k.price,priceUpper:h.price,amountA:A,amountB:x,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(K=>te($({},K),{pendingReward:new re(0)})),leverage:R,tokenFeeAmountA:new re(0),tokenFeeAmountB:new re(0)}];let T=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),E=await C.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=T,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=E}if(o){let d=Object.values(m),p=await tt(t,d,{batchRequest:r}),y={};for(let f=0;f<d.length;f++){let b=p[f];if(b===null)continue;let k=d[f].toString();y[k]=Ot.decode(b.data)}for(let{state:f,positionAccount:b}of e)if(!!b)for(let k of b){let h=`${f.programId.toString()}-${f.id.toString()}-${k.tickLower}`,A=`${f.programId.toString()}-${f.id.toString()}-${k.tickUpper}`,x=y[m[h].toString()],R=y[m[A].toString()],T=x.ticks[C.getTickOffsetInArray(k.tickLower,f.tickSpacing)],E=R.ticks[C.getTickOffsetInArray(k.tickUpper,f.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:H}=await Mt.GetPositionFees(f,k,T,E),B=await Mt.GetPositionRewards(f,k,T,E);k.tokenFeeAmountA=K.gte(new re(0))?K:new re(0),k.tokenFeeAmountB=H.gte(new re(0))?H:new re(0);for(let W=0;W<B.length;W++)k.rewardInfos[W].pendingReward=B[W].gte(new re(0))?B[W]:new re(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new N(0),catchLiquidityInsufficient:u=!1}){var be;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new N(0))?c=l?Xe.add(new re(1)):ze.sub(new re(1)):c=D.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=ce(o,m,r,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:b,executionPrice:k,feeAmount:h}=ge.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((be=p.fee)!=null?be:le),c,u),A=ce(f,d,r,!1),x=D.sqrtPriceX64ToPrice(k,e.mintA.decimals,e.mintB.decimals),R=l?x:new N(1).div(x),T=f.mul(new re(Math.floor((1-s)*1e10))).div(new re(1e10)),E=ce(T,d,r,!1),K=l?e.currentPrice:new N(1).div(e.currentPrice),H=new N(R).sub(K).abs(),B=K,W=new Ze(new N(H).mul(10**15).toFixed(0),new N(B).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:A,minAmountOut:E,expirationTime:ct(p.expirationTime,A.expirationTime),currentPrice:e.currentPrice,executionPrice:R,priceImpact:W,fee:h,remainingAccounts:b,executionPriceX64:k}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new _e(te($({},c),{mint:c.address,isToken2022:c.programId===Wi.toBase58()})),new _e(te($({},l),{mint:l.address,isToken2022:l.programId===Wi.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:b,expirationTime:k,currentPrice:h,executionPrice:A,priceImpact:x,fee:R,remainingAccounts:T,executionPriceX64:E}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new qe(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),K=te($({},y),{amount:new ye(m,y.amount),fee:y.fee===void 0?void 0:new ye(m,y.fee)}),H=te($({},f),{amount:new ye(d,f.amount),fee:f.fee===void 0?void 0:new ye(d,f.fee)}),B=te($({},b),{amount:new ye(d,b.amount),fee:b.fee===void 0?void 0:new ye(d,b.fee)}),W=new Fe({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:h.mul(new N(10**(20+d.decimals))).toFixed(0)}),be=new Fe({baseToken:m,denominator:new re(10).pow(new re(20+m.decimals)),quoteToken:d,numerator:A.mul(new N(10**(20+d.decimals))).toFixed(0)}),me=new ye(m,R);return{allTrade:p,realAmountIn:K,amountOut:H,minAmountOut:B,expirationTime:k,currentPrice:W,executionPrice:be,priceImpact:x,fee:me,remainingAccounts:T,executionPriceX64:E}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new N(0)}){var B;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new N(0))?l=u?ze.sub(new re(1)):Xe.add(new re(1)):l=D.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=ce(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:y,feeAmount:f}=ge.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((B=m.fee)!=null?B:le),l),b=u?e.mintB.address:e.mintA.address,k=ce(d,c[b],r,!1),h=D.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),A=u?h:new N(1).div(h),x=d.mul(new re(Math.floor((1+s)*1e10))).div(new re(1e10)),R=ce(x,c[b],r,!0),T=u?e.currentPrice:new N(1).div(e.currentPrice),E=new N(A).sub(T).abs(),K=T,H=new Ze(new N(E).mul(10**15).toFixed(0),new N(K).mul(10**15).toFixed(0));return{amountIn:k,maxAmountIn:R,realAmountOut:m,expirationTime:ct(k.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:H,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var y,f,b;let o=e[t],s=C.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=C.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((b=o.rewardApr[2])!=null?b:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Tt(e.mintA.address).toString()],d=r[Tt(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=D.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),b=D.getSqrtPriceX64FromTick(s),k=D.getSqrtPriceX64FromTick(a),{amountSlippageA:h,amountSlippageB:A}=Z.getAmountsFromLiquidityWithSlippage(f,b,k,t,!1,!1,0),{amountSlippageA:x,amountSlippageB:R}=Z.getAmountsFromLiquidityWithSlippage(f,b,k,o,!1,!1,0),T=new N(h.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(A.toString()).div(new N(10).pow(y)).mul(d.value)),E=new N(x.toString()).div(new N(10).pow(p)).mul(m.value).add(new N(R.toString()).div(new N(10).pow(y)).mul(d.value)),K=new N(1).div(T.add(E)),B=new N(l.volumeFee).mul(365).div(c).mul(K).mul(100).toNumber(),W=3600*24*365,be=e.rewardDefaultInfos.map(me=>{var ee,Un;let Ke=me.mint.decimals,ae=r[me.mint.address];return u<((ee=me.startTime)!=null?ee:0)||u>((Un=me.endTime)!=null?Un:0)||!me.perSecond||!ae||Ke===void 0?0:new N(ae.value).mul(new N(me.perSecond).mul(W)).div(new N(10).pow(Ke)).mul(K).mul(100).toNumber()});return{feeApr:B,rewardsApr:be,apr:B+be.reduce((me,Ke)=>me+Ke,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var k,h;let l=D.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),m=D.getSqrtPriceX64FromTick(n),d=D.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,y=ce(o,(k=e[t?"mintA":"mintB"].extensions)==null?void 0:k.feeConfig,u,!c),f=new re(new N(y.amount.sub((h=y.fee)!=null?h:le).toString()).mul(p).toFixed(0)),b;if(l.lte(m))b=t?Z.getLiquidityFromTokenAmountA(m,d,f,!a):new re(0);else if(l.lte(d)){let A=Z.getLiquidityFromTokenAmountA(l,d,f,!a),x=Z.getLiquidityFromTokenAmountB(m,l,f);b=t?A:x}else b=t?new re(0):Z.getLiquidityFromTokenAmountB(m,d,f);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:b,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var b,k,h,A;let u=D.getSqrtPriceX64FromTick(n),c=D.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Z.getAmountsFromLiquidity(D.priceToSqrtPriceX64(new N(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[ce(m.amountA,(b=t.mintA.extensions)==null?void 0:b.feeConfig,e,!0),ce(m.amountB,(k=t.mintB.extensions)==null?void 0:k.feeConfig,e,!0)],[y,f]=[ce(m.amountA.muln(l),(h=t.mintA.extensions)==null?void 0:h.feeConfig,e,!0),ce(m.amountB.muln(l),(A=t.mintB.extensions)==null?void 0:A.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ct(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new qe(u.id));(await tt(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=On.decode(u.data))});let s=t.map(u=>xe(new qe(u.programId),new qe(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>te($({},u),{[c.id]:te($({},n[c.id]),{id:new qe(c.id),version:6,programId:new qe(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:te($({},c.config),{id:new qe(c.config.id),fundOwner:""}),currentPrice:new N(c.price),exBitmapInfo:a[xe(new qe(c.programId),new qe(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var G=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(le)||(o=o.add(Oe)),o}static mulDivFloor(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(le))throw new Error("division by 0");return e.mul(t).add(n.sub(Oe)).div(n)}static x64ToDecimal(e,t){return new N(e.toString()).div(N.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new z(e.mul(N.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Jt).sub(t).mod(Jt)}};function ke(i,e){return Fn(i.mul(e),64,256)}function Jo(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Fn(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var D=class{static sqrtPriceX64ToPrice(e,t,n){return G.x64ToDecimal(e).pow(2).mul(N.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return G.decimalToX64(e.mul(N.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(le))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(le))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(le))return e;let o=t.shln(Lt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?G.mulDivCeil(s,e,a):G.mulDivRoundingUp(s,Oe,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return G.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Lt);if(r)return e.add(o.div(t));{let s=G.mulDivRoundingUp(o,Oe,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Be||e>Ie)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new z("18445821805675395072"):new z("18446744073709551616");return(t&2)!=0&&(n=ke(n,new z("18444899583751176192"))),(t&4)!=0&&(n=ke(n,new z("18443055278223355904"))),(t&8)!=0&&(n=ke(n,new z("18439367220385607680"))),(t&16)!=0&&(n=ke(n,new z("18431993317065453568"))),(t&32)!=0&&(n=ke(n,new z("18417254355718170624"))),(t&64)!=0&&(n=ke(n,new z("18387811781193609216"))),(t&128)!=0&&(n=ke(n,new z("18329067761203558400"))),(t&256)!=0&&(n=ke(n,new z("18212142134806163456"))),(t&512)!=0&&(n=ke(n,new z("17980523815641700352"))),(t&1024)!=0&&(n=ke(n,new z("17526086738831433728"))),(t&2048)!=0&&(n=ke(n,new z("16651378430235570176"))),(t&4096)!=0&&(n=ke(n,new z("15030750278694412288"))),(t&8192)!=0&&(n=ke(n,new z("12247334978884435968"))),(t&16384)!=0&&(n=ke(n,new z("8131365268886854656"))),(t&32768)!=0&&(n=ke(n,new z("3584323654725218816"))),(t&65536)!=0&&(n=ke(n,new z("696457651848324352"))),(t&131072)!=0&&(n=ke(n,new z("26294789957507116"))),(t&262144)!=0&&(n=ke(n,new z("37481735321082"))),e>0&&(n=Ii.div(n)),n}static getTickFromPrice(e,t,n){return D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ze)||e.lt(Xe))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new z(t-64),r=Jo(n,32,128),o=new z("8000000000000000","hex"),s=0,a=new z(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new z(0))&&s<xi;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new z(Si)),d=Fn(m.sub(new z(Ki)),64,128).toNumber(),p=Fn(m.add(new z(Ci)),64,128).toNumber();return d==p?d:D.getSqrtPriceX64FromTick(p).lte(e)?p:d}},pt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=pt.getTickWithPriceAndTickspacing(e,t,n,r),s=D.getSqrtPriceX64FromTick(o);return D.sqrtPriceX64ToPrice(s,n,r)}},Z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Lt),s=t.sub(e);return r?G.mulDivRoundingUp(G.mulDivCeil(o,s,t),Oe,e):G.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(le))throw new Error("sqrtPriceX64A must greater than 0");return r?G.mulDivCeil(n,t.sub(e),Ee):G.mulDivFloor(n,t.sub(e),Ee)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?G.mulDivRoundingUp(a,Oe,Sn):a.shrn(Lt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),G.mulDivFloor(n,Sn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Z.getLiquidityFromTokenAmountA(e,n,r,!1),a=Z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new z(0)};if(e.lt(n)){let s=Z.getTokenAmountAFromLiquidity(e,n,r,o),a=Z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new z(0),amountB:Z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=Z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new z(new N(u.toString()).mul(l).toFixed(0)),d=new z(new N(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var h,A,x,R;let c=D.priceToSqrtPriceX64(new N(e.price),e.mintA.decimals,e.mintB.decimals),l=D.getSqrtPriceX64FromTick(t),m=D.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=Z.getAmountsFromLiquidity(c,l,m,r,s),[y,f]=[ce(p.amountA,(h=e.mintA.extensions)==null?void 0:h.feeConfig,a,u),ce(p.amountB,(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,u)],[b,k]=[ce(new z(new N(p.amountA.toString()).mul(d).toFixed(0)),(x=e.mintA.extensions)==null?void 0:x.feeConfig,a,u),ce(new z(new N(p.amountB.toString()).mul(d).toFixed(0)),(R=e.mintB.extensions)==null?void 0:R.feeConfig,a,u)];return{liquidity:r,amountA:y,amountB:f,amountSlippageA:b,amountSlippageB:k,expirationTime:ct(y.expirationTime,f.expirationTime)}}},dt=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f=!1){if(d.eq(le))throw new Error("amountSpecified must not be 0");if(y||(y=s?Xe.add(Oe):ze.sub(Oe)),s){if(y.lt(Xe))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(ze))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let b=d.gt(le),k={amountSpecifiedRemaining:d,amountCalculated:le,sqrtPriceX64:m,tick:c>p?Math.min(p+Y.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new z(0)},h=p,A=n[p],x=0,R=!s&&A.startTickIndex===k.tick;for(;!k.amountSpecifiedRemaining.eq(le)&&!k.sqrtPriceX64.eq(y);){x>10;let T={};T.sqrtPriceStartX64=k.sqrtPriceX64;let E=C.nextInitTick(A,k.tick,l,s,R),K=E||null,H=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let W=ge.nextInitializedTickArrayStartIndex({tickCurrent:k.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},h,s);if(!W.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:k.amountSpecifiedRemaining,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts};throw Error("swapCompute LiquidityInsufficient")}h=W.nextStartIndex;let{publicKey:be}=J(e,t,h);H=be,A=n[h];try{K=C.firstInitializedTick(A,s)}catch{throw Error("not found next tick info")}}T.tickNext=K.tick,T.initialized=K.liquidityGross.gtn(0),p!==h&&H&&(k.accounts.push(H),p=h),T.tickNext<Be?T.tickNext=Be:T.tickNext>Ie&&(T.tickNext=Ie),T.sqrtPriceNextX64=D.getSqrtPriceX64FromTick(T.tickNext);let B;if(s&&T.sqrtPriceNextX64.lt(y)||!s&&T.sqrtPriceNextX64.gt(y)?B=y:B=T.sqrtPriceNextX64,[k.sqrtPriceX64,T.amountIn,T.amountOut,T.feeAmount]=dt.swapStepCompute(k.sqrtPriceX64,B,k.liquidity,k.amountSpecifiedRemaining,a),k.feeAmount=k.feeAmount.add(T.feeAmount),b?(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.sub(T.amountIn.add(T.feeAmount)),k.amountCalculated=k.amountCalculated.sub(T.amountOut)):(k.amountSpecifiedRemaining=k.amountSpecifiedRemaining.add(T.amountOut),k.amountCalculated=k.amountCalculated.add(T.amountIn.add(T.feeAmount))),k.sqrtPriceX64.eq(T.sqrtPriceNextX64)){if(T.initialized){let W=K.liquidityNet;s&&(W=W.mul(Je)),k.liquidity=Z.addDelta(k.liquidity,W)}R=T.tickNext!=k.tick&&!s&&A.startTickIndex===T.tickNext,k.tick=s?T.tickNext-1:T.tickNext}else if(k.sqrtPriceX64!=T.sqrtPriceStartX64){let W=D.getTickFromSqrtPriceX64(k.sqrtPriceX64);R=W!=k.tick&&!s&&A.startTickIndex===W,k.tick=W}++x}try{let{nextStartIndex:T,isExist:E}=Y.nextInitializedTickArray(k.tick,l,s,r,o);E&&p!==T&&(k.accounts.push(J(e,t,T).publicKey),p=T)}catch{}return{allTrade:!0,amountSpecifiedRemaining:le,amountCalculated:k.amountCalculated,feeAmount:k.feeAmount,sqrtPriceX64:k.sqrtPriceX64,liquidity:k.liquidity,tickCurrent:k.tick,accounts:k.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new z(0),amountIn:new z(0),amountOut:new z(0),feeAmount:new z(0)},a=e.gte(t),u=r.gte(le);if(u){let l=G.mulDivFloor(r,tn.sub(new z(o.toString())),tn);s.amountIn=a?Z.getTokenAmountAFromLiquidity(t,e,n,!0):Z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Z.getTokenAmountBFromLiquidity(t,e,n,!1):Z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(Je).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromOutput(e,n,r.mul(Je),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=Z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=Z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:Z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:Z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(Je))&&(s.amountOut=r.mul(Je)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=G.mulDivCeil(s.amountIn,new z(o),tn.sub(new z(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var fe=60,mt=512,C=class{static getTickArrayAddressByTick(e,t,n,r){let o=C.getTickArrayStartIndexByTick(n,r),{publicKey:s}=J(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=C.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=fe)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Y.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Y.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*fe,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*fe,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*fe:e+t*fe}static mergeTickArrayBitmap(e){let t=new $o(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*fe));return[...C.searchLowBitFromStart(e,t,s-1,o,n),...C.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return C.searchHightBitFromStart(e,t,0,mt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=C.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=J(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>C.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>C.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=Y.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Be||e>Ie}static nextInitTick(e,t,n,r,o){if(Y.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<fe;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=fe-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<fe;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new N(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new N(1).div(t),o=pt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new N(1).div(a)}}};var es=V([Te(8),X("bump"),lt("index"),S(""),At("protocolFeeRate"),At("tradeFeeRate"),lt("tickSpacing"),Q(g(),8,"")]),ts=V([At("blockTimestamp"),Ti("tickCumulative"),Q(g(),4)]),Vi=V([Te(8),Le("initialized"),g("recentEpoch"),lt("observationIndex"),S("poolId"),Q(ts,100,"observations"),Q(g(),4)]),ns=V([X("rewardState"),g("openTime"),g("endTime"),g("lastUpdateTime"),q("emissionsPerSecondX64"),g("rewardTotalEmissioned"),g("rewardClaimed"),S("tokenMint"),S("tokenVault"),S("creator"),q("rewardGrowthGlobalX64")]),On=V([Te(8),X("bump"),S("ammConfig"),S("creator"),S("mintA"),S("mintB"),S("vaultA"),S("vaultB"),S("observationId"),X("mintDecimalsA"),X("mintDecimalsB"),lt("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),we("tickCurrent"),At(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),g("protocolFeesTokenA"),g("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),X("status"),Q(X(),7,""),Q(ns,3,"rewardInfos"),Q(g(),16,"tickArrayBitmap"),g("totalFeesTokenA"),g("totalFeesClaimedTokenA"),g("totalFeesTokenB"),g("totalFeesClaimedTokenB"),g("fundFeesTokenA"),g("fundFeesTokenB"),g("startTime"),Q(g(),15*4-3,"padding")]),is=V([q("growthInsideLastX64"),g("rewardAmountOwed")]),En=V([Te(8),X("bump"),S("nftMint"),S("poolId"),we("tickLower"),we("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Q(is,3,"rewardInfos"),Q(g(),8,"")]),Ud=V([Te(8),X("bump"),S("poolId"),we("tickLowerIndex"),we("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),g("tokenFeesOwedA"),g("tokenFeesOwedB"),Q(q(),3,"rewardGrowthInside"),Q(g(),8,"")]),rs=V([we("tick"),Bi("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),Q(q(),3,"rewardGrowthsOutsideX64"),Q(At(),13,"")]),Ot=V([Te(8),S("poolId"),we("startTickIndex"),Q(rs,fe,"ticks"),X("initializedTickCount"),Q(X(),115,"")]),os=V([Te(329),Q(S(),100,"whitelistMints")]),vi=V([Te(8),S("poolId"),Q(Q(g(),8),Mn,"positiveTickArrayBitmap"),Q(Q(g(),8),Mn,"negativeTickArrayBitmap")]),Xd=V([g(),X("bump"),S("owner"),S("poolId"),S("positionId"),S("nftAccount"),Q(g(),8)]),zd=V([Te(8),X("bump"),S("lockOwner"),S("poolId"),S("positionId"),S("nftAccount"),S("lockNftMint"),g("recentEpoch"),Q(g(),8)]);Vi.span;var Di=de("Raydium_Clmm"),Ge={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},qi=[188,37,179,131,82,150,84,73],Gi=[16,72,250,198,14,162,212,19],bt=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y){let f=V([q("sqrtPriceX64"),g("startTime")]),b=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],k=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},k);let h=Buffer.from([...Ge.createPool,...k]);return new Se({keys:b,programId:e,data:h})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new I(r.address),new I(o.address)],{publicKey:m}=Mi(t,s,c,l),{publicKey:d}=Ei(t,m),{publicKey:p}=Nn(t,m,c),{publicKey:y}=Nn(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new I(r.programId||oe),l,y,new I(o.programId||oe),xe(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[ie.CreateAccount,ie.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,h,A,x,R,T,E,K,H,B){let W=V([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),q("liquidity"),g("amountMaxA"),g("amountMaxB"),Le("withMetadata"),X("optionBaseFlag"),Le("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...be],Ke=Buffer.alloc(W.span);W.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:R,liquidity:T,amountMaxA:E,amountMaxB:K,withMetadata:H==="create",baseFlag:!1,optionBaseFlag:0},Ke);let ae=Buffer.from([...Ge.openPosition,...Ke]);return new Se({keys:me,programId:e,data:ae})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],y;if(l)y=new I((await l(1))[0]);else{let K=on.generate();m.push(K),y=K.publicKey}let f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=J(d,p,f),{publicKey:h}=J(d,p,b),{publicKey:A}=Ne(n.wallet,y,oe),{publicKey:x}=ht(y),{publicKey:R}=Re(d,y),{publicKey:T}=$e(d,p,r,o),E=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,A,x,T,k,h,R,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,f,b,s,a,u,c);return{signers:m,instructions:[E],instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:R,protocolPosition:T}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],y;if(l)y=new I((await l(1))[0]);else{let K=on.generate();m.push(K),y=K.publicKey}let f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=J(d,p,f),{publicKey:h}=J(d,p,b),{publicKey:A}=Ne(n.wallet,y,oe),{publicKey:x}=ht(y),{publicKey:R}=Re(d,y),{publicKey:T}=$e(d,p,r,o),E=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,A,x,T,k,h,R,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,f,b,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?xe(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:R,protocolPosition:T},instructions:[E],signers:m,instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,h,A,x,R,T,E,K,H,B){let W=V([we("tickLowerIndex"),we("tickUpperIndex"),we("tickArrayLowerStartIndex"),we("tickArrayUpperStartIndex"),q("liquidity"),g("amountMaxA"),g("amountMaxB"),Le("withMetadata"),X("optionBaseFlag"),Le("baseFlag")]),be=[...B?[{pubkey:B,isSigner:!1,isWritable:!0}]:[]],me=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},...be],Ke=Buffer.alloc(W.span);W.encode({tickLowerIndex:h,tickUpperIndex:A,tickArrayLowerStartIndex:x,tickArrayUpperStartIndex:R,liquidity:new _i(0),amountMaxA:E==="MintA"?K:H,amountMaxB:E==="MintA"?H:K,withMetadata:T==="create",baseFlag:E==="MintA",optionBaseFlag:1},Ke);let ae=Buffer.from([...Ge.openPosition,...Ke]);return new Se({keys:me,programId:e,data:ae})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let K=on.generate();d.push(K),m=K.publicKey}let[p,y]=[new I(e.programId),new I(e.id)],f=C.getTickArrayStartIndexByTick(r,e.config.tickSpacing),b=C.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:k}=J(p,y,f),{publicKey:h}=J(p,y,b),{publicKey:A}=Ne(n.wallet,m,oe),{publicKey:x}=ht(m),{publicKey:R}=Re(p,m),{publicKey:T}=$e(p,y,r,o),E=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,A,x,T,k,h,R,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,f,b,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,b])?xe(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:k,tickArrayUpper:h,positionNftAccount:A,metadataAccount:x,personalPosition:R,protocolPosition:T},instructions:[E],signers:d,instructionTypes:[ie.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=V([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...Ge.closePosition,...u]);return new Se({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=Ne(n.wallet,r.nftMint,oe),{publicKey:a}=Re(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[ie.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,h){let A=V([q("liquidity"),g("amountMaxA"),g("amountMaxB"),X("optionBaseFlag"),Le("baseFlag")]),x=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],R=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...x],T=Buffer.alloc(A.span);A.encode({liquidity:f,amountMaxA:b,amountMaxB:k,optionBaseFlag:0,baseFlag:!1},T);let E=Buffer.from([...Ge.increaseLiquidity,...T]);return new Se({keys:R,programId:e,data:E})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new I(e.programId),new I(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(u,c,l),{publicKey:p}=J(u,c,m),{publicKey:y}=Ne(r.wallet,n.nftMint,oe),{publicKey:f}=Re(u,n.nftMint),{publicKey:b}=$e(u,c,n.tickLower,n.tickUpper),k=this.increasePositionFromLiquidityInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?xe(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},signers:[],instructions:[k],instructionTypes:[ie.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new I(e.programId),new I(e.id)],l=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=J(u,c,l),{publicKey:p}=J(u,c,m),{publicKey:y}=Ne(r.wallet,n.nftMint,oe),{publicKey:f}=Re(u,n.nftMint),{publicKey:b}=$e(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:b},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,y,f,c,b,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?xe(u,c).publicKey:void 0)],signers:[],instructionTypes:[ie.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,h){let A=V([q("liquidity"),g("amountMaxA"),g("amountMaxB"),X("optionBaseFlag"),Le("baseFlag")]),x=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[]],R=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...x],T=Buffer.alloc(A.span);A.encode({liquidity:new _i(0),amountMaxA:f==="MintA"?b:k,amountMaxB:f==="MintA"?k:b,baseFlag:f==="MintA",optionBaseFlag:1},T);let E=Buffer.from([...Ge.increaseLiquidity,...T]);return new Se({keys:R,programId:e,data:E})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k,h,A){let x=V([q("liquidity"),g("amountMinA"),g("amountMinB")]),R=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...f.map(H=>[{pubkey:H.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:H.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:H.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...R],E=Buffer.alloc(x.span);x.encode({liquidity:b,amountMinA:k,amountMinB:h},E);let K=Buffer.from([...Ge.decreaseLiquidity,...E]);return new Se({keys:T,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new I(e.programId),new I(e.id)],m=C.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=C.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=J(c,l,m),{publicKey:y}=J(c,l,d),{publicKey:f}=Ne(r.wallet,n.nftMint,u),{publicKey:b}=Re(c,n.nftMint),{publicKey:k}=$e(c,l,n.tickLower,n.tickUpper),h=[];for(let R=0;R<e.rewardDefaultInfos.length;R++)h.push({poolRewardVault:new I(t.rewardInfos[R].vault),ownerRewardVault:r.rewardAccounts[R],rewardMint:new I(e.rewardDefaultInfos[R].mint.address)});let A=[],x=this.decreaseLiquidityInstruction(c,r.wallet,f,b,l,k,p,y,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),h,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?xe(c,l).publicKey:void 0);return A.push(x),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:b,protocolPosition:k},signers:[],instructions:A,instructionTypes:[ie.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,p,y,f,b,k){let h=V([g("amount"),g("otherAmountThreshold"),q("sqrtPriceLimitX64"),Le("isBaseInput")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[],...m.map(E=>({pubkey:E,isSigner:!1,isWritable:!0}))],x=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...A],R=Buffer.alloc(h.span);h.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:b},R);let T=Buffer.from([...Ge.swap,...R]);return new Se({keys:x,programId:e,data:T})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[y,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toString(),k=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),b?r.tokenAccountA:r.tokenAccountB,b?r.tokenAccountB:r.tokenAccountA,b?d:p,b?p:d,b?y:f,b?f:y,c,n,s,a,u,!0,xe(l,m).publicKey)];return{signers:[],instructions:k,instructionTypes:[ie.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[y,f]=[new I(e.mintA.address),new I(e.mintB.address)],b=e.mintA.address===o.toBase58(),k=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),b?r.tokenAccountB:r.tokenAccountA,b?r.tokenAccountA:r.tokenAccountB,b?p:d,b?d:p,b?f:y,b?y:f,c,n,s,a,u,!1,xe(l,m).publicKey)];return{signers:[],instructions:k,instructionTypes:[ie.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=V([g("openTime"),g("endTime"),q("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:ue(l),endTime:ue(m),emissionsPerSecondX64:d},f);let b=Buffer.from([...Ge.initReward,...f]);return new Se({keys:y,programId:e,data:b})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=Oi(o,s,r.mint).publicKey,u=rn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[ie.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let p=V([X("rewardIndex"),q("emissionsPerSecondX64"),g("openTime"),g("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:ue(l),endTime:ue(m)},f);let b=Buffer.from([...Ge.setRewardEmissions,...f]);return new Se({keys:y,programId:e,data:b})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new I(t.rewardInfos[d].vault),c=new I(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Di.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=rn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[ie.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=V([X("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Qt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...Ge.collectReward,...l]);return new Se({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new I(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Di.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[ie.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let u=[],c;if(a)c=new I((await a(1))[0]);else{let b=on.generate();u.push(b),c=b.publicKey}let{publicKey:l}=Ne(o,s,oe),{publicKey:m}=Re(n,s),d=Rn(e,c).publicKey,p=Ne(o,c,oe).publicKey,y=ht(c).publicKey,f=bt.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:c,lockNftAccount:p,metadataAccount:y,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:p,lockNftMint:c,positionNftAccount:l,metadataAccount:y},instructions:[f],signers:u,instructionTypes:[ie.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:u,lockNftMint:c,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let p=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ut,isSigner:!1,isWritable:!1},{pubkey:Wn,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1}],y=V([Le("withMetadata")]),f=Buffer.alloc(y.span);y.encode({withMetadata:d},f);let b=Buffer.from([...qi,...f]);return new Se({keys:p,programId:e,data:b})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Ne(r,o,oe),{publicKey:a}=Re(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Ln(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:ft.programId,isSigner:!1,isWritable:!1}];return new Se({keys:u,programId:e,data:Buffer.from(qi)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=C.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=C.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=J(t,n,r),{publicKey:a}=J(t,n,o),{publicKey:u}=Ne(e.owner,e.ownerPosition.nftMint,oe),{publicKey:c}=Re(t,e.ownerPosition.nftMint),{publicKey:l}=$e(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new I(e.poolKeys.rewardInfos[y].mint.address)});let d=[...m.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Ln(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Se({keys:p,programId:e.programId,data:Buffer.from(Gi)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:y,tickArrayUpper:f,userVaultA:b,userVaultB:k,mintA:h,mintB:A,rewardAccounts:x,exTickArrayBitmap:R}){let T=[...R?[{pubkey:R,isSigner:!1,isWritable:!0}]:[],...x.map(K=>[{pubkey:K.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.rewardMint,isSigner:!1,isWritable:!1}]).flat()],E=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:k,isSigner:!1,isWritable:!0},{pubkey:oe,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Pt,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},...T];return new Se({keys:E,programId:e,data:Buffer.from(Gi)})}};import{PublicKey as yf,SystemProgram as gf,SYSVAR_RENT_PUBKEY as kf,TransactionInstruction as Xi}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as wf,TOKEN_PROGRAM_ID as zi}from"@solana/spl-token";var vn=V([X("instruction"),g("amountIn"),g("minAmountOut")]),Vn=V([X("instruction"),g("maxAmountIn"),g("amountOut")]),of=V([X("instruction"),X("nonce")]),ss=V([X("instruction"),X("nonce"),g("startTime")]),sf=V([g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalValue"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),g("swapBase2QuoteFee"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),g("swapQuote2BaseFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("withdrawQueue"),S("lpVault"),S("owner"),g("lpReserve"),Q(g(),3,"padding")]),af=V([g("accountType"),g("status"),g("nonce"),g("maxOrder"),g("depth"),g("baseDecimal"),g("quoteDecimal"),g("state"),g("resetFlag"),g("minSize"),g("volMaxCutRatio"),g("amountWaveRatio"),g("baseLotSize"),g("quoteLotSize"),g("minPriceMultiplier"),g("maxPriceMultiplier"),g("systemDecimalsValue"),g("abortTradeFactor"),g("priceTickMultiplier"),g("priceTick"),g("minSeparateNumerator"),g("minSeparateDenominator"),g("tradeFeeNumerator"),g("tradeFeeDenominator"),g("pnlNumerator"),g("pnlDenominator"),g("swapFeeNumerator"),g("swapFeeDenominator"),g("baseNeedTakePnl"),g("quoteNeedTakePnl"),g("quoteTotalPnl"),g("baseTotalPnl"),g("poolOpenTime"),g("punishPcAmount"),g("punishCoinAmount"),g("orderbookToInitTime"),q("swapBaseInAmount"),q("swapQuoteOutAmount"),q("swapQuoteInAmount"),q("swapBaseOutAmount"),g("swapQuote2BaseFee"),g("swapBase2QuoteFee"),S("baseVault"),S("quoteVault"),S("baseMint"),S("quoteMint"),S("lpMint"),S("modelDataAccount"),S("openOrders"),S("marketId"),S("marketProgramId"),S("targetOrders"),S("owner"),Q(g(),64,"padding")]),as=V([X("instruction"),g("baseAmountIn"),g("quoteAmountIn"),g("fixedSide"),g("otherAmountMin")]),us=V([X("instruction"),g("lpAmount"),g("baseAmountMin"),g("quoteAmountMin")]);var uf=V([g("fee")]);import{PublicKey as cs}from"@solana/web3.js";var _n=new cs("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),ls=5e4,ms=V([g("x"),g("y"),g("price")]),pf=V([g("accountType"),g("status"),g("multiplier"),g("validDataCount"),Q(ms,ls,"DataElement")]);var Ui=de("Raydium_liquidity_instruction");function ds({poolKeys:i,userKeys:e,amountIn:t,minAmountOut:n},r){let o=Me(i),s=Buffer.alloc(vn.span);vn.encode({instruction:9,amountIn:ue(t),minAmountOut:ue(n)},s);let a=[w({pubkey:zi,isWritable:!1}),w({pubkey:o.id}),w({pubkey:o.authority,isWritable:!1}),w({pubkey:o.openOrders})];return r===4&&a.push(w({pubkey:o.targetOrders})),a.push(w({pubkey:o.vault.A}),w({pubkey:o.vault.B})),r===5&&a.push(w({pubkey:_n})),a.push(w({pubkey:o.marketProgramId,isWritable:!1}),w({pubkey:o.marketId}),w({pubkey:o.marketBids}),w({pubkey:o.marketAsks}),w({pubkey:o.marketEventQueue}),w({pubkey:o.marketBaseVault}),w({pubkey:o.marketQuoteVault}),w({pubkey:o.marketAuthority,isWritable:!1}),w({pubkey:e.tokenAccountIn}),w({pubkey:e.tokenAccountOut}),w({pubkey:e.owner,isWritable:!1})),new Xi({programId:o.programId,keys:a,data:s})}function ps({poolKeys:i,userKeys:e,maxAmountIn:t,amountOut:n},r){let o=Me(i),s=Buffer.alloc(Vn.span);Vn.encode({instruction:11,maxAmountIn:ue(t),amountOut:ue(n)},s);let a=[w({pubkey:zi,isWritable:!1}),w({pubkey:o.id}),w({pubkey:o.authority,isWritable:!1}),w({pubkey:o.openOrders}),w({pubkey:o.targetOrders}),w({pubkey:o.vault.A}),w({pubkey:o.vault.B})];return r===5&&a.push(w({pubkey:_n})),a.push(w({pubkey:o.marketProgramId,isWritable:!1}),w({pubkey:o.marketId}),w({pubkey:o.marketBids}),w({pubkey:o.marketAsks}),w({pubkey:o.marketEventQueue}),w({pubkey:o.marketBaseVault}),w({pubkey:o.marketQuoteVault}),w({pubkey:o.marketAuthority,isWritable:!1}),w({pubkey:e.tokenAccountIn}),w({pubkey:e.tokenAccountOut}),w({pubkey:e.owner,isWritable:!1,isSigner:!0})),new Xi({programId:o.programId,keys:a,data:s})}function Hi(i){let{poolKeys:e,version:t,userKeys:n,amountIn:r,amountOut:o,fixedSide:s}=i;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return ds(te($({},a),{amountIn:r,minAmountOut:o}),t);if(s==="out")return ps(te($({},a),{maxAmountIn:r,amountOut:o}),t);Ui.logWithError("invalid params","params",i)}throw Ui.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}var Rf=V([Te(8),X("bump"),Le("disableCreatePool"),lt("index"),g("tradeFeeRate"),g("protocolFeeRate"),g("fundFeeRate"),g("createPoolFee"),S("protocolOwner"),S("fundOwner"),Q(g(),16)]),Mf=V([Te(8),S("configId"),S("poolCreator"),S("vaultA"),S("vaultB"),S("mintLp"),S("mintA"),S("mintB"),S("mintProgramA"),S("mintProgramB"),S("observationId"),X("bump"),X("status"),X("lpDecimals"),X("mintDecimalA"),X("mintDecimalB"),g("lpAmount"),g("protocolFeesMintA"),g("protocolFeesMintB"),g("fundFeesMintA"),g("fundFeesMintB"),g("openTime"),Q(g(),32)]);import{PublicKey as Qf,TransactionInstruction as fs,Keypair as Zf,SystemProgram as jf}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as $f,TOKEN_2022_PROGRAM_ID as eb,TOKEN_PROGRAM_ID as tb}from"@solana/spl-token";var Ff=Buffer.from("vault_and_lp_mint_auth_seed","utf8"),Wf=Buffer.from("amm_config","utf8"),vf=Buffer.from("pool","utf8"),Vf=Buffer.from("pool_lp_mint","utf8"),_f=Buffer.from("pool_vault","utf8"),Df=Buffer.from("observation","utf8");var qf=Buffer.from("locked_liquidity","utf8");var ab=de("Raydium_cpmm"),bs={initialize:[175,175,109,31,13,152,155,237],deposit:[242,35,198,137,82,225,242,182],withdraw:[183,18,70,156,148,109,161,34],swapBaseInput:[143,190,90,218,196,30,51,222],swapBaseOutput:[55,217,98,86,163,74,180,173],lockCpLiquidity:[216,157,29,78,38,51,31,26],collectCpFee:[8,30,51,199,209,184,247,133]};function Qi(i,e,t,n,r,o,s,a,u,c,l,m,d,p,y,f){let b=V([g("amountIn"),g("amounOutMin")]),k=[{pubkey:e,isSigner:!0,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!0}],h=Buffer.alloc(b.span);return b.encode({amountIn:y,amounOutMin:f},h),new fs({keys:k,programId:i,data:Buffer.from([...bs.swapBaseInput,...h])})}import hb from"bn.js";import Bb from"decimal.js-light";import ys from"bn.js";var pb=new ys(0);import gs from"bn.js";var gb=new gs(1e6);function zb(i,e,t,n,r,o,s,a,u,c,l,m){let d=V([X("instruction"),g("amountIn"),g("amountOut")]),p=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new L(t.programId),isSigner:!1,isWritable:!1},{pubkey:new L(t.id),isSigner:!1,isWritable:!0},{pubkey:new L(n.id),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let f=Me(t);p.push({pubkey:f.config.id,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.A:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.mintA.address.equals(u)?f.vault.B:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},...m.map(b=>({pubkey:b,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let f=Me(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0})}else{let f=Me(t);p.push({pubkey:f.authority,isSigner:!1,isWritable:!1},{pubkey:f.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:f.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:f.openOrders,isSigner:!1,isWritable:!0},{pubkey:f.vault.A,isSigner:!1,isWritable:!0},{pubkey:f.vault.B,isSigner:!1,isWritable:!0},{pubkey:f.marketId,isSigner:!1,isWritable:!0},{pubkey:f.marketBids,isSigner:!1,isWritable:!0},{pubkey:f.marketAsks,isSigner:!1,isWritable:!0},{pubkey:f.marketEventQueue,isSigner:!1,isWritable:!0},...f.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:f.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:f.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:f.id,isSigner:!1,isWritable:!0},{pubkey:f.id,isSigner:!1,isWritable:!0}])}let y=Buffer.alloc(d.span);return d.encode({instruction:4,amountIn:c,amountOut:l},y),new qn({keys:p,programId:i,data:y})}function Hb(i,e,t,n,r,o,s,a,u,c){let l=V([X("instruction")]),m=[{pubkey:Dn.programId,isSigner:!1,isWritable:!1},{pubkey:Gn,isSigner:!1,isWritable:!1},{pubkey:new L(String(n.programId)),isSigner:!1,isWritable:!1},{pubkey:new L(String(n.id)),isSigner:!1,isWritable:!0},{pubkey:new L(String(t.id)),isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!0,isWritable:!1}];if(e.type==="Concentrated"){let p=Me(n);m.push({pubkey:p.config.id,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.A:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.mintA.address.equals(u)?p.vault.B:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},...c.map(y=>({pubkey:y,isSigner:!1,isWritable:!0})))}else if(e.pooltype.includes("StablePool")){let p=Me(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:new L("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0})}else{let p=Me(n);m.push({pubkey:p.authority,isSigner:!1,isWritable:!1},{pubkey:p.marketProgramId,isSigner:!1,isWritable:!1},{pubkey:p.marketAuthority,isSigner:!1,isWritable:!1},{pubkey:p.openOrders,isSigner:!1,isWritable:!0},{pubkey:p.vault.A,isSigner:!1,isWritable:!0},{pubkey:p.vault.B,isSigner:!1,isWritable:!0},{pubkey:p.marketId,isSigner:!1,isWritable:!0},{pubkey:p.marketBids,isSigner:!1,isWritable:!0},{pubkey:p.marketAsks,isSigner:!1,isWritable:!0},{pubkey:p.marketEventQueue,isSigner:!1,isWritable:!0},...p.marketProgramId.toString()==="srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"?[{pubkey:p.marketBaseVault,isSigner:!1,isWritable:!0},{pubkey:p.marketQuoteVault,isSigner:!1,isWritable:!0}]:[{pubkey:p.id,isSigner:!1,isWritable:!0},{pubkey:p.id,isSigner:!1,isWritable:!0}])}let d=Buffer.alloc(l.span);return l.encode({instruction:5},d),new qn({keys:m,programId:i,data:d})}function ws(i,e,t,n,r,o,s,a,u,c,l,m,d,p,y){var T;let f=[],b=[w({pubkey:Gn,isWritable:!1}),w({pubkey:Ps,isWritable:!1}),w({pubkey:ks,isWritable:!1}),w({pubkey:Dn.programId,isWritable:!1}),w({pubkey:e,isSigner:!0})];b.push(w({pubkey:t})),b.push(w({pubkey:r}));let k=[u,c],h=[l,m],A=[o,s,a];for(let E=0;E<k.length;E++){let K=k[E],H=A[E]===K.mintA.address;if(b.push(w({pubkey:new L(K.programId),isWritable:!1})),E===k.length-1?b.push(w({pubkey:r})):b.push(w({pubkey:n})),b.push(w({pubkey:new L(A[E])})),b.push(w({pubkey:new L(A[E+1])})),K.version===6){let B=h[E];b.push(w({pubkey:new L(B.config.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(H?B.vault.A:B.vault.B)})),b.push(w({pubkey:new L(H?B.vault.B:B.vault.A)})),b.push(w({pubkey:new L(K.observationId)})),b.push(w({pubkey:Pt})),b.push(w({pubkey:xe(new L(K.programId),new L(K.id)).publicKey})),f.push(As(K.sqrtPriceX64.toString(),H));for(let W of(T=y[E])!=null?T:[])b.push(w({pubkey:new L(W)}))}else if(K.version===5){let B=h[E];b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.authority),isWritable:!1})),b.push(w({pubkey:new L(B.marketProgramId)})),b.push(w({pubkey:new L(B.marketAuthority)})),b.push(w({pubkey:yi,isWritable:!1})),b.push(w({pubkey:new L(B.openOrders)})),b.push(w({pubkey:new L(B.vault.A)})),b.push(w({pubkey:new L(B.vault.B)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.marketId)})),b.push(w({pubkey:new L(B.marketBids)})),b.push(w({pubkey:new L(B.marketAsks)})),b.push(w({pubkey:new L(B.marketEventQueue)})),b.push(w({pubkey:new L(B.marketBaseVault)})),b.push(w({pubkey:new L(B.marketQuoteVault)}))}else if(K.version===4){let B=h[E],W=K.status!==1;b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(B.authority),isWritable:!1})),b.push(w({pubkey:new L(W?B.id:B.marketProgramId)})),b.push(w({pubkey:new L(W?B.id:B.marketAuthority)})),b.push(w({pubkey:new L(W?B.id:B.openOrders)})),b.push(w({pubkey:new L(B.vault.A)})),b.push(w({pubkey:new L(B.vault.B)})),b.push(w({pubkey:new L(W?B.id:B.marketId)})),b.push(w({pubkey:new L(W?B.id:B.marketBids)})),b.push(w({pubkey:new L(W?B.id:B.marketAsks)})),b.push(w({pubkey:new L(W?B.id:B.marketEventQueue)})),b.push(w({pubkey:new L(W?B.id:B.marketBaseVault)})),b.push(w({pubkey:new L(W?B.id:B.marketQuoteVault)}))}else if(K.version===7){let B=h[E];b.push(w({pubkey:new L(B.authority)})),b.push(w({pubkey:new L(B.config.id)})),b.push(w({pubkey:new L(B.id)})),b.push(w({pubkey:new L(H?B.vault.A:B.vault.B)})),b.push(w({pubkey:new L(H?B.vault.B:B.vault.A)})),b.push(w({pubkey:new L(K.observationId)}))}else throw Error("pool type error")}let x=V([X("insId"),g("amountIn"),g("amountOut"),Q(q(),f.length,"clmmPriceLimit")]),R=Buffer.alloc(x.span);return x.encode({insId:0,amountIn:d,amountOut:p,clmmPriceLimit:f},R),new qn({keys:b,programId:i,data:R})}function As(i,e){if(i)if(e){let t=new yt(i).div(new yt(25));return t.gt($t)?t:$t}else{let t=new yt(i).mul(new yt(25));return t.lt(en)?t:en}else return e?$t:en}function Qb({routeProgram:i,ownerInfo:e,inputMint:t,swapInfo:n}){var r,o,s,a,u,c,l;if(n.routeType==="amm")if(n.poolInfo[0].version===6){let m=n.poolKey[0],d=Me(m),p=t.equals(d.mintA.address)?Xe.add(Oe):ze.sub(Oe);return bt.makeSwapBaseInInstructions({poolInfo:m,poolKeys:m,observationId:n.poolInfo[0].observationId,ownerInfo:{wallet:e.wallet,tokenAccountA:d.mintA.address.equals(t)?e.sourceToken:e.destinationToken,tokenAccountB:d.mintA.address.equals(t)?e.destinationToken:e.sourceToken},inputMint:t,amountIn:n.amountIn.amount.raw,amountOutMin:n.minAmountOut.amount.raw.sub((o=(r=n.minAmountOut.fee)==null?void 0:r.raw)!=null?o:new yt(0)),sqrtPriceLimitX64:p,remainingAccounts:(s=n.remainingAccounts[0])!=null?s:[]})}else if(n.poolInfo[0].version===7){let m=n.poolInfo[0],d=t.toString()===n.poolInfo[0].mintA.address;return{signers:[],instructions:[Qi(m.programId,e.wallet,m.authority,m.configId,m.id,e.sourceToken,e.destinationToken,d?m.vaultA:m.vaultB,d?m.vaultB:m.vaultA,d?m.mintProgramA:m.mintProgramB,d?m.mintProgramB:m.mintProgramA,new L(m[d?"mintA":"mintB"].address),new L(m[d?"mintB":"mintA"].address),m.observationId,n.amountIn.amount.raw,n.minAmountOut.amount.raw)],lookupTableAddress:[],instructionTypes:[d?ie.CpmmSwapBaseIn:ie.CpmmSwapBaseOut],address:{}}}else{let m=n.poolKey[0];return{signers:[],instructions:[Hi({poolKeys:m,version:n.poolInfo[0].pooltype.includes("StablePool")?5:4,userKeys:{tokenAccountIn:e.sourceToken,tokenAccountOut:e.destinationToken,owner:e.wallet},amountIn:n.amountIn.amount.raw,amountOut:n.minAmountOut.amount.raw.sub((u=(a=n.minAmountOut.fee)==null?void 0:a.raw)!=null?u:new yt(0)),fixedSide:"in"})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.poolInfo[0].pooltype.includes("StablePool")?ie.AmmV5SwapBaseIn:ie.AmmV4SwapBaseIn],address:{}}}else if(n.routeType==="route"){let m=n.poolInfo[0],d=n.poolInfo[1],p=n.poolKey[0],y=n.poolKey[1];if(e.routeToken===void 0)throw Error("owner route token account check error");return{signers:[],instructions:[ws(i,e.wallet,e.sourceToken,e.routeToken,e.destinationToken,t.toString(),n.middleToken.mint.toString(),n.outputMint.toString(),m,d,p,y,n.amountIn.amount.raw,n.minAmountOut.amount.raw.sub((l=(c=n.minAmountOut.fee)==null?void 0:c.raw)!=null?l:new yt(0)),n.remainingAccounts)],instructionTypes:[ie.RouteSwap],lookupTableAddress:[p.lookupTableAccount,y.lookupTableAccount].filter(f=>f!==void 0),address:{}}}else throw Error("route type error")}export{Qb as makeSwapInstruction,zb as route1Instruction,Hb as route2Instruction,ws as routeInstruction};
//# sourceMappingURL=instrument.mjs.map