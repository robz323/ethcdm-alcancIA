var mn=Object.defineProperty,dn=Object.defineProperties;var pn=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var St=Object.prototype.hasOwnProperty,Lt=Object.prototype.propertyIsEnumerable;var At=(e,t,n)=>t in e?mn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,H=(e,t)=>{for(var n in t||(t={}))St.call(t,n)&&At(e,n,t[n]);if(Me)for(var n of Me(t))Lt.call(t,n)&&At(e,n,t[n]);return e},oe=(e,t)=>dn(e,pn(t));var De=(e,t)=>{var n={};for(var r in e)St.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Me)for(var r of Me(e))t.indexOf(r)<0&&Lt.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Ur,Transaction as xt,TransactionInstruction as qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gr}from"@solana/spl-token";import ln from"bn.js";import{PublicKey as bn}from"@solana/web3.js";import{get as Bt,set as gn}from"lodash";var Xe=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},Ct={},hn={};function j(e){let t=Bt(Ct,e);if(!t){let n=Bt(hn,e);t=new Xe({name:e,logLevel:n}),gn(Ct,e,t)}return t}import{MINT_SIZE as ti,TOKEN_PROGRAM_ID as ni,getTransferFeeConfig as ri,unpackMint as ii}from"@solana/spl-token";var $e=j("Raydium_accountInfo_util");async function Re(e,t,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=H({batchRequest:!1},n),s=et(t,o),a=new Array(s.length).fill([]);if(r){let u=s.map(f=>{let m=e._buildArgs([f.map(d=>d.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=et(u,10);a=(await(await Promise.all(c.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:d,executable:y,lamports:g,owner:w,rentEpoch:T}=m;return d.length!==2&&d[1]!=="base64"&&$e.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(d[0],"base64"),executable:y,lamports:g,owner:new bn(w),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(u=>e.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&$e.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}import ne from"bn.js";var de=9e15,ce=1e9,nt="0123456789abcdef",_e="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Fe="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",rt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-de,maxE:de,crypto:!1},Et,ee,B=!0,Ke="[DecimalError] ",ue=Ke+"Invalid argument: ",Mt=Ke+"Precision limit exceeded",Dt=Ke+"crypto unavailable",Rt="[object Decimal]",q=Math.floor,W=Math.pow,yn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,wn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Tn=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Ot=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,J=1e7,S=7,Pn=9007199254740991,xn=_e.length-1,it=Fe.length-1,p={toStringTag:Rt};p.absoluteValue=p.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),x(e)};p.ceil=function(){return x(new this.constructor(this),this.e+1,2)};p.clampedTo=p.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(ue+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};p.comparedTo=p.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,u=o.s,c=e.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==e.e)return o.e>e.e^u<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1};p.cosine=p.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+S,r.rounding=1,n=An(r,Vt(r,n)),r.precision=e,r.rounding=t,x(ee==2||ee==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};p.cubeRoot=p.cbrt=function(){var e,t,n,r,i,o,s,a,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(B=!1,o=l.s*W(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=U(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=W(n,1/3),e=q((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(l),r=M(c.plus(l).times(a),c.plus(u),s+2,1),U(a.d).slice(0,s)===(n=U(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(x(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(x(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return B=!0,x(r,e,f.rounding,t)};p.decimalPlaces=p.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-q(this.e/S))*S,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};p.dividedBy=p.div=function(e){return M(this,new this.constructor(e))};p.dividedToIntegerBy=p.divToInt=function(e){var t=this,n=t.constructor;return x(M(t,new n(e),0,1,1),n.precision,n.rounding)};p.equals=p.eq=function(e){return this.cmp(e)===0};p.floor=function(){return x(new this.constructor(this),this.e+1,3)};p.greaterThan=p.gt=function(e){return this.cmp(e)>0};p.greaterThanOrEqualTo=p.gte=function(e){var t=this.cmp(e);return t==1||t===0};p.hyperbolicCosine=p.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/We(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=pe(s,1,o.times(t),new s(1),!0);for(var u,c=e,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return x(o,s.precision=n,s.rounding=r,!0)};p.hyperbolicSine=p.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=pe(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/We(5,e)),i=pe(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=t,o.rounding=n,x(i,t,n,!0)};p.hyperbolicTangent=p.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,M(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};p.inverseCosine=p.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Z(n,i,o):new n(0):new n(NaN):t.isZero()?Z(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Z(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};p.inverseHyperbolicCosine=p.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,B=!1,n=n.times(n).minus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};p.inverseHyperbolicSine=p.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,B=!1,n=n.times(n).plus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln())};p.inverseHyperbolicTangent=p.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?x(new o(i),e,t,!0):(o.precision=n=r-i.e,i=M(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};p.inverseSine=p.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Z(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};p.inverseTangent=p.atan=function(){var e,t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=it)return s=Z(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=it)return s=Z(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/S+2|0),e=n;e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(B=!1,t=Math.ceil(a/S),r=1,u=c.times(c),s=new l(c),i=c;e!==-1;)if(i=i.times(u),o=s.minus(i.div(r+=2)),i=i.times(u),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),B=!0,x(s,l.precision=f,l.rounding=m,!0)};p.isFinite=function(){return!!this.d};p.isInteger=p.isInt=function(){return!!this.d&&q(this.e/S)>this.d.length-2};p.isNaN=function(){return!this.s};p.isNegative=p.isNeg=function(){return this.s<0};p.isPositive=p.isPos=function(){return this.s>0};p.isZero=function(){return!!this.d&&this.d[0]===0};p.lessThan=p.lt=function(e){return this.cmp(e)<0};p.lessThanOrEqualTo=p.lte=function(e){return this.cmp(e)<1};p.logarithm=p.log=function(e){var t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding,d=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new l(n&&!n[0]?-1/0:c.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(B=!1,a=f+d,s=ae(c,a),r=t?ve(l,a+10):ae(e,a),u=M(s,r,a,1),we(u.d,i=f,m))do if(a+=10,s=ae(c,a),r=t?ve(l,a+10):ae(e,a),u=M(s,r,a,1),!o){+U(u.d).slice(i+1,i+15)+1==1e14&&(u=x(u,f+1,0));break}while(we(u.d,i+=10,m));return B=!0,x(u,f,m)};p.minus=p.sub=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,d=this,y=d.constructor;if(e=new y(e),!d.d||!e.d)return!d.s||!e.s?e=new y(NaN):d.d?e.s=-e.s:e=new y(e.d||d.s!==e.s?d:NaN),e;if(d.s!=e.s)return e.s=-e.s,d.plus(e);if(c=d.d,m=e.d,a=y.precision,u=y.rounding,!c[0]||!m[0]){if(m[0])e.s=-e.s;else if(c[0])e=new y(d);else return new y(u===3?-0:0);return B?x(e,a,u):e}if(n=q(e.e/S),l=q(d.e/S),c=c.slice(),o=l-n,o){for(f=o<0,f?(t=c,o=-o,s=m.length):(t=m,n=l,s=c.length),r=Math.max(Math.ceil(a/S),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(c[r]!=m[r]){f=c[r]<m[r];break}o=0}for(f&&(t=c,c=m,m=t,e.s=-e.s),s=c.length,r=m.length-s;r>0;--r)c[s++]=0;for(r=m.length;r>o;){if(c[--r]<m[r]){for(i=r;i&&c[--i]===0;)c[i]=J-1;--c[i],c[r]+=J}c[r]-=m[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(e.d=c,e.e=Ve(c,n),B?x(e,a,u):e):new y(u===3?-0:0)};p.modulo=p.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?x(new r(n),r.precision,r.rounding):(B=!1,r.modulo==9?(t=M(n,e.abs(),0,3,1),t.s*=e.s):t=M(n,e,0,r.modulo,1),t=t.times(e),B=!0,n.minus(t))};p.naturalExponential=p.exp=function(){return ot(this)};p.naturalLogarithm=p.ln=function(){return ae(this)};p.negated=p.neg=function(){var e=new this.constructor(this);return e.s=-e.s,x(e)};p.plus=p.add=function(e){var t,n,r,i,o,s,a,u,c,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(c=f.d,l=e.d,a=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(e=new m(f)),B?x(e,a,u):e;if(o=q(f.e/S),r=q(e.e/S),c=c.slice(),i=o-r,i){for(i<0?(n=c,i=-i,s=l.length):(n=l,r=o,s=c.length),o=Math.ceil(a/S),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,n=l,l=c,c=n),t=0;i;)t=(c[--i]=c[i]+l[i]+t)/J|0,c[i]%=J;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return e.d=c,e.e=Ve(c,r),B?x(e,a,u):e};p.precision=p.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(ue+e);return n.d?(t=_t(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};p.round=function(){var e=this,t=e.constructor;return x(new t(e),e.e+1,t.rounding)};p.sine=p.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+S,r.rounding=1,n=Ln(r,Vt(r,n)),r.precision=e,r.rounding=t,x(ee>2?n.neg():n,e,t,!0)):new r(NaN)};p.squareRoot=p.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(B=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=U(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=q((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new l(t)):r=new l(c.toString()),n=(u=l.precision)+3;;)if(o=r,r=o.plus(M(s,o,n+2,1)).times(.5),U(o.d).slice(0,n)===(t=U(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(x(o,u+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(x(r,u+1,1),e=!r.times(r).eq(s));break}return B=!0,x(r,u,l.rounding,e)};p.tangent=p.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=M(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,x(ee==2||ee==4?n.neg():n,e,t,!0)):new r(NaN)};p.times=p.mul=function(e){var t,n,r,i,o,s,a,u,c,l=this,f=l.constructor,m=l.d,d=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!d||!d[0])return new f(!e.s||m&&!m[0]&&!d||d&&!d[0]&&!m?NaN:!m||!d?e.s/0:e.s*0);for(n=q(l.e/S)+q(e.e/S),u=m.length,c=d.length,u<c&&(o=m,m=d,d=o,s=u,u=c,c=s),o=[],s=u+c,r=s;r--;)o.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)a=o[i]+d[r]*m[i-r-1]+t,o[i--]=a%J|0,t=a/J|0;o[i]=(o[i]+t)%J|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=Ve(o,n),B?x(e,f.precision,f.rounding):e};p.toBinary=function(e,t){return at(this,2,e,t)};p.toDecimalPlaces=p.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(z(e,0,ce),t===void 0?t=r.rounding:z(t,0,8),x(n,e+n.e+1,t))};p.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=X(r,!0):(z(e,0,ce),t===void 0?t=i.rounding:z(t,0,8),r=x(new i(r),e+1,t),n=X(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=X(i):(z(e,0,ce),t===void 0?t=o.rounding:z(t,0,8),r=x(new o(i),e+i.e+1,t),n=X(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};p.toFraction=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,d=this,y=d.d,g=d.constructor;if(!y)return new g(d);if(c=n=new g(1),r=u=new g(0),t=new g(r),o=t.e=_t(y)-d.e-1,s=o%S,t.d[0]=W(10,s<0?S+s:s),e==null)e=o>0?t:c;else{if(a=new g(e),!a.isInt()||a.lt(c))throw Error(ue+a);e=a.gt(t)?o>0?t:c:a}for(B=!1,a=new g(U(y)),l=g.precision,g.precision=o=y.length*S*2;f=M(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=c,c=u.plus(f.times(i)),u=i,i=t,t=a.minus(f.times(i)),a=i;return i=M(e.minus(n),r,0,1,1),u=u.plus(i.times(c)),n=n.plus(i.times(r)),u.s=c.s=d.s,m=M(c,r,o,1).minus(d).abs().cmp(M(u,n,o,1).minus(d).abs())<1?[c,r]:[u,n],g.precision=l,B=!0,m};p.toHexadecimal=p.toHex=function(e,t){return at(this,16,e,t)};p.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:z(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(B=!1,n=M(n,e,0,t,1).times(e),B=!0,x(n)):(e.s=n.s,n=e),n};p.toNumber=function(){return+this};p.toOctal=function(e,t){return at(this,8,e,t)};p.toPower=p.pow=function(e){var t,n,r,i,o,s,a=this,u=a.constructor,c=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(W(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,o=u.rounding,e.eq(1))return x(a,r,o);if(t=q(e.e/S),t>=e.d.length-1&&(n=c<0?-c:c)<=Pn)return i=Ft(u,a,n,r),e.s<0?new u(1).div(i):x(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new u(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=W(+a,c),t=n==0||!isFinite(n)?q(c*(Math.log("0."+U(a.d))/Math.LN10+a.e+1)):new u(n+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(B=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),i=ot(e.times(ae(a,r+n)),r),i.d&&(i=x(i,r+5,1),we(i.d,r,o)&&(t=r+10,i=x(ot(e.times(ae(a,t+n)),t),t+5,1),+U(i.d).slice(r+1,r+15)+1==1e14&&(i=x(i,r+1,0)))),i.s=s,B=!0,u.rounding=o,x(i,r,o))};p.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=X(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(z(e,1,ce),t===void 0?t=i.rounding:z(t,0,8),r=x(new i(r),e,t),n=X(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};p.toSignificantDigits=p.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(z(e,1,ce),t===void 0?t=r.rounding:z(t,0,8)),x(new r(n),e,t)};p.toString=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};p.truncated=p.trunc=function(){return x(new this.constructor(this),this.e+1,1)};p.valueOf=p.toJSON=function(){var e=this,t=e.constructor,n=X(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function U(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=S-r.length,n&&(o+=se(n)),o+=r;s=e[t],r=s+"",n=S-r.length,n&&(o+=se(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function z(e,t,n){if(e!==~~e||e<t||e>n)throw Error(ue+e)}function we(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=S,i=0):(i=Math.ceil((t+1)/S),t%=S),o=W(10,S-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==W(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==W(10,t-3)-1,s}function Oe(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=nt.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function An(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/We(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=pe(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var M=function(){function e(r,i,o){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+a,r[u]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(r[a]!=i[a]){u=r[a]>i[a]?1:-1;break}return u}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,u){var c,l,f,m,d,y,g,w,T,P,b,h,L,A,k,D,O,F,R,K,Q=r.constructor,ie=r.s==i.s?1:-1,V=r.d,E=i.d;if(!V||!V[0]||!E||!E[0])return new Q(!r.s||!i.s||(V?E&&V[0]==E[0]:!E)?NaN:V&&V[0]==0||!E?ie*0:ie/0);for(u?(d=1,l=r.e-i.e):(u=J,d=S,l=q(r.e/d)-q(i.e/d)),R=E.length,O=V.length,T=new Q(ie),P=T.d=[],f=0;E[f]==(V[f]||0);f++);if(E[f]>(V[f]||0)&&l--,o==null?(A=o=Q.precision,s=Q.rounding):a?A=o+(r.e-i.e)+1:A=o,A<0)P.push(1),y=!0;else{if(A=A/d+2|0,f=0,R==1){for(m=0,E=E[0],A++;(f<O||m)&&A--;f++)k=m*u+(V[f]||0),P[f]=k/E|0,m=k%E|0;y=m||f<O}else{for(m=u/(E[0]+1)|0,m>1&&(E=e(E,m,u),V=e(V,m,u),R=E.length,O=V.length),D=R,b=V.slice(0,R),h=b.length;h<R;)b[h++]=0;K=E.slice(),K.unshift(0),F=E[0],E[1]>=u/2&&++F;do m=0,c=t(E,b,R,h),c<0?(L=b[0],R!=h&&(L=L*u+(b[1]||0)),m=L/F|0,m>1?(m>=u&&(m=u-1),g=e(E,m,u),w=g.length,h=b.length,c=t(g,b,w,h),c==1&&(m--,n(g,R<w?K:E,w,u))):(m==0&&(c=m=1),g=E.slice()),w=g.length,w<h&&g.unshift(0),n(b,g,h,u),c==-1&&(h=b.length,c=t(E,b,R,h),c<1&&(m++,n(b,R<h?K:E,h,u))),h=b.length):c===0&&(m++,b=[0]),P[f++]=m,c&&b[0]?b[h++]=V[D]||0:(b=[V[D]],h=1);while((D++<O||b[0]!==void 0)&&A--);y=b[0]!==void 0}P[0]||P.shift()}if(d==1)T.e=l,Et=y;else{for(f=1,m=P[0];m>=10;m/=10)f++;T.e=f+l*d-1,x(T,a?o+T.e+1:o,s,y)}return T}}();function x(e,t,n,r){var i,o,s,a,u,c,l,f,m,d=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=S,s=t,l=f[m=0],u=l/W(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/S),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=u=0,i=1,o%=S,s=o-S+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=S,s=o-S+i,u=s<0?0:l/W(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%W(10,i-s-1)),c=n<4?(u||r)&&(n==0||n==(e.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(o>0?s>0?l/W(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,c?(t-=e.e+1,f[0]=W(10,(S-t%S)%S),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=W(10,S-o),f[m]=s>0?(l/W(10,i-s)%W(10,s)|0)*a:0),c)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==J&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=J)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return B&&(e.e>d.maxE?(e.d=null,e.e=NaN):e.e<d.minE&&(e.e=0,e.d=[0])),e}function X(e,t,n){if(!e.isFinite())return Kt(e);var r,i=e.e,o=U(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+se(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+se(-i-1)+o,n&&(r=n-s)>0&&(o+=se(r))):i>=s?(o+=se(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+se(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=se(r))),o}function Ve(e,t){var n=e[0];for(t*=S;n>=10;n/=10)t++;return t}function ve(e,t,n){if(t>xn)throw B=!0,n&&(e.precision=n),Error(Mt);return x(new e(_e),t,1,!0)}function Z(e,t,n){if(t>it)throw Error(Mt);return x(new e(Fe),t,n,!0)}function _t(e){var t=e.length-1,n=t*S+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function se(e){for(var t="";e--;)t+="0";return t}function Ft(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/S+4);for(B=!1;;){if(n%2&&(o=o.times(t),Nt(o.d,s)&&(i=!0)),n=q(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Nt(t.d,s)}return B=!0,o}function kt(e){return e.d[e.d.length-1]&1}function vt(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function ot(e,t){var n,r,i,o,s,a,u,c=0,l=0,f=0,m=e.constructor,d=m.rounding,y=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(B=!1,u=y):u=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(W(2,f))/Math.LN10*2+5|0,u+=r,n=o=s=new m(1),m.precision=u;;){if(o=x(o.times(e),u,1),n=n.times(++l),a=s.plus(M(o,n,u,1)),U(a.d).slice(0,u)===U(s.d).slice(0,u)){for(i=f;i--;)s=x(s.times(s),u,1);if(t==null)if(c<3&&we(s.d,u-r,d,c))m.precision=u+=10,n=o=a=new m(1),l=0,c++;else return x(s,m.precision=y,d,B=!0);else return m.precision=y,s}s=a}}function ae(e,t){var n,r,i,o,s,a,u,c,l,f,m,d=1,y=10,g=e,w=g.d,T=g.constructor,P=T.rounding,b=T.precision;if(g.s<0||!w||!w[0]||!g.e&&w[0]==1&&w.length==1)return new T(w&&!w[0]?-1/0:g.s!=1?NaN:w?0:g);if(t==null?(B=!1,l=b):l=t,T.precision=l+=y,n=U(w),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=U(g.d),r=n.charAt(0),d++;o=g.e,r>1?(g=new T("0."+n),o++):g=new T(r+"."+n.slice(1))}else return c=ve(T,l+2,b).times(o+""),g=ae(new T(r+"."+n.slice(1)),l-y).plus(c),T.precision=b,t==null?x(g,b,P,B=!0):g;for(f=g,u=s=g=M(g.minus(1),g.plus(1),l,1),m=x(g.times(g),l,1),i=3;;){if(s=x(s.times(m),l,1),c=u.plus(M(s,new T(i),l,1)),U(c.d).slice(0,l)===U(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(ve(T,l+2,b).times(o+""))),u=M(u,new T(d),l,1),t==null)if(we(u.d,l-y,P,a))T.precision=l+=y,c=s=g=M(f.minus(1),f.plus(1),l,1),m=x(g.times(g),l,1),i=a=1;else return x(u,T.precision=b,P,B=!0);else return T.precision=b,u;u=c,i+=2}}function Kt(e){return String(e.s*e.s/0)}function st(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%S,n<0&&(r+=S),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=S;r<i;)e.d.push(+t.slice(r,r+=S));t=t.slice(r),r=S-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),B&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function Sn(e,t){var n,r,i,o,s,a,u,c,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),Ot.test(t))return st(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(wn.test(t))n=16,t=t.toLowerCase();else if(yn.test(t))n=2;else if(Tn.test(t))n=8;else throw Error(ue+t);for(o=t.search(/p/i),o>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=Ft(r,new r(n),o,o*2)),c=Oe(t,n,J),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new r(e.s*0):(e.e=Ve(c,l),e.d=c,B=!1,s&&(e=M(e,i,a*4)),u&&(e=e.times(Math.abs(u)<54?W(2,u):Ue.pow(2,u))),B=!0,e)}function Ln(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:pe(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/We(5,n)),t=pe(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function pe(e,t,n,r,i){var o,s,a,u,c=1,l=e.precision,f=Math.ceil(l/S);for(B=!1,u=n.times(n),a=new e(r);;){if(s=M(a.times(u),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=M(s.times(u),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,c++}return B=!0,s.d.length=f+1,s}function We(e,t){for(var n=e;--t;)n*=e;return n}function Vt(e,t){var n,r=t.s<0,i=Z(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return ee=r?4:1,t;if(n=t.divToInt(i),n.isZero())ee=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return ee=kt(n)?r?2:3:r?4:1,t;ee=kt(n)?r?1:4:r?3:2}return t.minus(i).abs()}function at(e,t,n,r){var i,o,s,a,u,c,l,f,m,d=e.constructor,y=n!==void 0;if(y?(z(n,1,ce),r===void 0?r=d.rounding:z(r,0,8)):(n=d.precision,r=d.rounding),!e.isFinite())l=Kt(e);else{for(l=X(e),s=l.indexOf("."),y?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new d(1),m.e=l.length-s,m.d=Oe(X(m),10,i),m.e=m.d.length),f=Oe(l,10,i),o=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=y?"0p+0":"0";else{if(s<0?o--:(e=new d(e),e.d=f,e.e=o,e=M(e,m,n,r,0,i),f=e.d,o=e.e,c=Et),s=f[n],a=i/2,c=c||f[n+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,c)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=nt.charAt(f[s]);if(y){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)l+="0";for(f=Oe(l,i,t),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=nt.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Nt(e,t){if(e.length>t)return e.length=t,!0}function Bn(e){return new this(e).abs()}function Cn(e){return new this(e).acos()}function kn(e){return new this(e).acosh()}function Nn(e,t){return new this(e).plus(t)}function In(e){return new this(e).asin()}function En(e){return new this(e).asinh()}function Mn(e){return new this(e).atan()}function Dn(e){return new this(e).atanh()}function Rn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Z(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Z(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Z(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(M(e,t,o,1)),t=Z(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(M(e,t,o,1)),n}function On(e){return new this(e).cbrt()}function _n(e){return x(e=new this(e),e.e+1,2)}function Fn(e,t,n){return new this(e).clamp(t,n)}function vn(e){if(!e||typeof e!="object")throw Error(Ke+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,ce,"rounding",0,8,"toExpNeg",-de,0,"toExpPos",0,de,"maxE",0,de,"minE",-de,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=rt[n]),(r=e[n])!==void 0)if(q(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(ue+n+": "+r);if(n="crypto",i&&(this[n]=rt[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(Dt);else this[n]=!1;else throw Error(ue+n+": "+r);return this}function Kn(e){return new this(e).cos()}function Vn(e){return new this(e).cosh()}function Wt(e){var t,n,r;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,It(o)){c.s=o.s,B?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;B?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return st(c,o.toString())}else if(u!=="string")throw Error(ue+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Ot.test(o)?st(c,o):Sn(c,o)}if(i.prototype=p,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=vn,i.clone=Wt,i.isDecimal=It,i.abs=Bn,i.acos=Cn,i.acosh=kn,i.add=Nn,i.asin=In,i.asinh=En,i.atan=Mn,i.atanh=Dn,i.atan2=Rn,i.cbrt=On,i.ceil=_n,i.clamp=Fn,i.cos=Kn,i.cosh=Vn,i.div=Wn,i.exp=Un,i.floor=qn,i.hypot=Gn,i.ln=Hn,i.log=jn,i.log10=Yn,i.log2=zn,i.max=Zn,i.min=Jn,i.mod=Qn,i.mul=Xn,i.pow=$n,i.random=er,i.round=tr,i.sign=nr,i.sin=rr,i.sinh=ir,i.sqrt=or,i.sub=sr,i.sum=ar,i.tan=ur,i.tanh=cr,i.trunc=lr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function Wn(e,t){return new this(e).div(t)}function Un(e){return new this(e).exp()}function qn(e){return x(e=new this(e),e.e+1,3)}function Gn(){var e,t,n=new this(0);for(B=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return B=!0,new this(1/0);n=t}return B=!0,n.sqrt()}function It(e){return e instanceof Ue||e&&e.toStringTag===Rt||!1}function Hn(e){return new this(e).ln()}function jn(e,t){return new this(e).log(t)}function zn(e){return new this(e).log(2)}function Yn(e){return new this(e).log(10)}function Zn(){return vt(this,arguments,"lt")}function Jn(){return vt(this,arguments,"gt")}function Qn(e,t){return new this(e).mod(t)}function Xn(e,t){return new this(e).mul(t)}function $n(e,t){return new this(e).pow(t)}function er(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:z(e,1,ce),r=Math.ceil(e/S),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(Dt);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=S,r&&e&&(i=W(10,S-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=S)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<S&&(n-=S-r)}return s.e=n,s.d=a,s}function tr(e){return x(e=new this(e),e.e+1,this.rounding)}function nr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function rr(e){return new this(e).sin()}function ir(e){return new this(e).sinh()}function or(e){return new this(e).sqrt()}function sr(e,t){return new this(e).sub(t)}function ar(){var e=0,t=arguments,n=new this(t[e]);for(B=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return B=!0,x(n,this.precision,this.rounding)}function ur(e){return new this(e).tan()}function cr(e){return new this(e).tanh()}function lr(e){return x(e=new this(e),e.e+1,1)}p[Symbol.for("nodejs.util.inspect.custom")]=p.toString;p[Symbol.toStringTag]="Decimal";var Ue=p.constructor=Wt(rt);_e=new Ue(_e);Fe=new Ue(Fe);import yr from"big.js";import Ai from"bn.js";import fr from"toformat";var mr=fr,Te=mr;import Ge from"big.js";import pr from"bn.js";import gr from"decimal.js-light";import Pe from"bn.js";var Ut=9007199254740991;function te(e){let t=j("Raydium_parseBigNumberish");if(e instanceof Pe)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new Pe(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Ut||e<=-Ut)&&t.logWithError(`BigNumberish number overflow: ${e}`),new Pe(String(e))):typeof e=="bigint"?new Pe(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new Pe(0))}var qe=j("module/fraction"),ut=Te(Ge),xe=Te(gr),hr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},br={[0]:Ge.roundDown,[1]:Ge.roundHalfUp,[2]:Ge.roundUp},_=class{constructor(t,n=new pr(1)){this.numerator=te(t),this.denominator=te(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new _(this.denominator,this.numerator)}add(t){let n=t instanceof _?t:new _(te(t));return this.denominator.eq(n.denominator)?new _(this.numerator.add(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof _?t:new _(te(t));return this.denominator.eq(n.denominator)?new _(this.numerator.sub(n.numerator),this.denominator):new _(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof _?t:new _(te(t));return new _(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof _?t:new _(te(t));return new _(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||qe.logWithError(`${t} is not an integer.`),t<=0&&qe.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:hr[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||qe.logWithError(`${t} is not an integer.`),t<0&&qe.logWithError(`${t} is negative.`),ut.DP=t,ut.RM=br[r]||1,new ut(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};var Mi=j("Raydium_amount"),Di=Te(yr);import{PublicKey as Tr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as qt}from"@solana/spl-token";var Gt={chainId:101,address:Tr.default.toBase58(),programId:qt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},le={chainId:101,address:"So11111111111111111111111111111111111111112",programId:qt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as lt}from"@solana/web3.js";import{PublicKey as v,SystemProgram as Ht,SYSVAR_RENT_PUBKEY as Pr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as xr}from"@solana/spl-token";function ct({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Wi=[ct({pubkey:xr,isWritable:!1}),ct({pubkey:Ht.programId,isWritable:!1}),ct({pubkey:Pr,isWritable:!1})];function jt({publicKey:e,transformSol:t}){let n=zt(e.toString());if(n instanceof v)return t&&n.equals(Ae)?tt:n;if(t&&n.toString()===Ae.toBase58())return tt;if(typeof n=="string"){if(n===v.default.toBase58())return v.default;try{return new v(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function zt(e){try{return new v(e)}catch{return e}}var Ui=new v("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),qi=new v("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Gi=new v("SysvarRent111111111111111111111111111111111"),Hi=new v("SysvarC1ock11111111111111111111111111111111"),ji=new v("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),zi=new v("Sysvar1nstructions1111111111111111111111111"),Yi=Ht.programId,Zi=new v("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ji=new v("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Qi=new v("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Xi=new v("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),$i=new v("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),eo=new v("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),to=new v("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),no=new v("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ro=new v("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),io=new v("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),oo=new v("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),tt=new v("So11111111111111111111111111111111111111112"),Ae=v.default;var ft=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===Ae.toBase58()||t instanceof lt&&Ae.equals(t)){this.decimals=le.decimals,this.symbol=le.symbol,this.name=le.name,this.mint=new lt(le.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?lt.default:jt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},Y=ft;Y.WSOL=new ft(oe(H({},le),{mint:le.address}));var mt=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},He=mt;He.SOL=new mt(Gt);import Ar from"bn.js";var yo=new _(new Ar(100));var So=j("Raydium_price");import{PublicKey as Wo}from"@solana/web3.js";import qo from"bn.js";var Sr=new ne(0),us=new ne(1),cs=new ne(2),ls=new ne(3),fs=new ne(5),wr=new ne(10),ms=new ne(100),ds=new ne(1e3),ps=new ne(1e4);function et(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as Es}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ds}from"@solana/spl-token";import{ComputeBudgetProgram as Qt,Keypair as $t,PublicKey as Lr,Transaction as en,TransactionMessage as Br,VersionedTransaction as tn}from"@solana/web3.js";var dt={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Cr}from"@solana/spl-token";var Xt=j("Raydium_txUtil"),nn=1644;function je(e){let t=[],n=[];return e.microLamports&&(t.push(Qt.setComputeUnitPrice({microLamports:e.microLamports})),n.push(dt.SetComputeUnitPrice)),e.units&&(t.push(Qt.setComputeUnitLimit({units:e.units})),n.push(dt.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ge(e,t){var r,i;let n=t!=null?t:"confirmed";return(i=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:i.blockhash}async function ze(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let i=setTimeout(r,6e4);e.onSignature(t,o=>{if(clearTimeout(i),!o.err){n("");return}r(o.err.toString())},"confirmed")})}function pt(e,t){e.length<1&&Xt.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&Xt.logWithError(`no signers provided:, ${t.toString()}`);let n=new en;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<nn}catch{return!1}}function Ye(e,t){let[n,r]=Lr.findProgramAddressSync(e,t);return{publicKey:n,nonce:r}}function Se({instructions:e,payer:t,signers:n}){return pt(e,[t,...n])}function Le({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=$t.generate().publicKey.toString()}){let o=new Br({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new tn(o).serialize()).toString("base64").length<nn}catch{return!1}}var kr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),Nr=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof tn&&(t=kr(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function fe(e){let t=[];return e.forEach(n=>{n instanceof en&&(n.recentBlockhash||(n.recentBlockhash=Cr.toBase58()),n.feePayer||(n.feePayer=$t.generate().publicKey)),t.push(Nr(n))}),console.log("simulate tx string:",t),t}import{PublicKey as C}from"@solana/web3.js";var Fs=new C("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),vs=new C("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Ks=new C("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Vs=new C("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Ws=new C("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),Us=new C("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),qs=new C("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Gs=new C("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Hs=new C("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),js=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),zs=new C("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ys=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Zs=new C("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Js=new C("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Qs=new C("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Xs=new C("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),$s=new C("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),ea=new C("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ta=new C("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),na=new C("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ra=new C("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),ia=new C("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Ir=new C("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Er=new C("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Mr=new C("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),oa=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Dr=new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),sa=new C("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Rr=new C("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var aa={SERUM_MARKET:C.default,OPENBOOK_MARKET:new C("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:C.default,FarmV3:new C("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new C("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new C("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new C("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new C("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new C("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new C("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new C("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Ir,CREATE_CPMM_POOL_AUTH:Er,CREATE_CPMM_POOL_FEE_ACC:Mr,FEE_DESTINATION_ID:new C("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Dr,LCOK_CPMM_AUTH:Rr};import la from"bn.js";import{PublicKey as rn,AddressLookupTableAccount as Ze}from"@solana/web3.js";async function gt({connection:e,address:t}){let n=await Re(e,[...new Set(t.map(i=>i.toString()))].map(i=>new rn(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new Ze({key:s,state:Ze.deserialize(o.data)});r[s.toString()]=a,Je[s.toString()]=a}return r}var Je={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Ze({key:new rn("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Ze.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Be,sendAndConfirmTransaction as ht,Transaction as Ce,TransactionMessage as ke,VersionedTransaction as Ne}from"@solana/web3.js";import Or from"axios";var Qe=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Or.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=je(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Be.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(H({},n||{})):this.build(n)}build(t){var r;let n=new Ce;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await ge(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),fe([n]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await ht(this.connection,n,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let l=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var c;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var T;let{sequentially:f,onTxUpdate:m,skipTxCount:d=0,recentBlockHash:y,skipPreflight:g=!0}=l||{},w=y!=null?y:await ge(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(f){let P=[],b=0;for(let h of s){if(++b,b<=d)continue;let L=await ht(this.connection,h,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});P.push(L)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=w,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((h,L)=>(h.recentBlockhash=w,a[L].length&&h.sign(...a[L]),h));fe(P);let b=await this.signAllTransactions(P);if(f){let h=0,L=[],A=async()=>{if(!b[h])return;let k=await this.connection.sendRawTransaction(b[h].serialize(),{skipPreflight:g});L.push({txId:k,status:"sent",signedTx:b[h]}),m==null||m([...L]),h++,this.connection.onSignature(k,D=>{let O=L.findIndex(F=>F.txId===k);O>-1&&(L[O].status=D.err?"error":"success"),m==null||m([...L]),D.err||A()},"processed"),this.connection.getSignatureStatus(k)};return await A(),{txIds:L.map(k=>k.txId),signedTxs:b}}else{let h=[];for(let L=0;L<b.length;L+=1){let A=await this.connection.sendRawTransaction(b[L].serialize(),{skipPreflight:g});h.push(A)}return{txIds:h,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let y=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=y,s=De(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=H(H({},this.cluster==="devnet"?{}:Je),n),u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let w of u)a[w]===void 0&&c.push(new Be(w));let l=await gt({connection:this.connection,address:c});for(let[w,T]of Object.entries(l))a[w]=T;let f=i?Be.default.toBase58():o!=null?o:await ge(this.connection,this.blockhashCommitment),m=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let d=new Ne(m);return d.sign(this.signers),{builder:this,transaction:d,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var b;let{skipPreflight:T=!0,sendAndConfirm:P}=w||{};if(fe([d]),(b=this.owner)!=null&&b.isKeyPair){let h=await this.connection.sendTransaction(d,{skipPreflight:T});return P&&await ze(this.connection,h),{txId:h,signedTx:d}}if(this.signAllTransactions){let h=await this.signAllTransactions([d]);return{txId:await this.connection.sendTransaction(h[0],{skipPreflight:T}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var c;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:m,recentBlockHash:d,skipPreflight:y=!0}=l||{};if(d&&s.forEach(w=>w.message.recentBlockhash=d),fe(s),(g=this.owner)!=null&&g.isKeyPair){if(f){let w=[];for(let T of s){let P=await this.connection.sendTransaction(T,{skipPreflight:y});await ze(this.connection,P),w.push(P)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(f){let T=0,P=[],b=async()=>{if(!w[T])return;let h=await this.connection.sendTransaction(w[T],{skipPreflight:y});P.push({txId:h,status:"sent",signedTx:w[T]}),m==null||m([...P]),T++,this.connection.onSignature(h,L=>{let A=P.findIndex(k=>k.txId===h);A>-1&&(P[A].status=L.err?"error":"success"),m==null||m([...P]),L.err||b()},"processed"),this.connection.getSignatureStatus(h)};return b(),{txIds:[],signedTxs:w}}else{let T=[];for(let P=0;P<w.length;P+=1){let b=await this.connection.sendTransaction(w[P],{skipPreflight:y});T.push(b)}return{txIds:T,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var l;let c=t||{},{computeBudgetConfig:n}=c,r=De(c,["computeBudgetConfig"]),i=n?je(n):{instructions:[],instructionTypes:[]},o=this.signers.reduce((f,m)=>oe(H({},f),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(f=>{let m=[...u,f],d=n?[...i.instructions,...m]:m,g=[...new Set(m.map(w=>w.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(w=>new Be(w));if(u.length<12&&Se({instructions:d,payer:this.feePayer,signers:g})||Se({instructions:m,payer:this.feePayer,signers:g}))u.push(f);else{if(u.length===0)throw Error("item ins too big");Se({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:g})?s.push(new Ce().add(...i.instructions,...u)):s.push(new Ce().add(...u)),a.push(Array.from(new Set(u.map(w=>w.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(w=>o[w]).filter(w=>w!==void 0)),u=[f]}}),u.length>0){let m=[...new Set(u.map(d=>d.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(d=>o[d]).filter(d=>d!==void 0);Se({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(d=>d.publicKey)})?s.push(new Ce().add(...i.instructions,...u)):s.push(new Ce().add(...u)),a.push(m)}return s.forEach(f=>f.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async f=>{var P;let{sequentially:m,onTxUpdate:d,skipTxCount:y=0,recentBlockHash:g,skipPreflight:w=!0}=f||{},T=g!=null?g:await ge(this.connection,this.blockhashCommitment);if(s.forEach(async(b,h)=>{b.recentBlockhash=T,a[h].length&&b.sign(...a[h])}),fe(s),(P=this.owner)!=null&&P.isKeyPair){if(m){let b=0,h=[];for(let L of s){if(++b,b<=y){h.push("tx skipped");continue}let A=await ht(this.connection,L,this.signers.find(k=>k.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});h.push(A)}return{txIds:h,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:w}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s.slice(y,s.length)),h=[...s.slice(0,y),...b];if(m){let L=0,A=[],k=async()=>{if(!h[L])return;L<y&&(A.push({txId:"",status:"success",signedTx:h[L]}),d==null||d([...A]),L++,k());let D=await this.connection.sendRawTransaction(h[L].serialize(),{skipPreflight:w});A.push({txId:D,status:"sent",signedTx:h[L]}),d==null||d([...A]),L++,this.connection.onSignature(D,O=>{let F=A.findIndex(R=>R.txId===D);F>-1&&(A[F].status=O.err?"error":"success"),d==null||d([...A]),O.err||k()},"processed"),this.connection.getSignatureStatus(D)};return await k(),{txIds:A.map(D=>D.txId),signedTxs:h}}else{let L=[];for(let A=0;A<h.length;A+=1){let k=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:w});L.push(k)}return{txIds:L,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var T;let w=t||{},{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:i=[]}=w,o=De(w,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=H(H({},this.cluster==="devnet"?{}:Je),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let P of a)s[P]===void 0&&u.push(new Be(P));let c=await gt({connection:this.connection,address:u});for(let[P,b]of Object.entries(c))s[P]=b;let l=n?je(n):{instructions:[],instructionTypes:[]},f=await ge(this.connection,this.blockhashCommitment),m=this.signers.reduce((P,b)=>oe(H({},P),{[b.publicKey.toBase58()]:b}),{}),d=[],y=[],g=[];if(this.allInstructions.forEach(P=>{let b=[...g,P],h=n?[...l.instructions,...b]:b;if(g.length<12&&Le({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s})||Le({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(P);else{if(g.length===0)throw Error("item ins too big");let L={};for(let A of[...new Set(a)])s[A]!==void 0&&(L[A]=s[A]);if(n&&Le({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let A=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));d.push(new Ne(A))}else{let A=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));d.push(new Ne(A))}y.push(Array.from(new Set(g.map(A=>A.keys.filter(k=>k.isSigner).map(k=>k.pubkey.toString())).flat())).map(A=>m[A]).filter(A=>A!==void 0)),g=[P]}}),g.length>0){let b=[...new Set(g.map(h=>h.keys.filter(L=>L.isSigner).map(L=>L.pubkey.toString())).flat()).values()].map(h=>m[h]).filter(h=>h!==void 0);if(n&&Le({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let h=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));d.push(new Ne(h))}else{let h=new ke({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));d.push(new Ne(h))}y.push(b)}return(T=this.owner)!=null&&T.signer&&y.forEach(P=>{P.some(b=>b.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:d,buildProps:t,signers:y,instructionTypes:this.instructionTypes,execute:async P=>{var D;let{sequentially:b,onTxUpdate:h,skipTxCount:L=0,recentBlockHash:A,skipPreflight:k=!0}=P||{};if(d.map(async(O,F)=>{y[F].length&&O.sign(y[F]),A&&(O.message.recentBlockhash=A)}),fe(d),(D=this.owner)!=null&&D.isKeyPair){if(b){let O=0,F=[];for(let R of d){if(++O,O<=L){console.log("skip tx: ",O),F.push("tx skipped");continue}let K=await this.connection.sendTransaction(R,{skipPreflight:k});await ze(this.connection,K),F.push(K)}return{txIds:F,signedTxs:d}}return{txIds:await Promise.all(d.map(async O=>await this.connection.sendTransaction(O,{skipPreflight:k}))),signedTxs:d}}if(this.signAllTransactions){let O=await this.signAllTransactions(d.slice(L,d.length)),F=[...d.slice(0,L),...O];if(b){let R=0,K=[],Q=async()=>{if(!F[R])return;if(R<L){K.push({txId:"",status:"success",signedTx:F[R]}),h==null||h([...K]),R++,Q();return}let ie=await this.connection.sendTransaction(F[R],{skipPreflight:k});K.push({txId:ie,status:"sent",signedTx:F[R]}),h==null||h([...K]),R++,this.connection.onSignature(ie,V=>{let E=K.findIndex(fn=>fn.txId===ie);E>-1&&(K[E].status=V.err?"error":"success"),h==null||h([...K]),V.err||Q()},"processed"),this.connection.getSignatureStatus(ie)};return Q(),{txIds:[],signedTxs:F}}else{let R=[];for(let K=0;K<F.length;K+=1){let Q=await this.connection.sendTransaction(F[K],{skipPreflight:k});R.push(Q)}return{txIds:R,signedTxs:F}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{PublicKey as Wr}from"@solana/web3.js";import un,{isBN as cn}from"bn.js";import{bits as za,BitStructure as Ya,blob as _r,Blob as Za,cstr as Ja,f32 as Qa,f32be as Xa,f64 as $a,f64be as eu,greedy as tu,Layout as Fr,ns64 as nu,ns64be as ru,nu64 as iu,nu64be as ou,offset as su,s16 as au,s16be as uu,s24 as cu,s24be as lu,s32 as fu,s32be as mu,s40 as du,s40be as pu,s48 as gu,s48be as hu,s8 as bu,seq as vr,struct as yu,Structure as Kr,u16 as wu,u16be as Tu,u24 as Pu,u24be as xu,u32 as Au,u32be as Su,u40 as Lu,u40be as Bu,u48 as Cu,u48be as ku,u8 as Nu,UInt as Vr,union as Iu,Union as Eu,unionLayoutDiscriminator as Mu,utf8 as Du}from"@solana/buffer-layout";var bt=Fr,on=Kr;var sn=Vr;var an=vr;var he=_r;var yt=class extends bt{constructor(n,r,i){super(n,i);this.blob=he(n),this.signed=r}decode(n,r=0){let i=new un(this.blob.decode(n,r),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(n,r,i=0){return typeof n=="number"&&(n=new un(n)),this.signed&&(n=n.toTwos(this.span*8)),this.blob.encode(n.toArrayLike(Buffer,"le",this.span),r,i)}};function be(e){return new sn(1,e)}function $(e){return new yt(8,!1,e)}var wt=class extends bt{constructor(n,r,i,o){super(n.span,o);this.layout=n,this.decoder=r,this.encoder=i}decode(n,r){return this.decoder(this.layout.decode(n,r))}encode(n,r,i){return this.layout.encode(this.encoder(n),r,i)}getSpan(n,r){return this.layout.getSpan(n,r)}};function me(e){return new wt(he(32),t=>new Wr(t),t=>t.toBuffer(),e)}var Tt=class extends on{decode(t,n){return super.decode(t,n)}};function ye(e,t,n){return new Tt(e,t,n)}function Ie(e,t,n){let r,i=typeof t=="number"?t:cn(t)?t.toNumber():new Proxy(t,{get(o,s){if(!r){let a=Reflect.get(o,"count");r=cn(a)?a.toNumber():a,Reflect.set(o,"count",r)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(r=a),Reflect.set(o,s,a)}});return an(e,i,n)}var Pt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Ee=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=j(n)}createTxBuilder(t){return this.scope.checkOwner(),new Qe({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(Pt(t))}logInfo(...t){this.logger.info(Pt(t))}logAndCreateError(...t){let n=Pt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var G=class extends Ee{static getPdaPoolId(t,n){return Ye([G.SEED_CONFIG.pool.id,n.toBuffer()],t)}static getPdaOwnerId(t,n,r,i){return Ye([G.SEED_CONFIG.owner.id,n.toBuffer(),r.toBuffer(),Buffer.from(new ln(i).toArray())],t)}static async getAllInfo({connection:t,programId:n,poolIds:r,wallet:i,chainTime:o}){if(r.length===0)return[];let s=r.map(l=>G.getPdaPoolId(n,l).publicKey),a=[];for(let l=0;l<G.VERSION_PROJECT.length;l++)a.push(...s.map(f=>G.getPdaOwnerId(n,f,i,l).publicKey));let u=await Re(t,[...s,...a]),c=[];for(let l=0;l<u.length;l++){let f=Math.floor(l/r.length),m=l%r.length,d=s[m],y=a[l],g=u[m],w=u[r.length+l];if(!(g&&w)||g.data.length!==G.POOL_LAYOUT.span||w.data.length!==G.OWNER_LAYOUT.span)continue;let T=G.POOL_LAYOUT.decode(g.data),P=G.OWNER_LAYOUT.decode(w.data),b=T.openTime.toNumber(),h=T.endTime.toNumber(),L=P.tokenInfo.map(D=>D.debtAmount.gt(new ln(0))).filter(D=>!D).length!==3,A=o>b&&o<h&&T.status===1,k=L&&A;c.push({programId:n,poolId:d,ammId:T.ammId,ownerAccountId:y,snapshotLpAmount:P.lpAmount,project:G.VERSION_PROJECT[f],openTime:b,endTime:h,canClaim:k,canClaimErrorType:L?A?void 0:"outOfOperationalTime":"alreadyClaimIt",tokenInfo:T.tokenInfo.map((D,O)=>({mintAddress:D.mintAddress,mintVault:D.mintVault,mintDecimals:D.mintDecimals,perLpLoss:D.perLpLoss,debtAmount:P.tokenInfo[O].debtAmount.add(P.tokenInfo[O].claimedAmount)}))})}return c}async makeClaimTransaction({poolInfo:t,ownerInfo:n}){n.wallet||this.scope.checkOwner();let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o=[];for(let u of t.tokenInfo){let{account:c,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({mint:u.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:u.mintAddress.equals(Y.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!u.mintAddress.equals(Y.WSOL.mint),associatedOnly:u.mintAddress.equals(Y.WSOL.mint)?!1:n.associatedOnly});l&&r.addInstruction(l),o.push(c)}r.addInstruction({instructions:[G.makeClaimInstruction({programId:t.programId,poolInfo:t,ownerInfo:{wallet:i,ownerPda:t.ownerAccountId,claimAddress:o}})]});let{transaction:s,signers:a}=r.build();return[{transaction:s,signer:a}]}async makeClaimAllTransaction({poolInfos:t,ownerInfo:n}){let r=this.createTxBuilder(),i=n.wallet||this.scope.ownerPubKey,o={};for(let c of t){let l=[];for(let f of c.tokenInfo){let{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({mint:f.mintAddress,owner:this.scope.ownerPubKey,notUseTokenAccount:f.mintAddress.equals(Y.WSOL.mint),createInfo:{payer:i,amount:0},skipCloseAccount:!f.mintAddress.equals(Y.WSOL.mint),associatedOnly:f.mintAddress.equals(Y.WSOL.mint)?!1:n.associatedOnly});d&&r.addInstruction(d),m&&(o[f.mintAddress.toString()]=m,l.push(m))}r.addInstruction({instructions:[G.makeClaimInstruction({programId:c.programId,poolInfo:c,ownerInfo:{wallet:i,ownerPda:c.ownerAccountId,claimAddress:l}})]})}let{transaction:s,signers:a}=r.build(),u=r.allInstructions;return pt(u,[i,...a.map(c=>c.publicKey)])?[{transaction:s,signer:a}]:[{transaction:new xt().add(...u.slice(0,r.AllTxData.instructions.length-1)),signer:a},{transaction:new xt().add(...u.slice(r.AllTxData.instructions.length-1)),signer:[]},{transaction:new xt().add(...r.AllTxData.endInstructions),signer:[]}]}static makeClaimInstruction({programId:t,poolInfo:n,ownerInfo:r}){let i=ye([]),o=[{pubkey:r.wallet,isSigner:!0,isWritable:!0},{pubkey:n.poolId,isSigner:!1,isWritable:!0},{pubkey:r.ownerPda,isSigner:!1,isWritable:!0},...r.claimAddress.map(u=>({pubkey:u,isSigner:!1,isWritable:!0})),...n.tokenInfo.map(({mintVault:u})=>({pubkey:u,isSigner:!1,isWritable:!0})),{pubkey:Gr,isSigner:!1,isWritable:!1}],s=Buffer.alloc(i.span);i.encode({},s);let a=Buffer.from([10,66,208,184,161,6,191,98,...s]);return new qr({keys:o,programId:t,data:a})}},re=G;re.CLAIMED_NUM=3,re.POOL_LAYOUT=ye([he(8),be("bump"),be("status"),$("openTime"),$("endTime"),me("ammId"),Ie(ye([be("mintDecimals"),me("mintAddress"),me("mintVault"),$("perLpLoss"),$("totalClaimedAmount")]),G.CLAIMED_NUM,"tokenInfo"),Ie($(),10,"padding")]),re.OWNER_LAYOUT=ye([he(8),be("bump"),be("version"),me("poolId"),me("owner"),$("lpAmount"),Ie(ye([me("mintAddress"),$("debtAmount"),$("claimedAmount")]),G.CLAIMED_NUM,"tokenInfo"),Ie($(),4,"padding")]),re.DEFAULT_POOL_ID=["58oQChx4yWmvKdwLLZzBi4ChoCc2fqCUWBkwMihLYQo2","6UmmUiYoBjSrhakAobJw8BvkmJtDVxaeBtbt7rxWo1mg","AVs9TA4nWDzfPJE9gGVNJMVhcQy3V9PGazuz33BfG2RA","DVa7Qmb5ct9RCpaU7UTpSaf3GVMYz17vNVU67XpdCRut","7XawhbbxtsRcQA8KTkHT9f9nc6d69UwqCDh6U5EEbEmX","6a1CsrpeZubDjEJE9s1CMVheB6HWM5d7m1cj2jkhyXhj","EoNrn8iUhwgJySD1pHu8Qxm5gSQqLK3za4m8xzD2RuEb","AceAyRTWt4PyB2pHqf2qhDgNZDtKVNaxgL8Ru3V4aN1P","6tmFJbMk5yVHFcFy7X2K8RwHjKLr6KVFLYXpgpBNeAxB"].map(t=>new Ur(t)),re.SEED_CONFIG={pool:{id:Buffer.from("pool_seed","utf8")},owner:{id:Buffer.from("user_claim_seed","utf8")}},re.VERSION_PROJECT=[void 0,"Francium","Tulip","Larix"];export{re as default};
//# sourceMappingURL=utils1216.mjs.map