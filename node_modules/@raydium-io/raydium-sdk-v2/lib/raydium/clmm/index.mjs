var Ir=Object.defineProperty,Sr=Object.defineProperties;var Cr=Object.getOwnPropertyDescriptors;var en=Object.getOwnPropertySymbols;var pi=Object.prototype.hasOwnProperty,fi=Object.prototype.propertyIsEnumerable;var di=(i,e,t)=>e in i?Ir(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e)=>{for(var t in e||(e={}))pi.call(e,t)&&di(i,t,e[t]);if(en)for(var t of en(e))fi.call(e,t)&&di(i,t,e[t]);return i},X=(i,e)=>Sr(i,Cr(e));var Pt=(i,e)=>{var t={};for(var n in i)pi.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&en)for(var n of en(i))e.indexOf(n)<0&&fi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as N}from"@solana/web3.js";import Re from"bn.js";var At=9e15,st=1e9,Cn="0123456789abcdef",nn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Kn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-At,maxE:At,crypto:!1},wi,Je,V=!0,sn="[DecimalError] ",ot=sn+"Invalid argument: ",Pi=sn+"Precision limit exceeded",Ai=sn+"crypto unavailable",ki="[object Decimal]",Te=Math.floor,ge=Math.pow,Kr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Nr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Lr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,hi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,ve=1e7,D=7,Rr=9007199254740991,Mr=nn.length-1,Nn=rn.length-1,x={toStringTag:ki};x.absoluteValue=x.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),O(i)};x.ceil=function(){return O(new this.constructor(this),this.e+1,2)};x.clampedTo=x.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(ot+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};x.comparedTo=x.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};x.cosine=x.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=Or(n,Si(n,t)),n.precision=i,n.rounding=e,O(Je==2||Je==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};x.cubeRoot=x.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(V=!1,o=l.s*ge(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=Pe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ge(t,1/3),i=Te((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=re(u.plus(l).times(a),u.plus(c),s+2,1),Pe(a.d).slice(0,s)===(t=Pe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(O(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(O(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return V=!0,O(n,i,m.rounding,e)};x.decimalPlaces=x.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Te(this.e/D))*D,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};x.dividedBy=x.div=function(i){return re(this,new this.constructor(i))};x.dividedToIntegerBy=x.divToInt=function(i){var e=this,t=e.constructor;return O(re(e,new t(i),0,1,1),t.precision,t.rounding)};x.equals=x.eq=function(i){return this.cmp(i)===0};x.floor=function(){return O(new this.constructor(this),this.e+1,3)};x.greaterThan=x.gt=function(i){return this.cmp(i)>0};x.greaterThanOrEqualTo=x.gte=function(i){var e=this.cmp(i);return e==1||e===0};x.hyperbolicCosine=x.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/cn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=kt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return O(o,s.precision=t,s.rounding=n,!0)};x.hyperbolicSine=x.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=kt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/cn(5,i)),r=kt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,O(r,e,t,!0)};x.hyperbolicTangent=x.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,re(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};x.inverseCosine=x.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?De(t,r,o):new t(0):new t(NaN):e.isZero()?De(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=De(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};x.inverseHyperbolicCosine=x.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,V=!1,t=t.times(t).minus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};x.inverseHyperbolicSine=x.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,V=!1,t=t.times(t).plus(1).sqrt().plus(t),V=!0,n.precision=i,n.rounding=e,t.ln())};x.inverseHyperbolicTangent=x.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?O(new o(r),i,e,!0):(o.precision=t=n-r.e,r=re(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};x.inverseSine=x.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=De(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};x.inverseTangent=x.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Nn)return s=De(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Nn)return s=De(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/D+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(V=!1,e=Math.ceil(a/D),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),V=!0,O(s,l.precision=m,l.rounding=d,!0)};x.isFinite=function(){return!!this.d};x.isInteger=x.isInt=function(){return!!this.d&&Te(this.e/D)>this.d.length-2};x.isNaN=function(){return!this.s};x.isNegative=x.isNeg=function(){return this.s<0};x.isPositive=x.isPos=function(){return this.s>0};x.isZero=function(){return!!this.d&&this.d[0]===0};x.lessThan=x.lt=function(i){return this.cmp(i)<0};x.lessThanOrEqualTo=x.lte=function(i){return this.cmp(i)<1};x.logarithm=x.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,p=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(V=!1,a=m+p,s=rt(u,a),n=e?on(l,a+10):rt(i,a),c=re(s,n,a,1),It(c.d,r=m,d))do if(a+=10,s=rt(u,a),n=e?on(l,a+10):rt(i,a),c=re(s,n,a,1),!o){+Pe(c.d).slice(r+1,r+15)+1==1e14&&(c=O(c,m+1,0));break}while(It(c.d,r+=10,d));return V=!0,O(c,m,d)};x.minus=x.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,f=p.constructor;if(i=new f(i),!p.d||!i.d)return!p.s||!i.s?i=new f(NaN):p.d?i.s=-i.s:i=new f(i.d||p.s!==i.s?p:NaN),i;if(p.s!=i.s)return i.s=-i.s,p.plus(i);if(u=p.d,d=i.d,a=f.precision,c=f.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new f(p);else return new f(c===3?-0:0);return V?O(i,a,c):i}if(t=Te(i.e/D),l=Te(p.e/D),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/D),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=ve-1;--u[r],u[n]+=ve}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=an(u,t),V?O(i,a,c):i):new f(c===3?-0:0)};x.modulo=x.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?O(new n(t),n.precision,n.rounding):(V=!1,n.modulo==9?(e=re(t,i.abs(),0,3,1),e.s*=i.s):e=re(t,i,0,n.modulo,1),e=e.times(i),V=!0,t.minus(e))};x.naturalExponential=x.exp=function(){return Ln(this)};x.naturalLogarithm=x.ln=function(){return rt(this)};x.negated=x.neg=function(){var i=new this.constructor(this);return i.s=-i.s,O(i)};x.plus=x.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),V?O(i,a,c):i;if(o=Te(m.e/D),n=Te(i.e/D),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/D),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/ve|0,u[r]%=ve;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=an(u,n),V?O(i,a,c):i};x.precision=x.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(ot+i);return t.d?(e=Ti(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};x.round=function(){var i=this,e=i.constructor;return O(new e(i),i.e+1,e.rounding)};x.sine=x.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+D,n.rounding=1,t=Er(n,Si(n,t)),n.precision=i,n.rounding=e,O(Je>2?t.neg():t,i,e,!0)):new n(NaN)};x.squareRoot=x.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(V=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=Pe(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Te((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(re(s,o,t+2,1)).times(.5),Pe(o.d).slice(0,t)===(e=Pe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(O(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(O(n,c+1,1),i=!n.times(n).eq(s));break}return V=!0,O(n,c,l.rounding,i)};x.tangent=x.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=re(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,O(Je==2||Je==4?t.neg():t,i,e,!0)):new n(NaN)};x.times=x.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,p=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!i.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?i.s/0:i.s*0);for(t=Te(l.e/D)+Te(i.e/D),c=d.length,u=p.length,c<u&&(o=d,d=p,p=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+p[n]*d[r-n-1]+e,o[r--]=a%ve|0,e=a/ve|0;o[r]=(o[r]+e)%ve|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=an(o,t),V?O(i,m.precision,m.rounding):i};x.toBinary=function(i,e){return Mn(this,2,i,e)};x.toDecimalPlaces=x.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Le(i,0,st),e===void 0?e=n.rounding:Le(e,0,8),O(t,i+t.e+1,e))};x.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Le(i,0,st),e===void 0?e=r.rounding:Le(e,0,8),n=O(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Le(i,0,st),e===void 0?e=o.rounding:Le(e,0,8),n=O(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};x.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,p=this,f=p.d,g=p.constructor;if(!f)return new g(p);if(u=t=new g(1),n=c=new g(0),e=new g(n),o=e.e=Ti(f)-p.e-1,s=o%D,e.d[0]=ge(10,s<0?D+s:s),i==null)i=o>0?e:u;else{if(a=new g(i),!a.isInt()||a.lt(u))throw Error(ot+a);i=a.gt(e)?o>0?e:u:a}for(V=!1,a=new g(Pe(f)),l=g.precision,g.precision=o=f.length*D*2;m=re(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=re(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=p.s,d=re(u,n,o,1).minus(p).abs().cmp(re(c,t,o,1).minus(p).abs())<1?[u,n]:[c,t],g.precision=l,V=!0,d};x.toHexadecimal=x.toHex=function(i,e){return Mn(this,16,i,e)};x.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Le(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(V=!1,t=re(t,i,0,e,1).times(i),V=!0,O(t)):(i.s=t.s,t=i),t};x.toNumber=function(){return+this};x.toOctal=function(i,e){return Mn(this,8,i,e)};x.toPower=x.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ge(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return O(a,n,o);if(e=Te(i.e/D),e>=i.d.length-1&&(t=u<0?-u:u)<=Rr)return r=xi(c,a,t,n),i.s<0?new c(1).div(r):O(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ge(+a,u),e=t==0||!isFinite(t)?Te(u*(Math.log("0."+Pe(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(V=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Ln(i.times(rt(a,n+t)),n),r.d&&(r=O(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=O(Ln(i.times(rt(a,e+t)),e),e+5,1),+Pe(r.d).slice(n+1,n+15)+1==1e14&&(r=O(r,n+1,0)))),r.s=s,V=!0,c.rounding=o,O(r,n,o))};x.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Le(i,1,st),e===void 0?e=r.rounding:Le(e,0,8),n=O(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toSignificantDigits=x.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Le(i,1,st),e===void 0?e=n.rounding:Le(e,0,8)),O(new n(t),i,e)};x.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};x.truncated=x.trunc=function(){return O(new this.constructor(this),this.e+1,1)};x.valueOf=x.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function Pe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=D-n.length,t&&(o+=it(t)),o+=n;s=i[e],n=s+"",t=D-n.length,t&&(o+=it(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Le(i,e,t){if(i!==~~i||i<e||i>t)throw Error(ot+i)}function It(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=D,r=0):(r=Math.ceil((e+1)/D),e%=D),o=ge(10,D-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ge(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ge(10,e-3)-1,s}function tn(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Cn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Or(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/cn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=kt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var re=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,p,f,g,y,b,k,w,A,h,P,T,B,R,S,K,q,J=n.constructor,oe=n.s==r.s?1:-1,ee=n.d,Y=r.d;if(!ee||!ee[0]||!Y||!Y[0])return new J(!n.s||!r.s||(ee?Y&&ee[0]==Y[0]:!Y)?NaN:ee&&ee[0]==0||!Y?oe*0:oe/0);for(c?(p=1,l=n.e-r.e):(c=ve,p=D,l=Te(n.e/p)-Te(r.e/p)),K=Y.length,R=ee.length,b=new J(oe),k=b.d=[],m=0;Y[m]==(ee[m]||0);m++);if(Y[m]>(ee[m]||0)&&l--,o==null?(P=o=J.precision,s=J.rounding):a?P=o+(n.e-r.e)+1:P=o,P<0)k.push(1),f=!0;else{if(P=P/p+2|0,m=0,K==1){for(d=0,Y=Y[0],P++;(m<R||d)&&P--;m++)T=d*c+(ee[m]||0),k[m]=T/Y|0,d=T%Y|0;f=d||m<R}else{for(d=c/(Y[0]+1)|0,d>1&&(Y=i(Y,d,c),ee=i(ee,d,c),K=Y.length,R=ee.length),B=K,w=ee.slice(0,K),A=w.length;A<K;)w[A++]=0;q=Y.slice(),q.unshift(0),S=Y[0],Y[1]>=c/2&&++S;do d=0,u=e(Y,w,K,A),u<0?(h=w[0],K!=A&&(h=h*c+(w[1]||0)),d=h/S|0,d>1?(d>=c&&(d=c-1),g=i(Y,d,c),y=g.length,A=w.length,u=e(g,w,y,A),u==1&&(d--,t(g,K<y?q:Y,y,c))):(d==0&&(u=d=1),g=Y.slice()),y=g.length,y<A&&g.unshift(0),t(w,g,A,c),u==-1&&(A=w.length,u=e(Y,w,K,A),u<1&&(d++,t(w,K<A?q:Y,A,c))),A=w.length):u===0&&(d++,w=[0]),k[m++]=d,u&&w[0]?w[A++]=ee[B]||0:(w=[ee[B]],A=1);while((B++<R||w[0]!==void 0)&&P--);f=w[0]!==void 0}k[0]||k.shift()}if(p==1)b.e=l,wi=f;else{for(m=1,d=k[0];d>=10;d/=10)m++;b.e=m+l*p-1,O(b,a?o+b.e+1:o,s,f)}return b}}();function O(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=D,s=e,l=m[d=0],c=l/ge(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/D),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=D,s=o-D+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=D,s=o-D+r,c=s<0?0:l/ge(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ge(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ge(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=ge(10,(D-e%D)%D),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ge(10,D-o),m[d]=s>0?(l/ge(10,r-s)%ge(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==ve&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=ve)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return V&&(i.e>p.maxE?(i.d=null,i.e=NaN):i.e<p.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return Ii(i);var n,r=i.e,o=Pe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+it(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+it(-r-1)+o,t&&(n=t-s)>0&&(o+=it(n))):r>=s?(o+=it(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+it(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=it(n))),o}function an(i,e){var t=i[0];for(e*=D;t>=10;t/=10)e++;return e}function on(i,e,t){if(e>Mr)throw V=!0,t&&(i.precision=t),Error(Pi);return O(new i(nn),e,1,!0)}function De(i,e,t){if(e>Nn)throw Error(Pi);return O(new i(rn),e,t,!0)}function Ti(i){var e=i.length-1,t=e*D+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function it(i){for(var e="";i--;)e+="0";return e}function xi(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/D+4);for(V=!1;;){if(t%2&&(o=o.times(e),bi(o.d,s)&&(r=!0)),t=Te(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),bi(e.d,s)}return V=!0,o}function gi(i){return i.d[i.d.length-1]&1}function Bi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Ln(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,p=d.rounding,f=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(V=!1,c=f):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ge(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=O(o.times(i),c,1),t=t.times(++l),a=s.plus(re(o,t,c,1)),Pe(a.d).slice(0,c)===Pe(s.d).slice(0,c)){for(r=m;r--;)s=O(s.times(s),c,1);if(e==null)if(u<3&&It(s.d,c-n,p,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return O(s,d.precision=f,p,V=!0);else return d.precision=f,s}s=a}}function rt(i,e){var t,n,r,o,s,a,c,u,l,m,d,p=1,f=10,g=i,y=g.d,b=g.constructor,k=b.rounding,w=b.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(e==null?(V=!1,l=w):l=e,b.precision=l+=f,t=Pe(y),n=t.charAt(0),Math.abs(o=g.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)g=g.times(i),t=Pe(g.d),n=t.charAt(0),p++;o=g.e,n>1?(g=new b("0."+t),o++):g=new b(n+"."+t.slice(1))}else return u=on(b,l+2,w).times(o+""),g=rt(new b(n+"."+t.slice(1)),l-f).plus(u),b.precision=w,e==null?O(g,w,k,V=!0):g;for(m=g,c=s=g=re(g.minus(1),g.plus(1),l,1),d=O(g.times(g),l,1),r=3;;){if(s=O(s.times(d),l,1),u=c.plus(re(s,new b(r),l,1)),Pe(u.d).slice(0,l)===Pe(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(on(b,l+2,w).times(o+""))),c=re(c,new b(p),l,1),e==null)if(It(c.d,l-f,k,a))b.precision=l+=f,u=s=g=re(m.minus(1),m.plus(1),l,1),d=O(g.times(g),l,1),r=a=1;else return O(c,b.precision=w,k,V=!0);else return b.precision=w,c;c=u,r+=2}}function Ii(i){return String(i.s*i.s/0)}function Rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%D,t<0&&(n+=D),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=D;n<r;)i.d.push(+e.slice(n,n+=D));e=e.slice(n),n=D-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),V&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Fr(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),hi.test(e))return Rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Nr.test(e))t=16,e=e.toLowerCase();else if(Kr.test(e))t=2;else if(Lr.test(e))t=8;else throw Error(ot+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=xi(n,new n(t),o,o*2)),u=tn(e,t,ve),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=an(u,l),i.d=u,V=!1,s&&(i=re(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ge(2,c):St.pow(2,c))),V=!0,i)}function Er(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:kt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/cn(5,t)),e=kt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function kt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/D);for(V=!1,c=t.times(t),a=new i(n);;){if(s=re(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=re(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return V=!0,s.d.length=m+1,s}function cn(i,e){for(var t=i;--e;)t*=i;return t}function Si(i,e){var t,n=e.s<0,r=De(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Je=n?4:1,e;if(t=e.divToInt(r),t.isZero())Je=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Je=gi(t)?n?2:3:n?4:1,e;Je=gi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Mn(i,e,t,n){var r,o,s,a,c,u,l,m,d,p=i.constructor,f=t!==void 0;if(f?(Le(t,1,st),n===void 0?n=p.rounding:Le(n,0,8)):(t=p.precision,n=p.rounding),!i.isFinite())l=Ii(i);else{for(l=Xe(i),s=l.indexOf("."),f?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=tn(Xe(d),10,r),d.e=d.d.length),m=tn(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=f?"0p+0":"0";else{if(s<0?o--:(i=new p(i),i.d=m,i.e=o,i=re(i,d,t,n,0,r),m=i.d,o=i.e,u=wi),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=Cn.charAt(m[s]);if(f){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=tn(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Cn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function bi(i,e){if(i.length>e)return i.length=e,!0}function Dr(i){return new this(i).abs()}function vr(i){return new this(i).acos()}function Vr(i){return new this(i).acosh()}function _r(i,e){return new this(i).plus(e)}function Wr(i){return new this(i).asin()}function qr(i){return new this(i).asinh()}function Gr(i){return new this(i).atan()}function Ur(i){return new this(i).atanh()}function Xr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=De(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?De(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=De(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(re(i,e,o,1)),e=De(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(re(i,e,o,1)),t}function Hr(i){return new this(i).cbrt()}function zr(i){return O(i=new this(i),i.e+1,2)}function Yr(i,e,t){return new this(i).clamp(e,t)}function Zr(i){if(!i||typeof i!="object")throw Error(sn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,st,"rounding",0,8,"toExpNeg",-At,0,"toExpPos",0,At,"maxE",0,At,"minE",-At,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Kn[t]),(n=i[t])!==void 0)if(Te(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ot+t+": "+n);if(t="crypto",r&&(this[t]=Kn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Ai);else this[t]=!1;else throw Error(ot+t+": "+n);return this}function jr(i){return new this(i).cos()}function Qr(i){return new this(i).cosh()}function Ci(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,yi(o)){u.s=o.s,V?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;V?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Rn(u,o.toString())}else if(c!=="string")throw Error(ot+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),hi.test(o)?Rn(u,o):Fr(u,o)}if(r.prototype=x,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Zr,r.clone=Ci,r.isDecimal=yi,r.abs=Dr,r.acos=vr,r.acosh=Vr,r.add=_r,r.asin=Wr,r.asinh=qr,r.atan=Gr,r.atanh=Ur,r.atan2=Xr,r.cbrt=Hr,r.ceil=zr,r.clamp=Yr,r.cos=jr,r.cosh=Qr,r.div=Jr,r.exp=$r,r.floor=eo,r.hypot=to,r.ln=no,r.log=io,r.log10=oo,r.log2=ro,r.max=so,r.min=ao,r.mod=co,r.mul=uo,r.pow=lo,r.random=mo,r.round=po,r.sign=fo,r.sin=go,r.sinh=bo,r.sqrt=yo,r.sub=wo,r.sum=Po,r.tan=Ao,r.tanh=ko,r.trunc=ho,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Jr(i,e){return new this(i).div(e)}function $r(i){return new this(i).exp()}function eo(i){return O(i=new this(i),i.e+1,3)}function to(){var i,e,t=new this(0);for(V=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return V=!0,new this(1/0);t=e}return V=!0,t.sqrt()}function yi(i){return i instanceof St||i&&i.toStringTag===ki||!1}function no(i){return new this(i).ln()}function io(i,e){return new this(i).log(e)}function ro(i){return new this(i).log(2)}function oo(i){return new this(i).log(10)}function so(){return Bi(this,arguments,"lt")}function ao(){return Bi(this,arguments,"gt")}function co(i,e){return new this(i).mod(e)}function uo(i,e){return new this(i).mul(e)}function lo(i,e){return new this(i).pow(e)}function mo(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Le(i,1,st),n=Math.ceil(i/D),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Ai);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=D,n&&i&&(r=ge(10,D-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=D)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<D&&(t-=D-n)}return s.e=t,s.d=a,s}function po(i){return O(i=new this(i),i.e+1,this.rounding)}function fo(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function go(i){return new this(i).sin()}function bo(i){return new this(i).sinh()}function yo(i){return new this(i).sqrt()}function wo(i,e){return new this(i).sub(e)}function Po(){var i=0,e=arguments,t=new this(e[i]);for(V=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return V=!0,O(t,this.precision,this.rounding)}function Ao(i){return new this(i).tan()}function ko(i){return new this(i).tanh()}function ho(i){return O(i=new this(i),i.e+1,1)}x[Symbol.for("nodejs.util.inspect.custom")]=x.toString;x[Symbol.toStringTag]="Decimal";var St=x.constructor=Ci(Kn);nn=new St(nn);rn=new St(rn);var C=St;import{PublicKey as Li}from"@solana/web3.js";import{get as Ki,set as To}from"lodash";var On=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ni={},xo={};function Ae(i){let e=Ki(Ni,i);if(!e){let t=Ki(xo,i);e=new On({name:i,logLevel:t}),To(Ni,i,e)}return e}import{MINT_SIZE as Bo,TOKEN_PROGRAM_ID as Io,getTransferFeeConfig as So,unpackMint as Co}from"@solana/spl-token";var Fn=Ae("Raydium_accountInfo_util");async function $e(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=M({batchRequest:!1},t),s=En(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=i._buildArgs([m.map(p=>p.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=En(c,10);a=(await(await Promise.all(u.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:f,lamports:g,owner:y,rentEpoch:b}=d;return p.length!==2&&p[1]!=="base64"&&Fn.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:f,lamports:g,owner:new Li(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&Fn.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function at(i,e,t){let n=await $e(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>X(M({},r),{accountInfo:n[o]}))}async function Ri({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await at(i,e.map(c=>({pubkey:dt(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<Bo){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=Co(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=X(M({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Io,feeConfig:(a=So(u))!=null?a:void 0})}return r[Li.default.toBase58()]=r[$.toBase58()],r}import et from"bn.js";import Eo from"big.js";import mn from"bn.js";import Ko from"toformat";var No=Ko,Ct=No;import ln from"big.js";import Ro from"bn.js";import Mo from"decimal.js-light";import Kt from"bn.js";var Mi=9007199254740991;function ye(i){let e=Ae("Raydium_parseBigNumberish");if(i instanceof Kt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Kt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Mi||i<=-Mi)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Kt(String(i))):typeof i=="bigint"?new Kt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Kt(0))}var un=Ae("module/fraction"),Dn=Ct(ln),Nt=Ct(Mo),Oo={[0]:Nt.ROUND_DOWN,[1]:Nt.ROUND_HALF_UP,[2]:Nt.ROUND_UP},Fo={[0]:ln.roundDown,[1]:ln.roundHalfUp,[2]:ln.roundUp},te=class{constructor(e,t=new Ro(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new te(this.denominator,this.numerator)}add(e){let t=e instanceof te?e:new te(ye(e));return this.denominator.eq(t.denominator)?new te(this.numerator.add(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof te?e:new te(ye(e));return this.denominator.eq(t.denominator)?new te(this.numerator.sub(t.numerator),this.denominator):new te(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof te?e:new te(ye(e));return new te(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof te?e:new te(ye(e));return new te(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<=0&&un.logWithError(`${e} is not positive.`),Nt.set({precision:e+1,rounding:Oo[n]});let r=new Nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<0&&un.logWithError(`${e} is negative.`),Dn.DP=e,Dn.RM=Fo[n]||1,new Dn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Do=Ae("Raydium_amount"),Oi=Ct(Eo);function vo(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Do.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var ke=class extends te{constructor(t,n,r=!0,o){let s=new mn(0),a=vn.pow(new mn(t.decimals));if(r)s=ye(n);else{let c=new mn(0),u=new mn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=vo(n.toString(),t.decimals);c=ye(l),u=ye(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=Ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new ke(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new ke(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Oi.DP=this.token.decimals,new Oi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as Vo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Fi}from"@solana/spl-token";var Vn={chainId:101,address:Vo.default.toBase58(),programId:Fi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ct={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Fi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Gn}from"@solana/web3.js";import{PublicKey as ue,SystemProgram as Ei,SYSVAR_RENT_PUBKEY as _o}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";function _n({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var ka=[_n({pubkey:Wo,isWritable:!1}),_n({pubkey:Ei.programId,isWritable:!1}),_n({pubkey:_o,isWritable:!1})];function Wn({publicKey:i,transformSol:e}){let t=Di(i.toString());if(t instanceof ue)return e&&t.equals(Lt)?$:t;if(e&&t.toString()===Lt.toBase58())return $;if(typeof t=="string"){if(t===ue.default.toBase58())return ue.default;try{return new ue(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Di(i){try{return new ue(i)}catch{return i}}var dn=new ue("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),qn=new ue("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ht=new ue("SysvarRent111111111111111111111111111111111"),ha=new ue("SysvarC1ock11111111111111111111111111111111"),pt=new ue("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ta=new ue("Sysvar1nstructions1111111111111111111111111"),xa=Ei.programId,Ba=new ue("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ia=new ue("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Sa=new ue("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ca=new ue("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ka=new ue("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Na=new ue("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),La=new ue("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ra=new ue("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ma=new ue("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Oa=new ue("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Fa=new ue("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),$=new ue("So11111111111111111111111111111111111111112"),Lt=ue.default;function dt(i){return Wn({publicKey:i,transformSol:!0})}var Un=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Lt.toBase58()||e instanceof Gn&&Lt.equals(e)){this.decimals=ct.decimals,this.symbol=ct.symbol,this.name=ct.name,this.mint=new Gn(ct.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Gn.default:Wn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},He=Un;He.WSOL=new Un(X(M({},ct),{mint:ct.address}));var Xn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},pn=Xn;pn.SOL=new Xn(Vn);import qo from"bn.js";var vi=new te(new qo(100)),ut=class extends te{toSignificant(e=5,t,n){return this.mul(vi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(vi).toFixed(e,t,n)}};var Go=Ae("Raydium_price"),Ve=class extends te{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new te(Hn(n.decimals),Hn(r.decimals))}get raw(){return new te(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ve({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Go.logWithError("mul token not equals");let n=super.mul(t);return new Ve({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as pc}from"@solana/web3.js";import gc from"bn.js";var Uo=new et(0),Mc=new et(1),Oc=new et(2),Fc=new et(3),Ec=new et(5),vn=new et(10),Dc=new et(100),vc=new et(1e3),Vc=new et(1e4);function Hn(i){return vn.pow(ye(i))}function En(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Qo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Jo}from"@solana/spl-token";import{ComputeBudgetProgram as Vi,Keypair as Wi,PublicKey as Xo,Transaction as qi,TransactionMessage as Ho,VersionedTransaction as Gi}from"@solana/web3.js";var de={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as zo}from"@solana/spl-token";var _i=Ae("Raydium_txUtil"),Ui=1644;function fn(i){let e=[],t=[];return i.microLamports&&(e.push(Vi.setComputeUnitPrice({microLamports:i.microLamports})),t.push(de.SetComputeUnitPrice)),i.units&&(e.push(Vi.setComputeUnitLimit({units:i.units})),t.push(de.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Tt(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function gn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Yo(i,e){i.length<1&&_i.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&_i.logWithError(`no signers provided:, ${e.toString()}`);let t=new qi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ui}catch{return!1}}function xe(i,e){let[t,n]=Xo.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Rt({instructions:i,payer:e,signers:t}){return Yo(i,[e,...t])}function Mt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Wi.generate().publicKey.toString()}){let o=new Ho({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Gi(o).serialize()).toString("base64").length<Ui}catch{return!1}}var Zo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),jo=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Gi&&(e=Zo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function ft(i){let e=[];return i.forEach(t=>{t instanceof qi&&(t.recentBlockhash||(t.recentBlockhash=zo.toBase58()),t.feePayer||(t.feePayer=Wi.generate().publicKey)),e.push(jo(t))}),console.log("simulate tx string:",e),e}function Be(i,e,t){return xe([i.toBuffer(),(t!=null?t:Jo).toBuffer(),e.toBuffer()],new Qo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as G}from"@solana/web3.js";var su=new G("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),au=new G("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),cu=new G("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),uu=new G("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),lu=new G("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),mu=new G("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),du=new G("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),pu=new G("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),fu=new G("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),gu=new G("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ot=new G("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Ft=new G("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),bn=new G("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),bu=new G("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),yu=new G("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),wu=new G("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Pu=new G("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Au=new G("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),ku=new G("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),hu=new G("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Tu=new G("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),xu=new G("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),$o=new G("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),es=new G("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),ts=new G("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Bu=new G("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ns=new G("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Iu=new G("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),is=new G("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Su={SERUM_MARKET:G.default,OPENBOOK_MARKET:new G("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:G.default,FarmV3:new G("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new G("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new G("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new G("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new G("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new G("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new G("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new G("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new G("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:$o,CREATE_CPMM_POOL_AUTH:es,CREATE_CPMM_POOL_FEE_ACC:ts,FEE_DESTINATION_ID:new G("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ns,LCOK_CPMM_AUTH:is};import _e from"bn.js";var Et=1e4;function le(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=X(M({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Et){let c=new _e(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=zn(i.mul(new _e(Et)),new _e(Et-o.transferFeeBasisPoints)),u=new _e(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=zn(l.mul(new _e(o.transferFeeBasisPoints)),new _e(Et)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=zn(i.mul(new _e(o.transferFeeBasisPoints)),new _e(Et)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function lt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function zn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as Xi,AddressLookupTableAccount as yn}from"@solana/web3.js";async function Yn({connection:i,address:e}){let t=await $e(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Xi(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new yn({key:s,state:yn.deserialize(o.data)});n[s.toString()]=a,wn[s.toString()]=a}return n}var wn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new yn({key:new Xi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:yn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Dt,sendAndConfirmTransaction as Zn,Transaction as vt,TransactionMessage as Vt,VersionedTransaction as _t}from"@solana/web3.js";import os from"axios";var Pn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await os.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=fn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Dt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(M({},t||{})):this.build(t)}build(e){var n;let t=new vt;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await Tt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),ft([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await Zn(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:f,skipPreflight:g=!0}=l||{},y=f!=null?f:await Tt(this.connection,this.blockhashCommitment);if((b=this.owner)!=null&&b.isKeyPair){if(m){let k=[],w=0;for(let A of s){if(++w,w<=p)continue;let h=await Zn(this.connection,A,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});k.push(h)}return{txIds:k,signedTxs:s}}return{txIds:await await Promise.all(s.map(async k=>(k.recentBlockhash=y,await this.connection.sendRawTransaction(k.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let k=s.map((A,h)=>(A.recentBlockhash=y,a[h].length&&A.sign(...a[h]),A));ft(k);let w=await this.signAllTransactions(k);if(m){let A=0,h=[],P=async()=>{if(!w[A])return;let T=await this.connection.sendRawTransaction(w[A].serialize(),{skipPreflight:g});h.push({txId:T,status:"sent",signedTx:w[A]}),d==null||d([...h]),A++,this.connection.onSignature(T,B=>{let R=h.findIndex(S=>S.txId===T);R>-1&&(h[R].status=B.err?"error":"success"),d==null||d([...h]),B.err||P()},"processed"),this.connection.getSignatureStatus(T)};return await P(),{txIds:h.map(T=>T.txId),signedTxs:w}}else{let A=[];for(let h=0;h<w.length;h+=1){let P=await this.connection.sendRawTransaction(w[h].serialize(),{skipPreflight:g});A.push(P)}return{txIds:A,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var g;let f=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=f,s=Pt(f,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=M(M({},this.cluster==="devnet"?{}:wn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Dt(y));let l=await Yn({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=r?Dt.default.toBase58():o!=null?o:await Tt(this.connection,this.blockhashCommitment),d=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new _t(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:b=!0,sendAndConfirm:k}=y||{};if(ft([p]),(w=this.owner)!=null&&w.isKeyPair){let A=await this.connection.sendTransaction(p,{skipPreflight:b});return k&&await gn(this.connection,A),{txId:A,signedTx:p}}if(this.signAllTransactions){let A=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(A[0],{skipPreflight:b}),signedTx:A[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var g;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:f=!0}=l||{};if(p&&s.forEach(y=>y.message.recentBlockhash=p),ft(s),(g=this.owner)!=null&&g.isKeyPair){if(m){let y=[];for(let b of s){let k=await this.connection.sendTransaction(b,{skipPreflight:f});await gn(this.connection,k),y.push(k)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:f}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,k=[],w=async()=>{if(!y[b])return;let A=await this.connection.sendTransaction(y[b],{skipPreflight:f});k.push({txId:A,status:"sent",signedTx:y[b]}),d==null||d([...k]),b++,this.connection.onSignature(A,h=>{let P=k.findIndex(T=>T.txId===A);P>-1&&(k[P].status=h.err?"error":"success"),d==null||d([...k]),h.err||w()},"processed"),this.connection.getSignatureStatus(A)};return w(),{txIds:[],signedTxs:y}}else{let b=[];for(let k=0;k<y.length;k+=1){let w=await this.connection.sendTransaction(y[k],{skipPreflight:f});b.push(w)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=Pt(u,["computeBudgetConfig"]),r=t?fn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>X(M({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],p=t?[...r.instructions,...d]:d,g=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Dt(y));if(c.length<12&&Rt({instructions:p,payer:this.feePayer,signers:g})||Rt({instructions:d,payer:this.feePayer,signers:g}))c.push(m);else{if(c.length===0)throw Error("item ins too big");Rt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:g})?s.push(new vt().add(...r.instructions,...c)):s.push(new vt().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(p=>p.keys.filter(f=>f.isSigner).map(f=>f.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Rt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new vt().add(...r.instructions,...c)):s.push(new vt().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var k;let{sequentially:d,onTxUpdate:p,skipTxCount:f=0,recentBlockHash:g,skipPreflight:y=!0}=m||{},b=g!=null?g:await Tt(this.connection,this.blockhashCommitment);if(s.forEach(async(w,A)=>{w.recentBlockhash=b,a[A].length&&w.sign(...a[A])}),ft(s),(k=this.owner)!=null&&k.isKeyPair){if(d){let w=0,A=[];for(let h of s){if(++w,w<=f){A.push("tx skipped");continue}let P=await Zn(this.connection,h,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});A.push(P)}return{txIds:A,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s.slice(f,s.length)),A=[...s.slice(0,f),...w];if(d){let h=0,P=[],T=async()=>{if(!A[h])return;h<f&&(P.push({txId:"",status:"success",signedTx:A[h]}),p==null||p([...P]),h++,T());let B=await this.connection.sendRawTransaction(A[h].serialize(),{skipPreflight:y});P.push({txId:B,status:"sent",signedTx:A[h]}),p==null||p([...P]),h++,this.connection.onSignature(B,R=>{let S=P.findIndex(K=>K.txId===B);S>-1&&(P[S].status=R.err?"error":"success"),p==null||p([...P]),R.err||T()},"processed"),this.connection.getSignatureStatus(B)};return await T(),{txIds:P.map(B=>B.txId),signedTxs:A}}else{let h=[];for(let P=0;P<A.length;P+=1){let T=await this.connection.sendRawTransaction(A[P].serialize(),{skipPreflight:y});h.push(T)}return{txIds:h,signedTxs:A}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=Pt(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=M(M({},this.cluster==="devnet"?{}:wn),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let k of a)s[k]===void 0&&c.push(new Dt(k));let u=await Yn({connection:this.connection,address:c});for(let[k,w]of Object.entries(u))s[k]=w;let l=t?fn(t):{instructions:[],instructionTypes:[]},m=await Tt(this.connection,this.blockhashCommitment),d=this.signers.reduce((k,w)=>X(M({},k),{[w.publicKey.toBase58()]:w}),{}),p=[],f=[],g=[];if(this.allInstructions.forEach(k=>{let w=[...g,k],A=t?[...l.instructions,...w]:w;if(g.length<12&&Mt({instructions:A,payer:this.feePayer,lookupTableAddressAccount:s})||Mt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(k);else{if(g.length===0)throw Error("item ins too big");let h={};for(let P of[...new Set(a)])s[P]!==void 0&&(h[P]=s[P]);if(t&&Mt({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new _t(P))}else{let P=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new _t(P))}f.push(Array.from(new Set(g.map(P=>P.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(P=>d[P]).filter(P=>P!==void 0)),g=[k]}}),g.length>0){let w=[...new Set(g.map(A=>A.keys.filter(h=>h.isSigner).map(h=>h.pubkey.toString())).flat()).values()].map(A=>d[A]).filter(A=>A!==void 0);if(t&&Mt({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let A=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new _t(A))}else{let A=new Vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new _t(A))}f.push(w)}return(b=this.owner)!=null&&b.signer&&f.forEach(k=>{k.some(w=>w.publicKey.equals(this.owner.publicKey))||k.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:f,instructionTypes:this.instructionTypes,execute:async k=>{var B;let{sequentially:w,onTxUpdate:A,skipTxCount:h=0,recentBlockHash:P,skipPreflight:T=!0}=k||{};if(p.map(async(R,S)=>{f[S].length&&R.sign(f[S]),P&&(R.message.recentBlockhash=P)}),ft(p),(B=this.owner)!=null&&B.isKeyPair){if(w){let R=0,S=[];for(let K of p){if(++R,R<=h){console.log("skip tx: ",R),S.push("tx skipped");continue}let q=await this.connection.sendTransaction(K,{skipPreflight:T});await gn(this.connection,q),S.push(q)}return{txIds:S,signedTxs:p}}return{txIds:await Promise.all(p.map(async R=>await this.connection.sendTransaction(R,{skipPreflight:T}))),signedTxs:p}}if(this.signAllTransactions){let R=await this.signAllTransactions(p.slice(h,p.length)),S=[...p.slice(0,h),...R];if(w){let K=0,q=[],J=async()=>{if(!S[K])return;if(K<h){q.push({txId:"",status:"success",signedTx:S[K]}),A==null||A([...q]),K++,J();return}let oe=await this.connection.sendTransaction(S[K],{skipPreflight:T});q.push({txId:oe,status:"sent",signedTx:S[K]}),A==null||A([...q]),K++,this.connection.onSignature(oe,ee=>{let Y=q.findIndex(mt=>mt.txId===oe);Y>-1&&(q[Y].status=ee.err?"error":"success"),A==null||A([...q]),ee.err||J()},"processed"),this.connection.getSignatureStatus(oe)};return J(),{txIds:[],signedTxs:S}}else{let K=[];for(let q=0;q<S.length;q+=1){let J=await this.connection.sendTransaction(S[q],{skipPreflight:T});K.push(J)}return{txIds:K,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{AccountLayout as Tr,TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";import{PublicKey as dl}from"@solana/web3.js";import{MintLayout as fl,TOKEN_PROGRAM_ID as bl}from"@solana/spl-token";var An=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=Pt(o,["address","programId","decimals"]);return M({chainId:101,address:dt(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},jn=i=>i?X(M({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:X(M({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:X(M({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var Qn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),Wt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=Ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new Pn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Qn(e))}logInfo(...e){this.logger.info(Qn(e))}logAndCreateError(...e){let t=Qn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as In,PublicKey as I,SystemProgram as wt,TransactionInstruction as Ne}from"@solana/web3.js";import Pr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ui,TOKEN_2022_PROGRAM_ID as Qe,TOKEN_PROGRAM_ID as ae}from"@solana/spl-token";import{PublicKey as fs}from"@solana/web3.js";import Zi,{isBN as ji}from"bn.js";import{bits as Sl,BitStructure as Cl,blob as ss,Blob as Kl,cstr as Nl,f32 as Ll,f32be as Rl,f64 as Ml,f64be as Ol,greedy as Fl,Layout as as,ns64 as El,ns64be as Dl,nu64 as vl,nu64be as Vl,offset as _l,s16 as Wl,s16be as ql,s24 as Gl,s24be as Ul,s32 as cs,s32be as Xl,s40 as Hl,s40be as zl,s48 as Yl,s48be as Zl,s8 as jl,seq as us,struct as Ql,Structure as ls,u16 as ms,u16be as Jl,u24 as $l,u24be as em,u32 as tm,u32be as nm,u40 as im,u40be as rm,u48 as om,u48be as sm,u8 as ds,UInt as ps,union as am,Union as cm,unionLayoutDiscriminator as um,utf8 as lm}from"@solana/buffer-layout";var Jn=as,Hi=ls;var $n=ps;var zi=ds,qt=ms;var he=cs;var Yi=us;var Me=ss;var xt=class extends Jn{constructor(t,n,r){super(t,r);this.blob=Me(t),this.signed=n}decode(t,n=0){let r=new Zi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Zi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function pe(i){return new $n(1,i)}function Bt(i){return new $n(4,i)}function F(i){return new xt(8,!1,i)}function j(i){return new xt(16,!1,i)}function Qi(i){return new xt(8,!0,i)}function Ji(i){return new xt(16,!0,i)}var kn=class extends Jn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function ne(i){return new kn(Me(32),e=>new fs(e),e=>e.toBuffer(),i)}function We(i){return new kn(zi(),gs,bs,i)}function gs(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function bs(i){return i?1:0}var ei=class extends Hi{decode(e,t){return super.decode(e,t)}};function ie(i,e,t){return new ei(i,e,t)}function me(i,e,t){let n,r=typeof e=="number"?e:ji(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ji(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Yi(i,r,t)}import Cs from"bn.js";import Fe from"bn.js";var Q=new Fe(0),ze=new Fe(1),tt=new Fe(-1),Oe=new Fe(1).shln(64),hn=new Fe(1).shln(128),ti=Oe.sub(ze),Gt=64,$i=hn.subn(1),Ie=-443636,Se=-Ie,Ye=new Fe("4295048016"),Ze=new Fe("79226673521066979257578248091"),xm=new Fe("4295048017"),Bm=new Fe("79226673521066979257578248090"),er=16,tr="59543866431248",nr="184467440737095516",ir="15793534762490258745",Tn=new Fe(10).pow(new Fe(6)),ys=(n=>(n[n.rate_500=500]="rate_500",n[n.rate_3000=3e3]="rate_3000",n[n.rate_10000=1e4]="rate_10000",n))(ys||{}),Im={[500]:10,[3e3]:60,[1e4]:200},Sm={version:6,liquidity:Q,tickCurrent:0,feeGrowthGlobalX64A:Q,feeGrowthGlobalX64B:Q,protocolFeesTokenA:Q,protocolFeesTokenB:Q,swapInAmountTokenA:Q,swapOutAmountTokenB:Q,swapInAmountTokenB:Q,swapOutAmountTokenA:Q,tickArrayBitmap:[],rewardInfos:[],day:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},week:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},month:{volume:0,volumeFee:0,feeA:0,feeB:0,feeApr:0,rewardApr:{A:0,B:0,C:0},apr:0,priceMax:0,priceMin:0},tvl:0},rr={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Cm=new Fe("18446744073700000000");import U from"bn.js";function or(i){let e=new ArrayBuffer(2);return new DataView(e).setUint16(0,i,!1),new Uint8Array(e)}function Nm(i){let e=new ArrayBuffer(2);return new DataView(e).setInt16(0,i,!1),new Uint8Array(e)}function Lm(i){let e=new ArrayBuffer(4);return new DataView(e).setUint32(0,i,!1),new Uint8Array(e)}function xn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function ni(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function ii(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Ut(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function sr(i,e){return Ut(i,e)?null:ni(i,e)}function ar(i,e){return Ut(i,e)?null:ii(i,e)}var ws=Buffer.from("amm_config","utf8"),Ps=Buffer.from("pool","utf8"),As=Buffer.from("pool_vault","utf8"),ks=Buffer.from("pool_reward_vault","utf8"),cr=Buffer.from("position","utf8"),hs=Buffer.from("tick_array","utf8"),Ts=Buffer.from("operation","utf8"),xs=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Bs=Buffer.from("observation","utf8");function Fm(i,e){return xe([ws,or(e)],i)}function ur(i,e,t,n){return xe([Ps,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function ri(i,e,t){return xe([As,e.toBuffer(),t.toBuffer()],i)}function lr(i,e,t){return xe([ks,e.toBuffer(),t.toBuffer()],i)}function H(i,e,t){return xe([hs,e.toBuffer(),xn(t)],i)}function qe(i,e,t,n){return xe([cr,e.toBuffer(),xn(t),xn(n)],i)}function Ce(i,e){return xe([cr,e.toBuffer()],i)}function Xt(i){return xe([Buffer.from("metadata","utf8"),pt.toBuffer(),i.toBuffer()],pt)}function Ht(i){return xe([Ts],i)}function Ke(i,e){return xe([xs,e.toBuffer()],i)}function mr(i,e){return xe([Bs,e.toBuffer()],i)}var dr=Buffer.from("locked_position","utf8");function oi(i,e){return xe([dr,e.toBuffer()],i)}function zt(i,e){return xe([dr,e.toBuffer()],i)}import{PublicKey as Ge}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as pr}from"@solana/spl-token";import se from"bn.js";import je from"bn.js";var Yt=class{static getfeeGrowthInside(e,t,n){let r=new je(0),o=new je(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new je(0),a=new je(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=v.wrappingSubU128(v.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),c=t.tokenFeesOwedA.add(a),u=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=v.mulDivFloor(v.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),c=t.tokenFeesOwedA.add(a),u=v.mulDivFloor(v.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=v.wrappingSubU128(c,u.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Oe),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=v.wrappingSubU128(c,u.growthInsideLastX64),m=v.mulDivFloor(l,t.liquidity,Oe),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new je(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new je(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(v.wrappingSubU128(v.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,k,w;let a=E.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),c=E.getSqrtPriceX64FromTick(t.tickLower),u=E.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=z.getAmountsFromLiquidity(a,c,u,n,o),[d,p]=[le(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),le(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[f,g]=[le(new je(new C(m.amountA.toString()).mul(l).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,s,!0),le(new je(new C(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:f,amountSlippageB:g,expirationTime:lt(d.expirationTime,p.expirationTime)}}};var Is=15,Z=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=L.getTickArrayStartIndexByTick(r,o),l=L.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Is/2));for(let p=0;p<l.length;p++){let{publicKey:f}=H(t,n,l[p]);c.push(f)}let m=(await $e(e,c)).map(p=>p!==null?Zt.decode(p.data):null),d={};for(let p=0;p<c.length;p++){let f=m[p];f!==null&&(d[f.startTickIndex]=X(M({},f),{address:c[p]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=L.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Z.tickCount(t)),a=n?L.searchLowBitFromStart(r,o,s-1,1,t):L.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=H(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=L.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<be;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=H(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Se)return!1;let n=L.getTickArrayStartIndexByTick(Ie,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};var si=14,nt=class{static maxTickInTickarrayBitmap(e){return e*be*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Z.tickCount(n):t+Z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=sr(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=ar(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Z.tickCount(n)}}}},jt=class{static getBitmapOffset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=nt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=nt.maxTickInTickarrayBitmap(e),n=-t;if(Se<=t)throw Error(`extensionTickBoundary check error: ${Se}, ${t}`);if(n<=Ie)throw Error(`extensionTickBoundary check error: ${n}, ${Ie}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=nt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=L.mergeTickArrayBitmap(e).shln(gt-1-a),u=Ut(512,c)?null:ni(512,c);if(u!==null){let l=t-u*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=L.mergeTickArrayBitmap(e).shrn(a),u=Ut(512,c)?null:ii(512,c);if(u!==null){let l=t+u*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%nt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Z.tickCount(t));return e<0&&n!=0&&(r=gt-r),r}};var fe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:p,accounts:f,sqrtPriceX64:g,feeAmount:y}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...f),{allTrade:d,expectedAmountOut:p.mul(tt),remainingAccounts:c,executionPrice:g,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let g=this.preInitializedTickArrayStartIndex(e,s);if(g.isExist){let{publicKey:y}=H(e.programId,e.id,g.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:f}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(tt),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:f}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=fe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?jt.checkTickArrayIsInit(Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=H(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=H(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Z.tickCount(e.tickSpacing)),r=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=nt.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=jt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Ie||t>Se)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let p=X(M({},m),{perSecond:v.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ge(d)});if(p.tokenMint.equals(Ge.default))continue;if(n<=p.openTime.toNumber()||r.eq(Q)){s.push(p);continue}let f=new se(Math.min(p.endTime.toNumber(),n)),g=f.sub(p.lastUpdateTime),y=v.mulDivFloor(g,p.emissionsPerSecondX64,r),b=p.rewardGrowthGlobalX64.add(y),k=v.mulDivFloor(g,p.emissionsPerSecondX64,Oe),w=p.rewardTotalEmissioned.add(k);s.push(X(M({},p),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:f}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=L.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=nt.maxTickInTickarrayBitmap(e),n=-t;return t>Se&&(t=Z.getArrayStartIndex(Se,e)+Z.tickCount(e)),n<Ie&&(n=Z.getArrayStartIndex(Ie,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Z.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await at(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=gr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=L.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=L.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=H(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await at(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=Zt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=X(M({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let p of s)u.push(Ce(p,d).publicKey);let l=await $e(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let p=Qt.decode(d.data),f=p.poolId.toString(),g=e.find(B=>B.state.id.toBase58()===f);if(g===void 0)continue;let y=g.state,b=L._getTickPriceLegacy({poolInfo:y,tick:p.tickLower,baseIn:!0}),k=L._getTickPriceLegacy({poolInfo:y,tick:p.tickUpper,baseIn:!0}),{amountA:w,amountB:A}=z.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,k.tickSqrtPriceX64,p.liquidity,!1),h=1/(1-Math.sqrt(Math.sqrt(b.price.div(k.price).toNumber())));g.positionAccount=[...(a=g.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:b.price,priceUpper:k.price,amountA:w,amountB:A,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(B=>X(M({},B),{pendingReward:new se(0)})),leverage:h,tokenFeeAmountA:new se(0),tokenFeeAmountB:new se(0)}];let P=await L.getTickArrayAddressByTick(g.state.programId,p.poolId,p.tickLower,g.state.tickSpacing),T=await L.getTickArrayAddressByTick(g.state.programId,p.poolId,p.tickUpper,g.state.tickSpacing);m[`${g.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=P,m[`${g.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=T}if(o){let d=Object.values(m),p=await $e(t,d,{batchRequest:r}),f={};for(let g=0;g<d.length;g++){let y=p[g];if(y===null)continue;let b=d[g].toString();f[b]=Zt.decode(y.data)}for(let{state:g,positionAccount:y}of e)if(!!y)for(let b of y){let k=`${g.programId.toString()}-${g.id.toString()}-${b.tickLower}`,w=`${g.programId.toString()}-${g.id.toString()}-${b.tickUpper}`,A=f[m[k].toString()],h=f[m[w].toString()],P=A.ticks[L.getTickOffsetInArray(b.tickLower,g.tickSpacing)],T=h.ticks[L.getTickOffsetInArray(b.tickUpper,g.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:R}=await Yt.GetPositionFees(g,b,P,T),S=await Yt.GetPositionRewards(g,b,P,T);b.tokenFeeAmountA=B.gte(new se(0))?B:new se(0),b.tokenFeeAmountB=R.gte(new se(0))?R:new se(0);for(let K=0;K<S.length;K++)b.rewardInfos[K].pendingReward=S[K].gte(new se(0))?S[K]:new se(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new C(0),catchLiquidityInsufficient:c=!1}){var q;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new C(0))?u=l?Ye.add(new se(1)):Ze.sub(new se(1)):u=E.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=le(o,m,r,!1),{allTrade:f,expectedAmountOut:g,remainingAccounts:y,executionPrice:b,feeAmount:k}=fe.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((q=p.fee)!=null?q:Q),u,c),w=le(g,d,r,!1),A=E.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),h=l?A:new C(1).div(A),P=g.mul(new se(Math.floor((1-s)*1e10))).div(new se(1e10)),T=le(P,d,r,!1),B=l?e.currentPrice:new C(1).div(e.currentPrice),R=new C(h).sub(B).abs(),S=B,K=new ut(new C(R).mul(10**15).toFixed(0),new C(S).mul(10**15).toFixed(0));return{allTrade:f,realAmountIn:p,amountOut:w,minAmountOut:T,expirationTime:lt(p.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:K,fee:k,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new He(X(M({},u),{mint:u.address,isToken2022:u.programId===pr.toBase58()})),new He(X(M({},l),{mint:l.address,isToken2022:l.programId===pr.toBase58()}))],{allTrade:p,realAmountIn:f,amountOut:g,minAmountOut:y,expirationTime:b,currentPrice:k,executionPrice:w,priceImpact:A,fee:h,remainingAccounts:P,executionPriceX64:T}=fe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ge(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=X(M({},f),{amount:new ke(m,f.amount),fee:f.fee===void 0?void 0:new ke(m,f.fee)}),R=X(M({},g),{amount:new ke(d,g.amount),fee:g.fee===void 0?void 0:new ke(d,g.fee)}),S=X(M({},y),{amount:new ke(d,y.amount),fee:y.fee===void 0?void 0:new ke(d,y.fee)}),K=new Ve({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:k.mul(new C(10**(20+d.decimals))).toFixed(0)}),q=new Ve({baseToken:m,denominator:new se(10).pow(new se(20+m.decimals)),quoteToken:d,numerator:w.mul(new C(10**(20+d.decimals))).toFixed(0)}),J=new ke(m,h);return{allTrade:p,realAmountIn:B,amountOut:R,minAmountOut:S,expirationTime:b,currentPrice:K,executionPrice:q,priceImpact:A,fee:J,remainingAccounts:P,executionPriceX64:T}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new C(0)}){var S;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new C(0))?l=c?Ze.sub(new se(1)):Ye.add(new se(1)):l=E.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=le(o,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:f,feeAmount:g}=fe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((S=m.fee)!=null?S:Q),l),y=c?e.mintB.address:e.mintA.address,b=le(d,u[y],r,!1),k=E.sqrtPriceX64ToPrice(f,e.mintA.decimals,e.mintB.decimals),w=c?k:new C(1).div(k),A=d.mul(new se(Math.floor((1+s)*1e10))).div(new se(1e10)),h=le(A,u[y],r,!0),P=c?e.currentPrice:new C(1).div(e.currentPrice),T=new C(w).sub(P).abs(),B=P,R=new ut(new C(T).mul(10**15).toFixed(0),new C(B).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:h,realAmountOut:m,expirationTime:lt(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:R,fee:g,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var f,g,y;let o=e[t],s=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=L.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((f=o.rewardApr[0])!=null?f:0)*p,((g=o.rewardApr[1])!=null?g:0)*p,((y=o.rewardApr[2])!=null?y:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[dt(e.mintA.address).toString()],d=r[dt(e.mintB.address).toString()],p=e.mintA.decimals,f=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let g=E.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),y=E.getSqrtPriceX64FromTick(s),b=E.getSqrtPriceX64FromTick(a),{amountSlippageA:k,amountSlippageB:w}=z.getAmountsFromLiquidityWithSlippage(g,y,b,t,!1,!1,0),{amountSlippageA:A,amountSlippageB:h}=z.getAmountsFromLiquidityWithSlippage(g,y,b,o,!1,!1,0),P=new C(k.toString()).div(new C(10).pow(p)).mul(m.value).add(new C(w.toString()).div(new C(10).pow(f)).mul(d.value)),T=new C(A.toString()).div(new C(10).pow(p)).mul(m.value).add(new C(h.toString()).div(new C(10).pow(f)).mul(d.value)),B=new C(1).div(P.add(T)),S=new C(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),K=3600*24*365,q=e.rewardDefaultInfos.map(J=>{var Y,mt;let oe=J.mint.decimals,ee=r[J.mint.address];return c<((Y=J.startTime)!=null?Y:0)||c>((mt=J.endTime)!=null?mt:0)||!J.perSecond||!ee||oe===void 0?0:new C(ee.value).mul(new C(J.perSecond).mul(K)).div(new C(10).pow(oe)).mul(B).mul(100).toNumber()});return{feeApr:S,rewardsApr:q,apr:S+q.reduce((J,oe)=>J+oe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,k;let l=E.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),m=E.getSqrtPriceX64FromTick(n),d=E.getSqrtPriceX64FromTick(r),p=a?1-s:1+s,f=le(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),g=new se(new C(f.amount.sub((k=f.fee)!=null?k:Q).toString()).mul(p).toFixed(0)),y;if(l.lte(m))y=t?z.getLiquidityFromTokenAmountA(m,d,g,!a):new se(0);else if(l.lte(d)){let w=z.getLiquidityFromTokenAmountA(l,d,g,!a),A=z.getLiquidityFromTokenAmountB(m,l,g);y=t?w:A}else y=t?new se(0):z.getLiquidityFromTokenAmountB(m,d,g);return fe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,k,w;let c=E.getSqrtPriceX64FromTick(n),u=E.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=z.getAmountsFromLiquidity(E.priceToSqrtPriceX64(new C(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,p]=[le(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),le(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[f,g]=[le(m.amountA.muln(l),(k=t.mintA.extensions)==null?void 0:k.feeConfig,e,!0),le(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:f,amountSlippageB:g,expirationTime:lt(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ge(c.id));(await $e(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=Bn.decode(c.data))});let s=t.map(c=>Ke(new Ge(c.programId),new Ge(c.id)).publicKey),a=await fe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>X(M({},c),{[u.id]:X(M({},n[u.id]),{id:new Ge(u.id),version:6,programId:new Ge(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:X(M({},u.config),{id:new Ge(u.config.id),fundOwner:""}),currentPrice:new C(u.price),exBitmapInfo:a[Ke(new Ge(u.programId),new Ge(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};function Ad({poolInfo:i,tickLower:e,tickUpper:t,amountA:n,amountB:r,slippage:o,add:s,epochInfo:a,amountHasFee:c}){var w,A,h,P;let[u,l,m,d]=e<t?[e,t,n,r]:[t,e,r,n],p=E.priceToSqrtPriceX64(new C(i.price),i.mintA.decimals,i.mintB.decimals),f=E.getSqrtPriceX64FromTick(u),g=E.getSqrtPriceX64FromTick(l),[y,b]=[le(m,(w=i.mintA.extensions)==null?void 0:w.feeConfig,a,!c),le(d,(A=i.mintB.extensions)==null?void 0:A.feeConfig,a,!c)],k=z.getLiquidityFromTokenAmounts(p,f,g,y.amount.sub((h=y.fee)!=null?h:Q),b.amount.sub((P=b.fee)!=null?P:Q));return z.getAmountsOutFromLiquidity({poolInfo:i,tickLower:e,tickUpper:t,liquidity:k,slippage:o,add:s,epochInfo:a,amountAddFee:!c})}var ai={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function fr(i){return X(M({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,openTime:i.startTime.toString(),tvl:0,day:ai,week:ai,month:ai,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:X(M({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var v=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(Q)||(o=o.add(ze)),o}static mulDivFloor(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(Q))throw new Error("division by 0");return e.mul(t).add(n.sub(ze)).div(n)}static x64ToDecimal(e,t){return new C(e.toString()).div(C.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new U(e.mul(C.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(hn).sub(t).mod(hn)}};function we(i,e){return ci(i.mul(e),64,256)}function Ss(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function ci(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var E=class{static sqrtPriceX64ToPrice(e,t,n){return v.x64ToDecimal(e).pow(2).mul(C.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return v.decimalToX64(e.mul(C.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(Q))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(Q))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(Q))return e;let o=t.shln(Gt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?v.mulDivCeil(s,e,a):v.mulDivRoundingUp(s,ze,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return v.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Gt);if(r)return e.add(o.div(t));{let s=v.mulDivRoundingUp(o,ze,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Ie||e>Se)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new U("18445821805675395072"):new U("18446744073709551616");return(t&2)!=0&&(n=we(n,new U("18444899583751176192"))),(t&4)!=0&&(n=we(n,new U("18443055278223355904"))),(t&8)!=0&&(n=we(n,new U("18439367220385607680"))),(t&16)!=0&&(n=we(n,new U("18431993317065453568"))),(t&32)!=0&&(n=we(n,new U("18417254355718170624"))),(t&64)!=0&&(n=we(n,new U("18387811781193609216"))),(t&128)!=0&&(n=we(n,new U("18329067761203558400"))),(t&256)!=0&&(n=we(n,new U("18212142134806163456"))),(t&512)!=0&&(n=we(n,new U("17980523815641700352"))),(t&1024)!=0&&(n=we(n,new U("17526086738831433728"))),(t&2048)!=0&&(n=we(n,new U("16651378430235570176"))),(t&4096)!=0&&(n=we(n,new U("15030750278694412288"))),(t&8192)!=0&&(n=we(n,new U("12247334978884435968"))),(t&16384)!=0&&(n=we(n,new U("8131365268886854656"))),(t&32768)!=0&&(n=we(n,new U("3584323654725218816"))),(t&65536)!=0&&(n=we(n,new U("696457651848324352"))),(t&131072)!=0&&(n=we(n,new U("26294789957507116"))),(t&262144)!=0&&(n=we(n,new U("37481735321082"))),e>0&&(n=$i.div(n)),n}static getTickFromPrice(e,t,n){return E.getTickFromSqrtPriceX64(E.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Ze)||e.lt(Ye))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new U(t-64),r=Ss(n,32,128),o=new U("8000000000000000","hex"),s=0,a=new U(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new U(0))&&s<er;){c=c.mul(c);let f=c.shrn(127);c=c.shrn(63+f.toNumber()),a=a.add(o.mul(f)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new U(tr)),d=ci(m.sub(new U(nr)),64,128).toNumber(),p=ci(m.add(new U(ir)),64,128).toNumber();return d==p?d:E.getSqrtPriceX64FromTick(p).lte(e)?p:d}},yt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=E.getTickFromSqrtPriceX64(E.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=yt.getTickWithPriceAndTickspacing(e,t,n,r),s=E.getSqrtPriceX64FromTick(o);return E.sqrtPriceX64ToPrice(s,n,r)}},z=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Gt),s=t.sub(e);return r?v.mulDivRoundingUp(v.mulDivCeil(o,s,t),ze,e):v.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(Q))throw new Error("sqrtPriceX64A must greater than 0");return r?v.mulDivCeil(n,t.sub(e),Oe):v.mulDivFloor(n,t.sub(e),Oe)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?v.mulDivRoundingUp(a,ze,ti):a.shrn(Gt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),v.mulDivFloor(n,ti,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return z.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=z.getLiquidityFromTokenAmountA(e,n,r,!1),a=z.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return z.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:z.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new U(0)};if(e.lt(n)){let s=z.getTokenAmountAFromLiquidity(e,n,r,o),a=z.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new U(0),amountB:z.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=z.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new U(new C(c.toString()).mul(l).toFixed(0)),d=new U(new C(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var k,w,A,h;let u=E.priceToSqrtPriceX64(new C(e.price),e.mintA.decimals,e.mintB.decimals),l=E.getSqrtPriceX64FromTick(t),m=E.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=z.getAmountsFromLiquidity(u,l,m,r,s),[f,g]=[le(p.amountA,(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,c),le(p.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[y,b]=[le(new U(new C(p.amountA.toString()).mul(d).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,c),le(new U(new C(p.amountB.toString()).mul(d).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,c)];return{liquidity:r,amountA:f,amountB:g,amountSlippageA:y,amountSlippageB:b,expirationTime:lt(f.expirationTime,g.expirationTime)}}},bt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g=!1){if(d.eq(Q))throw new Error("amountSpecified must not be 0");if(f||(f=s?Ye.add(ze):Ze.sub(ze)),s){if(f.lt(Ye))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(f.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(f.gt(Ze))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(f.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(Q),b={amountSpecifiedRemaining:d,amountCalculated:Q,sqrtPriceX64:m,tick:u>p?Math.min(p+Z.tickCount(l)-1,u):p,accounts:[],liquidity:c,feeAmount:new U(0)},k=p,w=n[p],A=0,h=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(Q)&&!b.sqrtPriceX64.eq(f);){A>10;let P={};P.sqrtPriceStartX64=b.sqrtPriceX64;let T=L.nextInitTick(w,b.tick,l,s,h),B=T||null,R=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let K=fe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},k,s);if(!K.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}k=K.nextStartIndex;let{publicKey:q}=H(e,t,k);R=q,w=n[k];try{B=L.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}P.tickNext=B.tick,P.initialized=B.liquidityGross.gtn(0),p!==k&&R&&(b.accounts.push(R),p=k),P.tickNext<Ie?P.tickNext=Ie:P.tickNext>Se&&(P.tickNext=Se),P.sqrtPriceNextX64=E.getSqrtPriceX64FromTick(P.tickNext);let S;if(s&&P.sqrtPriceNextX64.lt(f)||!s&&P.sqrtPriceNextX64.gt(f)?S=f:S=P.sqrtPriceNextX64,[b.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=bt.swapStepCompute(b.sqrtPriceX64,S,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(P.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),b.amountCalculated=b.amountCalculated.sub(P.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(P.amountOut),b.amountCalculated=b.amountCalculated.add(P.amountIn.add(P.feeAmount))),b.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let K=B.liquidityNet;s&&(K=K.mul(tt)),b.liquidity=z.addDelta(b.liquidity,K)}h=P.tickNext!=b.tick&&!s&&w.startTickIndex===P.tickNext,b.tick=s?P.tickNext-1:P.tickNext}else if(b.sqrtPriceX64!=P.sqrtPriceStartX64){let K=E.getTickFromSqrtPriceX64(b.sqrtPriceX64);h=K!=b.tick&&!s&&w.startTickIndex===K,b.tick=K}++A}try{let{nextStartIndex:P,isExist:T}=Z.nextInitializedTickArray(b.tick,l,s,r,o);T&&p!==P&&(b.accounts.push(H(e,t,P).publicKey),p=P)}catch{}return{allTrade:!0,amountSpecifiedRemaining:Q,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new U(0),amountIn:new U(0),amountOut:new U(0),feeAmount:new U(0)},a=e.gte(t),c=r.gte(Q);if(c){let l=v.mulDivFloor(r,Tn.sub(new U(o.toString())),Tn);s.amountIn=a?z.getTokenAmountAFromLiquidity(t,e,n,!0):z.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=E.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?z.getTokenAmountBFromLiquidity(t,e,n,!1):z.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(tt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=E.getNextSqrtPriceX64FromOutput(e,n,r.mul(tt),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=z.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=z.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:z.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:z.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(tt))&&(s.amountOut=r.mul(tt)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=v.mulDivCeil(s.amountIn,new U(o),Tn.sub(new U(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,gt=512,L=class{static getTickArrayAddressByTick(e,t,n,r){let o=L.getTickArrayStartIndexByTick(n,r),{publicKey:s}=H(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new Cs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...L.searchLowBitFromStart(e,t,s-1,o,n),...L.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,0,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=L.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=H(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>L.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=Z.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>L.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=Z.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Ie||e>Se}static nextInitTick(e,t,n,r,o){if(Z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=E.getSqrtPriceX64FromTick(t),o=E.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new C(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new C(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=E.getSqrtPriceX64FromTick(o),a=E.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new C(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=E.getSqrtPriceX64FromTick(t),o=E.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new C(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new C(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=E.getSqrtPriceX64FromTick(o),a=E.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new C(1).div(a)}}};var br=ie([Me(8),pe("bump"),qt("index"),ne(""),Bt("protocolFeeRate"),Bt("tradeFeeRate"),qt("tickSpacing"),me(F(),8,"")]),Ks=ie([Bt("blockTimestamp"),Qi("tickCumulative"),me(F(),4)]),yr=ie([Me(8),We("initialized"),F("recentEpoch"),qt("observationIndex"),ne("poolId"),me(Ks,100,"observations"),me(F(),4)]),Ns=ie([pe("rewardState"),F("openTime"),F("endTime"),F("lastUpdateTime"),j("emissionsPerSecondX64"),F("rewardTotalEmissioned"),F("rewardClaimed"),ne("tokenMint"),ne("tokenVault"),ne("creator"),j("rewardGrowthGlobalX64")]),Bn=ie([Me(8),pe("bump"),ne("ammConfig"),ne("creator"),ne("mintA"),ne("mintB"),ne("vaultA"),ne("vaultB"),ne("observationId"),pe("mintDecimalsA"),pe("mintDecimalsB"),qt("tickSpacing"),j("liquidity"),j("sqrtPriceX64"),he("tickCurrent"),Bt(),j("feeGrowthGlobalX64A"),j("feeGrowthGlobalX64B"),F("protocolFeesTokenA"),F("protocolFeesTokenB"),j("swapInAmountTokenA"),j("swapOutAmountTokenB"),j("swapInAmountTokenB"),j("swapOutAmountTokenA"),pe("status"),me(pe(),7,""),me(Ns,3,"rewardInfos"),me(F(),16,"tickArrayBitmap"),F("totalFeesTokenA"),F("totalFeesClaimedTokenA"),F("totalFeesTokenB"),F("totalFeesClaimedTokenB"),F("fundFeesTokenA"),F("fundFeesTokenB"),F("startTime"),me(F(),15*4-3,"padding")]),Ls=ie([j("growthInsideLastX64"),F("rewardAmountOwed")]),Qt=ie([Me(8),pe("bump"),ne("nftMint"),ne("poolId"),he("tickLower"),he("tickUpper"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),me(Ls,3,"rewardInfos"),me(F(),8,"")]),Ud=ie([Me(8),pe("bump"),ne("poolId"),he("tickLowerIndex"),he("tickUpperIndex"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),F("tokenFeesOwedA"),F("tokenFeesOwedB"),me(j(),3,"rewardGrowthInside"),me(F(),8,"")]),Rs=ie([he("tick"),Ji("liquidityNet"),j("liquidityGross"),j("feeGrowthOutsideX64A"),j("feeGrowthOutsideX64B"),me(j(),3,"rewardGrowthsOutsideX64"),me(Bt(),13,"")]),Zt=ie([Me(8),ne("poolId"),he("startTickIndex"),me(Rs,be,"ticks"),pe("initializedTickCount"),me(pe(),115,"")]),wr=ie([Me(329),me(ne(),100,"whitelistMints")]),gr=ie([Me(8),ne("poolId"),me(me(F(),8),si,"positiveTickArrayBitmap"),me(me(F(),8),si,"negativeTickArrayBitmap")]),Xd=ie([F(),pe("bump"),ne("owner"),ne("poolId"),ne("positionId"),ne("nftAccount"),me(F(),8)]),Hd=ie([Me(8),pe("bump"),ne("lockOwner"),ne("poolId"),ne("positionId"),ne("nftAccount"),ne("lockNftMint"),F("recentEpoch"),me(F(),8)]);yr.span;var Ar=Ae("Raydium_Clmm"),Ue={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},kr=[188,37,179,131,82,150,84,73],hr=[16,72,250,198,14,162,212,19],ce=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f){let g=ie([j("sqrtPriceX64"),F("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1}],b=Buffer.alloc(g.span);g.encode({sqrtPriceX64:p,startTime:f},b);let k=Buffer.from([...Ue.createPool,...b]);return new Ne({keys:y,programId:e,data:k})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(r.address),new I(o.address)],{publicKey:m}=ur(t,s,u,l),{publicKey:d}=mr(t,m),{publicKey:p}=ri(t,m,u),{publicKey:f}=ri(t,m,l),g=[this.createPoolInstruction(t,m,n,s,d,u,p,new I(r.programId||ae),l,f,new I(o.programId||ae),Ke(t,m).publicKey,a,c)];return{signers:[],instructions:g,instructionTypes:[de.CreateAccount,de.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:f},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b,k,w,A,h,P,T,B,R,S){let K=ie([he("tickLowerIndex"),he("tickUpperIndex"),he("tickArrayLowerStartIndex"),he("tickArrayUpperStartIndex"),j("liquidity"),F("amountMaxA"),F("amountMaxB"),We("withMetadata"),pe("optionBaseFlag"),We("baseFlag")]),q=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],J=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...q],oe=Buffer.alloc(K.span);K.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:h,liquidity:P,amountMaxA:T,amountMaxB:B,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},oe);let ee=Buffer.from([...Ue.openPosition,...oe]);return new Ne({keys:J,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let B=In.generate();m.push(B),f=B.publicKey}let g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=H(d,p,g),{publicKey:k}=H(d,p,y),{publicKey:w}=Be(n.wallet,f,ae),{publicKey:A}=Xt(f),{publicKey:h}=Ce(d,f),{publicKey:P}=qe(d,p,r,o),T=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,f,w,A,P,b,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,g,y,s,a,c,u);return{signers:m,instructions:[T],instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:f,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:A,personalPosition:h,protocolPosition:P}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,p]=[new I(e.programId),new I(e.id)],f;if(l)f=new I((await l(1))[0]);else{let B=In.generate();m.push(B),f=B.publicKey}let g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=H(d,p,g),{publicKey:k}=H(d,p,y),{publicKey:w}=Be(n.wallet,f,ae),{publicKey:A}=Xt(f),{publicKey:h}=Ce(d,f),{publicKey:P}=qe(d,p,r,o),T=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,f,w,A,P,b,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,g,y,u,s,a,c,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(d,p).publicKey:void 0);return{address:{nftMint:f,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:A,personalPosition:h,protocolPosition:P},instructions:[T],signers:m,instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b,k,w,A,h,P,T,B,R,S){let K=ie([he("tickLowerIndex"),he("tickUpperIndex"),he("tickArrayLowerStartIndex"),he("tickArrayUpperStartIndex"),j("liquidity"),F("amountMaxA"),F("amountMaxB"),We("withMetadata"),pe("optionBaseFlag"),We("baseFlag")]),q=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],J=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...q],oe=Buffer.alloc(K.span);K.encode({tickLowerIndex:k,tickUpperIndex:w,tickArrayLowerStartIndex:A,tickArrayUpperStartIndex:h,liquidity:new Pr(0),amountMaxA:T==="MintA"?B:R,amountMaxB:T==="MintA"?R:B,withMetadata:P==="create",baseFlag:T==="MintA",optionBaseFlag:1},oe);let ee=Buffer.from([...Ue.openPosition,...oe]);return new Ne({keys:J,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let B=In.generate();d.push(B),m=B.publicKey}let[p,f]=[new I(e.programId),new I(e.id)],g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=H(p,f,g),{publicKey:k}=H(p,f,y),{publicKey:w}=Be(n.wallet,m,ae),{publicKey:A}=Xt(m),{publicKey:h}=Ce(p,m),{publicKey:P}=qe(p,f,r,o),T=this.openPositionFromLiquidityInstruction(p,n.wallet,f,n.wallet,m,w,A,P,b,k,h,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,g,y,s,a,c,u,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(p,f).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:k,positionNftAccount:w,metadataAccount:A,personalPosition:h,protocolPosition:P},instructions:[T],signers:d,instructionTypes:[de.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=ie([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...Ue.closePosition,...c]);return new Ne({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=Be(n.wallet,r.nftMint,ae),{publicKey:a}=Ce(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[de.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b,k){let w=ie([j("liquidity"),F("amountMaxA"),F("amountMaxB"),pe("optionBaseFlag"),We("baseFlag")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(w.span);w.encode({liquidity:g,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},P);let T=Buffer.from([...Ue.increaseLiquidity,...P]);return new Ne({keys:h,programId:e,data:T})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=H(c,u,l),{publicKey:p}=H(c,u,m),{publicKey:f}=Be(r.wallet,n.nftMint,ae),{publicKey:g}=Ce(c,n.nftMint),{publicKey:y}=qe(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,f,g,u,y,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:f,personalPosition:g,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[de.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=H(c,u,l),{publicKey:p}=H(c,u,m),{publicKey:f}=Be(r.wallet,n.nftMint,ae),{publicKey:g}=Ce(c,n.nftMint),{publicKey:y}=qe(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:f,personalPosition:g,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,f,g,u,y,d,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(c,u).publicKey:void 0)],signers:[],instructionTypes:[de.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b,k){let w=ie([j("liquidity"),F("amountMaxA"),F("amountMaxB"),pe("optionBaseFlag"),We("baseFlag")]),A=[...k?[{pubkey:k,isSigner:!1,isWritable:!0}]:[]],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...A],P=Buffer.alloc(w.span);w.encode({liquidity:new Pr(0),amountMaxA:g==="MintA"?y:b,amountMaxB:g==="MintA"?b:y,baseFlag:g==="MintA",optionBaseFlag:1},P);let T=Buffer.from([...Ue.increaseLiquidity,...P]);return new Ne({keys:h,programId:e,data:T})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b,k,w){let A=ie([j("liquidity"),F("amountMinA"),F("amountMinB")]),h=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...g.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},...h],T=Buffer.alloc(A.span);A.encode({liquidity:y,amountMinA:b,amountMinB:k},T);let B=Buffer.from([...Ue.decreaseLiquidity,...T]);return new Ne({keys:P,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=H(u,l,m),{publicKey:f}=H(u,l,d),{publicKey:g}=Be(r.wallet,n.nftMint,c),{publicKey:y}=Ce(u,n.nftMint),{publicKey:b}=qe(u,l,n.tickLower,n.tickUpper),k=[];for(let h=0;h<e.rewardDefaultInfos.length;h++)k.push({poolRewardVault:new I(t.rewardInfos[h].vault),ownerRewardVault:r.rewardAccounts[h],rewardMint:new I(e.rewardDefaultInfos[h].mint.address)});let w=[],A=this.decreaseLiquidityInstruction(u,r.wallet,g,y,l,b,p,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),k,o,s,a,fe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ke(u,l).publicKey:void 0);return w.push(A),{address:{tickArrayLower:p,tickArrayUpper:f,positionNftAccount:g,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[de.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,p,f,g,y,b){let k=ie([F("amount"),F("otherAmountThreshold"),j("sqrtPriceLimitX64"),We("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(T=>({pubkey:T,isSigner:!1,isWritable:!0}))],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],h=Buffer.alloc(k.span);k.encode({amount:p,otherAmountThreshold:f,sqrtPriceLimitX64:g,isBaseInput:y},h);let P=Buffer.from([...Ue.swap,...h]);return new Ne({keys:A,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[f,g]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:p,y?p:d,y?f:g,y?g:f,u,n,s,a,c,!0,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[de.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,p]=[new I(t.vault.A),new I(t.vault.B)],[f,g]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?p:d,y?d:p,y?g:f,y?f:g,u,n,s,a,c,!1,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[de.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=ie([F("openTime"),F("endTime"),j("emissionsPerSecondX64")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1}],g=Buffer.alloc(p.span);p.encode({openTime:ye(l),endTime:ye(m),emissionsPerSecondX64:d},g);let y=Buffer.from([...Ue.initReward,...g]);return new Ne({keys:f,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=lr(o,s,r.mint).publicKey,c=Ht(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[de.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let p=ie([pe("rewardIndex"),j("emissionsPerSecondX64"),F("openTime"),F("endTime")]),f=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],g=Buffer.alloc(p.span);p.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:ye(l),endTime:ye(m)},g);let y=Buffer.from([...Ue.setRewardEmissions,...g]);return new Ne({keys:f,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&Ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Ht(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[de.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=ie([pe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...Ue.collectReward,...l]);return new Ne({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&Ar.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[de.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let c=[],u;if(a)u=new I((await a(1))[0]);else{let y=In.generate();c.push(y),u=y.publicKey}let{publicKey:l}=Be(o,s,ae),{publicKey:m}=Ce(n,s),d=zt(e,u).publicKey,p=Be(o,u,ae).publicKey,f=Xt(u).publicKey,g=ce.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:u,lockNftAccount:p,metadataAccount:f,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:p,lockNftMint:u,positionNftAccount:l,metadataAccount:f},instructions:[g],signers:c,instructionTypes:[de.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:c,lockNftMint:u,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let p=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:pt,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:ht,isSigner:!1,isWritable:!1},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1}],f=ie([We("withMetadata")]),g=Buffer.alloc(f.span);f.encode({withMetadata:d},g);let y=Buffer.from([...kr,...g]);return new Ne({keys:p,programId:e,data:y})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Be(r,o,ae),{publicKey:a}=Ce(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:oi(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1}];return new Ne({keys:c,programId:e,data:Buffer.from(kr)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=L.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=L.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=H(t,n,r),{publicKey:a}=H(t,n,o),{publicKey:c}=Be(e.owner,e.ownerPosition.nftMint,ae),{publicKey:u}=Ce(t,e.ownerPosition.nftMint),{publicKey:l}=qe(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let f=0;f<e.poolKeys.rewardInfos.length;f++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[f].vault),ownerRewardVault:e.ownerRewardAccounts[f],rewardMint:new I(e.poolKeys.rewardInfos[f].mint.address)});let d=[...m.map(f=>[{pubkey:f.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:f.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:oi(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:qn,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ne({keys:p,programId:e.programId,data:Buffer.from(hr)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:f,tickArrayUpper:g,userVaultA:y,userVaultB:b,mintA:k,mintB:w,rewardAccounts:A,exTickArrayBitmap:h}){let P=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...A.map(B=>[{pubkey:B.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:ae,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:qn,isSigner:!1,isWritable:!1},{pubkey:k,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...P];return new Ne({keys:T,programId:e,data:Buffer.from(hr)})}};var li=class extends Wt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||N.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,p=this.createTxBuilder(),[f,g,y]=new Re(new N(r.address).toBuffer()).gt(new Re(new N(o.address).toBuffer()))?[o,r,new C(1).div(a)]:[r,o,a],b=E.priceToSqrtPriceX64(y,f.decimals,g.decimals),k=await ce.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:f,mintB:g,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:!m&&l});return p.addInstruction(k),p.addCustomComputeBudget(u),p.versionBuild({txVersion:d,extInfo:{address:X(M({},k.address),{programId:t.toString(),id:k.address.poolId.toString(),mintA:f,mintB:g,openTime:c.toString(),vault:{A:k.address.mintAVault.toString(),B:k.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:M({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:k.address.poolId.toString(),mintA:f,mintB:g,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},rr),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:p,txVersion:f}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let g=this.createTxBuilder(),y=null,b=null,k=n.useSOLBalance&&e.mintA.address===$.toString(),w=n.useSOLBalance&&e.mintB.address===$.toString(),[A,h]=s==="MintA"?[a,c]:[c,a],{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:k||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:u,checkCreateATAOwner:l});P&&(y=P),g.addInstruction(T||{});let{account:B,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||h.isZero()?{payer:this.scope.ownerPubKey,amount:h}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(b=B),g.addInstruction(R||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let S=t||await this.getClmmPoolKeys(e.id),K=await ce.openPositionFromBaseInstructions({poolInfo:e,poolKeys:S,ownerInfo:X(M({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return g.addInstruction(K),g.addCustomComputeBudget(p),g.versionBuild({txVersion:f,extInfo:M({},K.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:p,getEphemeralSigners:f}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),y=null,b=null,k=n.useSOLBalance&&e.mintA.address===$.toBase58(),w=n.useSOLBalance&&e.mintB.address===$.toBase58(),{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:k||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:k?!1:u,checkCreateATAOwner:l});A&&(y=A),g.addInstruction(h||{});let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});P&&(b=P),g.addInstruction(T||{}),(y===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.getClmmPoolKeys(e.id),R=await ce.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:f});return g.addInstruction(R),g.addCustomComputeBudget(p),g.versionBuild({txVersion:d,extInfo:{address:R.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,p=this.createTxBuilder(),f,g,y=c.useSOLBalance&&t.mintA.address===$.toString(),b=c.useSOLBalance&&t.mintB.address===$.toString(),{account:k,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});k&&(f=k),p.addInstruction(w||{});let{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});A&&(g=A),p.addInstruction(h||{}),!f&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let P=n!=null?n:await this.getClmmPoolKeys(t.id),T=ce.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:P,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:g},liquidity:a,amountMaxA:o,amountMaxB:s});return p.addInstruction(T),p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),p,f,g=a.useSOLBalance&&t.mintA.address===$.toString(),y=a.useSOLBalance&&t.mintB.address===$.toString(),{account:b,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:g||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});b&&(p=b),d.addInstruction(k||{});let{account:w,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w&&(f=w),d.addInstruction(A||{}),!p&&!f&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=await this.getClmmPoolKeys(t.id),P=ce.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:h,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:f},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(P),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:P.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let p=this.createTxBuilder(),f=o.useSOLBalance&&t.mintA.address===$.toString(),g=o.useSOLBalance&&t.mintB.address===$.toString(),y,b,{account:k,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:f,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,associatedOnly:f?!1:u,checkCreateATAOwner:l});y=k,w&&p.addInstruction(w);let{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});b=A,h&&p.addInstruction(h);let P=[];for(let S of t.rewardDefaultInfos){let K=o.useSOLBalance&&S.mint.address===$.toString(),q;if(S.mint.address===t.mintA.address)q=y;else if(S.mint.address===t.mintB.address)q=b;else{let{account:J,instructionParams:oe}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(S.mint.programId),mint:new N(S.mint.address),notUseTokenAccount:K,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!K,associatedOnly:K?!1:u,checkCreateATAOwner:l});q=J,oe&&p.addInstruction(oe)}P.push(q)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let T=n!=null?n:await this.getClmmPoolKeys(t.id),B=await ce.decreaseLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:P},liquidity:c,amountMinA:s,amountMinB:a});p.addInstruction({instructions:B.instructions,instructionTypes:[de.ClmmDecreasePosition]});let R=M({},B.address);if(o.closePosition){let S=await ce.closePositionInstructions({poolInfo:t,poolKeys:T,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});p.addInstruction({endInstructions:S.instructions,endInstructionTypes:S.instructionTypes}),R=M(M({},R),S.address)}return p.addCustomComputeBudget(m),p.versionBuild({txVersion:d,extInfo:{address:R}})}async lockPosition(e){let{programId:t=Ft,authProgramId:n=bn,poolProgramId:r=Ot,ownerPosition:o,payer:s,computeBudgetConfig:a,txVersion:c,getEphemeralSigners:u}=e,l=this.createTxBuilder(),m=await ce.makeLockPositions({programId:t,authProgramId:n,poolProgramId:r,wallet:this.scope.ownerPubKey,payer:s!=null?s:this.scope.ownerPubKey,nftMint:o.nftMint,getEphemeralSigners:u});return l.addInstruction(m),l.addCustomComputeBudget(a),l.versionBuild({txVersion:c,extInfo:m.address})}async harvestLockPosition(e){let{programId:t=Ft,authProgramId:n=bn,clmmProgram:r=Ot,poolKeys:o,lockData:s,ownerInfo:a={useSOLBalance:!0},associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=o||await this.getClmmPoolKeys(s.poolId.toString()),p=this.createTxBuilder(),f=await this.scope.connection.getAccountInfo(s.positionId);f||this.logger.logWithError("position not found",s.positionId);let g=Qt.decode(f.data),y=a.useSOLBalance&&d.mintA.address===$.toString(),b=a.useSOLBalance&&d.mintB.address===$.toString(),k,w,{account:A,instructionParams:h}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new N(d.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});k=A,h&&p.addInstruction(h);let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new N(d.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});w=P,T&&p.addInstruction(T);let B={},R=[];for(let Ee of d.rewardInfos){let Sn=a.useSOLBalance&&Ee.mint.address===$.toString(),$t=B[Ee.mint.address];if(!$t){let{account:Br,instructionParams:mi}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(Ee.mint.programId),mint:new N(Ee.mint.address),notUseTokenAccount:Sn,owner:this.scope.ownerPubKey,skipCloseAccount:!Sn,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:Sn?!1:c});$t=Br,mi&&p.addInstruction(mi)}B[Ee.mint.address]=$t,R.push($t)}let S=zt(t,s.lockNftMint).publicKey,K=Be(this.scope.ownerPubKey,s.lockNftMint,Jt).publicKey,q=L.getTickArrayStartIndexByTick(g.tickLower,d.config.tickSpacing),J=L.getTickArrayStartIndexByTick(g.tickUpper,d.config.tickSpacing),{publicKey:oe}=H(new N(d.programId),s.poolId,q),{publicKey:ee}=H(new N(d.programId),s.poolId,J),{publicKey:Y}=qe(new N(d.programId),s.poolId,g.tickLower,g.tickUpper),mt=[];for(let Ee=0;Ee<d.rewardInfos.length;Ee++)mt.push({poolRewardVault:new N(d.rewardInfos[Ee].vault),ownerRewardVault:R[Ee],rewardMint:new N(d.rewardInfos[Ee].mint.address)});let xr=await ce.harvestLockPositionInstructionV2({programId:t,auth:n,lockPositionId:S,clmmProgram:r,lockOwner:this.scope.ownerPubKey,lockNftMint:s.lockNftMint,lockNftAccount:K,positionNftAccount:s.nftAccount,positionId:s.positionId,poolId:s.poolId,protocolPosition:Y,vaultA:new N(d.vault.A),vaultB:new N(d.vault.B),tickArrayLower:oe,tickArrayUpper:ee,userVaultA:k,userVaultB:w,mintA:new N(d.mintA.address),mintB:new N(d.mintB.address),rewardAccounts:mt,exTickArrayBitmap:Ke(r,s.poolId).publicKey});return p.addInstruction({instructions:[xr],instructionTypes:[de.ClmmHarvestLockPosition]}),p.addCustomComputeBudget(l),p.versionBuild({txVersion:m})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=ce.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===$.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(n.mint.address),mint:new N(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Re(new C(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let p=await this.getClmmPoolKeys(e.id),f=ce.initRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new N(n.mint.programId),mint:new N(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:v.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===$.toString(),p=m.perSecond.mul(m.endTime-m.openTime),{account:f,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(m.mint.programId),mint:new N(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Re(new C(p.toFixed(0)).gte(p)?p.toFixed(0):p.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=ce.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{programId:new N(m.mint.programId),mint:new N(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:v.decimalToX64(m.perSecond)}});l=M(M({},l),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals($),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Re(new C(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),p=ce.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:v.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===$.toString(),{account:p,instructionParams:f}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(m.mint.programId),mint:new N(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Re(new C(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});f&&u.addInstruction(f),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=t!=null?t:await this.getClmmPoolKeys(e.id),y=ce.setRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{mint:new N(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:v.decimalToX64(m.perSecond)}});u.addInstruction(y),l=M(M({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(p=>p.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals($),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=ce.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(g=>g.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals($),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let p=await this.getClmmPoolKeys(e.id),f=ce.collectRewardInstructions({poolInfo:e,poolKeys:p,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(f),a=M(M({},a),f.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let f=this.createTxBuilder(),g=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===$.toBase58(),b=c.useSOLBalance&&e.mintB.address===$.toBase58(),k;!s||s.equals(new C(0))?k=g?Ye.add(new Re(1)):Ze.sub(new Re(1)):k=E.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?r:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=P,T&&f.addInstruction(T)}let A;if(!A){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?0:r}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=P,T&&f.addInstruction(T)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let h=t!=null?t:await this.getClmmPoolKeys(e.id);return f.addInstruction(ce.makeSwapBaseInInstructions({poolInfo:e,poolKeys:h,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},inputMint:new N(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:k,remainingAccounts:u})),f.addCustomComputeBudget(p),f.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:p}){let f=this.createTxBuilder(),g=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===$.toBase58(),b=c.useSOLBalance&&e.mintB.address===$.toBase58(),k;!s||s.equals(new C(0))?k=n.toString()===e.mintB.address?Ye.add(new Re(1)):Ze.sub(new Re(1)):k=E.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=P,T&&f.addInstruction(T)}let A;if(!A){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?0:o}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});A=P,T&&f.addInstruction(T)}(!w||!A)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:A,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let h=t!=null?t:await this.getClmmPoolKeys(e.id);return f.addInstruction(ce.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:h,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:A},outputMint:new N(n),amountOut:r,amountInMax:o,sqrtPriceLimitX64:k,remainingAccounts:u})),f.addCustomComputeBudget(p),f.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){var d;let l={};for(let p of this.scope.account.tokenAccountRawInfos)o?Be(this.scope.ownerPubKey,p.accountInfo.mint,a).publicKey.equals(p.pubkey)&&(l[p.accountInfo.mint.toString()]=p.pubkey):l[p.accountInfo.mint.toString()]=p.pubkey;let m=this.createTxBuilder();for(let p of Object.values(e)){if(t[p.id]===void 0||!t[p.id].find(P=>!P.liquidity.isZero()||P.rewardInfos.find(T=>!T.rewardAmountOwed.isZero())))continue;let f=p,g=r.useSOLBalance&&f.mintA.address===$.toString(),y=r.useSOLBalance&&f.mintB.address===$.toString(),b=l[f.mintA.address];if(!b){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:f.mintA.programId,mint:new N(f.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:o,checkCreateATAOwner:s});b=P,T&&m.addInstruction(T)}let k=l[f.mintB.address];if(!k){let{account:P,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:f.mintB.programId,mint:new N(f.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:o,checkCreateATAOwner:s});k=P,T&&m.addInstruction(T)}l[f.mintA.address]=b,l[f.mintB.address]=k;let w=[];for(let P of f.rewardDefaultInfos){let T=r.useSOLBalance&&P.mint.address===$.toString(),B=l[P.mint.address];if(!B){let{account:R,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(P.mint.programId),mint:new N(P.mint.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,skipCloseAccount:!T,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:T?!1:o});B=R,S&&m.addInstruction(S)}l[P.mint.address]=B,w.push(B)}let A=await this.getClmmPoolKeys(f.id),h=[];for(let P=0;P<A.rewardInfos.length;P++)h.push({poolRewardVault:new N(A.rewardInfos[P].vault),ownerRewardVault:w[P],rewardMint:new N(A.rewardInfos[P].mint.address)});for(let P of t[p.id]){let T=(d=n==null?void 0:n[p.id])==null?void 0:d[P.nftMint.toBase58()];if(T){let B=Be(this.scope.ownerPubKey,T.lockNftMint,Jt).publicKey,R=L.getTickArrayStartIndexByTick(P.tickLower,A.config.tickSpacing),S=L.getTickArrayStartIndexByTick(P.tickUpper,A.config.tickSpacing),{publicKey:K}=H(new N(A.programId),T.poolId,R),{publicKey:q}=H(new N(A.programId),T.poolId,S),{publicKey:J}=qe(new N(A.programId),T.poolId,P.tickLower,P.tickUpper),oe=zt(Ft,T.lockNftMint).publicKey,ee=ce.harvestLockPositionInstructionV2({programId:Ft,auth:bn,lockPositionId:oe,clmmProgram:Ot,lockOwner:this.scope.ownerPubKey,lockNftMint:T.lockNftMint,lockNftAccount:B,positionNftAccount:T.nftAccount,positionId:T.positionId,poolId:T.poolId,protocolPosition:J,vaultA:new N(A.vault.A),vaultB:new N(A.vault.B),tickArrayLower:K,tickArrayUpper:q,userVaultA:b,userVaultB:k,mintA:new N(A.mintA.address),mintB:new N(A.mintB.address),rewardAccounts:h,exTickArrayBitmap:Ke(Ot,T.poolId).publicKey});m.addInstruction({instructions:[ee],instructionTypes:[de.ClmmHarvestLockPosition],lookupTableAddress:A.lookupTableAccount?[A.lookupTableAccount]:[]})}else{let B=ce.decreaseLiquidityInstructions({poolInfo:f,poolKeys:A,ownerPosition:P,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:k,rewardAccounts:w},liquidity:new Re(0),amountMinA:new Re(0),amountMinB:new Re(0)});m.addInstruction(B)}}}return c===0?m.sizeCheckBuildV0({computeBudgetConfig:u}):m.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(Ht(e).publicKey);return t?wr.decode(t.data).whitelistMints.filter(r=>!r.equals(N.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Re(1))).map(s=>Ce(new N(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=Qt.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await at(this.scope.connection,e.map(o=>({pubkey:new N(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=Bn.decode(s.accountInfo.data),c=E.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=X(M({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await at(this.scope.connection,Array.from(n).map(c=>({pubkey:new N(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=br.decode(c.accountInfo.data))});let s=await fe.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,p,f;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:An({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||Jt.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?jn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:An({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||Jt.toBase58(),extensions:{feeConfig:(p=t[l])!=null&&p.feeConfig?jn((f=t[l])==null?void 0:f.feeConfig):void 0}}),price:e[c].currentPrice,config:X(M({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await fe.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await Ri({connection:this.scope.connection,mints:Array.from(n).map(m=>new N(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await at(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=fr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(Tr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(Tr.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=X(M({},o[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},config:c.config,rewardInfos:o[e].rewardInfos.filter(m=>!m.tokenVault.equals(N.default)).map(m=>({mint:An({address:m.tokenMint.toBase58(),programId:Jt.toBase58(),decimals:10}),vault:m.tokenVault.toBase58()}))});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{ws as AMM_CONFIG_SEED,er as BIT_PRECISION,li as Clmm,br as ClmmConfigLayout,ce as ClmmInstrument,si as EXTENSION_TICKARRAY_BITMAP_SIZE,Tn as FEE_RATE_DENOMINATOR,Is as FETCH_TICKARRAY_COUNT,ys as Fee,tr as LOG_B_2_X32,nr as LOG_B_P_ERR_MARGIN_LOWER_X64,ir as LOG_B_P_ERR_MARGIN_UPPER_X64,z as LiquidityMath,Hd as LockClPositionLayoutV2,Xd as LockPositionLayout,Ze as MAX_SQRT_PRICE_X64,Bm as MAX_SQRT_PRICE_X64_SUB_ONE,Se as MAX_TICK,Ye as MIN_SQRT_PRICE_X64,xm as MIN_SQRT_PRICE_X64_ADD_ONE,Ie as MIN_TICK,v as MathUtil,ti as MaxU64,$i as MaxUint128,tt as NEGATIVE_ONE,Bs as OBSERVATION_SEED,ze as ONE,Ts as OPERATION_SEED,yr as ObservationInfoLayout,Ks as ObservationLayout,wr as OperationLayout,dr as POOL_LOCK_ID_SEED,ks as POOL_REWARD_VAULT_SEED,Ps as POOL_SEED,xs as POOL_TICK_ARRAY_BITMAP_SEED,As as POOL_VAULT_SEED,cr as POSITION_SEED,Bn as PoolInfoLayout,fe as PoolUtils,Qt as PositionInfoLayout,Ls as PositionRewardInfoLayout,Yt as PositionUtils,Ud as ProtocolPositionLayout,hn as Q128,Oe as Q64,Ns as RewardInfo,E as SqrtPriceMath,bt as SwapMath,gt as TICK_ARRAY_BITMAP_SIZE,hs as TICK_ARRAY_SEED,be as TICK_ARRAY_SIZE,Im as TICK_SPACINGS,nt as TickArrayBitmap,gr as TickArrayBitmapExtensionLayout,jt as TickArrayBitmapExtensionUtils,Zt as TickArrayLayout,Rs as TickLayout,yt as TickMath,Z as TickQuery,L as TickUtils,Gt as U64Resolution,Cm as U64_IGNORE_RANGE,Q as ZERO,fr as clmmComputeInfoToApiInfo,Ad as getLiquidityFromAmounts,Fm as getPdaAmmConfigId,Ke as getPdaExBitmapAccount,zt as getPdaLockClPositionIdV2,oi as getPdaLockPositionId,Xt as getPdaMetadataKey,mr as getPdaObservationAccount,Ht as getPdaOperationAccount,Ce as getPdaPersonalPositionAddress,ur as getPdaPoolId,lr as getPdaPoolRewardVaulId,ri as getPdaPoolVaultId,qe as getPdaProtocolPositionAddress,H as getPdaTickArrayAddress,Nm as i16ToBytes,xn as i32ToBytes,Ut as isZero,ni as leadingZeros,ar as leastSignificantBit,Sm as mockCreatePoolInfo,rr as mockV3CreatePoolInfo,sr as mostSignificantBit,ii as trailingZeros,or as u16ToBytes,Lm as u32ToBytes};
//# sourceMappingURL=index.mjs.map