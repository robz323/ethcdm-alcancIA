var Ki=Object.defineProperty,Li=Object.defineProperties;var Ri=Object.getOwnPropertyDescriptors;var Cn=Object.getOwnPropertySymbols;var Mi=Object.prototype.hasOwnProperty,Ei=Object.prototype.propertyIsEnumerable;var Kn=(i,e,t)=>e in i?Ki(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,Q=(i,e)=>{for(var t in e||(e={}))Mi.call(e,t)&&Kn(i,t,e[t]);if(Cn)for(var t of Cn(e))Ei.call(e,t)&&Kn(i,t,e[t]);return i},ie=(i,e)=>Li(i,Ri(e));import{Keypair as zt,PublicKey as P,SystemProgram as ct,TransactionInstruction as Te}from"@solana/web3.js";import Ii from"bn.js";import{PublicKey as Oi}from"@solana/web3.js";import{get as Ln,set as _i}from"lodash";var jt=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Rn={},Fi={};function ke(i){let e=Ln(Rn,i);if(!e){let t=Ln(Fi,i);e=new jt({name:i,logLevel:t}),_i(Rn,i,e)}return e}import{MINT_SIZE as vo,TOKEN_PROGRAM_ID as Wo,getTransferFeeConfig as qo,unpackMint as Vo}from"@solana/spl-token";var Zt=ke("Raydium_accountInfo_util");async function je(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=Q({batchRequest:!1},t),s=Yt(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Yt(u,10);a=(await(await Promise.all(c.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Zt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:b,owner:y,rentEpoch:g}=d;return f.length!==2&&f[1]!=="base64"&&Zt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:b,owner:new Oi(y),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(u=>i.getMultipleAccountsInfo(u,r)))}catch(u){u instanceof Error&&Zt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Qt(i,e,t){let n=await je(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>ie(Q({},r),{accountInfo:n[o]}))}import Xe from"bn.js";var lt=9e15,Je=1e9,$t="0123456789abcdef",Lt="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rt="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",en={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-lt,maxE:lt,crypto:!1},Fn,Ge,L=!0,Et="[DecimalError] ",Qe=Et+"Invalid argument: ",On=Et+"Precision limit exceeded",Dn=Et+"crypto unavailable",vn="[object Decimal]",ye=Math.floor,ue=Math.pow,Di=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,vi=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Wi=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Wn=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Me=1e7,C=7,qi=9007199254740991,Vi=Lt.length-1,tn=Rt.length-1,h={toStringTag:vn};h.absoluteValue=h.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),I(i)};h.ceil=function(){return I(new this.constructor(this),this.e+1,2)};h.clampedTo=h.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(Qe+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};h.comparedTo=h.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,u=o.s,c=i.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==i.e)return o.e>i.e^u<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===r?0:n>r^u<0?1:-1};h.cosine=h.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=Gi(n,Xn(n,t)),n.precision=i,n.rounding=e,I(Ge==2||Ge==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};h.cubeRoot=h.cbrt=function(){var i,e,t,n,r,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(L=!1,o=l.s*ue(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=fe(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ue(t,1/3),i=ye((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=Y(c.plus(l).times(a),c.plus(u),s+2,1),fe(a.d).slice(0,s)===(t=fe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(I(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(I(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return L=!0,I(n,i,m.rounding,e)};h.decimalPlaces=h.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-ye(this.e/C))*C,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};h.dividedBy=h.div=function(i){return Y(this,new this.constructor(i))};h.dividedToIntegerBy=h.divToInt=function(i){var e=this,t=e.constructor;return I(Y(e,new t(i),0,1,1),t.precision,t.rounding)};h.equals=h.eq=function(i){return this.cmp(i)===0};h.floor=function(){return I(new this.constructor(this),this.e+1,3)};h.greaterThan=h.gt=function(i){return this.cmp(i)>0};h.greaterThanOrEqualTo=h.gte=function(i){var e=this.cmp(i);return e==1||e===0};h.hyperbolicCosine=h.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/Ft(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=mt(s,1,o.times(e),new s(1),!0);for(var u,c=i,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return I(o,s.precision=t,s.rounding=n,!0)};h.hyperbolicSine=h.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=mt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/Ft(5,i)),r=mt(o,2,r,r,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,I(r,e,t,!0)};h.hyperbolicTangent=h.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,Y(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};h.inverseCosine=h.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?Re(t,r,o):new t(0):new t(NaN):e.isZero()?Re(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=Re(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};h.inverseHyperbolicCosine=h.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,L=!1,t=t.times(t).minus(1).sqrt().plus(t),L=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};h.inverseHyperbolicSine=h.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,L=!1,t=t.times(t).plus(1).sqrt().plus(t),L=!0,n.precision=i,n.rounding=e,t.ln())};h.inverseHyperbolicTangent=h.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?I(new o(r),i,e,!0):(o.precision=t=n-r.e,r=Y(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};h.inverseSine=h.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=Re(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};h.inverseTangent=h.atan=function(){var i,e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=tn)return s=Re(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=tn)return s=Re(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/C+2|0),i=t;i;--i)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(L=!1,e=Math.ceil(a/C),n=1,u=c.times(c),s=new l(c),r=c;i!==-1;)if(r=r.times(u),o=s.minus(r.div(n+=2)),r=r.times(u),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),L=!0,I(s,l.precision=m,l.rounding=d,!0)};h.isFinite=function(){return!!this.d};h.isInteger=h.isInt=function(){return!!this.d&&ye(this.e/C)>this.d.length-2};h.isNaN=function(){return!this.s};h.isNegative=h.isNeg=function(){return this.s<0};h.isPositive=h.isPos=function(){return this.s>0};h.isZero=function(){return!!this.d&&this.d[0]===0};h.lessThan=h.lt=function(i){return this.cmp(i)<0};h.lessThanOrEqualTo=h.lte=function(i){return this.cmp(i)<1};h.logarithm=h.log=function(i){var e,t,n,r,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(L=!1,a=m+f,s=Ye(c,a),n=e?Mt(l,a+10):Ye(i,a),u=Y(s,n,a,1),bt(u.d,r=m,d))do if(a+=10,s=Ye(c,a),n=e?Mt(l,a+10):Ye(i,a),u=Y(s,n,a,1),!o){+fe(u.d).slice(r+1,r+15)+1==1e14&&(u=I(u,m+1,0));break}while(bt(u.d,r+=10,d));return L=!0,I(u,m,d)};h.minus=h.sub=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.constructor;if(i=new p(i),!f.d||!i.d)return!f.s||!i.s?i=new p(NaN):f.d?i.s=-i.s:i=new p(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(c=f.d,d=i.d,a=p.precision,u=p.rounding,!c[0]||!d[0]){if(d[0])i.s=-i.s;else if(c[0])i=new p(f);else return new p(u===3?-0:0);return L?I(i,a,u):i}if(t=ye(i.e/C),l=ye(f.e/C),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/C),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,i.s=-i.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(r=n;r&&c[--r]===0;)c[r]=Me-1;--c[r],c[n]+=Me}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(i.d=c,i.e=_t(c,t),L?I(i,a,u):i):new p(u===3?-0:0)};h.modulo=h.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?I(new n(t),n.precision,n.rounding):(L=!1,n.modulo==9?(e=Y(t,i.abs(),0,3,1),e.s*=i.s):e=Y(t,i,0,n.modulo,1),e=e.times(i),L=!0,t.minus(e))};h.naturalExponential=h.exp=function(){return nn(this)};h.naturalLogarithm=h.ln=function(){return Ye(this)};h.negated=h.neg=function(){var i=new this.constructor(this);return i.s=-i.s,I(i)};h.plus=h.add=function(i){var e,t,n,r,o,s,a,u,c,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(c=m.d,l=i.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(i=new d(m)),L?I(i,a,u):i;if(o=ye(m.e/C),n=ye(i.e/C),c=c.slice(),r=o-n,r){for(r<0?(t=c,r=-r,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/C),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=c.length,r=l.length,s-r<0&&(r=s,t=l,l=c,c=t),e=0;r;)e=(c[--r]=c[r]+l[r]+e)/Me|0,c[r]%=Me;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return i.d=c,i.e=_t(c,n),L?I(i,a,u):i};h.precision=h.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(Qe+i);return t.d?(e=qn(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};h.round=function(){var i=this,e=i.constructor;return I(new e(i),i.e+1,e.rounding)};h.sine=h.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+C,n.rounding=1,t=Xi(n,Xn(n,t)),n.precision=i,n.rounding=e,I(Ge>2?t.neg():t,i,e,!0)):new n(NaN)};h.squareRoot=h.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(L=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=fe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=ye((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(Y(s,o,t+2,1)).times(.5),fe(o.d).slice(0,t)===(e=fe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(I(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(I(n,u+1,1),i=!n.times(n).eq(s));break}return L=!0,I(n,u,l.rounding,i)};h.tangent=h.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=Y(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,I(Ge==2||Ge==4?t.neg():t,i,e,!0)):new n(NaN)};h.times=h.mul=function(i){var e,t,n,r,o,s,a,u,c,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=ye(l.e/C)+ye(i.e/C),u=d.length,c=f.length,u<c&&(o=d,d=f,f=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,r=u+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%Me|0,e=a/Me|0;o[r]=(o[r]+e)%Me|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=_t(o,t),L?I(i,m.precision,m.rounding):i};h.toBinary=function(i,e){return on(this,2,i,e)};h.toDecimalPlaces=h.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Be(i,0,Je),e===void 0?e=n.rounding:Be(e,0,8),I(t,i+t.e+1,e))};h.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,!0):(Be(i,0,Je),e===void 0?e=r.rounding:Be(e,0,8),n=I(new r(n),i+1,e),t=ve(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=ve(r):(Be(i,0,Je),e===void 0?e=o.rounding:Be(e,0,8),n=I(new o(r),i+r.e+1,e),t=ve(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};h.toFraction=function(i){var e,t,n,r,o,s,a,u,c,l,m,d,f=this,p=f.d,b=f.constructor;if(!p)return new b(f);if(c=t=new b(1),n=u=new b(0),e=new b(n),o=e.e=qn(p)-f.e-1,s=o%C,e.d[0]=ue(10,s<0?C+s:s),i==null)i=o>0?e:c;else{if(a=new b(i),!a.isInt()||a.lt(c))throw Error(Qe+a);i=a.gt(e)?o>0?e:c:a}for(L=!1,a=new b(fe(p)),l=b.precision,b.precision=o=p.length*C*2;m=Y(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=c,c=u.plus(m.times(r)),u=r,r=e,e=a.minus(m.times(r)),a=r;return r=Y(i.minus(t),n,0,1,1),u=u.plus(r.times(c)),t=t.plus(r.times(n)),u.s=c.s=f.s,d=Y(c,n,o,1).minus(f).abs().cmp(Y(u,t,o,1).minus(f).abs())<1?[c,n]:[u,t],b.precision=l,L=!0,d};h.toHexadecimal=h.toHex=function(i,e){return on(this,16,i,e)};h.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Be(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(L=!1,t=Y(t,i,0,e,1).times(i),L=!0,I(t)):(i.s=t.s,t=i),t};h.toNumber=function(){return+this};h.toOctal=function(i,e){return on(this,8,i,e)};h.toPower=h.pow=function(i){var e,t,n,r,o,s,a=this,u=a.constructor,c=+(i=new u(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new u(ue(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,i.eq(1))return I(a,n,o);if(e=ye(i.e/C),e>=i.d.length-1&&(t=c<0?-c:c)<=qi)return r=Vn(u,a,t,n),i.s<0?new u(1).div(r):I(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new u(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ue(+a,c),e=t==0||!isFinite(t)?ye(c*(Math.log("0."+fe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(L=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),r=nn(i.times(Ye(a,n+t)),n),r.d&&(r=I(r,n+5,1),bt(r.d,n,o)&&(e=n+10,r=I(nn(i.times(Ye(a,e+t)),e),e+5,1),+fe(r.d).slice(n+1,n+15)+1==1e14&&(r=I(r,n+1,0)))),r.s=s,L=!0,u.rounding=o,I(r,n,o))};h.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=ve(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Be(i,1,Je),e===void 0?e=r.rounding:Be(e,0,8),n=I(new r(n),i,e),t=ve(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};h.toSignificantDigits=h.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Be(i,1,Je),e===void 0?e=n.rounding:Be(e,0,8)),I(new n(t),i,e)};h.toString=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};h.truncated=h.trunc=function(){return I(new this.constructor(this),this.e+1,1)};h.valueOf=h.toJSON=function(){var i=this,e=i.constructor,t=ve(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function fe(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=C-n.length,t&&(o+=Ze(t)),o+=n;s=i[e],n=s+"",t=C-n.length,t&&(o+=Ze(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Be(i,e,t){if(i!==~~i||i<e||i>t)throw Error(Qe+i)}function bt(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=C,r=0):(r=Math.ceil((e+1)/C),e%=C),o=ue(10,C-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ue(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ue(10,e-3)-1,s}function Kt(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=$t.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Gi(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/Ft(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=mt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var Y=function(){function i(n,r,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*r+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=r[a]){u=n[a]>r[a]?1:-1;break}return u}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,u){var c,l,m,d,f,p,b,y,g,A,w,T,S,k,R,K,z,Z,O,le,ae=n.constructor,xe=n.s==r.s?1:-1,ne=n.d,X=r.d;if(!ne||!ne[0]||!X||!X[0])return new ae(!n.s||!r.s||(ne?X&&ne[0]==X[0]:!X)?NaN:ne&&ne[0]==0||!X?xe*0:xe/0);for(u?(f=1,l=n.e-r.e):(u=Me,f=C,l=ye(n.e/f)-ye(r.e/f)),O=X.length,z=ne.length,g=new ae(xe),A=g.d=[],m=0;X[m]==(ne[m]||0);m++);if(X[m]>(ne[m]||0)&&l--,o==null?(k=o=ae.precision,s=ae.rounding):a?k=o+(n.e-r.e)+1:k=o,k<0)A.push(1),p=!0;else{if(k=k/f+2|0,m=0,O==1){for(d=0,X=X[0],k++;(m<z||d)&&k--;m++)R=d*u+(ne[m]||0),A[m]=R/X|0,d=R%X|0;p=d||m<z}else{for(d=u/(X[0]+1)|0,d>1&&(X=i(X,d,u),ne=i(ne,d,u),O=X.length,z=ne.length),K=O,w=ne.slice(0,O),T=w.length;T<O;)w[T++]=0;le=X.slice(),le.unshift(0),Z=X[0],X[1]>=u/2&&++Z;do d=0,c=e(X,w,O,T),c<0?(S=w[0],O!=T&&(S=S*u+(w[1]||0)),d=S/Z|0,d>1?(d>=u&&(d=u-1),b=i(X,d,u),y=b.length,T=w.length,c=e(b,w,y,T),c==1&&(d--,t(b,O<y?le:X,y,u))):(d==0&&(c=d=1),b=X.slice()),y=b.length,y<T&&b.unshift(0),t(w,b,T,u),c==-1&&(T=w.length,c=e(X,w,O,T),c<1&&(d++,t(w,O<T?le:X,T,u))),T=w.length):c===0&&(d++,w=[0]),A[m++]=d,c&&w[0]?w[T++]=ne[K]||0:(w=[ne[K]],T=1);while((K++<z||w[0]!==void 0)&&k--);p=w[0]!==void 0}A[0]||A.shift()}if(f==1)g.e=l,Fn=p;else{for(m=1,d=A[0];d>=10;d/=10)m++;g.e=m+l*f-1,I(g,a?o+g.e+1:o,s,p)}return g}}();function I(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=C,s=e,l=m[d=0],u=l/ue(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/C),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,r=1,o%=C,s=o-C+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=C,s=o-C+r,u=s<0?0:l/ue(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ue(10,r-s-1)),c=t<4?(u||n)&&(t==0||t==(i.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ue(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=i.e+1,m[0]=ue(10,(C-e%C)%C),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ue(10,C-o),m[d]=s>0?(l/ue(10,r-s)%ue(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==Me&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Me)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return L&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function ve(i,e,t){if(!i.isFinite())return Un(i);var n,r=i.e,o=fe(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+Ze(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+Ze(-r-1)+o,t&&(n=t-s)>0&&(o+=Ze(n))):r>=s?(o+=Ze(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+Ze(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=Ze(n))),o}function _t(i,e){var t=i[0];for(e*=C;t>=10;t/=10)e++;return e}function Mt(i,e,t){if(e>Vi)throw L=!0,t&&(i.precision=t),Error(On);return I(new i(Lt),e,1,!0)}function Re(i,e,t){if(e>tn)throw Error(On);return I(new i(Rt),e,t,!0)}function qn(i){var e=i.length-1,t=e*C+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function Ze(i){for(var e="";i--;)e+="0";return e}function Vn(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/C+4);for(L=!1;;){if(t%2&&(o=o.times(e),En(o.d,s)&&(r=!0)),t=ye(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),En(e.d,s)}return L=!0,o}function Mn(i){return i.d[i.d.length-1]&1}function Gn(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function nn(i,e){var t,n,r,o,s,a,u,c=0,l=0,m=0,d=i.constructor,f=d.rounding,p=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(L=!1,u=p):u=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ue(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=I(o.times(i),u,1),t=t.times(++l),a=s.plus(Y(o,t,u,1)),fe(a.d).slice(0,u)===fe(s.d).slice(0,u)){for(r=m;r--;)s=I(s.times(s),u,1);if(e==null)if(c<3&&bt(s.d,u-n,f,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return I(s,d.precision=p,f,L=!0);else return d.precision=p,s}s=a}}function Ye(i,e){var t,n,r,o,s,a,u,c,l,m,d,f=1,p=10,b=i,y=b.d,g=b.constructor,A=g.rounding,w=g.precision;if(b.s<0||!y||!y[0]||!b.e&&y[0]==1&&y.length==1)return new g(y&&!y[0]?-1/0:b.s!=1?NaN:y?0:b);if(e==null?(L=!1,l=w):l=e,g.precision=l+=p,t=fe(y),n=t.charAt(0),Math.abs(o=b.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)b=b.times(i),t=fe(b.d),n=t.charAt(0),f++;o=b.e,n>1?(b=new g("0."+t),o++):b=new g(n+"."+t.slice(1))}else return c=Mt(g,l+2,w).times(o+""),b=Ye(new g(n+"."+t.slice(1)),l-p).plus(c),g.precision=w,e==null?I(b,w,A,L=!0):b;for(m=b,u=s=b=Y(b.minus(1),b.plus(1),l,1),d=I(b.times(b),l,1),r=3;;){if(s=I(s.times(d),l,1),c=u.plus(Y(s,new g(r),l,1)),fe(c.d).slice(0,l)===fe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Mt(g,l+2,w).times(o+""))),u=Y(u,new g(f),l,1),e==null)if(bt(u.d,l-p,A,a))g.precision=l+=p,c=s=b=Y(m.minus(1),m.plus(1),l,1),d=I(b.times(b),l,1),r=a=1;else return I(u,g.precision=w,A,L=!0);else return g.precision=w,u;u=c,r+=2}}function Un(i){return String(i.s*i.s/0)}function rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%C,t<0&&(n+=C),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=C;n<r;)i.d.push(+e.slice(n,n+=C));e=e.slice(n),n=C-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),L&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Ui(i,e){var t,n,r,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Wn.test(e))return rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(vi.test(e))t=16,e=e.toLowerCase();else if(Di.test(e))t=2;else if(Wi.test(e))t=8;else throw Error(Qe+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Vn(n,new n(t),o,o*2)),c=Kt(e,t,Me),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(i.s*0):(i.e=_t(c,l),i.d=c,L=!1,s&&(i=Y(i,r,a*4)),u&&(i=i.times(Math.abs(u)<54?ue(2,u):gt.pow(2,u))),L=!0,i)}function Xi(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:mt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/Ft(5,t)),e=mt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function mt(i,e,t,n,r){var o,s,a,u,c=1,l=i.precision,m=Math.ceil(l/C);for(L=!1,u=t.times(t),a=new i(n);;){if(s=Y(a.times(u),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=Y(s.times(u),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return L=!0,s.d.length=m+1,s}function Ft(i,e){for(var t=i;--e;)t*=i;return t}function Xn(i,e){var t,n=e.s<0,r=Re(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Ge=n?4:1,e;if(t=e.divToInt(r),t.isZero())Ge=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Ge=Mn(t)?n?2:3:n?4:1,e;Ge=Mn(t)?n?1:4:n?3:2}return e.minus(r).abs()}function on(i,e,t,n){var r,o,s,a,u,c,l,m,d,f=i.constructor,p=t!==void 0;if(p?(Be(t,1,Je),n===void 0?n=f.rounding:Be(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=Un(i);else{for(l=ve(i),s=l.indexOf("."),p?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=Kt(ve(d),10,r),d.e=d.d.length),m=Kt(l,10,r),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=p?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=Y(i,d,t,n,0,r),m=i.d,o=i.e,c=Fn),s=m[t],a=r/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,c)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=$t.charAt(m[s]);if(p){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Kt(l,r,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=$t.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function En(i,e){if(i.length>e)return i.length=e,!0}function zi(i){return new this(i).abs()}function Hi(i){return new this(i).acos()}function ji(i){return new this(i).acosh()}function Zi(i,e){return new this(i).plus(e)}function Yi(i){return new this(i).asin()}function Qi(i){return new this(i).asinh()}function Ji(i){return new this(i).atan()}function $i(i){return new this(i).atanh()}function er(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=Re(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?Re(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=Re(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(Y(i,e,o,1)),e=Re(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(Y(i,e,o,1)),t}function tr(i){return new this(i).cbrt()}function nr(i){return I(i=new this(i),i.e+1,2)}function ir(i,e,t){return new this(i).clamp(e,t)}function rr(i){if(!i||typeof i!="object")throw Error(Et+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,Je,"rounding",0,8,"toExpNeg",-lt,0,"toExpPos",0,lt,"maxE",0,lt,"minE",-lt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=en[t]),(n=i[t])!==void 0)if(ye(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(Qe+t+": "+n);if(t="crypto",r&&(this[t]=en[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Dn);else this[t]=!1;else throw Error(Qe+t+": "+n);return this}function or(i){return new this(i).cos()}function sr(i){return new this(i).cosh()}function zn(i){var e,t,n;function r(o){var s,a,u,c=this;if(!(c instanceof r))return new r(o);if(c.constructor=r,_n(o)){c.s=o.s,L?!o.d||o.e>r.maxE?(c.e=NaN,c.d=null):o.e<r.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;L?s>r.maxE?(c.e=NaN,c.d=null):s<r.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return rn(c,o.toString())}else if(u!=="string")throw Error(Qe+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),Wn.test(o)?rn(c,o):Ui(c,o)}if(r.prototype=h,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=rr,r.clone=zn,r.isDecimal=_n,r.abs=zi,r.acos=Hi,r.acosh=ji,r.add=Zi,r.asin=Yi,r.asinh=Qi,r.atan=Ji,r.atanh=$i,r.atan2=er,r.cbrt=tr,r.ceil=nr,r.clamp=ir,r.cos=or,r.cosh=sr,r.div=ar,r.exp=ur,r.floor=cr,r.hypot=lr,r.ln=mr,r.log=dr,r.log10=pr,r.log2=fr,r.max=br,r.min=gr,r.mod=yr,r.mul=hr,r.pow=wr,r.random=kr,r.round=Pr,r.sign=Ar,r.sin=Tr,r.sinh=xr,r.sqrt=Br,r.sub=Ir,r.sum=Sr,r.tan=Nr,r.tanh=Cr,r.trunc=Kr,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function ar(i,e){return new this(i).div(e)}function ur(i){return new this(i).exp()}function cr(i){return I(i=new this(i),i.e+1,3)}function lr(){var i,e,t=new this(0);for(L=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return L=!0,new this(1/0);t=e}return L=!0,t.sqrt()}function _n(i){return i instanceof gt||i&&i.toStringTag===vn||!1}function mr(i){return new this(i).ln()}function dr(i,e){return new this(i).log(e)}function fr(i){return new this(i).log(2)}function pr(i){return new this(i).log(10)}function br(){return Gn(this,arguments,"lt")}function gr(){return Gn(this,arguments,"gt")}function yr(i,e){return new this(i).mod(e)}function hr(i,e){return new this(i).mul(e)}function wr(i,e){return new this(i).pow(e)}function kr(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Be(i,1,Je),n=Math.ceil(i/C),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(Dn);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=C,n&&i&&(r=ue(10,C-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=C)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<C&&(t-=C-n)}return s.e=t,s.d=a,s}function Pr(i){return I(i=new this(i),i.e+1,this.rounding)}function Ar(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function Tr(i){return new this(i).sin()}function xr(i){return new this(i).sinh()}function Br(i){return new this(i).sqrt()}function Ir(i,e){return new this(i).sub(e)}function Sr(){var i=0,e=arguments,t=new this(e[i]);for(L=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return L=!0,I(t,this.precision,this.rounding)}function Nr(i){return new this(i).tan()}function Cr(i){return new this(i).tanh()}function Kr(i){return I(i=new this(i),i.e+1,1)}h[Symbol.for("nodejs.util.inspect.custom")]=h.toString;h[Symbol.toStringTag]="Decimal";var gt=h.constructor=zn(en);Lt=new gt(Lt);Rt=new gt(Rt);var B=gt;import Dr from"big.js";import vt from"bn.js";import Lr from"toformat";var Rr=Lr,yt=Rr;import Dt from"big.js";import Er from"bn.js";import _r from"decimal.js-light";import ht from"bn.js";var Hn=9007199254740991;function me(i){let e=ke("Raydium_parseBigNumberish");if(i instanceof ht)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new ht(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Hn||i<=-Hn)&&e.logWithError(`BigNumberish number overflow: ${i}`),new ht(String(i))):typeof i=="bigint"?new ht(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new ht(0))}var Ot=ke("module/fraction"),sn=yt(Dt),wt=yt(_r),Fr={[0]:wt.ROUND_DOWN,[1]:wt.ROUND_HALF_UP,[2]:wt.ROUND_UP},Or={[0]:Dt.roundDown,[1]:Dt.roundHalfUp,[2]:Dt.roundUp},G=class{constructor(e,t=new Er(1)){this.numerator=me(e),this.denominator=me(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new G(this.denominator,this.numerator)}add(e){let t=e instanceof G?e:new G(me(e));return this.denominator.eq(t.denominator)?new G(this.numerator.add(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof G?e:new G(me(e));return this.denominator.eq(t.denominator)?new G(this.numerator.sub(t.numerator),this.denominator):new G(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof G?e:new G(me(e));return new G(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof G?e:new G(me(e));return new G(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<=0&&Ot.logWithError(`${e} is not positive.`),wt.set({precision:e+1,rounding:Fr[n]});let r=new wt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||Ot.logWithError(`${e} is not an integer.`),e<0&&Ot.logWithError(`${e} is negative.`),sn.DP=e,sn.RM=Or[n]||1,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var vr=ke("Raydium_amount"),jn=yt(Dr);function Wr(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):vr.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var he=class extends G{constructor(t,n,r=!0,o){let s=new vt(0),a=an.pow(new vt(t.decimals));if(r)s=me(n);else{let u=new vt(0),c=new vt(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Wr(n.toString(),t.decimals);u=me(l),c=me(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ke(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new he(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new he(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return jn.DP=this.token.decimals,new jn(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as qr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zn}from"@solana/spl-token";var Yn={chainId:101,address:qr.default.toBase58(),programId:Zn.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},nt={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Zn.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as mn}from"@solana/web3.js";import{PublicKey as ee,SystemProgram as Qn,SYSVAR_RENT_PUBKEY as Vr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gr}from"@solana/spl-token";function un({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var Ps=[un({pubkey:Gr,isWritable:!1}),un({pubkey:Qn.programId,isWritable:!1}),un({pubkey:Vr,isWritable:!1})];function cn({publicKey:i,transformSol:e}){let t=Jn(i.toString());if(t instanceof ee)return e&&t.equals(kt)?Jt:t;if(e&&t.toString()===kt.toBase58())return Jt;if(typeof t=="string"){if(t===ee.default.toBase58())return ee.default;try{return new ee(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Jn(i){try{return new ee(i)}catch{return i}}var Wt=new ee("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),ln=new ee("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),dt=new ee("SysvarRent111111111111111111111111111111111"),As=new ee("SysvarC1ock11111111111111111111111111111111"),it=new ee("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Ts=new ee("Sysvar1nstructions1111111111111111111111111"),xs=Qn.programId,Bs=new ee("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Is=new ee("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Ss=new ee("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ns=new ee("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Cs=new ee("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Ks=new ee("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ls=new ee("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Rs=new ee("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ms=new ee("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Es=new ee("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),_s=new ee("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Jt=new ee("So11111111111111111111111111111111111111112"),kt=ee.default;function Ct(i){return cn({publicKey:i,transformSol:!0})}var dn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===kt.toBase58()||e instanceof mn&&kt.equals(e)){this.decimals=nt.decimals,this.symbol=nt.symbol,this.name=nt.name,this.mint=new mn(nt.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?mn.default:cn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ue=dn;Ue.WSOL=new dn(ie(Q({},nt),{mint:nt.address}));var fn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},qt=fn;qt.SOL=new fn(Yn);import Ur from"bn.js";var $n=new G(new Ur(100)),$e=class extends G{toSignificant(e=5,t,n){return this.mul($n).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul($n).toFixed(e,t,n)}};var Xr=ke("Raydium_price"),Ee=class extends G{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new G(pn(n.decimals),pn(r.decimals))}get raw(){return new G(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new Ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Xr.logWithError("mul token not equals");let n=super.mul(t);return new Ee({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as fa}from"@solana/web3.js";import ba from"bn.js";var zr=new Xe(0),Ma=new Xe(1),Ea=new Xe(2),_a=new Xe(3),Fa=new Xe(5),an=new Xe(10),Oa=new Xe(100),Da=new Xe(1e3),va=new Xe(1e4);function pn(i){return an.pow(me(i))}function Yt(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as jr}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Zr}from"@solana/spl-token";import{ComputeBudgetProgram as Ha,Keypair as Ya,PublicKey as Hr,Transaction as Ja,TransactionMessage as eu,VersionedTransaction as tu}from"@solana/web3.js";var pe={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as ou}from"@solana/spl-token";var su=ke("Raydium_txUtil");function Pe(i,e){let[t,n]=Hr.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Ce(i,e,t){return Pe([i.toBuffer(),(t!=null?t:Zr).toBuffer(),e.toBuffer()],new jr("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as E}from"@solana/web3.js";var fu=new E("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),pu=new E("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),bu=new E("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),gu=new E("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),yu=new E("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),hu=new E("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),wu=new E("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ku=new E("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),Pu=new E("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),Au=new E("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Tu=new E("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),xu=new E("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Bu=new E("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Iu=new E("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),Su=new E("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Nu=new E("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),Cu=new E("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Ku=new E("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Lu=new E("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Ru=new E("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),Mu=new E("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Eu=new E("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Yr=new E("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Qr=new E("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Jr=new E("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),_u=new E("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),$r=new E("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Fu=new E("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),eo=new E("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var Ou={SERUM_MARKET:E.default,OPENBOOK_MARKET:new E("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:E.default,FarmV3:new E("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new E("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new E("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new E("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new E("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new E("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new E("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new E("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new E("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Yr,CREATE_CPMM_POOL_AUTH:Qr,CREATE_CPMM_POOL_FEE_ACC:Jr,FEE_DESTINATION_ID:new E("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:$r,LCOK_CPMM_AUTH:eo};import _e from"bn.js";var Pt=1e4;function re(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=ie(Q({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new _e(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Pt){let u=new _e(o.maximumFee.toString());return{amount:i.add(u),fee:u,expirationTime:a}}else{let u=bn(i.mul(new _e(Pt)),new _e(Pt-o.transferFeeBasisPoints)),c=new _e(o.maximumFee.toString()),l=u.sub(i).gt(c)?i.add(c):u,m=bn(l.mul(new _e(o.transferFeeBasisPoints)),new _e(Pt)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=bn(i.mul(new _e(o.transferFeeBasisPoints)),new _e(Pt)),c=u.gt(s)?s:u;return{amount:i,fee:c,expirationTime:a}}}function et(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function bn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new _e(0))?t.add(new _e(1)):t}import{PublicKey as to,AddressLookupTableAccount as ei}from"@solana/web3.js";var no={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new ei({key:new to("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:ei.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as ic,sendAndConfirmTransaction as rc,Transaction as sc,TransactionMessage as uc,VersionedTransaction as cc}from"@solana/web3.js";import mc from"axios";import{ASSOCIATED_TOKEN_PROGRAM_ID as Sn,TOKEN_2022_PROGRAM_ID as Ve,TOKEN_PROGRAM_ID as $}from"@solana/spl-token";import{PublicKey as mo}from"@solana/web3.js";import ri,{isBN as oi}from"bn.js";import{bits as Fc,BitStructure as Oc,blob as io,Blob as Dc,cstr as vc,f32 as Wc,f32be as qc,f64 as Vc,f64be as Gc,greedy as Uc,Layout as ro,ns64 as Xc,ns64be as zc,nu64 as Hc,nu64be as jc,offset as Zc,s16 as Yc,s16be as Qc,s24 as Jc,s24be as $c,s32 as oo,s32be as el,s40 as tl,s40be as nl,s48 as il,s48be as rl,s8 as ol,seq as so,struct as sl,Structure as ao,u16 as uo,u16be as al,u24 as ul,u24be as cl,u32 as ll,u32be as ml,u40 as dl,u40be as fl,u48 as pl,u48be as bl,u8 as co,UInt as lo,union as gl,Union as yl,unionLayoutDiscriminator as hl,utf8 as wl}from"@solana/buffer-layout";var gn=ro,ti=ao;var yn=lo;var ni=co,At=uo;var be=oo;var ii=so;var Ie=io;var ft=class extends gn{constructor(t,n,r){super(t,r);this.blob=Ie(t),this.signed=n}decode(t,n=0){let r=new ri(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new ri(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function se(i){return new yn(1,i)}function pt(i){return new yn(4,i)}function N(i){return new ft(8,!1,i)}function q(i){return new ft(16,!1,i)}function si(i){return new ft(8,!0,i)}function ai(i){return new ft(16,!0,i)}var Vt=class extends gn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function H(i){return new Vt(Ie(32),e=>new mo(e),e=>e.toBuffer(),i)}function Fe(i){return new Vt(ni(),fo,po,i)}function fo(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function po(i){return i?1:0}var hn=class extends ti{decode(e,t){return super.decode(e,t)}};function j(i,e,t){return new hn(i,e,t)}function te(i,e,t){let n,r=typeof e=="number"?e:oi(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=oi(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ii(i,r,t)}import xo from"bn.js";import Ke from"bn.js";var oe=new Ke(0),We=new Ke(1),ze=new Ke(-1),Se=new Ke(1).shln(64),Gt=new Ke(1).shln(128),wn=Se.sub(We),Tt=64,ui=Gt.subn(1),we=-443636,Ae=-we,rt=new Ke("4295048016"),ot=new Ke("79226673521066979257578248091"),Ml=new Ke("4295048017"),El=new Ke("79226673521066979257578248090"),ci=16,li="59543866431248",mi="184467440737095516",di="15793534762490258745",Ut=new Ke(10).pow(new Ke(6));var _l=new Ke("18446744073700000000");import F from"bn.js";function Xt(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function kn(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function Pn(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function xt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function fi(i,e){return xt(i,e)?null:kn(i,e)}function pi(i,e){return xt(i,e)?null:Pn(i,e)}var ql=Buffer.from("amm_config","utf8"),bo=Buffer.from("pool","utf8"),go=Buffer.from("pool_vault","utf8"),yo=Buffer.from("pool_reward_vault","utf8"),bi=Buffer.from("position","utf8"),ho=Buffer.from("tick_array","utf8"),wo=Buffer.from("operation","utf8"),ko=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Po=Buffer.from("observation","utf8");function gi(i,e,t,n){return Pe([bo,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function An(i,e,t){return Pe([go,e.toBuffer(),t.toBuffer()],i)}function yi(i,e,t){return Pe([yo,e.toBuffer(),t.toBuffer()],i)}function U(i,e,t){return Pe([ho,e.toBuffer(),Xt(t)],i)}function tt(i,e,t,n){return Pe([bi,e.toBuffer(),Xt(t),Xt(n)],i)}function Ne(i,e){return Pe([bi,e.toBuffer()],i)}function Bt(i){return Pe([Buffer.from("metadata","utf8"),it.toBuffer(),i.toBuffer()],it)}function Tn(i){return Pe([wo],i)}function Le(i,e){return Pe([ko,e.toBuffer()],i)}function hi(i,e){return Pe([Po,e.toBuffer()],i)}var wi=Buffer.from("locked_position","utf8");function xn(i,e){return Pe([wi,e.toBuffer()],i)}function ki(i,e){return Pe([wi,e.toBuffer()],i)}import{PublicKey as Oe}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Pi}from"@solana/spl-token";import J from"bn.js";import qe from"bn.js";var It=class{static getfeeGrowthInside(e,t,n){let r=new qe(0),o=new qe(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new qe(0),a=new qe(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),c=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Se),u=t.tokenFeesOwedA.add(a),c=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Se),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Se),u=t.tokenFeesOwedA.add(a),c=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Se),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=_.wrappingSubU128(u,c.growthInsideLastX64),m=_.mulDivFloor(l,t.liquidity,Se),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=_.wrappingSubU128(u,c.growthInsideLastX64),m=_.mulDivFloor(l,t.liquidity,Se),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new qe(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new qe(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,g,A,w;let a=M.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),u=M.getSqrtPriceX64FromTick(t.tickLower),c=M.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=V.getAmountsFromLiquidity(a,u,c,n,o),[d,f]=[re(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),re(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[p,b]=[re(new qe(new B(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),re(new qe(new B(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:et(d.expirationTime,f.expirationTime)}}};var Ao=15,W=class{static async getTickArrays(e,t,n,r,o,s,a){let u=[],c=x.getTickArrayStartIndexByTick(r,o),l=x.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Ao/2));for(let f=0;f<l.length;f++){let{publicKey:p}=U(t,n,l[f]);u.push(p)}let m=(await je(e,u)).map(f=>f!==null?St.decode(f.data):null),d={};for(let f=0;f<u.length;f++){let p=m[f];p!==null&&(d[p.startTickIndex]=ie(Q({},p),{address:u[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=x.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/W.tickCount(t)),a=n?x.searchLowBitFromStart(r,o,s-1,1,t):x.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=ce-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<ce;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=U(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=x.getTickArrayStartIndexByTick(r,o),u=Math.floor((r-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<ce;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=U(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(x.checkIsOutOfBoundary(e)){if(e>Ae)return!1;let n=x.getTickArrayStartIndexByTick(we,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return ce*e}};var Bn=14,He=class{static maxTickInTickarrayBitmap(e){return e*ce*st}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!W.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-W.tickCount(n):t+W.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*ce,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(r){let l=e.shln(1024-c-1),m=fi(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=pi(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-W.tickCount(n)}}}},Nt=class{static getBitmapOffset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=He.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=He.maxTickInTickarrayBitmap(e),n=-t;if(Ae<=t)throw Error(`extensionTickBoundary check error: ${Ae}, ${t}`);if(n<=we)throw Error(`extensionTickBoundary check error: ${n}, ${we}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:x.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=W.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=He.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let u=x.mergeTickArrayBitmap(e).shln(st-1-a),c=xt(512,u)?null:kn(512,u);if(c!==null){let l=t-c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=x.mergeTickArrayBitmap(e).shrn(a),c=xt(512,u)?null:Pn(512,u);if(c!==null){let l=t+c*W.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-W.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%He.maxTickInTickarrayBitmap(t),r=Math.floor(n/W.tickCount(t));return e<0&&n!=0&&(r=st-r),r}};var ge=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:b,feeAmount:y}=at.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return u.push(...p),{allTrade:d,expectedAmountOut:f.mul(ze),remainingAccounts:u,executionPrice:b,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let b=this.preInitializedTickArrayStartIndex(e,s);if(b.isExist){let{publicKey:y}=U(e.programId,e.id,b.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:p}=at.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(ze),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=ge.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Nt.checkTickArrayIsInit(W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):x.checkTickArrayIsInitialized(x.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=U(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,W.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=U(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/W.tickCount(e.tickSpacing)),r=t?x.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):x.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=W.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=He.nextInitializedTickArrayStartIndex(x.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Nt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<we||t>Ae)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let f=ie(Q({},m),{perSecond:_.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Oe(d)});if(f.tokenMint.equals(Oe.default))continue;if(n<=f.openTime.toNumber()||r.eq(oe)){s.push(f);continue}let p=new J(Math.min(f.endTime.toNumber(),n)),b=p.sub(f.lastUpdateTime),y=_.mulDivFloor(b,f.emissionsPerSecondX64,r),g=f.rewardGrowthGlobalX64.add(y),A=_.mulDivFloor(b,f.emissionsPerSecondX64,Se),w=f.rewardTotalEmissioned.add(A);s.push(ie(Q({},f),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:w,lastUpdateTime:p}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=x.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=He.maxTickInTickarrayBitmap(e),n=-t;return t>Ae&&(t=W.getArrayStartIndex(Ae,e)+W.tickCount(e)),n<we&&(n=W.getArrayStartIndex(we,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!W.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/W.tickCount(t)*st}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await Qt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=xi.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let u of t){let c=x.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=x.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=U(u.programId,u.id,m);o.push({pubkey:d}),r[d.toString()]=u.id}}let s=await Qt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=r[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=St.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=ie(Q({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let f of s)c.push(Ne(f,d).publicKey);let l=await je(t,c,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=Ti.decode(d.data),p=f.poolId.toString(),b=e.find(K=>K.state.id.toBase58()===p);if(b===void 0)continue;let y=b.state,g=x._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),A=x._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:T}=V.getAmountsFromLiquidity(y.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,f.liquidity,!1),S=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));b.positionAccount=[...(a=b.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:g.price,priceUpper:A.price,amountA:w,amountB:T,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(K=>ie(Q({},K),{pendingReward:new J(0)})),leverage:S,tokenFeeAmountA:new J(0),tokenFeeAmountB:new J(0)}];let k=await x.getTickArrayAddressByTick(b.state.programId,f.poolId,f.tickLower,b.state.tickSpacing),R=await x.getTickArrayAddressByTick(b.state.programId,f.poolId,f.tickUpper,b.state.tickSpacing);m[`${b.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=k,m[`${b.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=R}if(o){let d=Object.values(m),f=await je(t,d,{batchRequest:r}),p={};for(let b=0;b<d.length;b++){let y=f[b];if(y===null)continue;let g=d[b].toString();p[g]=St.decode(y.data)}for(let{state:b,positionAccount:y}of e)if(!!y)for(let g of y){let A=`${b.programId.toString()}-${b.id.toString()}-${g.tickLower}`,w=`${b.programId.toString()}-${b.id.toString()}-${g.tickUpper}`,T=p[m[A].toString()],S=p[m[w].toString()],k=T.ticks[x.getTickOffsetInArray(g.tickLower,b.tickSpacing)],R=S.ticks[x.getTickOffsetInArray(g.tickUpper,b.tickSpacing)],{tokenFeeAmountA:K,tokenFeeAmountB:z}=await It.GetPositionFees(b,g,k,R),Z=await It.GetPositionRewards(b,g,k,R);g.tokenFeeAmountA=K.gte(new J(0))?K:new J(0),g.tokenFeeAmountB=z.gte(new J(0))?z:new J(0);for(let O=0;O<Z.length;O++)g.rewardInfos[O].pendingReward=Z[O].gte(new J(0))?Z[O]:new J(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new B(0),catchLiquidityInsufficient:u=!1}){var le;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new B(0))?c=l?rt.add(new J(1)):ot.sub(new J(1)):c=M.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=re(o,m,r,!1),{allTrade:p,expectedAmountOut:b,remainingAccounts:y,executionPrice:g,feeAmount:A}=ge.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((le=f.fee)!=null?le:oe),c,u),w=re(b,d,r,!1),T=M.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),S=l?T:new B(1).div(T),k=b.mul(new J(Math.floor((1-s)*1e10))).div(new J(1e10)),R=re(k,d,r,!1),K=l?e.currentPrice:new B(1).div(e.currentPrice),z=new B(S).sub(K).abs(),Z=K,O=new $e(new B(z).mul(10**15).toFixed(0),new B(Z).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:w,minAmountOut:R,expirationTime:et(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:S,priceImpact:O,fee:A,remainingAccounts:y,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=r.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ue(ie(Q({},c),{mint:c.address,isToken2022:c.programId===Pi.toBase58()})),new Ue(ie(Q({},l),{mint:l.address,isToken2022:l.programId===Pi.toBase58()}))],{allTrade:f,realAmountIn:p,amountOut:b,minAmountOut:y,expirationTime:g,currentPrice:A,executionPrice:w,priceImpact:T,fee:S,remainingAccounts:k,executionPriceX64:R}=ge.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Oe(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),K=ie(Q({},p),{amount:new he(m,p.amount),fee:p.fee===void 0?void 0:new he(m,p.fee)}),z=ie(Q({},b),{amount:new he(d,b.amount),fee:b.fee===void 0?void 0:new he(d,b.fee)}),Z=ie(Q({},y),{amount:new he(d,y.amount),fee:y.fee===void 0?void 0:new he(d,y.fee)}),O=new Ee({baseToken:m,denominator:new J(10).pow(new J(20+m.decimals)),quoteToken:d,numerator:A.mul(new B(10**(20+d.decimals))).toFixed(0)}),le=new Ee({baseToken:m,denominator:new J(10).pow(new J(20+m.decimals)),quoteToken:d,numerator:w.mul(new B(10**(20+d.decimals))).toFixed(0)}),ae=new he(m,S);return{allTrade:f,realAmountIn:K,amountOut:z,minAmountOut:Z,expirationTime:g,currentPrice:O,executionPrice:le,priceImpact:T,fee:ae,remainingAccounts:k,executionPriceX64:R}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new B(0)}){var Z;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new B(0))?l=u?ot.sub(new J(1)):rt.add(new J(1)):l=M.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=re(o,c[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:b}=ge.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((Z=m.fee)!=null?Z:oe),l),y=u?e.mintB.address:e.mintA.address,g=re(d,c[y],r,!1),A=M.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),w=u?A:new B(1).div(A),T=d.mul(new J(Math.floor((1+s)*1e10))).div(new J(1e10)),S=re(T,c[y],r,!0),k=u?e.currentPrice:new B(1).div(e.currentPrice),R=new B(w).sub(k).abs(),K=k,z=new $e(new B(R).mul(10**15).toFixed(0),new B(K).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:S,realAmountOut:m,expirationTime:et(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:z,fee:b,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var p,b,y;let o=e[t],s=x.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=x.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((p=o.rewardApr[0])!=null?p:0)*f,((b=o.rewardApr[1])!=null?b:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[Ct(e.mintA.address).toString()],d=r[Ct(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let b=M.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),y=M.getSqrtPriceX64FromTick(s),g=M.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:w}=V.getAmountsFromLiquidityWithSlippage(b,y,g,t,!1,!1,0),{amountSlippageA:T,amountSlippageB:S}=V.getAmountsFromLiquidityWithSlippage(b,y,g,o,!1,!1,0),k=new B(A.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(w.toString()).div(new B(10).pow(p)).mul(d.value)),R=new B(T.toString()).div(new B(10).pow(f)).mul(m.value).add(new B(S.toString()).div(new B(10).pow(p)).mul(d.value)),K=new B(1).div(k.add(R)),Z=new B(l.volumeFee).mul(365).div(c).mul(K).mul(100).toNumber(),O=3600*24*365,le=e.rewardDefaultInfos.map(ae=>{var X,Nn;let xe=ae.mint.decimals,ne=r[ae.mint.address];return u<((X=ae.startTime)!=null?X:0)||u>((Nn=ae.endTime)!=null?Nn:0)||!ae.perSecond||!ne||xe===void 0?0:new B(ne.value).mul(new B(ae.perSecond).mul(O)).div(new B(10).pow(xe)).mul(K).mul(100).toNumber()});return{feeApr:Z,rewardsApr:le,apr:Z+le.reduce((ae,xe)=>ae+xe,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,A;let l=M.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),m=M.getSqrtPriceX64FromTick(n),d=M.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,p=re(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),b=new J(new B(p.amount.sub((A=p.fee)!=null?A:oe).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?V.getLiquidityFromTokenAmountA(m,d,b,!a):new J(0);else if(l.lte(d)){let w=V.getLiquidityFromTokenAmountA(l,d,b,!a),T=V.getLiquidityFromTokenAmountB(m,l,b);y=t?w:T}else y=t?new J(0):V.getLiquidityFromTokenAmountB(m,d,b);return ge.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,g,A,w;let u=M.getSqrtPriceX64FromTick(n),c=M.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=V.getAmountsFromLiquidity(M.priceToSqrtPriceX64(new B(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,f]=[re(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),re(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[p,b]=[re(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),re(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:b,expirationTime:et(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(u=>!n[u.id]).map(u=>new Oe(u.id));(await je(e,r)).forEach((u,c)=>{!u||(n[r[c].toBase58()]=Ai.decode(u.data))});let s=t.map(u=>Le(new Oe(u.programId),new Oe(u.id)).publicKey),a=await ge.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>ie(Q({},u),{[c.id]:ie(Q({},n[c.id]),{id:new Oe(c.id),version:6,programId:new Oe(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:ie(Q({},c.config),{id:new Oe(c.config.id),fundOwner:""}),currentPrice:new B(c.price),exBitmapInfo:a[Le(new Oe(c.programId),new Oe(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var _=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(oe)||(o=o.add(We)),o}static mulDivFloor(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(oe))throw new Error("division by 0");return e.mul(t).add(n.sub(We)).div(n)}static x64ToDecimal(e,t){return new B(e.toString()).div(B.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new F(e.mul(B.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(Gt).sub(t).mod(Gt)}};function de(i,e){return In(i.mul(e),64,256)}function To(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function In(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var M=class{static sqrtPriceX64ToPrice(e,t,n){return _.x64ToDecimal(e).pow(2).mul(B.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return _.decimalToX64(e.mul(B.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(oe))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(oe))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(oe))return e;let o=t.shln(Tt);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?_.mulDivCeil(s,e,a):_.mulDivRoundingUp(s,We,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return _.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Tt);if(r)return e.add(o.div(t));{let s=_.mulDivRoundingUp(o,We,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<we||e>Ae)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new F("18445821805675395072"):new F("18446744073709551616");return(t&2)!=0&&(n=de(n,new F("18444899583751176192"))),(t&4)!=0&&(n=de(n,new F("18443055278223355904"))),(t&8)!=0&&(n=de(n,new F("18439367220385607680"))),(t&16)!=0&&(n=de(n,new F("18431993317065453568"))),(t&32)!=0&&(n=de(n,new F("18417254355718170624"))),(t&64)!=0&&(n=de(n,new F("18387811781193609216"))),(t&128)!=0&&(n=de(n,new F("18329067761203558400"))),(t&256)!=0&&(n=de(n,new F("18212142134806163456"))),(t&512)!=0&&(n=de(n,new F("17980523815641700352"))),(t&1024)!=0&&(n=de(n,new F("17526086738831433728"))),(t&2048)!=0&&(n=de(n,new F("16651378430235570176"))),(t&4096)!=0&&(n=de(n,new F("15030750278694412288"))),(t&8192)!=0&&(n=de(n,new F("12247334978884435968"))),(t&16384)!=0&&(n=de(n,new F("8131365268886854656"))),(t&32768)!=0&&(n=de(n,new F("3584323654725218816"))),(t&65536)!=0&&(n=de(n,new F("696457651848324352"))),(t&131072)!=0&&(n=de(n,new F("26294789957507116"))),(t&262144)!=0&&(n=de(n,new F("37481735321082"))),e>0&&(n=ui.div(n)),n}static getTickFromPrice(e,t,n){return M.getTickFromSqrtPriceX64(M.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(ot)||e.lt(rt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new F(t-64),r=To(n,32,128),o=new F("8000000000000000","hex"),s=0,a=new F(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new F(0))&&s<ci;){u=u.mul(u);let p=u.shrn(127);u=u.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=r.add(c).mul(new F(li)),d=In(m.sub(new F(mi)),64,128).toNumber(),f=In(m.add(new F(di)),64,128).toNumber();return d==f?d:M.getSqrtPriceX64FromTick(f).lte(e)?f:d}},ut=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=M.getTickFromSqrtPriceX64(M.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=ut.getTickWithPriceAndTickspacing(e,t,n,r),s=M.getSqrtPriceX64FromTick(o);return M.sqrtPriceX64ToPrice(s,n,r)}},V=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Tt),s=t.sub(e);return r?_.mulDivRoundingUp(_.mulDivCeil(o,s,t),We,e):_.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(oe))throw new Error("sqrtPriceX64A must greater than 0");return r?_.mulDivCeil(n,t.sub(e),Se):_.mulDivFloor(n,t.sub(e),Se)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?_.mulDivRoundingUp(a,We,wn):a.shrn(Tt)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),_.mulDivFloor(n,wn,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return V.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=V.getLiquidityFromTokenAmountA(e,n,r,!1),a=V.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return V.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:V.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new F(0)};if(e.lt(n)){let s=V.getTokenAmountAFromLiquidity(e,n,r,o),a=V.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new F(0),amountB:V.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:u,amountB:c}=V.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new F(new B(u.toString()).mul(l).toFixed(0)),d=new F(new B(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,w,T,S;let c=M.priceToSqrtPriceX64(new B(e.price),e.mintA.decimals,e.mintB.decimals),l=M.getSqrtPriceX64FromTick(t),m=M.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=V.getAmountsFromLiquidity(c,l,m,r,s),[p,b]=[re(f.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),re(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,u)],[y,g]=[re(new F(new B(f.amountA.toString()).mul(d).toFixed(0)),(T=e.mintA.extensions)==null?void 0:T.feeConfig,a,u),re(new F(new B(f.amountB.toString()).mul(d).toFixed(0)),(S=e.mintB.extensions)==null?void 0:S.feeConfig,a,u)];return{liquidity:r,amountA:p,amountB:b,amountSlippageA:y,amountSlippageB:g,expirationTime:et(p.expirationTime,b.expirationTime)}}},at=class{static swapCompute(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b=!1){if(d.eq(oe))throw new Error("amountSpecified must not be 0");if(p||(p=s?rt.add(We):ot.sub(We)),s){if(p.lt(rt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(ot))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(oe),g={amountSpecifiedRemaining:d,amountCalculated:oe,sqrtPriceX64:m,tick:c>f?Math.min(f+W.tickCount(l)-1,c):f,accounts:[],liquidity:u,feeAmount:new F(0)},A=f,w=n[f],T=0,S=!s&&w.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(oe)&&!g.sqrtPriceX64.eq(p);){T>10;let k={};k.sqrtPriceStartX64=g.sqrtPriceX64;let R=x.nextInitTick(w,g.tick,l,s,S),K=R||null,z=null;if(!(K!=null&&K.liquidityGross.gtn(0))){let O=ge.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},A,s);if(!O.isExist){if(b)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=O.nextStartIndex;let{publicKey:le}=U(e,t,A);z=le,w=n[A];try{K=x.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}k.tickNext=K.tick,k.initialized=K.liquidityGross.gtn(0),f!==A&&z&&(g.accounts.push(z),f=A),k.tickNext<we?k.tickNext=we:k.tickNext>Ae&&(k.tickNext=Ae),k.sqrtPriceNextX64=M.getSqrtPriceX64FromTick(k.tickNext);let Z;if(s&&k.sqrtPriceNextX64.lt(p)||!s&&k.sqrtPriceNextX64.gt(p)?Z=p:Z=k.sqrtPriceNextX64,[g.sqrtPriceX64,k.amountIn,k.amountOut,k.feeAmount]=at.swapStepCompute(g.sqrtPriceX64,Z,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(k.feeAmount),y?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(k.amountIn.add(k.feeAmount)),g.amountCalculated=g.amountCalculated.sub(k.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(k.amountOut),g.amountCalculated=g.amountCalculated.add(k.amountIn.add(k.feeAmount))),g.sqrtPriceX64.eq(k.sqrtPriceNextX64)){if(k.initialized){let O=K.liquidityNet;s&&(O=O.mul(ze)),g.liquidity=V.addDelta(g.liquidity,O)}S=k.tickNext!=g.tick&&!s&&w.startTickIndex===k.tickNext,g.tick=s?k.tickNext-1:k.tickNext}else if(g.sqrtPriceX64!=k.sqrtPriceStartX64){let O=M.getTickFromSqrtPriceX64(g.sqrtPriceX64);S=O!=g.tick&&!s&&w.startTickIndex===O,g.tick=O}++T}try{let{nextStartIndex:k,isExist:R}=W.nextInitializedTickArray(g.tick,l,s,r,o);R&&f!==k&&(g.accounts.push(U(e,t,k).publicKey),f=k)}catch{}return{allTrade:!0,amountSpecifiedRemaining:oe,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new F(0),amountIn:new F(0),amountOut:new F(0),feeAmount:new F(0)},a=e.gte(t),u=r.gte(oe);if(u){let l=_.mulDivFloor(r,Ut.sub(new F(o.toString())),Ut);s.amountIn=a?V.getTokenAmountAFromLiquidity(t,e,n,!0):V.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=M.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?V.getTokenAmountBFromLiquidity(t,e,n,!1):V.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(ze).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=M.getNextSqrtPriceX64FromOutput(e,n,r.mul(ze),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=V.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=V.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:V.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:V.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(r.mul(ze))&&(s.amountOut=r.mul(ze)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=_.mulDivCeil(s.amountIn,new F(o),Ut.sub(new F(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var ce=60,st=512,x=class{static getTickArrayAddressByTick(e,t,n,r){let o=x.getTickArrayStartIndexByTick(n,r),{publicKey:s}=U(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=x.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=ce)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=W.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*W.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*ce,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*ce,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*ce:e+t*ce}static mergeTickArrayBitmap(e){let t=new xo(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*ce));return[...x.searchLowBitFromStart(e,t,s-1,o,n),...x.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return x.searchHightBitFromStart(e,t,0,st,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=x.getAllInitializedTickArrayStartIndex(n,r,o);for(let u of a){let{publicKey:c}=U(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>x.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===r)break}let u=W.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<we||e>Ae}static nextInitTick(e,t,n,r,o){if(W.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<ce;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=ce-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<ce;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=M.getSqrtPriceX64FromTick(t),o=M.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=ut.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=M.getSqrtPriceX64FromTick(o),a=M.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=M.getSqrtPriceX64FromTick(t),o=M.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new B(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new B(1).div(t),o=ut.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=M.getSqrtPriceX64FromTick(o),a=M.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new B(1).div(a)}}};var Zm=j([Ie(8),se("bump"),At("index"),H(""),pt("protocolFeeRate"),pt("tradeFeeRate"),At("tickSpacing"),te(N(),8,"")]),Bo=j([pt("blockTimestamp"),si("tickCumulative"),te(N(),4)]),Bi=j([Ie(8),Fe("initialized"),N("recentEpoch"),At("observationIndex"),H("poolId"),te(Bo,100,"observations"),te(N(),4)]),Io=j([se("rewardState"),N("openTime"),N("endTime"),N("lastUpdateTime"),q("emissionsPerSecondX64"),N("rewardTotalEmissioned"),N("rewardClaimed"),H("tokenMint"),H("tokenVault"),H("creator"),q("rewardGrowthGlobalX64")]),Ai=j([Ie(8),se("bump"),H("ammConfig"),H("creator"),H("mintA"),H("mintB"),H("vaultA"),H("vaultB"),H("observationId"),se("mintDecimalsA"),se("mintDecimalsB"),At("tickSpacing"),q("liquidity"),q("sqrtPriceX64"),be("tickCurrent"),pt(),q("feeGrowthGlobalX64A"),q("feeGrowthGlobalX64B"),N("protocolFeesTokenA"),N("protocolFeesTokenB"),q("swapInAmountTokenA"),q("swapOutAmountTokenB"),q("swapInAmountTokenB"),q("swapOutAmountTokenA"),se("status"),te(se(),7,""),te(Io,3,"rewardInfos"),te(N(),16,"tickArrayBitmap"),N("totalFeesTokenA"),N("totalFeesClaimedTokenA"),N("totalFeesTokenB"),N("totalFeesClaimedTokenB"),N("fundFeesTokenA"),N("fundFeesTokenB"),N("startTime"),te(N(),15*4-3,"padding")]),So=j([q("growthInsideLastX64"),N("rewardAmountOwed")]),Ti=j([Ie(8),se("bump"),H("nftMint"),H("poolId"),be("tickLower"),be("tickUpper"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),te(So,3,"rewardInfos"),te(N(),8,"")]),Ym=j([Ie(8),se("bump"),H("poolId"),be("tickLowerIndex"),be("tickUpperIndex"),q("liquidity"),q("feeGrowthInsideLastX64A"),q("feeGrowthInsideLastX64B"),N("tokenFeesOwedA"),N("tokenFeesOwedB"),te(q(),3,"rewardGrowthInside"),te(N(),8,"")]),No=j([be("tick"),ai("liquidityNet"),q("liquidityGross"),q("feeGrowthOutsideX64A"),q("feeGrowthOutsideX64B"),te(q(),3,"rewardGrowthsOutsideX64"),te(pt(),13,"")]),St=j([Ie(8),H("poolId"),be("startTickIndex"),te(No,ce,"ticks"),se("initializedTickCount"),te(se(),115,"")]),Qm=j([Ie(329),te(H(),100,"whitelistMints")]),xi=j([Ie(8),H("poolId"),te(te(N(),8),Bn,"positiveTickArrayBitmap"),te(te(N(),8),Bn,"negativeTickArrayBitmap")]),Jm=j([N(),se("bump"),H("owner"),H("poolId"),H("positionId"),H("nftAccount"),te(N(),8)]),$m=j([Ie(8),se("bump"),H("lockOwner"),H("poolId"),H("positionId"),H("nftAccount"),H("lockNftMint"),N("recentEpoch"),te(N(),8)]);Bi.span;var Si=ke("Raydium_Clmm"),De={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Ni=[188,37,179,131,82,150,84,73],Ci=[16,72,250,198,14,162,212,19],Ht=class{static createPoolInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p){let b=j([q("sqrtPriceX64"),N("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1}],g=Buffer.alloc(b.span);b.encode({sqrtPriceX64:f,startTime:p},g);let A=Buffer.from([...De.createPool,...g]);return new Te({keys:y,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new P(r.address),new P(o.address)],{publicKey:m}=gi(t,s,c,l),{publicKey:d}=hi(t,m),{publicKey:f}=An(t,m,c),{publicKey:p}=An(t,m,l),b=[this.createPoolInstruction(t,m,n,s,d,c,f,new P(r.programId||$),l,p,new P(o.programId||$),Le(t,m).publicKey,a,u)];return{signers:[],instructions:b,instructionTypes:[pe.CreateAccount,pe.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:p},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,w,T,S,k,R,K,z,Z){let O=j([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Fe("withMetadata"),se("optionBaseFlag"),Fe("baseFlag")]),le=[...Z?[{pubkey:Z,isSigner:!1,isWritable:!0}]:[]],ae=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],xe=Buffer.alloc(O.span);O.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:S,liquidity:k,amountMaxA:R,amountMaxB:K,withMetadata:z==="create",baseFlag:!1,optionBaseFlag:0},xe);let ne=Buffer.from([...De.openPosition,...xe]);return new Te({keys:ae,programId:e,data:ne})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new P(e.programId),new P(e.id)],p;if(l)p=new P((await l(1))[0]);else{let K=zt.generate();m.push(K),p=K.publicKey}let b=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=U(d,f,b),{publicKey:A}=U(d,f,y),{publicKey:w}=Ce(n.wallet,p,$),{publicKey:T}=Bt(p),{publicKey:S}=Ne(d,p),{publicKey:k}=tt(d,f,r,o),R=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,p,w,T,k,g,A,S,n.tokenAccountA,n.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(e.mintA.address),new P(e.mintB.address),r,o,b,y,s,a,u,c);return{signers:m,instructions:[R],instructionTypes:[pe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:p,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:T,personalPosition:S,protocolPosition:k}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,f]=[new P(e.programId),new P(e.id)],p;if(l)p=new P((await l(1))[0]);else{let K=zt.generate();m.push(K),p=K.publicKey}let b=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=U(d,f,b),{publicKey:A}=U(d,f,y),{publicKey:w}=Ce(n.wallet,p,$),{publicKey:T}=Bt(p),{publicKey:S}=Ne(d,p),{publicKey:k}=tt(d,f,r,o),R=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,p,w,T,k,g,A,S,n.tokenAccountA,n.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(e.mintA.address),new P(e.mintB.address),r,o,b,y,c,s,a,u,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Le(d,f).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:T,personalPosition:S,protocolPosition:k},instructions:[R],signers:m,instructionTypes:[pe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,w,T,S,k,R,K,z,Z){let O=j([be("tickLowerIndex"),be("tickUpperIndex"),be("tickArrayLowerStartIndex"),be("tickArrayUpperStartIndex"),q("liquidity"),N("amountMaxA"),N("amountMaxB"),Fe("withMetadata"),se("optionBaseFlag"),Fe("baseFlag")]),le=[...Z?[{pubkey:Z,isSigner:!1,isWritable:!0}]:[]],ae=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...le],xe=Buffer.alloc(O.span);O.encode({tickLowerIndex:A,tickUpperIndex:w,tickArrayLowerStartIndex:T,tickArrayUpperStartIndex:S,liquidity:new Ii(0),amountMaxA:R==="MintA"?K:z,amountMaxB:R==="MintA"?z:K,withMetadata:k==="create",baseFlag:R==="MintA",optionBaseFlag:1},xe);let ne=Buffer.from([...De.openPosition,...xe]);return new Te({keys:ae,programId:e,data:ne})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new P((await l(1))[0]);else{let K=zt.generate();d.push(K),m=K.publicKey}let[f,p]=[new P(e.programId),new P(e.id)],b=x.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=x.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=U(f,p,b),{publicKey:A}=U(f,p,y),{publicKey:w}=Ce(n.wallet,m,$),{publicKey:T}=Bt(m),{publicKey:S}=Ne(f,m),{publicKey:k}=tt(f,p,r,o),R=this.openPositionFromLiquidityInstruction(f,n.wallet,p,n.wallet,m,w,T,k,g,A,S,n.tokenAccountA,n.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(t.mintA.address),new P(t.mintB.address),r,o,b,y,s,a,u,c,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[b,y])?Le(f,p).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:w,metadataAccount:T,personalPosition:S,protocolPosition:k},instructions:[R],signers:d,instructionTypes:[pe.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=j([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...De.closePosition,...u]);return new Te({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new P(e.programId),{publicKey:s}=Ce(n.wallet,r.nftMint,$),{publicKey:a}=Ne(o,r.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[pe.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A){let w=j([q("liquidity"),N("amountMaxA"),N("amountMaxB"),se("optionBaseFlag"),Fe("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...T],k=Buffer.alloc(w.span);w.encode({liquidity:b,amountMaxA:y,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},k);let R=Buffer.from([...De.increaseLiquidity,...k]);return new Te({keys:S,programId:e,data:R})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new P(e.programId),new P(e.id)],l=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=U(u,c,l),{publicKey:f}=U(u,c,m),{publicKey:p}=Ce(r.wallet,n.nftMint,$),{publicKey:b}=Ne(u,n.nftMint),{publicKey:y}=tt(u,c,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(u,r.wallet,p,b,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(e.mintA.address),new P(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Le(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:b,protocolPosition:y},signers:[],instructions:[g],instructionTypes:[pe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new P(e.programId),new P(e.id)],l=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=U(u,c,l),{publicKey:f}=U(u,c,m),{publicKey:p}=Ce(r.wallet,n.nftMint,$),{publicKey:b}=Ne(u,n.nftMint),{publicKey:y}=tt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:b,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(u,r.wallet,p,b,c,y,d,f,r.tokenAccountA,r.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(e.mintA.address),new P(e.mintB.address),o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Le(u,c).publicKey:void 0)],signers:[],instructionTypes:[pe.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A){let w=j([q("liquidity"),N("amountMaxA"),N("amountMaxB"),se("optionBaseFlag"),Fe("baseFlag")]),T=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],S=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...T],k=Buffer.alloc(w.span);w.encode({liquidity:new Ii(0),amountMaxA:b==="MintA"?y:g,amountMaxB:b==="MintA"?g:y,baseFlag:b==="MintA",optionBaseFlag:1},k);let R=Buffer.from([...De.increaseLiquidity,...k]);return new Te({keys:S,programId:e,data:R})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g,A,w){let T=j([q("liquidity"),N("amountMinA"),N("amountMinB")]),S=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...b.map(z=>[{pubkey:z.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:z.rewardMint,isSigner:!1,isWritable:!1}]).flat()],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...S],R=Buffer.alloc(T.span);T.encode({liquidity:y,amountMinA:g,amountMinB:A},R);let K=Buffer.from([...De.decreaseLiquidity,...R]);return new Te({keys:k,programId:e,data:K})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new P(e.programId),new P(e.id)],m=x.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=x.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=U(c,l,m),{publicKey:p}=U(c,l,d),{publicKey:b}=Ce(r.wallet,n.nftMint,u),{publicKey:y}=Ne(c,n.nftMint),{publicKey:g}=tt(c,l,n.tickLower,n.tickUpper),A=[];for(let S=0;S<e.rewardDefaultInfos.length;S++)A.push({poolRewardVault:new P(t.rewardInfos[S].vault),ownerRewardVault:r.rewardAccounts[S],rewardMint:new P(e.rewardDefaultInfos[S].mint.address)});let w=[],T=this.decreaseLiquidityInstruction(c,r.wallet,b,y,l,g,f,p,r.tokenAccountA,r.tokenAccountB,new P(t.vault.A),new P(t.vault.B),new P(e.mintA.address),new P(e.mintB.address),A,o,s,a,ge.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Le(c,l).publicKey:void 0);return w.push(T),{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:b,personalPosition:y,protocolPosition:g},signers:[],instructions:w,instructionTypes:[pe.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,u,c,l,m,d,f,p,b,y,g){let A=j([N("amount"),N("otherAmountThreshold"),q("sqrtPriceLimitX64"),Fe("isBaseInput")]),w=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(R=>({pubkey:R,isSigner:!1,isWritable:!0}))],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],S=Buffer.alloc(A.span);A.encode({amount:f,otherAmountThreshold:p,sqrtPriceLimitX64:b,isBaseInput:y},S);let k=Buffer.from([...De.swap,...S]);return new Te({keys:T,programId:e,data:k})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new P(e.programId),new P(e.id)],[d,f]=[new P(t.vault.A),new P(t.vault.B)],[p,b]=[new P(e.mintA.address),new P(e.mintB.address)],y=e.mintA.address===o.toString(),g=[this.swapInstruction(l,r.wallet,m,new P(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?p:b,y?b:p,c,n,s,a,u,!0,Le(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[pe.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new P(e.programId),new P(e.id)],[d,f]=[new P(t.vault.A),new P(t.vault.B)],[p,b]=[new P(e.mintA.address),new P(e.mintB.address)],y=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,r.wallet,m,new P(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?b:p,y?p:b,c,n,s,a,u,!1,Le(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[pe.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([N("openTime"),N("endTime"),q("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1}],b=Buffer.alloc(f.span);f.encode({openTime:me(l),endTime:me(m),emissionsPerSecondX64:d},b);let y=Buffer.from([...De.initReward,...b]);return new Te({keys:p,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new P(e.programId),new P(e.id)],a=yi(o,s,r.mint).publicKey,u=Tn(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new P(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[pe.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,u,c,l,m,d){let f=j([se("rewardIndex"),q("emissionsPerSecondX64"),N("openTime"),N("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],b=Buffer.alloc(f.span);f.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:me(l),endTime:me(m)},b);let y=Buffer.from([...De.setRewardEmissions,...b]);return new Te({keys:p,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new P(e.programId),new P(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,u=new P(t.rewardInfos[d].vault),c=new P(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Si.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Tn(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new P(e.config.id),n.tokenAccount,u,c,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[pe.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let u=j([se("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:Wt,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...De.collectReward,...l]);return new Te({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new P(e.programId),new P(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,u=new P(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Si.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,r,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[pe.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let u=[],c;if(a)c=new P((await a(1))[0]);else{let y=zt.generate();u.push(y),c=y.publicKey}let{publicKey:l}=Ce(o,s,$),{publicKey:m}=Ne(n,s),d=ki(e,c).publicKey,f=Ce(o,c,$).publicKey,p=Bt(c).publicKey,b=Ht.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:c,lockNftAccount:f,metadataAccount:p,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:f,lockNftMint:c,positionNftAccount:l,metadataAccount:p},instructions:[b],signers:u,instructionTypes:[pe.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:u,lockNftMint:c,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let f=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:it,isSigner:!1,isWritable:!1},{pubkey:Sn,isSigner:!1,isWritable:!1},{pubkey:dt,isSigner:!1,isWritable:!1},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}],p=j([Fe("withMetadata")]),b=Buffer.alloc(p.span);p.encode({withMetadata:d},b);let y=Buffer.from([...Ni,...b]);return new Te({keys:f,programId:e,data:y})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=Ce(r,o,$),{publicKey:a}=Ne(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:xn(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:ct.programId,isSigner:!1,isWritable:!1}];return new Te({keys:u,programId:e,data:Buffer.from(Ni)})}static harvestLockPositionInstruction(e){let[t,n]=[new P(e.poolKeys.programId),new P(e.poolKeys.id)],r=x.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=x.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=U(t,n,r),{publicKey:a}=U(t,n,o),{publicKey:u}=Ce(e.owner,e.ownerPosition.nftMint,$),{publicKey:c}=Ne(t,e.ownerPosition.nftMint),{publicKey:l}=tt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let p=0;p<e.poolKeys.rewardInfos.length;p++)m.push({poolRewardVault:new P(e.poolKeys.rewardInfos[p].vault),ownerRewardVault:e.ownerRewardAccounts[p],rewardMint:new P(e.poolKeys.rewardInfos[p].mint.address)});let d=[...m.map(p=>[{pubkey:p.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:xn(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new P(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new P(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:new P(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new P(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Te({keys:f,programId:e.programId,data:Buffer.from(Ci)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:f,tickArrayLower:p,tickArrayUpper:b,userVaultA:y,userVaultB:g,mintA:A,mintB:w,rewardAccounts:T,exTickArrayBitmap:S}){let k=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[],...T.map(K=>[{pubkey:K.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:K.rewardMint,isSigner:!1,isWritable:!1}]).flat()],R=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:$,isSigner:!1,isWritable:!1},{pubkey:Ve,isSigner:!1,isWritable:!1},{pubkey:ln,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...k];return new Te({keys:R,programId:e,data:Buffer.from(Ci)})}};export{Ht as ClmmInstrument};
//# sourceMappingURL=instrument.mjs.map