var Br=Object.defineProperty,Ir=Object.defineProperties;var Sr=Object.getOwnPropertyDescriptors;var en=Object.getOwnPropertySymbols;var di=Object.prototype.hasOwnProperty,fi=Object.prototype.propertyIsEnumerable;var mi=(i,e,t)=>e in i?Br(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t,M=(i,e)=>{for(var t in e||(e={}))di.call(e,t)&&mi(i,t,e[t]);if(en)for(var t of en(e))fi.call(e,t)&&mi(i,t,e[t]);return i},X=(i,e)=>Ir(i,Sr(e));var ht=(i,e)=>{var t={};for(var n in i)di.call(i,n)&&e.indexOf(n)<0&&(t[n]=i[n]);if(i!=null&&en)for(var n of en(i))e.indexOf(n)<0&&fi.call(i,n)&&(t[n]=i[n]);return t};import{PublicKey as N}from"@solana/web3.js";import Re from"bn.js";var kt=9e15,st=1e9,Cn="0123456789abcdef",nn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",Kn={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-kt,maxE:kt,crypto:!1},yi,Je,v=!0,sn="[DecimalError] ",ot=sn+"Invalid argument: ",wi=sn+"Precision limit exceeded",hi=sn+"crypto unavailable",ki="[object Decimal]",Te=Math.floor,ge=Math.pow,Cr=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Kr=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,Nr=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,Pi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,_e=1e7,F=7,Lr=9007199254740991,Rr=nn.length-1,Nn=rn.length-1,x={toStringTag:ki};x.absoluteValue=x.abs=function(){var i=new this.constructor(this);return i.s<0&&(i.s=1),O(i)};x.ceil=function(){return O(new this.constructor(this),this.e+1,2)};x.clampedTo=x.clamp=function(i,e){var t,n=this,r=n.constructor;if(i=new r(i),e=new r(e),!i.s||!e.s)return new r(NaN);if(i.gt(e))throw Error(ot+e);return t=n.cmp(i),t<0?i:n.cmp(e)>0?e:new r(n)};x.comparedTo=x.cmp=function(i){var e,t,n,r,o=this,s=o.d,a=(i=new o.constructor(i)).d,c=o.s,u=i.s;if(!s||!a)return!c||!u?NaN:c!==u?c:s===a?0:!s^c<0?1:-1;if(!s[0]||!a[0])return s[0]?c:a[0]?-u:0;if(c!==u)return c;if(o.e!==i.e)return o.e>i.e^c<0?1:-1;for(n=s.length,r=a.length,e=0,t=n<r?n:r;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^c<0?1:-1;return n===r?0:n>r^c<0?1:-1};x.cosine=x.cos=function(){var i,e,t=this,n=t.constructor;return t.d?t.d[0]?(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=Mr(n,Ii(n,t)),n.precision=i,n.rounding=e,O(Je==2||Je==3?t.neg():t,i,e,!0)):new n(1):new n(NaN)};x.cubeRoot=x.cbrt=function(){var i,e,t,n,r,o,s,a,c,u,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(v=!1,o=l.s*ge(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=he(l.d),i=l.e,(o=(i-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ge(t,1/3),i=Te((i+1)/3)-(i%3==(i<0?-1:2)),o==1/0?t="5e"+i:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+i),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(i=m.precision)+3;;)if(a=n,c=a.times(a).times(a),u=c.plus(l),n=ie(u.plus(l).times(a),u.plus(c),s+2,1),he(a.d).slice(0,s)===(t=he(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!r&&t=="4999"){if(!r&&(O(a,i+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,r=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(O(n,i+1,1),e=!n.times(n).times(n).eq(l));break}return v=!0,O(n,i,m.rounding,e)};x.decimalPlaces=x.dp=function(){var i,e=this.d,t=NaN;if(e){if(i=e.length-1,t=(i-Te(this.e/F))*F,i=e[i],i)for(;i%10==0;i/=10)t--;t<0&&(t=0)}return t};x.dividedBy=x.div=function(i){return ie(this,new this.constructor(i))};x.dividedToIntegerBy=x.divToInt=function(i){var e=this,t=e.constructor;return O(ie(e,new t(i),0,1,1),t.precision,t.rounding)};x.equals=x.eq=function(i){return this.cmp(i)===0};x.floor=function(){return O(new this.constructor(this),this.e+1,3)};x.greaterThan=x.gt=function(i){return this.cmp(i)>0};x.greaterThanOrEqualTo=x.gte=function(i){var e=this.cmp(i);return e==1||e===0};x.hyperbolicCosine=x.cosh=function(){var i,e,t,n,r,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,r=o.d.length,r<32?(i=Math.ceil(r/3),e=(1/cn(4,i)).toString()):(i=16,e="2.3283064365386962890625e-10"),o=Pt(s,1,o.times(e),new s(1),!0);for(var c,u=i,l=new s(8);u--;)c=o.times(o),o=a.minus(c.times(l.minus(c.times(l))));return O(o,s.precision=t,s.rounding=n,!0)};x.hyperbolicSine=x.sinh=function(){var i,e,t,n,r=this,o=r.constructor;if(!r.isFinite()||r.isZero())return new o(r);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(r.e,r.sd())+4,o.rounding=1,n=r.d.length,n<3)r=Pt(o,2,r,r,!0);else{i=1.4*Math.sqrt(n),i=i>16?16:i|0,r=r.times(1/cn(5,i)),r=Pt(o,2,r,r,!0);for(var s,a=new o(5),c=new o(16),u=new o(20);i--;)s=r.times(r),r=r.times(a.plus(s.times(c.times(s).plus(u))))}return o.precision=e,o.rounding=t,O(r,e,t,!0)};x.hyperbolicTangent=x.tanh=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+7,n.rounding=1,ie(t.sinh(),t.cosh(),n.precision=i,n.rounding=e)):new n(t.s)};x.inverseCosine=x.acos=function(){var i,e=this,t=e.constructor,n=e.abs().cmp(1),r=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?De(t,r,o):new t(0):new t(NaN):e.isZero()?De(t,r+4,o).times(.5):(t.precision=r+6,t.rounding=1,e=e.asin(),i=De(t,r+4,o).times(.5),t.precision=r,t.rounding=o,i.minus(e))};x.inverseHyperbolicCosine=x.acosh=function(){var i,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(i=n.precision,e=n.rounding,n.precision=i+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,v=!1,t=t.times(t).minus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln()):new n(t)};x.inverseHyperbolicSine=x.asinh=function(){var i,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,v=!1,t=t.times(t).plus(1).sqrt().plus(t),v=!0,n.precision=i,n.rounding=e,t.ln())};x.inverseHyperbolicTangent=x.atanh=function(){var i,e,t,n,r=this,o=r.constructor;return r.isFinite()?r.e>=0?new o(r.abs().eq(1)?r.s/0:r.isZero()?r:NaN):(i=o.precision,e=o.rounding,n=r.sd(),Math.max(n,i)<2*-r.e-1?O(new o(r),i,e,!0):(o.precision=t=n-r.e,r=ie(r.plus(1),new o(1).minus(r),t+i,1),o.precision=i+4,o.rounding=1,r=r.ln(),o.precision=i,o.rounding=e,r.times(.5))):new o(NaN)};x.inverseSine=x.asin=function(){var i,e,t,n,r=this,o=r.constructor;return r.isZero()?new o(r):(e=r.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(i=De(o,t+4,n).times(.5),i.s=r.s,i):new o(NaN):(o.precision=t+6,o.rounding=1,r=r.div(new o(1).minus(r.times(r)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,r.times(2)))};x.inverseTangent=x.atan=function(){var i,e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding;if(u.isFinite()){if(u.isZero())return new l(u);if(u.abs().eq(1)&&m+4<=Nn)return s=De(l,m+4,d).times(.25),s.s=u.s,s}else{if(!u.s)return new l(NaN);if(m+4<=Nn)return s=De(l,m+4,d).times(.5),s.s=u.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/F+2|0),i=t;i;--i)u=u.div(u.times(u).plus(1).sqrt().plus(1));for(v=!1,e=Math.ceil(a/F),n=1,c=u.times(u),s=new l(u),r=u;i!==-1;)if(r=r.times(c),o=s.minus(r.div(n+=2)),r=r.times(c),s=o.plus(r.div(n+=2)),s.d[e]!==void 0)for(i=e;s.d[i]===o.d[i]&&i--;);return t&&(s=s.times(2<<t-1)),v=!0,O(s,l.precision=m,l.rounding=d,!0)};x.isFinite=function(){return!!this.d};x.isInteger=x.isInt=function(){return!!this.d&&Te(this.e/F)>this.d.length-2};x.isNaN=function(){return!this.s};x.isNegative=x.isNeg=function(){return this.s<0};x.isPositive=x.isPos=function(){return this.s>0};x.isZero=function(){return!!this.d&&this.d[0]===0};x.lessThan=x.lt=function(i){return this.cmp(i)<0};x.lessThanOrEqualTo=x.lte=function(i){return this.cmp(i)<1};x.logarithm=x.log=function(i){var e,t,n,r,o,s,a,c,u=this,l=u.constructor,m=l.precision,d=l.rounding,f=5;if(i==null)i=new l(10),e=!0;else{if(i=new l(i),t=i.d,i.s<0||!t||!t[0]||i.eq(1))return new l(NaN);e=i.eq(10)}if(t=u.d,u.s<0||!t||!t[0]||u.eq(1))return new l(t&&!t[0]?-1/0:u.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(r=t[0];r%10===0;)r/=10;o=r!==1}if(v=!1,a=m+f,s=rt(u,a),n=e?on(l,a+10):rt(i,a),c=ie(s,n,a,1),It(c.d,r=m,d))do if(a+=10,s=rt(u,a),n=e?on(l,a+10):rt(i,a),c=ie(s,n,a,1),!o){+he(c.d).slice(r+1,r+15)+1==1e14&&(c=O(c,m+1,0));break}while(It(c.d,r+=10,d));return v=!0,O(c,m,d)};x.minus=x.sub=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,p=f.constructor;if(i=new p(i),!f.d||!i.d)return!f.s||!i.s?i=new p(NaN):f.d?i.s=-i.s:i=new p(i.d||f.s!==i.s?f:NaN),i;if(f.s!=i.s)return i.s=-i.s,f.plus(i);if(u=f.d,d=i.d,a=p.precision,c=p.rounding,!u[0]||!d[0]){if(d[0])i.s=-i.s;else if(u[0])i=new p(f);else return new p(c===3?-0:0);return v?O(i,a,c):i}if(t=Te(i.e/F),l=Te(f.e/F),u=u.slice(),o=l-t,o){for(m=o<0,m?(e=u,o=-o,s=d.length):(e=d,t=l,s=u.length),n=Math.max(Math.ceil(a/F),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=u.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(u[n]!=d[n]){m=u[n]<d[n];break}o=0}for(m&&(e=u,u=d,d=e,i.s=-i.s),s=u.length,n=d.length-s;n>0;--n)u[s++]=0;for(n=d.length;n>o;){if(u[--n]<d[n]){for(r=n;r&&u[--r]===0;)u[r]=_e-1;--u[r],u[n]+=_e}u[n]-=d[n]}for(;u[--s]===0;)u.pop();for(;u[0]===0;u.shift())--t;return u[0]?(i.d=u,i.e=an(u,t),v?O(i,a,c):i):new p(c===3?-0:0)};x.modulo=x.mod=function(i){var e,t=this,n=t.constructor;return i=new n(i),!t.d||!i.s||i.d&&!i.d[0]?new n(NaN):!i.d||t.d&&!t.d[0]?O(new n(t),n.precision,n.rounding):(v=!1,n.modulo==9?(e=ie(t,i.abs(),0,3,1),e.s*=i.s):e=ie(t,i,0,n.modulo,1),e=e.times(i),v=!0,t.minus(e))};x.naturalExponential=x.exp=function(){return Ln(this)};x.naturalLogarithm=x.ln=function(){return rt(this)};x.negated=x.neg=function(){var i=new this.constructor(this);return i.s=-i.s,O(i)};x.plus=x.add=function(i){var e,t,n,r,o,s,a,c,u,l,m=this,d=m.constructor;if(i=new d(i),!m.d||!i.d)return!m.s||!i.s?i=new d(NaN):m.d||(i=new d(i.d||m.s===i.s?m:NaN)),i;if(m.s!=i.s)return i.s=-i.s,m.minus(i);if(u=m.d,l=i.d,a=d.precision,c=d.rounding,!u[0]||!l[0])return l[0]||(i=new d(m)),v?O(i,a,c):i;if(o=Te(m.e/F),n=Te(i.e/F),u=u.slice(),r=o-n,r){for(r<0?(t=u,r=-r,s=l.length):(t=l,n=o,s=u.length),o=Math.ceil(a/F),s=o>s?o+1:s+1,r>s&&(r=s,t.length=1),t.reverse();r--;)t.push(0);t.reverse()}for(s=u.length,r=l.length,s-r<0&&(r=s,t=l,l=u,u=t),e=0;r;)e=(u[--r]=u[r]+l[r]+e)/_e|0,u[r]%=_e;for(e&&(u.unshift(e),++n),s=u.length;u[--s]==0;)u.pop();return i.d=u,i.e=an(u,n),v?O(i,a,c):i};x.precision=x.sd=function(i){var e,t=this;if(i!==void 0&&i!==!!i&&i!==1&&i!==0)throw Error(ot+i);return t.d?(e=Ai(t.d),i&&t.e+1>e&&(e=t.e+1)):e=NaN,e};x.round=function(){var i=this,e=i.constructor;return O(new e(i),i.e+1,e.rounding)};x.sine=x.sin=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+Math.max(t.e,t.sd())+F,n.rounding=1,t=Er(n,Ii(n,t)),n.precision=i,n.rounding=e,O(Je>2?t.neg():t,i,e,!0)):new n(NaN)};x.squareRoot=x.sqrt=function(){var i,e,t,n,r,o,s=this,a=s.d,c=s.e,u=s.s,l=s.constructor;if(u!==1||!a||!a[0])return new l(!u||u<0&&(!a||a[0])?NaN:a?s:1/0);for(v=!1,u=Math.sqrt(+s),u==0||u==1/0?(e=he(a),(e.length+c)%2==0&&(e+="0"),u=Math.sqrt(e),c=Te((c+1)/2)-(c<0||c%2),u==1/0?e="5e"+c:(e=u.toExponential(),e=e.slice(0,e.indexOf("e")+1)+c),n=new l(e)):n=new l(u.toString()),t=(c=l.precision)+3;;)if(o=n,n=o.plus(ie(s,o,t+2,1)).times(.5),he(o.d).slice(0,t)===(e=he(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!r&&e=="4999"){if(!r&&(O(o,c+1,0),o.times(o).eq(s))){n=o;break}t+=4,r=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(O(n,c+1,1),i=!n.times(n).eq(s));break}return v=!0,O(n,c,l.rounding,i)};x.tangent=x.tan=function(){var i,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(i=n.precision,e=n.rounding,n.precision=i+10,n.rounding=1,t=t.sin(),t.s=1,t=ie(t,new n(1).minus(t.times(t)).sqrt(),i+10,0),n.precision=i,n.rounding=e,O(Je==2||Je==4?t.neg():t,i,e,!0)):new n(NaN)};x.times=x.mul=function(i){var e,t,n,r,o,s,a,c,u,l=this,m=l.constructor,d=l.d,f=(i=new m(i)).d;if(i.s*=l.s,!d||!d[0]||!f||!f[0])return new m(!i.s||d&&!d[0]&&!f||f&&!f[0]&&!d?NaN:!d||!f?i.s/0:i.s*0);for(t=Te(l.e/F)+Te(i.e/F),c=d.length,u=f.length,c<u&&(o=d,d=f,f=o,s=c,c=u,u=s),o=[],s=c+u,n=s;n--;)o.push(0);for(n=u;--n>=0;){for(e=0,r=c+n;r>n;)a=o[r]+f[n]*d[r-n-1]+e,o[r--]=a%_e|0,e=a/_e|0;o[r]=(o[r]+e)%_e|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),i.d=o,i.e=an(o,t),v?O(i,m.precision,m.rounding):i};x.toBinary=function(i,e){return Mn(this,2,i,e)};x.toDecimalPlaces=x.toDP=function(i,e){var t=this,n=t.constructor;return t=new n(t),i===void 0?t:(Le(i,0,st),e===void 0?e=n.rounding:Le(e,0,8),O(t,i+t.e+1,e))};x.toExponential=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,!0):(Le(i,0,st),e===void 0?e=r.rounding:Le(e,0,8),n=O(new r(n),i+1,e),t=Xe(n,!0,i+1)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toFixed=function(i,e){var t,n,r=this,o=r.constructor;return i===void 0?t=Xe(r):(Le(i,0,st),e===void 0?e=o.rounding:Le(e,0,8),n=O(new o(r),i+r.e+1,e),t=Xe(n,!1,i+n.e+1)),r.isNeg()&&!r.isZero()?"-"+t:t};x.toFraction=function(i){var e,t,n,r,o,s,a,c,u,l,m,d,f=this,p=f.d,g=f.constructor;if(!p)return new g(f);if(u=t=new g(1),n=c=new g(0),e=new g(n),o=e.e=Ai(p)-f.e-1,s=o%F,e.d[0]=ge(10,s<0?F+s:s),i==null)i=o>0?e:u;else{if(a=new g(i),!a.isInt()||a.lt(u))throw Error(ot+a);i=a.gt(e)?o>0?e:u:a}for(v=!1,a=new g(he(p)),l=g.precision,g.precision=o=p.length*F*2;m=ie(a,e,0,1,1),r=t.plus(m.times(n)),r.cmp(i)!=1;)t=n,n=r,r=u,u=c.plus(m.times(r)),c=r,r=e,e=a.minus(m.times(r)),a=r;return r=ie(i.minus(t),n,0,1,1),c=c.plus(r.times(u)),t=t.plus(r.times(n)),c.s=u.s=f.s,d=ie(u,n,o,1).minus(f).abs().cmp(ie(c,t,o,1).minus(f).abs())<1?[u,n]:[c,t],g.precision=l,v=!0,d};x.toHexadecimal=x.toHex=function(i,e){return Mn(this,16,i,e)};x.toNearest=function(i,e){var t=this,n=t.constructor;if(t=new n(t),i==null){if(!t.d)return t;i=new n(1),e=n.rounding}else{if(i=new n(i),e===void 0?e=n.rounding:Le(e,0,8),!t.d)return i.s?t:i;if(!i.d)return i.s&&(i.s=t.s),i}return i.d[0]?(v=!1,t=ie(t,i,0,e,1).times(i),v=!0,O(t)):(i.s=t.s,t=i),t};x.toNumber=function(){return+this};x.toOctal=function(i,e){return Mn(this,8,i,e)};x.toPower=x.pow=function(i){var e,t,n,r,o,s,a=this,c=a.constructor,u=+(i=new c(i));if(!a.d||!i.d||!a.d[0]||!i.d[0])return new c(ge(+a,u));if(a=new c(a),a.eq(1))return a;if(n=c.precision,o=c.rounding,i.eq(1))return O(a,n,o);if(e=Te(i.e/F),e>=i.d.length-1&&(t=u<0?-u:u)<=Lr)return r=Ti(c,a,t,n),i.s<0?new c(1).div(r):O(r,n,o);if(s=a.s,s<0){if(e<i.d.length-1)return new c(NaN);if((i.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ge(+a,u),e=t==0||!isFinite(t)?Te(u*(Math.log("0."+he(a.d))/Math.LN10+a.e+1)):new c(t+"").e,e>c.maxE+1||e<c.minE-1?new c(e>0?s/0:0):(v=!1,c.rounding=a.s=1,t=Math.min(12,(e+"").length),r=Ln(i.times(rt(a,n+t)),n),r.d&&(r=O(r,n+5,1),It(r.d,n,o)&&(e=n+10,r=O(Ln(i.times(rt(a,e+t)),e),e+5,1),+he(r.d).slice(n+1,n+15)+1==1e14&&(r=O(r,n+1,0)))),r.s=s,v=!0,c.rounding=o,O(r,n,o))};x.toPrecision=function(i,e){var t,n=this,r=n.constructor;return i===void 0?t=Xe(n,n.e<=r.toExpNeg||n.e>=r.toExpPos):(Le(i,1,st),e===void 0?e=r.rounding:Le(e,0,8),n=O(new r(n),i,e),t=Xe(n,i<=n.e||n.e<=r.toExpNeg,i)),n.isNeg()&&!n.isZero()?"-"+t:t};x.toSignificantDigits=x.toSD=function(i,e){var t=this,n=t.constructor;return i===void 0?(i=n.precision,e=n.rounding):(Le(i,1,st),e===void 0?e=n.rounding:Le(e,0,8)),O(new n(t),i,e)};x.toString=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()&&!i.isZero()?"-"+t:t};x.truncated=x.trunc=function(){return O(new this.constructor(this),this.e+1,1)};x.valueOf=x.toJSON=function(){var i=this,e=i.constructor,t=Xe(i,i.e<=e.toExpNeg||i.e>=e.toExpPos);return i.isNeg()?"-"+t:t};function he(i){var e,t,n,r=i.length-1,o="",s=i[0];if(r>0){for(o+=s,e=1;e<r;e++)n=i[e]+"",t=F-n.length,t&&(o+=it(t)),o+=n;s=i[e],n=s+"",t=F-n.length,t&&(o+=it(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function Le(i,e,t){if(i!==~~i||i<e||i>t)throw Error(ot+i)}function It(i,e,t,n){var r,o,s,a;for(o=i[0];o>=10;o/=10)--e;return--e<0?(e+=F,r=0):(r=Math.ceil((e+1)/F),e%=F),o=ge(10,F-e),a=i[r]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(i[r+1]/o/100|0)==ge(10,e-2)-1||(a==o/2||a==0)&&(i[r+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(i[r+1]/o/1e3|0)==ge(10,e-3)-1,s}function tn(i,e,t){for(var n,r=[0],o,s=0,a=i.length;s<a;){for(o=r.length;o--;)r[o]*=e;for(r[0]+=Cn.indexOf(i.charAt(s++)),n=0;n<r.length;n++)r[n]>t-1&&(r[n+1]===void 0&&(r[n+1]=0),r[n+1]+=r[n]/t|0,r[n]%=t)}return r.reverse()}function Mr(i,e){var t,n,r;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),r=(1/cn(4,t)).toString()):(t=16,r="2.3283064365386962890625e-10"),i.precision+=t,e=Pt(i,1,e.times(r),new i(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return i.precision-=t,e}var ie=function(){function i(n,r,o){var s,a=0,c=n.length;for(n=n.slice();c--;)s=n[c]*r+a,n[c]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,r,o,s){var a,c;if(o!=s)c=o>s?1:-1;else for(a=c=0;a<o;a++)if(n[a]!=r[a]){c=n[a]>r[a]?1:-1;break}return c}function t(n,r,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<r[o]?1:0,n[o]=a*s+n[o]-r[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,r,o,s,a,c){var u,l,m,d,f,p,g,y,b,P,w,k,A,h,T,B,R,S,C,V,Q=n.constructor,re=n.s==r.s?1:-1,$=n.d,H=r.d;if(!$||!$[0]||!H||!H[0])return new Q(!n.s||!r.s||($?H&&$[0]==H[0]:!H)?NaN:$&&$[0]==0||!H?re*0:re/0);for(c?(f=1,l=n.e-r.e):(c=_e,f=F,l=Te(n.e/f)-Te(r.e/f)),C=H.length,R=$.length,b=new Q(re),P=b.d=[],m=0;H[m]==($[m]||0);m++);if(H[m]>($[m]||0)&&l--,o==null?(h=o=Q.precision,s=Q.rounding):a?h=o+(n.e-r.e)+1:h=o,h<0)P.push(1),p=!0;else{if(h=h/f+2|0,m=0,C==1){for(d=0,H=H[0],h++;(m<R||d)&&h--;m++)T=d*c+($[m]||0),P[m]=T/H|0,d=T%H|0;p=d||m<R}else{for(d=c/(H[0]+1)|0,d>1&&(H=i(H,d,c),$=i($,d,c),C=H.length,R=$.length),B=C,w=$.slice(0,C),k=w.length;k<C;)w[k++]=0;V=H.slice(),V.unshift(0),S=H[0],H[1]>=c/2&&++S;do d=0,u=e(H,w,C,k),u<0?(A=w[0],C!=k&&(A=A*c+(w[1]||0)),d=A/S|0,d>1?(d>=c&&(d=c-1),g=i(H,d,c),y=g.length,k=w.length,u=e(g,w,y,k),u==1&&(d--,t(g,C<y?V:H,y,c))):(d==0&&(u=d=1),g=H.slice()),y=g.length,y<k&&g.unshift(0),t(w,g,k,c),u==-1&&(k=w.length,u=e(H,w,C,k),u<1&&(d++,t(w,C<k?V:H,k,c))),k=w.length):u===0&&(d++,w=[0]),P[m++]=d,u&&w[0]?w[k++]=$[B]||0:(w=[$[B]],k=1);while((B++<R||w[0]!==void 0)&&h--);p=w[0]!==void 0}P[0]||P.shift()}if(f==1)b.e=l,yi=p;else{for(m=1,d=P[0];d>=10;d/=10)m++;b.e=m+l*f-1,O(b,a?o+b.e+1:o,s,p)}return b}}();function O(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor;e:if(e!=null){if(m=i.d,!m)return i;for(r=1,a=m[0];a>=10;a/=10)r++;if(o=e-r,o<0)o+=F,s=e,l=m[d=0],c=l/ge(10,r-s-1)%10|0;else if(d=Math.ceil((o+1)/F),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=c=0,r=1,o%=F,s=o-F+1}else break e;else{for(l=a=m[d],r=1;a>=10;a/=10)r++;o%=F,s=o-F+r,c=s<0?0:l/ge(10,r-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ge(10,r-s-1)),u=t<4?(c||n)&&(t==0||t==(i.s<0?3:2)):c>5||c==5&&(t==4||n||t==6&&(o>0?s>0?l/ge(10,r-s):0:m[d-1])%10&1||t==(i.s<0?8:7)),e<1||!m[0])return m.length=0,u?(e-=i.e+1,m[0]=ge(10,(F-e%F)%F),i.e=-e||0):m[0]=i.e=0,i;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ge(10,F-o),m[d]=s>0?(l/ge(10,r-s)%ge(10,s)|0)*a:0),u)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(i.e++,m[0]==_e&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=_e)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return v&&(i.e>f.maxE?(i.d=null,i.e=NaN):i.e<f.minE&&(i.e=0,i.d=[0])),i}function Xe(i,e,t){if(!i.isFinite())return Bi(i);var n,r=i.e,o=he(i.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+it(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(i.e<0?"e":"e+")+i.e):r<0?(o="0."+it(-r-1)+o,t&&(n=t-s)>0&&(o+=it(n))):r>=s?(o+=it(r+1-s),t&&(n=t-r-1)>0&&(o=o+"."+it(n))):((n=r+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(r+1===s&&(o+="."),o+=it(n))),o}function an(i,e){var t=i[0];for(e*=F;t>=10;t/=10)e++;return e}function on(i,e,t){if(e>Rr)throw v=!0,t&&(i.precision=t),Error(wi);return O(new i(nn),e,1,!0)}function De(i,e,t){if(e>Nn)throw Error(wi);return O(new i(rn),e,t,!0)}function Ai(i){var e=i.length-1,t=e*F+1;if(e=i[e],e){for(;e%10==0;e/=10)t--;for(e=i[0];e>=10;e/=10)t++}return t}function it(i){for(var e="";i--;)e+="0";return e}function Ti(i,e,t,n){var r,o=new i(1),s=Math.ceil(n/F+4);for(v=!1;;){if(t%2&&(o=o.times(e),gi(o.d,s)&&(r=!0)),t=Te(t/2),t===0){t=o.d.length-1,r&&o.d[t]===0&&++o.d[t];break}e=e.times(e),gi(e.d,s)}return v=!0,o}function pi(i){return i.d[i.d.length-1]&1}function xi(i,e,t){for(var n,r=new i(e[0]),o=0;++o<e.length;)if(n=new i(e[o]),n.s)r[t](n)&&(r=n);else{r=n;break}return r}function Ln(i,e){var t,n,r,o,s,a,c,u=0,l=0,m=0,d=i.constructor,f=d.rounding,p=d.precision;if(!i.d||!i.d[0]||i.e>17)return new d(i.d?i.d[0]?i.s<0?0:1/0:1:i.s?i.s<0?0:i:0/0);for(e==null?(v=!1,c=p):c=e,a=new d(.03125);i.e>-2;)i=i.times(a),m+=5;for(n=Math.log(ge(2,m))/Math.LN10*2+5|0,c+=n,t=o=s=new d(1),d.precision=c;;){if(o=O(o.times(i),c,1),t=t.times(++l),a=s.plus(ie(o,t,c,1)),he(a.d).slice(0,c)===he(s.d).slice(0,c)){for(r=m;r--;)s=O(s.times(s),c,1);if(e==null)if(u<3&&It(s.d,c-n,f,u))d.precision=c+=10,t=o=a=new d(1),l=0,u++;else return O(s,d.precision=p,f,v=!0);else return d.precision=p,s}s=a}}function rt(i,e){var t,n,r,o,s,a,c,u,l,m,d,f=1,p=10,g=i,y=g.d,b=g.constructor,P=b.rounding,w=b.precision;if(g.s<0||!y||!y[0]||!g.e&&y[0]==1&&y.length==1)return new b(y&&!y[0]?-1/0:g.s!=1?NaN:y?0:g);if(e==null?(v=!1,l=w):l=e,b.precision=l+=p,t=he(y),n=t.charAt(0),Math.abs(o=g.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)g=g.times(i),t=he(g.d),n=t.charAt(0),f++;o=g.e,n>1?(g=new b("0."+t),o++):g=new b(n+"."+t.slice(1))}else return u=on(b,l+2,w).times(o+""),g=rt(new b(n+"."+t.slice(1)),l-p).plus(u),b.precision=w,e==null?O(g,w,P,v=!0):g;for(m=g,c=s=g=ie(g.minus(1),g.plus(1),l,1),d=O(g.times(g),l,1),r=3;;){if(s=O(s.times(d),l,1),u=c.plus(ie(s,new b(r),l,1)),he(u.d).slice(0,l)===he(c.d).slice(0,l))if(c=c.times(2),o!==0&&(c=c.plus(on(b,l+2,w).times(o+""))),c=ie(c,new b(f),l,1),e==null)if(It(c.d,l-p,P,a))b.precision=l+=p,u=s=g=ie(m.minus(1),m.plus(1),l,1),d=O(g.times(g),l,1),r=a=1;else return O(c,b.precision=w,P,v=!0);else return b.precision=w,c;c=u,r+=2}}function Bi(i){return String(i.s*i.s/0)}function Rn(i,e){var t,n,r;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(r=e.length;e.charCodeAt(r-1)===48;--r);if(e=e.slice(n,r),e){if(r-=n,i.e=t=t-n-1,i.d=[],n=(t+1)%F,t<0&&(n+=F),n<r){for(n&&i.d.push(+e.slice(0,n)),r-=F;n<r;)i.d.push(+e.slice(n,n+=F));e=e.slice(n),n=F-e.length}else n-=r;for(;n--;)e+="0";i.d.push(+e),v&&(i.e>i.constructor.maxE?(i.d=null,i.e=NaN):i.e<i.constructor.minE&&(i.e=0,i.d=[0]))}else i.e=0,i.d=[0];return i}function Or(i,e){var t,n,r,o,s,a,c,u,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),Pi.test(e))return Rn(i,e)}else if(e==="Infinity"||e==="NaN")return+e||(i.s=NaN),i.e=NaN,i.d=null,i;if(Kr.test(e))t=16,e=e.toLowerCase();else if(Cr.test(e))t=2;else if(Nr.test(e))t=8;else throw Error(ot+e);for(o=e.search(/p/i),o>0?(c=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=i.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,r=Ti(n,new n(t),o,o*2)),u=tn(e,t,_e),l=u.length-1,o=l;u[o]===0;--o)u.pop();return o<0?new n(i.s*0):(i.e=an(u,l),i.d=u,v=!1,s&&(i=ie(i,r,a*4)),c&&(i=i.times(Math.abs(c)<54?ge(2,c):St.pow(2,c))),v=!0,i)}function Er(i,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Pt(i,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/cn(5,t)),e=Pt(i,2,e,e);for(var r,o=new i(5),s=new i(16),a=new i(20);t--;)r=e.times(e),e=e.times(o.plus(r.times(s.times(r).minus(a))));return e}function Pt(i,e,t,n,r){var o,s,a,c,u=1,l=i.precision,m=Math.ceil(l/F);for(v=!1,c=t.times(t),a=new i(n);;){if(s=ie(a.times(c),new i(e++*e++),l,1),a=r?n.plus(s):n.minus(s),n=ie(s.times(c),new i(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,u++}return v=!0,s.d.length=m+1,s}function cn(i,e){for(var t=i;--e;)t*=i;return t}function Ii(i,e){var t,n=e.s<0,r=De(i,i.precision,1),o=r.times(.5);if(e=e.abs(),e.lte(o))return Je=n?4:1,e;if(t=e.divToInt(r),t.isZero())Je=n?3:2;else{if(e=e.minus(t.times(r)),e.lte(o))return Je=pi(t)?n?2:3:n?4:1,e;Je=pi(t)?n?1:4:n?3:2}return e.minus(r).abs()}function Mn(i,e,t,n){var r,o,s,a,c,u,l,m,d,f=i.constructor,p=t!==void 0;if(p?(Le(t,1,st),n===void 0?n=f.rounding:Le(n,0,8)):(t=f.precision,n=f.rounding),!i.isFinite())l=Bi(i);else{for(l=Xe(i),s=l.indexOf("."),p?(r=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):r=e,s>=0&&(l=l.replace(".",""),d=new f(1),d.e=l.length-s,d.d=tn(Xe(d),10,r),d.e=d.d.length),m=tn(l,10,r),o=c=m.length;m[--c]==0;)m.pop();if(!m[0])l=p?"0p+0":"0";else{if(s<0?o--:(i=new f(i),i.d=m,i.e=o,i=ie(i,d,t,n,0,r),m=i.d,o=i.e,u=yi),s=m[t],a=r/2,u=u||m[t+1]!==void 0,u=n<4?(s!==void 0||u)&&(n===0||n===(i.s<0?3:2)):s>a||s===a&&(n===4||u||n===6&&m[t-1]&1||n===(i.s<0?8:7)),m.length=t,u)for(;++m[--t]>r-1;)m[t]=0,t||(++o,m.unshift(1));for(c=m.length;!m[c-1];--c);for(s=0,l="";s<c;s++)l+=Cn.charAt(m[s]);if(p){if(c>1)if(e==16||e==8){for(s=e==16?4:3,--c;c%s;c++)l+="0";for(m=tn(l,r,e),c=m.length;!m[c-1];--c);for(s=1,l="1.";s<c;s++)l+=Cn.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>c)for(o-=c;o--;)l+="0";else o<c&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return i.s<0?"-"+l:l}function gi(i,e){if(i.length>e)return i.length=e,!0}function Fr(i){return new this(i).abs()}function Dr(i){return new this(i).acos()}function _r(i){return new this(i).acosh()}function vr(i,e){return new this(i).plus(e)}function Wr(i){return new this(i).asin()}function qr(i){return new this(i).asinh()}function Vr(i){return new this(i).atan()}function Ur(i){return new this(i).atanh()}function Gr(i,e){i=new this(i),e=new this(e);var t,n=this.precision,r=this.rounding,o=n+4;return!i.s||!e.s?t=new this(NaN):!i.d&&!e.d?(t=De(this,o,1).times(e.s>0?.25:.75),t.s=i.s):!e.d||i.isZero()?(t=e.s<0?De(this,n,r):new this(0),t.s=i.s):!i.d||e.isZero()?(t=De(this,o,1).times(.5),t.s=i.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ie(i,e,o,1)),e=De(this,o,1),this.precision=n,this.rounding=r,t=i.s<0?t.minus(e):t.plus(e)):t=this.atan(ie(i,e,o,1)),t}function Xr(i){return new this(i).cbrt()}function zr(i){return O(i=new this(i),i.e+1,2)}function Hr(i,e,t){return new this(i).clamp(e,t)}function Zr(i){if(!i||typeof i!="object")throw Error(sn+"Object expected");var e,t,n,r=i.defaults===!0,o=["precision",1,st,"rounding",0,8,"toExpNeg",-kt,0,"toExpPos",0,kt,"maxE",0,kt,"minE",-kt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],r&&(this[t]=Kn[t]),(n=i[t])!==void 0)if(Te(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(ot+t+": "+n);if(t="crypto",r&&(this[t]=Kn[t]),(n=i[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(hi);else this[t]=!1;else throw Error(ot+t+": "+n);return this}function jr(i){return new this(i).cos()}function Yr(i){return new this(i).cosh()}function Si(i){var e,t,n;function r(o){var s,a,c,u=this;if(!(u instanceof r))return new r(o);if(u.constructor=r,bi(o)){u.s=o.s,v?!o.d||o.e>r.maxE?(u.e=NaN,u.d=null):o.e<r.minE?(u.e=0,u.d=[0]):(u.e=o.e,u.d=o.d.slice()):(u.e=o.e,u.d=o.d?o.d.slice():o.d);return}if(c=typeof o,c==="number"){if(o===0){u.s=1/o<0?-1:1,u.e=0,u.d=[0];return}if(o<0?(o=-o,u.s=-1):u.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;v?s>r.maxE?(u.e=NaN,u.d=null):s<r.minE?(u.e=0,u.d=[0]):(u.e=s,u.d=[o]):(u.e=s,u.d=[o]);return}else if(o*0!==0){o||(u.s=NaN),u.e=NaN,u.d=null;return}return Rn(u,o.toString())}else if(c!=="string")throw Error(ot+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),u.s=-1):(a===43&&(o=o.slice(1)),u.s=1),Pi.test(o)?Rn(u,o):Or(u,o)}if(r.prototype=x,r.ROUND_UP=0,r.ROUND_DOWN=1,r.ROUND_CEIL=2,r.ROUND_FLOOR=3,r.ROUND_HALF_UP=4,r.ROUND_HALF_DOWN=5,r.ROUND_HALF_EVEN=6,r.ROUND_HALF_CEIL=7,r.ROUND_HALF_FLOOR=8,r.EUCLID=9,r.config=r.set=Zr,r.clone=Si,r.isDecimal=bi,r.abs=Fr,r.acos=Dr,r.acosh=_r,r.add=vr,r.asin=Wr,r.asinh=qr,r.atan=Vr,r.atanh=Ur,r.atan2=Gr,r.cbrt=Xr,r.ceil=zr,r.clamp=Hr,r.cos=jr,r.cosh=Yr,r.div=Qr,r.exp=Jr,r.floor=$r,r.hypot=eo,r.ln=to,r.log=no,r.log10=ro,r.log2=io,r.max=oo,r.min=so,r.mod=ao,r.mul=co,r.pow=uo,r.random=lo,r.round=mo,r.sign=fo,r.sin=po,r.sinh=go,r.sqrt=bo,r.sub=yo,r.sum=wo,r.tan=ho,r.tanh=ko,r.trunc=Po,i===void 0&&(i={}),i&&i.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)i.hasOwnProperty(t=n[e++])||(i[t]=this[t]);return r.config(i),r}function Qr(i,e){return new this(i).div(e)}function Jr(i){return new this(i).exp()}function $r(i){return O(i=new this(i),i.e+1,3)}function eo(){var i,e,t=new this(0);for(v=!1,i=0;i<arguments.length;)if(e=new this(arguments[i++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return v=!0,new this(1/0);t=e}return v=!0,t.sqrt()}function bi(i){return i instanceof St||i&&i.toStringTag===ki||!1}function to(i){return new this(i).ln()}function no(i,e){return new this(i).log(e)}function io(i){return new this(i).log(2)}function ro(i){return new this(i).log(10)}function oo(){return xi(this,arguments,"lt")}function so(){return xi(this,arguments,"gt")}function ao(i,e){return new this(i).mod(e)}function co(i,e){return new this(i).mul(e)}function uo(i,e){return new this(i).pow(e)}function lo(i){var e,t,n,r,o=0,s=new this(1),a=[];if(i===void 0?i=this.precision:Le(i,1,st),n=Math.ceil(i/F),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)r=e[o],r>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=r%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)r=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),r>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(r%1e7),o+=4);o=n/4}else throw Error(hi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],i%=F,n&&i&&(r=ge(10,F-i),a[o]=(n/r|0)*r);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=F)a.shift();for(n=1,r=a[0];r>=10;r/=10)n++;n<F&&(t-=F-n)}return s.e=t,s.d=a,s}function mo(i){return O(i=new this(i),i.e+1,this.rounding)}function fo(i){return i=new this(i),i.d?i.d[0]?i.s:0*i.s:i.s||NaN}function po(i){return new this(i).sin()}function go(i){return new this(i).sinh()}function bo(i){return new this(i).sqrt()}function yo(i,e){return new this(i).sub(e)}function wo(){var i=0,e=arguments,t=new this(e[i]);for(v=!1;t.s&&++i<e.length;)t=t.plus(e[i]);return v=!0,O(t,this.precision,this.rounding)}function ho(i){return new this(i).tan()}function ko(i){return new this(i).tanh()}function Po(i){return O(i=new this(i),i.e+1,1)}x[Symbol.for("nodejs.util.inspect.custom")]=x.toString;x[Symbol.toStringTag]="Decimal";var St=x.constructor=Si(Kn);nn=new St(nn);rn=new St(rn);var K=St;import{PublicKey as Ni}from"@solana/web3.js";import{get as Ci,set as Ao}from"lodash";var On=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ki={},To={};function ke(i){let e=Ci(Ki,i);if(!e){let t=Ci(To,i);e=new On({name:i,logLevel:t}),Ao(Ki,i,e)}return e}import{MINT_SIZE as xo,TOKEN_PROGRAM_ID as Bo,getTransferFeeConfig as Io,unpackMint as So}from"@solana/spl-token";var En=ke("Raydium_accountInfo_util");async function $e(i,e,t){let{batchRequest:n,commitment:r="confirmed",chunkCount:o=100}=M({batchRequest:!1},t),s=Fn(e,o),a=new Array(s.length).fill([]);if(n){let c=s.map(m=>{let d=i._buildArgs([m.map(f=>f.toBase58())],r,"base64");return{methodName:"getMultipleAccounts",args:d}}),u=Fn(c,10);a=(await(await Promise.all(u.map(async m=>await i._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&En.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:f,executable:p,lamports:g,owner:y,rentEpoch:b}=d;return f.length!==2&&f[1]!=="base64"&&En.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(f[0],"base64"),executable:p,lamports:g,owner:new Ni(y),rentEpoch:b}}return null})))}else try{a=await Promise.all(s.map(c=>i.getMultipleAccountsInfo(c,r)))}catch(c){c instanceof Error&&En.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${c.message}`)}return a.flat()}async function at(i,e,t){let n=await $e(i,e.map(r=>r.pubkey),t);return e.map((r,o)=>X(M({},r),{accountInfo:n[o]}))}async function Li({connection:i,mints:e,config:t}){var o,s,a;if(e.length===0)return{};let n=await at(i,e.map(c=>({pubkey:dt(c)})),t),r={};for(let c of n){if(!c.accountInfo||c.accountInfo.data.length<xo){console.log("invalid mint account",c.pubkey.toBase58());continue}let u=So(c.pubkey,c.accountInfo,(o=c.accountInfo)==null?void 0:o.owner);r[c.pubkey.toString()]=X(M({},u),{programId:((s=c.accountInfo)==null?void 0:s.owner)||Bo,feeConfig:(a=Io(u))!=null?a:void 0})}return r[Ni.default.toBase58()]=r[J.toBase58()],r}import et from"bn.js";import Eo from"big.js";import mn from"bn.js";import Co from"toformat";var Ko=Co,Ct=Ko;import ln from"big.js";import Lo from"bn.js";import Ro from"decimal.js-light";import Kt from"bn.js";var Ri=9007199254740991;function ye(i){let e=ke("Raydium_parseBigNumberish");if(i instanceof Kt)return i;if(typeof i=="string"){if(i.match(/^-?[0-9]+$/))return new Kt(i);e.logWithError(`invalid BigNumberish string: ${i}`)}return typeof i=="number"?(i%1&&e.logWithError(`BigNumberish number underflow: ${i}`),(i>=Ri||i<=-Ri)&&e.logWithError(`BigNumberish number overflow: ${i}`),new Kt(String(i))):typeof i=="bigint"?new Kt(i.toString()):(e.error(`invalid BigNumberish value: ${i}`),new Kt(0))}var un=ke("module/fraction"),Dn=Ct(ln),Nt=Ct(Ro),Mo={[0]:Nt.ROUND_DOWN,[1]:Nt.ROUND_HALF_UP,[2]:Nt.ROUND_UP},Oo={[0]:ln.roundDown,[1]:ln.roundHalfUp,[2]:ln.roundUp},ee=class{constructor(e,t=new Lo(1)){this.numerator=ye(e),this.denominator=ye(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new ee(this.denominator,this.numerator)}add(e){let t=e instanceof ee?e:new ee(ye(e));return this.denominator.eq(t.denominator)?new ee(this.numerator.add(t.numerator),this.denominator):new ee(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof ee?e:new ee(ye(e));return this.denominator.eq(t.denominator)?new ee(this.numerator.sub(t.numerator),this.denominator):new ee(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof ee?e:new ee(ye(e));return new ee(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof ee?e:new ee(ye(e));return new ee(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<=0&&un.logWithError(`${e} is not positive.`),Nt.set({precision:e+1,rounding:Mo[n]});let r=new Nt(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return r.toFormat(r.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||un.logWithError(`${e} is not an integer.`),e<0&&un.logWithError(`${e} is negative.`),Dn.DP=e,Dn.RM=Oo[n]||1,new Dn(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var Fo=ke("Raydium_amount"),Mi=Ct(Eo);function Do(i,e){let t="0",n="0";if(i.includes(".")){let r=i.split(".");r.length===2?([t,n]=r,n=n.padEnd(e,"0")):Fo.logWithError(`invalid number string, num: ${i}`)}else t=i;return[t,n.slice(0,e)||n]}var Pe=class extends ee{constructor(t,n,r=!0,o){let s=new mn(0),a=_n.pow(new mn(t.decimals));if(r)s=ye(n);else{let c=new mn(0),u=new mn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=Do(n.toString(),t.decimals);c=ye(l),u=ye(m)}c=c.mul(a),s=c.add(u)}super(s,a);this.logger=ke(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new Pe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new Pe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,r=0){return super.toSignificant(t,n,r)}toFixed(t=this.token.decimals,n,r=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,r)}toExact(t={groupSeparator:""}){return Mi.DP=this.token.decimals,new Mi(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as _o}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Oi}from"@solana/spl-token";var vn={chainId:101,address:_o.default.toBase58(),programId:Oi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ct={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Oi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Un}from"@solana/web3.js";import{PublicKey as ce,SystemProgram as Ei,SYSVAR_RENT_PUBKEY as vo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Wo}from"@solana/spl-token";function Wn({pubkey:i,isSigner:e=!1,isWritable:t=!0}){return{pubkey:i,isWritable:t,isSigner:e}}var wa=[Wn({pubkey:Wo,isWritable:!1}),Wn({pubkey:Ei.programId,isWritable:!1}),Wn({pubkey:vo,isWritable:!1})];function qn({publicKey:i,transformSol:e}){let t=Fi(i.toString());if(t instanceof ce)return e&&t.equals(Lt)?J:t;if(e&&t.toString()===Lt.toBase58())return J;if(typeof t=="string"){if(t===ce.default.toBase58())return ce.default;try{return new ce(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Fi(i){try{return new ce(i)}catch{return i}}var dn=new ce("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Vn=new ce("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),At=new ce("SysvarRent111111111111111111111111111111111"),ha=new ce("SysvarC1ock11111111111111111111111111111111"),ft=new ce("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),ka=new ce("Sysvar1nstructions1111111111111111111111111"),Pa=Ei.programId,Aa=new ce("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ta=new ce("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),xa=new ce("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),Ba=new ce("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Ia=new ce("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),Sa=new ce("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Ca=new ce("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Ka=new ce("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Na=new ce("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),La=new ce("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ra=new ce("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),J=new ce("So11111111111111111111111111111111111111112"),Lt=ce.default;function dt(i){return qn({publicKey:i,transformSol:!0})}var Gn=class{constructor({mint:e,decimals:t,symbol:n,name:r,skipMint:o=!1,isToken2022:s=!1}){if(e===Lt.toBase58()||e instanceof Un&&Lt.equals(e)){this.decimals=ct.decimals,this.symbol=ct.symbol,this.name=ct.name,this.mint=new Un(ct.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=r||e.toString().substring(0,6),this.mint=o?Un.default:qn({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},ze=Gn;ze.WSOL=new Gn(X(M({},ct),{mint:ct.address}));var Xn=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},fn=Xn;fn.SOL=new Xn(vn);import qo from"bn.js";var Di=new ee(new qo(100)),ut=class extends ee{toSignificant(e=5,t,n){return this.mul(Di).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Di).toFixed(e,t,n)}};var Vo=ke("Raydium_price"),ve=class extends ee{constructor(t){let{baseToken:n,quoteToken:r,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=r,this.scalar=new ee(zn(n.decimals),zn(r.decimals))}get raw(){return new ee(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ve({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Vo.logWithError("mul token not equals");let n=super.mul(t);return new ve({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,r){return this.adjusted.toSignificant(t,n,r)}toFixed(t=this.quoteToken.decimals,n,r){return this.adjusted.toFixed(t,n,r)}};import{PublicKey as lc}from"@solana/web3.js";import dc from"bn.js";var Uo=new et(0),Nc=new et(1),Lc=new et(2),Rc=new et(3),Mc=new et(5),_n=new et(10),Oc=new et(100),Ec=new et(1e3),Fc=new et(1e4);function zn(i){return _n.pow(ye(i))}function Fn(i,e=1,t=[]){let n=[...i];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as Yo}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Qo}from"@solana/spl-token";import{ComputeBudgetProgram as _i,Keypair as Wi,PublicKey as Go,Transaction as qi,TransactionMessage as Xo,VersionedTransaction as Vi}from"@solana/web3.js";var le={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as zo}from"@solana/spl-token";var vi=ke("Raydium_txUtil"),Ui=1644;function pn(i){let e=[],t=[];return i.microLamports&&(e.push(_i.setComputeUnitPrice({microLamports:i.microLamports})),t.push(le.SetComputeUnitPrice)),i.units&&(e.push(_i.setComputeUnitLimit({units:i.units})),t.push(le.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function Tt(i,e){var n,r;let t=e!=null?e:"confirmed";return(r=await((n=i.getLatestBlockhash)==null?void 0:n.call(i,{commitment:t})))==null?void 0:r.blockhash}async function gn(i,e){return i.getSignatureStatuses([e]),new Promise((t,n)=>{let r=setTimeout(n,6e4);i.onSignature(e,o=>{if(clearTimeout(r),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Ho(i,e){i.length<1&&vi.logWithError(`no instructions provided: ${i.toString()}`),e.length<1&&vi.logWithError(`no signers provided:, ${e.toString()}`);let t=new qi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...i);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Ui}catch{return!1}}function Ie(i,e){let[t,n]=Go.findProgramAddressSync(i,e);return{publicKey:t,nonce:n}}function Rt({instructions:i,payer:e,signers:t}){return Ho(i,[e,...t])}function Mt({instructions:i,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=Wi.generate().publicKey.toString()}){let o=new Xo({payerKey:e,recentBlockhash:n,instructions:i}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Vi(o).serialize()).toString("base64").length<Ui}catch{return!1}}var Zo=i=>Buffer.isBuffer(i)?i:i instanceof Uint8Array?Buffer.from(i.buffer,i.byteOffset,i.byteLength):Buffer.from(i),jo=i=>{let e=i.serialize({requireAllSignatures:!1,verifySignatures:!1});i instanceof Vi&&(e=Zo(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function pt(i){let e=[];return i.forEach(t=>{t instanceof qi&&(t.recentBlockhash||(t.recentBlockhash=zo.toBase58()),t.feePayer||(t.feePayer=Wi.generate().publicKey)),e.push(jo(t))}),console.log("simulate tx string:",e),e}function xe(i,e,t){return Ie([i.toBuffer(),(t!=null?t:Qo).toBuffer(),e.toBuffer()],new Yo("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as U}from"@solana/web3.js";var iu=new U("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ru=new U("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ou=new U("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),su=new U("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),au=new U("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),cu=new U("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),uu=new U("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),lu=new U("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),mu=new U("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),du=new U("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Ot=new U("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Et=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),bn=new U("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),fu=new U("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),pu=new U("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),gu=new U("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),bu=new U("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),yu=new U("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),wu=new U("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),hu=new U("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),ku=new U("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Pu=new U("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Jo=new U("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),$o=new U("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),es=new U("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Au=new U("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),ts=new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Tu=new U("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),ns=new U("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var xu={SERUM_MARKET:U.default,OPENBOOK_MARKET:new U("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:U.default,FarmV3:new U("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new U("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new U("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new U("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new U("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new U("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new U("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new U("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new U("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Jo,CREATE_CPMM_POOL_AUTH:$o,CREATE_CPMM_POOL_FEE_ACC:es,FEE_DESTINATION_ID:new U("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:ts,LCOK_CPMM_AUTH:ns};import We from"bn.js";var Ft=1e4;function me(i,e,t,n){if(e===void 0)return{amount:i,fee:void 0,expirationTime:void 0};let r=X(M({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<r.newerTransferFee.epoch?r.olderTransferFee:r.newerTransferFee,s=new We(o.maximumFee.toString()),a=t.epoch<r.newerTransferFee.epoch?(Number(r.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===Ft){let c=new We(o.maximumFee.toString());return{amount:i.add(c),fee:c,expirationTime:a}}else{let c=Hn(i.mul(new We(Ft)),new We(Ft-o.transferFeeBasisPoints)),u=new We(o.maximumFee.toString()),l=c.sub(i).gt(u)?i.add(u):c,m=Hn(l.mul(new We(o.transferFeeBasisPoints)),new We(Ft)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let c=Hn(i.mul(new We(o.transferFeeBasisPoints)),new We(Ft)),u=c.gt(s)?s:c;return{amount:i,fee:u,expirationTime:a}}}function lt(i,e){return i===void 0?e:e===void 0?i:Math.min(i,e)}function Hn(i,e){let{div:t,mod:n}=i.divmod(e);return n.gt(new We(0))?t.add(new We(1)):t}import{PublicKey as Gi,AddressLookupTableAccount as yn}from"@solana/web3.js";async function Zn({connection:i,address:e}){let t=await $e(i,[...new Set(e.map(r=>r.toString()))].map(r=>new Gi(r))),n={};for(let r=0;r<e.length;r++){let o=t[r],s=e[r];if(!o)continue;let a=new yn({key:s,state:yn.deserialize(o.data)});n[s.toString()]=a,wn[s.toString()]=a}return n}var wn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new yn({key:new Gi("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:yn.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as Dt,sendAndConfirmTransaction as jn,Transaction as _t,TransactionMessage as vt,VersionedTransaction as Wt}from"@solana/web3.js";import rs from"axios";var hn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await rs.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=pn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:r=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...r),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==Dt.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(M({},t||{})):this.build(t)}build(e){var n;let t=new _t;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(r=>r.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async r=>{var u;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=r||{},c=o!=null?o:await Tt(this.connection,this.blockhashCommitment);if(t.recentBlockhash=c,this.signers.length&&t.sign(...this.signers),pt([t]),(u=this.owner)!=null&&u.isKeyPair)return{txId:a?await jn(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var u;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:r}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:c,execute:async l=>{var b;let{sequentially:m,onTxUpdate:d,skipTxCount:f=0,recentBlockHash:p,skipPreflight:g=!0}=l||{},y=p!=null?p:await Tt(this.connection,this.blockhashCommitment);if((b=this.owner)!=null&&b.isKeyPair){if(m){let P=[],w=0;for(let k of s){if(++w,w<=f)continue;let A=await jn(this.connection,k,this.signers.find(h=>h.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});P.push(A)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=y,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((k,A)=>(k.recentBlockhash=y,a[A].length&&k.sign(...a[A]),k));pt(P);let w=await this.signAllTransactions(P);if(m){let k=0,A=[],h=async()=>{if(!w[k])return;let T=await this.connection.sendRawTransaction(w[k].serialize(),{skipPreflight:g});A.push({txId:T,status:"sent",signedTx:w[k]}),d==null||d([...A]),k++,this.connection.onSignature(T,B=>{let R=A.findIndex(S=>S.txId===T);R>-1&&(A[R].status=B.err?"error":"success"),d==null||d([...A]),B.err||h()},"processed"),this.connection.getSignatureStatus(T)};return await h(),{txIds:A.map(T=>T.txId),signedTxs:w}}else{let k=[];for(let A=0;A<w.length;A+=1){let h=await this.connection.sendRawTransaction(w[A].serialize(),{skipPreflight:g});k.push(h)}return{txIds:k,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var g;let p=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:r,recentBlockhash:o}=p,s=ht(p,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=M(M({},this.cluster==="devnet"?{}:wn),t),c=Array.from(new Set([...n,...this.lookupTableAddress])),u=[];for(let y of c)a[y]===void 0&&u.push(new Dt(y));let l=await Zn({connection:this.connection,address:u});for(let[y,b]of Object.entries(l))a[y]=b;let m=r?Dt.default.toBase58():o!=null?o:await Tt(this.connection,this.blockhashCommitment),d=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(y=>y.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let f=new Wt(d);return f.sign(this.signers),{builder:this,transaction:f,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async y=>{var w;let{skipPreflight:b=!0,sendAndConfirm:P}=y||{};if(pt([f]),(w=this.owner)!=null&&w.isKeyPair){let k=await this.connection.sendTransaction(f,{skipPreflight:b});return P&&await gn(this.connection,k),{txId:k,signedTx:f}}if(this.signAllTransactions){let k=await this.signAllTransactions([f]);return{txId:await this.connection.sendTransaction(k[0],{skipPreflight:b}),signedTx:k[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var u;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:r}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[r,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],c=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(u=this.owner)!=null&&u.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:c,buildProps:n,execute:async l=>{var g;let{sequentially:m,onTxUpdate:d,recentBlockHash:f,skipPreflight:p=!0}=l||{};if(f&&s.forEach(y=>y.message.recentBlockhash=f),pt(s),(g=this.owner)!=null&&g.isKeyPair){if(m){let y=[];for(let b of s){let P=await this.connection.sendTransaction(b,{skipPreflight:p});await gn(this.connection,P),y.push(P)}return{txIds:y,signedTxs:s}}return{txIds:await Promise.all(s.map(async y=>await this.connection.sendTransaction(y,{skipPreflight:p}))),signedTxs:s}}if(this.signAllTransactions){let y=await this.signAllTransactions(s);if(m){let b=0,P=[],w=async()=>{if(!y[b])return;let k=await this.connection.sendTransaction(y[b],{skipPreflight:p});P.push({txId:k,status:"sent",signedTx:y[b]}),d==null||d([...P]),b++,this.connection.onSignature(k,A=>{let h=P.findIndex(T=>T.txId===k);h>-1&&(P[h].status=A.err?"error":"success"),d==null||d([...P]),A.err||w()},"processed"),this.connection.getSignatureStatus(k)};return w(),{txIds:[],signedTxs:y}}else{let b=[];for(let P=0;P<y.length;P+=1){let w=await this.connection.sendTransaction(y[P],{skipPreflight:p});b.push(w)}return{txIds:b,signedTxs:y}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let u=e||{},{computeBudgetConfig:t}=u,n=ht(u,["computeBudgetConfig"]),r=t?pn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>X(M({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],c=[];if(this.allInstructions.forEach(m=>{let d=[...c,m],f=t?[...r.instructions,...d]:d,g=[...new Set(d.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat()).values()].map(y=>new Dt(y));if(c.length<12&&Rt({instructions:f,payer:this.feePayer,signers:g})||Rt({instructions:d,payer:this.feePayer,signers:g}))c.push(m);else{if(c.length===0)throw Error("item ins too big");Rt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:g})?s.push(new _t().add(...r.instructions,...c)):s.push(new _t().add(...c)),a.push(Array.from(new Set(c.map(y=>y.keys.filter(b=>b.isSigner).map(b=>b.pubkey.toString())).flat())).map(y=>o[y]).filter(y=>y!==void 0)),c=[m]}}),c.length>0){let d=[...new Set(c.map(f=>f.keys.filter(p=>p.isSigner).map(p=>p.pubkey.toString())).flat()).values()].map(f=>o[f]).filter(f=>f!==void 0);Rt({instructions:t?[...r.instructions,...c]:[...c],payer:this.feePayer,signers:d.map(f=>f.publicKey)})?s.push(new _t().add(...r.instructions,...c)):s.push(new _t().add(...c)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var P;let{sequentially:d,onTxUpdate:f,skipTxCount:p=0,recentBlockHash:g,skipPreflight:y=!0}=m||{},b=g!=null?g:await Tt(this.connection,this.blockhashCommitment);if(s.forEach(async(w,k)=>{w.recentBlockhash=b,a[k].length&&w.sign(...a[k])}),pt(s),(P=this.owner)!=null&&P.isKeyPair){if(d){let w=0,k=[];for(let A of s){if(++w,w<=p){k.push("tx skipped");continue}let h=await jn(this.connection,A,this.signers.find(T=>T.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:y});k.push(h)}return{txIds:k,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendRawTransaction(w.serialize(),{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s.slice(p,s.length)),k=[...s.slice(0,p),...w];if(d){let A=0,h=[],T=async()=>{if(!k[A])return;A<p&&(h.push({txId:"",status:"success",signedTx:k[A]}),f==null||f([...h]),A++,T());let B=await this.connection.sendRawTransaction(k[A].serialize(),{skipPreflight:y});h.push({txId:B,status:"sent",signedTx:k[A]}),f==null||f([...h]),A++,this.connection.onSignature(B,R=>{let S=h.findIndex(C=>C.txId===B);S>-1&&(h[S].status=R.err?"error":"success"),f==null||f([...h]),R.err||T()},"processed"),this.connection.getSignatureStatus(B)};return await T(),{txIds:h.map(B=>B.txId),signedTxs:k}}else{let A=[];for(let h=0;h<k.length;h+=1){let T=await this.connection.sendRawTransaction(k[h].serialize(),{skipPreflight:y});A.push(T)}return{txIds:A,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var b;let y=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:r=[]}=y,o=ht(y,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=M(M({},this.cluster==="devnet"?{}:wn),n),a=Array.from(new Set([...this.lookupTableAddress,...r])),c=[];for(let P of a)s[P]===void 0&&c.push(new Dt(P));let u=await Zn({connection:this.connection,address:c});for(let[P,w]of Object.entries(u))s[P]=w;let l=t?pn(t):{instructions:[],instructionTypes:[]},m=await Tt(this.connection,this.blockhashCommitment),d=this.signers.reduce((P,w)=>X(M({},P),{[w.publicKey.toBase58()]:w}),{}),f=[],p=[],g=[];if(this.allInstructions.forEach(P=>{let w=[...g,P],k=t?[...l.instructions,...w]:w;if(g.length<12&&Mt({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||Mt({instructions:w,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(P);else{if(g.length===0)throw Error("item ins too big");let A={};for(let h of[...new Set(a)])s[h]!==void 0&&(A[h]=s[h]);if(t&&Mt({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let h=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));f.push(new Wt(h))}else{let h=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...g]}).compileToV0Message(Object.values(s));f.push(new Wt(h))}p.push(Array.from(new Set(g.map(h=>h.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(h=>d[h]).filter(h=>h!==void 0)),g=[P]}}),g.length>0){let w=[...new Set(g.map(k=>k.keys.filter(A=>A.isSigner).map(A=>A.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&Mt({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));f.push(new Wt(k))}else{let k=new vt({payerKey:this.feePayer,recentBlockhash:m,instructions:[...g]}).compileToV0Message(Object.values(s));f.push(new Wt(k))}p.push(w)}return(b=this.owner)!=null&&b.signer&&p.forEach(P=>{P.some(w=>w.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:f,buildProps:e,signers:p,instructionTypes:this.instructionTypes,execute:async P=>{var B;let{sequentially:w,onTxUpdate:k,skipTxCount:A=0,recentBlockHash:h,skipPreflight:T=!0}=P||{};if(f.map(async(R,S)=>{p[S].length&&R.sign(p[S]),h&&(R.message.recentBlockhash=h)}),pt(f),(B=this.owner)!=null&&B.isKeyPair){if(w){let R=0,S=[];for(let C of f){if(++R,R<=A){console.log("skip tx: ",R),S.push("tx skipped");continue}let V=await this.connection.sendTransaction(C,{skipPreflight:T});await gn(this.connection,V),S.push(V)}return{txIds:S,signedTxs:f}}return{txIds:await Promise.all(f.map(async R=>await this.connection.sendTransaction(R,{skipPreflight:T}))),signedTxs:f}}if(this.signAllTransactions){let R=await this.signAllTransactions(f.slice(A,f.length)),S=[...f.slice(0,A),...R];if(w){let C=0,V=[],Q=async()=>{if(!S[C])return;if(C<A){V.push({txId:"",status:"success",signedTx:S[C]}),k==null||k([...V]),C++,Q();return}let re=await this.connection.sendTransaction(S[C],{skipPreflight:T});V.push({txId:re,status:"sent",signedTx:S[C]}),k==null||k([...V]),C++,this.connection.onSignature(re,$=>{let H=V.findIndex(mt=>mt.txId===re);H>-1&&(V[H].status=$.err?"error":"success"),k==null||k([...V]),$.err||Q()},"processed"),this.connection.getSignatureStatus(re)};return Q(),{txIds:[],signedTxs:S}}else{let C=[];for(let V=0;V<S.length;V+=1){let Q=await this.connection.sendTransaction(S[V],{skipPreflight:T});C.push(Q)}return{txIds:C,signedTxs:S}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{AccountLayout as Pr,TOKEN_PROGRAM_ID as Jt}from"@solana/spl-token";import{PublicKey as ul}from"@solana/web3.js";import{MintLayout as ml,TOKEN_PROGRAM_ID as fl}from"@solana/spl-token";var kn=r=>{var o=r,{address:i,programId:e,decimals:t}=o,n=ht(o,["address","programId","decimals"]);return M({chainId:101,address:dt(i).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)},Yn=i=>i?X(M({},i),{transferFeeConfigAuthority:i.transferFeeConfigAuthority.toBase58(),withdrawWithheldAuthority:i.withdrawWithheldAuthority.toBase58(),withheldAmount:i.withheldAmount.toString(),olderTransferFee:X(M({},i.olderTransferFee),{epoch:i.olderTransferFee.epoch.toString(),maximumFee:i.olderTransferFee.maximumFee.toString()}),newerTransferFee:X(M({},i.newerTransferFee),{epoch:i.newerTransferFee.epoch.toString(),maximumFee:i.newerTransferFee.maximumFee.toString()})}):void 0;var Qn=(...i)=>i.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),qt=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ke(t)}createTxBuilder(e){return this.scope.checkOwner(),new hn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Qn(e))}logInfo(...e){this.logger.info(Qn(e))}logAndCreateError(...e){let t=Qn(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{Keypair as In,PublicKey as I,SystemProgram as wt,TransactionInstruction as Ne}from"@solana/web3.js";import yr from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as ui,TOKEN_2022_PROGRAM_ID as Qe,TOKEN_PROGRAM_ID as se}from"@solana/spl-token";import{PublicKey as fs}from"@solana/web3.js";import Zi,{isBN as ji}from"bn.js";import{bits as xl,BitStructure as Bl,blob as os,Blob as Il,cstr as Sl,f32 as Cl,f32be as Kl,f64 as Nl,f64be as Ll,greedy as Rl,Layout as ss,ns64 as Ml,ns64be as Ol,nu64 as El,nu64be as Fl,offset as Dl,s16 as _l,s16be as vl,s24 as Wl,s24be as ql,s32 as as,s32be as Vl,s40 as Ul,s40be as Gl,s48 as Xl,s48be as zl,s8 as Hl,seq as cs,struct as Zl,Structure as us,u16 as ls,u16be as jl,u24 as Yl,u24be as Ql,u32 as Jl,u32be as $l,u40 as em,u40be as tm,u48 as nm,u48be as im,u8 as ms,UInt as ds,union as rm,Union as om,unionLayoutDiscriminator as sm,utf8 as am}from"@solana/buffer-layout";var Jn=ss,Xi=us;var $n=ds;var zi=ms,Vt=ls;var Ae=as;var Hi=cs;var Me=os;var xt=class extends Jn{constructor(t,n,r){super(t,r);this.blob=Me(t),this.signed=n}decode(t,n=0){let r=new Zi(this.blob.decode(t,n),10,"le");return this.signed?r.fromTwos(this.span*8).clone():r}encode(t,n,r=0){return typeof t=="number"&&(t=new Zi(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,r)}};function fe(i){return new $n(1,i)}function Bt(i){return new $n(4,i)}function E(i){return new xt(8,!1,i)}function j(i){return new xt(16,!1,i)}function Yi(i){return new xt(8,!0,i)}function Qi(i){return new xt(16,!0,i)}var Pn=class extends Jn{constructor(t,n,r,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=r}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,r){return this.layout.encode(this.encoder(t),n,r)}getSpan(t,n){return this.layout.getSpan(t,n)}};function te(i){return new Pn(Me(32),e=>new fs(e),e=>e.toBuffer(),i)}function qe(i){return new Pn(zi(),ps,gs,i)}function ps(i){if(i===0)return!1;if(i===1)return!0;throw new Error("Invalid bool: "+i)}function gs(i){return i?1:0}var ei=class extends Xi{decode(e,t){return super.decode(e,t)}};function ne(i,e,t){return new ei(i,e,t)}function ue(i,e,t){let n,r=typeof e=="number"?e:ji(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=ji(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return Hi(i,r,t)}import Bs from"bn.js";import Ee from"bn.js";var de=new Ee(0),He=new Ee(1),tt=new Ee(-1),Oe=new Ee(1).shln(64),An=new Ee(1).shln(128),ti=Oe.sub(He),Ut=64,Ji=An.subn(1),Be=-443636,Se=-Be,Ze=new Ee("4295048016"),je=new Ee("79226673521066979257578248091"),Pm=new Ee("4295048017"),Am=new Ee("79226673521066979257578248090"),$i=16,er="59543866431248",tr="184467440737095516",nr="15793534762490258745",Tn=new Ee(10).pow(new Ee(6));var ir={tvl:0,volumeQuote:0,mintAmountA:0,mintAmountB:0,rewardDefaultInfos:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,day:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},week:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},month:{volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[0]},pooltype:[]},Tm=new Ee("18446744073700000000");import G from"bn.js";function xn(i){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,i,!1),new Uint8Array(e)}function ni(i,e){let t=0;for(let n=i-1;n>=0&&!e.testn(n);n--)t++;return t}function ii(i,e){let t=0;for(let n=0;n<i&&!e.testn(n);n++)t++;return t}function Gt(i,e){for(let t=0;t<i;t++)if(e.testn(t))return!1;return!0}function rr(i,e){return Gt(i,e)?null:ni(i,e)}function or(i,e){return Gt(i,e)?null:ii(i,e)}var Km=Buffer.from("amm_config","utf8"),bs=Buffer.from("pool","utf8"),ys=Buffer.from("pool_vault","utf8"),ws=Buffer.from("pool_reward_vault","utf8"),sr=Buffer.from("position","utf8"),hs=Buffer.from("tick_array","utf8"),ks=Buffer.from("operation","utf8"),Ps=Buffer.from("pool_tick_array_bitmap_extension","utf8"),As=Buffer.from("observation","utf8");function ar(i,e,t,n){return Ie([bs,e.toBuffer(),t.toBuffer(),n.toBuffer()],i)}function ri(i,e,t){return Ie([ys,e.toBuffer(),t.toBuffer()],i)}function cr(i,e,t){return Ie([ws,e.toBuffer(),t.toBuffer()],i)}function z(i,e,t){return Ie([hs,e.toBuffer(),xn(t)],i)}function Ve(i,e,t,n){return Ie([sr,e.toBuffer(),xn(t),xn(n)],i)}function Ce(i,e){return Ie([sr,e.toBuffer()],i)}function Xt(i){return Ie([Buffer.from("metadata","utf8"),ft.toBuffer(),i.toBuffer()],ft)}function zt(i){return Ie([ks],i)}function Ke(i,e){return Ie([Ps,e.toBuffer()],i)}function ur(i,e){return Ie([As,e.toBuffer()],i)}var lr=Buffer.from("locked_position","utf8");function oi(i,e){return Ie([lr,e.toBuffer()],i)}function Ht(i,e){return Ie([lr,e.toBuffer()],i)}import{PublicKey as Ue}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as mr}from"@solana/spl-token";import oe from"bn.js";import Ye from"bn.js";var Zt=class{static getfeeGrowthInside(e,t,n){let r=new Ye(0),o=new Ye(0);e.tickCurrent>=t.tick?(r=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(r=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new Ye(0),a=new Ye(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let c=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64A,r),s),u=_.wrappingSubU128(_.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:c,feeGrowthInsideBX64:u}}static GetPositionFees(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),c=t.tokenFeesOwedA.add(a),u=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,r){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,r),a=_.mulDivFloor(_.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,Oe),c=t.tokenFeesOwedA.add(a),u=_.mulDivFloor(_.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,Oe),l=t.tokenFeesOwedB.add(u);return{tokenFeeAmountA:c,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,r){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=_.wrappingSubU128(c,u.growthInsideLastX64),m=_.mulDivFloor(l,t.liquidity,Oe),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,r){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,r,e.rewardInfos);for(let a=0;a<s.length;a++){let c=s[a],u=t.rewardInfos[a],l=_.wrappingSubU128(c,u.growthInsideLastX64),m=_.mulDivFloor(l,t.liquidity,Oe),d=u.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getRewardGrowthInsideV2(e,t,n,r){let o=[];for(let s=0;s<r.length;s++){let a=new Ye(0);t.liquidityGross.eqn(0)?a=r[s].rewardGrowthGlobalX64:e<t.tick?a=r[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let c=new Ye(0);n.liquidityGross.eqn(0)||(e<n.tick?c=n.rewardGrowthsOutsideX64[s]:c=r[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(_.wrappingSubU128(_.wrappingSubU128(r[s].rewardGrowthGlobalX64,a),c))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:r,add:o,epochInfo:s}){var y,b,P,w;let a=D.priceToSqrtPriceX64(new K(e.price),e.mintA.decimals,e.mintB.decimals),c=D.getSqrtPriceX64FromTick(t.tickLower),u=D.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+r:1-r,m=Y.getAmountsFromLiquidity(a,c,u,n,o),[d,f]=[me(m.amountA,(y=e.mintA.extensions)==null?void 0:y.feeConfig,s,!0),me(m.amountB,(b=e.mintB.extensions)==null?void 0:b.feeConfig,s,!0)],[p,g]=[me(new Ye(new K(m.amountA.toString()).mul(l).toFixed(0)),(P=e.mintA.extensions)==null?void 0:P.feeConfig,s,!0),me(new Ye(new K(m.amountB.toString()).mul(l).toFixed(0)),(w=e.mintB.extensions)==null?void 0:w.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:g,expirationTime:lt(d.expirationTime,f.expirationTime)}}};var Ts=15,Z=class{static async getTickArrays(e,t,n,r,o,s,a){let c=[],u=L.getTickArrayStartIndexByTick(r,o),l=L.getInitializedTickArrayInRange(s,a,o,u,Math.floor(Ts/2));for(let f=0;f<l.length;f++){let{publicKey:p}=z(t,n,l[f]);c.push(p)}let m=(await $e(e,c)).map(f=>f!==null?jt.decode(f.data):null),d={};for(let f=0;f<c.length;f++){let p=m[f];p!==null&&(d[p.startTickIndex]=X(M({},p),{address:c[f]}))}return d}static nextInitializedTick(e,t,n,r,o,s){let{initializedTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}=this.nextInitializedTickInOneArray(e,t,n,r,o,s);for(;a==null||a.liquidityGross.lten(0);){if(u=L.getNextTickArrayStartIndex(u,o,s),this.checkIsValidStartIndex(u,o))throw new Error("No enough initialized tickArray");let l=n[u];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:f}=this.firstInitializedTickInOneArray(e,t,l,s);[a,c,u]=[m,d,f]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:c,tickArrayStartTickIndex:u}}static nextInitializedTickArray(e,t,n,r,o){let s=Math.floor(e/Z.tickCount(t)),a=n?L.searchLowBitFromStart(r,o,s-1,1,t):L.searchHightBitFromStart(r,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,r){let o;if(r){let a=be-1;for(;a>=0;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a-1}}else{let a=0;for(;a<be;){let c=n.ticks[a];if(c.liquidityGross.gtn(0)){o=c;break}a=a+1}}let{publicKey:s}=z(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,r,o,s){let a=L.getTickArrayStartIndexByTick(r,o),c=Math.floor((r-a)/o),u=n[a];if(u==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;c>=0;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c-1}else for(c=c+1;c<be;){let d=u.ticks[c];if(d.liquidityGross.gtn(0)){l=d;break}c=c+1}let{publicKey:m}=z(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:u.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(L.checkIsOutOfBoundary(e)){if(e>Se)return!1;let n=L.getTickArrayStartIndexByTick(Be,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return be*e}};var si=14,nt=class{static maxTickInTickarrayBitmap(e){return e*be*gt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(r+=1);let o=n*r;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,r){if(!Z.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=r?t-Z.tickCount(n):t+Z.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*be,c=s/a+512;s<0&&s%a!=0&&c--;let u=Math.abs(c);if(r){let l=e.shln(1024-u-1),m=rr(1024,l);if(m!==null){let d=(u-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(u),m=or(1024,l);if(m!==null){let d=(u+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-Z.tickCount(n)}}}},Yt=class{static getBitmapOffset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=nt.maxTickInTickarrayBitmap(t),r=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&r--,r}static getBitmap(e,t,n){let r=this.getBitmapOffset(e,t);return e<0?{offset:r,tickarrayBitmap:n.negativeTickArrayBitmap[r]}:{offset:r,tickarrayBitmap:n.positiveTickArrayBitmap[r]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:r}=this.extensionTickBoundary(t);if(e>=r&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=nt.maxTickInTickarrayBitmap(e),n=-t;if(Se<=t)throw Error(`extensionTickBoundary check error: ${Se}, ${t}`);if(n<=Be)throw Error(`extensionTickBoundary check error: ${n}, ${Be}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:r}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:L.mergeTickArrayBitmap(r).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,r){let o=Z.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,r);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,r){let{minValue:o,maxValue:s}=nt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(r){let c=L.mergeTickArrayBitmap(e).shln(gt-1-a),u=Gt(512,c)?null:ni(512,c);if(u!==null){let l=t-u*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let c=L.mergeTickArrayBitmap(e).shrn(a),u=Gt(512,c)?null:ii(512,c);if(u!==null){let l=t+u*Z.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-Z.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%nt.maxTickInTickarrayBitmap(t),r=Math.floor(n/Z.tickCount(t));return e<0&&n!=0&&(r=gt-r),r}};var pe=class{static getOutputAmountAndRemainAccounts(e,t,n,r,o,s=!1){let a=n.toBase58()===e.mintA.address,c=[],{isExist:u,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!u||l===void 0||!m)throw new Error("Invalid tick array");c.push(m);let{allTrade:d,amountCalculated:f,accounts:p,sqrtPriceX64:g,feeAmount:y}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r,l,o,s);return c.push(...p),{allTrade:d,expectedAmountOut:f.mul(tt),remainingAccounts:c,executionPrice:g,feeAmount:y}}static getInputAmountAndRemainAccounts(e,t,n,r,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:c,startIndex:u,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!c||u===void 0||!l)throw new Error("Invalid tick array");try{let g=this.preInitializedTickArrayStartIndex(e,s);if(g.isExist){let{publicKey:y}=z(e.programId,e.id,g.nextStartIndex);a.push(y)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:f,feeAmount:p}=bt.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,r.mul(tt),u,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:f,feeAmount:p}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:r}=pe.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?Yt.checkTickArrayIsInit(Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):L.checkTickArrayIsInitialized(L.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=z(e.programId,e.id,r);return{isExist:!0,startIndex:r,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=z(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/Z.tickCount(e.tickSpacing)),r=t?L.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):L.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return r.length>0?{isExist:!0,nextStartIndex:r[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=Z.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:r,tickIndex:o}=nt.nextInitializedTickArrayStartIndex(L.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(r)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=Yt.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Be||t>Se)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:r,rewardInfos:o}){var a,c,u;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(u=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?u:(c=await e.getAccountInfo(m.tokenMint))==null?void 0:c.owner;if(d===void 0)throw Error("get new reward mint info error");let f=X(M({},m),{perSecond:_.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ue(d)});if(f.tokenMint.equals(Ue.default))continue;if(n<=f.openTime.toNumber()||r.eq(de)){s.push(f);continue}let p=new oe(Math.min(f.endTime.toNumber(),n)),g=p.sub(f.lastUpdateTime),y=_.mulDivFloor(g,f.emissionsPerSecondX64,r),b=f.rewardGrowthGlobalX64.add(y),P=_.mulDivFloor(g,f.emissionsPerSecondX64,Oe),w=f.rewardTotalEmissioned.add(P);s.push(X(M({},f),{rewardGrowthGlobalX64:b,rewardTotalEmissioned:w,lastUpdateTime:p}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:r}=this.tickRange(e);for(let o of t){let s=L.getTickArrayStartIndexByTick(o,e);if(s>=n||s<r)return!0}return!1}static tickRange(e){let t=nt.maxTickInTickarrayBitmap(e),n=-t;return t>Se&&(t=Z.getArrayStartIndex(Se,e)+Z.tickCount(e)),n<Be&&(n=Z.getArrayStartIndex(Be,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!Z.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/Z.tickCount(t)*gt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let r=await at(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of r)s.accountInfo!==null&&(o[s.pubkey.toString()]=fr.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let r={},o=[];for(let c of t){let u=L.getTickArrayStartIndexByTick(c.tickCurrent,c.tickSpacing),l=L.getInitializedTickArrayInRange(c.tickArrayBitmap,c.exBitmapInfo,c.tickSpacing,u,7);for(let m of l){let{publicKey:d}=z(c.programId,c.id,m);o.push({pubkey:d}),r[d.toString()]=c.id}}let s=await at(e,o,{batchRequest:n}),a={};for(let c of s){if(!c.accountInfo)continue;let u=r[c.pubkey.toString()];if(!u)continue;a[u.toString()]===void 0&&(a[u.toString()]={});let l=jt.decode(c.accountInfo.data);a[u.toString()][l.startTickIndex]=X(M({},l),{address:c.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:r=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let c=0;c<e.length;c++){let u=e[c];u!==null&&(s.find(l=>l.equals(u.state.programId))||s.push(u.state.programId))}if(n){let c=n.tokenAccounts.map(d=>d.accountInfo.mint),u=[];for(let d of c)for(let f of s)u.push(Ce(f,d).publicKey);let l=await $e(t,u,{batchRequest:r}),m={};for(let d of l){if(d===null)continue;let f=Qt.decode(d.data),p=f.poolId.toString(),g=e.find(B=>B.state.id.toBase58()===p);if(g===void 0)continue;let y=g.state,b=L._getTickPriceLegacy({poolInfo:y,tick:f.tickLower,baseIn:!0}),P=L._getTickPriceLegacy({poolInfo:y,tick:f.tickUpper,baseIn:!0}),{amountA:w,amountB:k}=Y.getAmountsFromLiquidity(y.sqrtPriceX64,b.tickSqrtPriceX64,P.tickSqrtPriceX64,f.liquidity,!1),A=1/(1-Math.sqrt(Math.sqrt(b.price.div(P.price).toNumber())));g.positionAccount=[...(a=g.positionAccount)!=null?a:[],{poolId:f.poolId,nftMint:f.nftMint,priceLower:b.price,priceUpper:P.price,amountA:w,amountB:k,tickLower:f.tickLower,tickUpper:f.tickUpper,liquidity:f.liquidity,feeGrowthInsideLastX64A:f.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:f.feeGrowthInsideLastX64B,tokenFeesOwedA:f.tokenFeesOwedA,tokenFeesOwedB:f.tokenFeesOwedB,rewardInfos:f.rewardInfos.map(B=>X(M({},B),{pendingReward:new oe(0)})),leverage:A,tokenFeeAmountA:new oe(0),tokenFeeAmountB:new oe(0)}];let h=await L.getTickArrayAddressByTick(g.state.programId,f.poolId,f.tickLower,g.state.tickSpacing),T=await L.getTickArrayAddressByTick(g.state.programId,f.poolId,f.tickUpper,g.state.tickSpacing);m[`${g.state.programId.toString()}-${f.poolId.toString()}-${f.tickLower}`]=h,m[`${g.state.programId.toString()}-${f.poolId.toString()}-${f.tickUpper}`]=T}if(o){let d=Object.values(m),f=await $e(t,d,{batchRequest:r}),p={};for(let g=0;g<d.length;g++){let y=f[g];if(y===null)continue;let b=d[g].toString();p[b]=jt.decode(y.data)}for(let{state:g,positionAccount:y}of e)if(!!y)for(let b of y){let P=`${g.programId.toString()}-${g.id.toString()}-${b.tickLower}`,w=`${g.programId.toString()}-${g.id.toString()}-${b.tickUpper}`,k=p[m[P].toString()],A=p[m[w].toString()],h=k.ticks[L.getTickOffsetInArray(b.tickLower,g.tickSpacing)],T=A.ticks[L.getTickOffsetInArray(b.tickUpper,g.tickSpacing)],{tokenFeeAmountA:B,tokenFeeAmountB:R}=await Zt.GetPositionFees(g,b,h,T),S=await Zt.GetPositionRewards(g,b,h,T);b.tokenFeeAmountA=B.gte(new oe(0))?B:new oe(0),b.tokenFeeAmountB=R.gte(new oe(0))?R:new oe(0);for(let C=0;C<S.length;C++)b.rewardInfos[C].pendingReward=S[C].gte(new oe(0))?S[C]:new oe(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountIn:o,slippage:s,priceLimit:a=new K(0),catchLiquidityInsufficient:c=!1}){var V;let u,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new K(0))?u=l?Ze.add(new oe(1)):je.sub(new oe(1)):u=D.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let f=me(o,m,r,!1),{allTrade:p,expectedAmountOut:g,remainingAccounts:y,executionPrice:b,feeAmount:P}=pe.getOutputAmountAndRemainAccounts(e,t,n,f.amount.sub((V=f.fee)!=null?V:de),u,c),w=me(g,d,r,!1),k=D.sqrtPriceX64ToPrice(b,e.mintA.decimals,e.mintB.decimals),A=l?k:new K(1).div(k),h=g.mul(new oe(Math.floor((1-s)*1e10))).div(new oe(1e10)),T=me(h,d,r,!1),B=l?e.currentPrice:new K(1).div(e.currentPrice),R=new K(A).sub(B).abs(),S=B,C=new ut(new K(R).mul(10**15).toFixed(0),new K(S).mul(10**15).toFixed(0));return{allTrade:p,realAmountIn:f,amountOut:w,minAmountOut:T,expirationTime:lt(f.expirationTime,w.expirationTime),currentPrice:e.currentPrice,executionPrice:A,priceImpact:C,fee:P,remainingAccounts:y,executionPriceX64:b}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:r,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let c=r.address===e.mintB.address,[u,l]=c?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new ze(X(M({},u),{mint:u.address,isToken2022:u.programId===mr.toBase58()})),new ze(X(M({},l),{mint:l.address,isToken2022:l.programId===mr.toBase58()}))],{allTrade:f,realAmountIn:p,amountOut:g,minAmountOut:y,expirationTime:b,currentPrice:P,executionPrice:w,priceImpact:k,fee:A,remainingAccounts:h,executionPriceX64:T}=pe.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ue(u.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),B=X(M({},p),{amount:new Pe(m,p.amount),fee:p.fee===void 0?void 0:new Pe(m,p.fee)}),R=X(M({},g),{amount:new Pe(d,g.amount),fee:g.fee===void 0?void 0:new Pe(d,g.fee)}),S=X(M({},y),{amount:new Pe(d,y.amount),fee:y.fee===void 0?void 0:new Pe(d,y.fee)}),C=new ve({baseToken:m,denominator:new oe(10).pow(new oe(20+m.decimals)),quoteToken:d,numerator:P.mul(new K(10**(20+d.decimals))).toFixed(0)}),V=new ve({baseToken:m,denominator:new oe(10).pow(new oe(20+m.decimals)),quoteToken:d,numerator:w.mul(new K(10**(20+d.decimals))).toFixed(0)}),Q=new Pe(m,A);return{allTrade:f,realAmountIn:B,amountOut:R,minAmountOut:S,expirationTime:b,currentPrice:C,executionPrice:V,priceImpact:k,fee:Q,remainingAccounts:h,executionPriceX64:T}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:r,amountOut:o,slippage:s,priceLimit:a=new K(0)}){var S;let c=n.toBase58()===e.mintA.address,u={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new K(0))?l=c?je.sub(new oe(1)):Ze.add(new oe(1)):l=D.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=me(o,u[n.toString()],r,!0),{expectedAmountIn:d,remainingAccounts:f,executionPrice:p,feeAmount:g}=pe.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((S=m.fee)!=null?S:de),l),y=c?e.mintB.address:e.mintA.address,b=me(d,u[y],r,!1),P=D.sqrtPriceX64ToPrice(p,e.mintA.decimals,e.mintB.decimals),w=c?P:new K(1).div(P),k=d.mul(new oe(Math.floor((1+s)*1e10))).div(new oe(1e10)),A=me(k,u[y],r,!0),h=c?e.currentPrice:new K(1).div(e.currentPrice),T=new K(w).sub(h).abs(),B=h,R=new ut(new K(T).mul(10**15).toFixed(0),new K(B).mul(10**15).toFixed(0));return{amountIn:b,maxAmountIn:A,realAmountOut:m,expirationTime:lt(b.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:w,priceImpact:R,fee:g,remainingAccounts:f}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:r}){var p,g,y;let o=e[t],s=L.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=L.getTickPrice({poolInfo:e,tick:r,baseIn:!0}).price.toNumber(),c=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-c,m=a-s,d=o.priceMax-o.priceMin,f;return l<=0?f=0:m===l?f=d/l:d===l?f=l/m:f=l/d*(l/m),{feeApr:o.feeApr*f,rewardsApr:[((p=o.rewardApr[0])!=null?p:0)*f,((g=o.rewardApr[1])!=null?g:0)*f,((y=o.rewardApr[2])!=null?y:0)*f],apr:o.apr*f}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:r,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:c}){let u=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=r[dt(e.mintA.address).toString()],d=r[dt(e.mintB.address).toString()],f=e.mintA.decimals,p=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let g=D.priceToSqrtPriceX64(new K(e.price),e.mintA.decimals,e.mintB.decimals),y=D.getSqrtPriceX64FromTick(s),b=D.getSqrtPriceX64FromTick(a),{amountSlippageA:P,amountSlippageB:w}=Y.getAmountsFromLiquidityWithSlippage(g,y,b,t,!1,!1,0),{amountSlippageA:k,amountSlippageB:A}=Y.getAmountsFromLiquidityWithSlippage(g,y,b,o,!1,!1,0),h=new K(P.toString()).div(new K(10).pow(f)).mul(m.value).add(new K(w.toString()).div(new K(10).pow(p)).mul(d.value)),T=new K(k.toString()).div(new K(10).pow(f)).mul(m.value).add(new K(A.toString()).div(new K(10).pow(p)).mul(d.value)),B=new K(1).div(h.add(T)),S=new K(l.volumeFee).mul(365).div(u).mul(B).mul(100).toNumber(),C=3600*24*365,V=e.rewardDefaultInfos.map(Q=>{var H,mt;let re=Q.mint.decimals,$=r[Q.mint.address];return c<((H=Q.startTime)!=null?H:0)||c>((mt=Q.endTime)!=null?mt:0)||!Q.perSecond||!$||re===void 0?0:new K($.value).mul(new K(Q.perSecond).mul(C)).div(new K(10).pow(re)).mul(B).mul(100).toNumber()});return{feeApr:S,rewardsApr:V,apr:S+V.reduce((Q,re)=>Q+re,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:r,amount:o,slippage:s,add:a,epochInfo:c,amountHasFee:u}){var b,P;let l=D.priceToSqrtPriceX64(new K(e.price),e.mintA.decimals,e.mintB.decimals),m=D.getSqrtPriceX64FromTick(n),d=D.getSqrtPriceX64FromTick(r),f=a?1-s:1+s,p=me(o,(b=e[t?"mintA":"mintB"].extensions)==null?void 0:b.feeConfig,c,!u),g=new oe(new K(p.amount.sub((P=p.fee)!=null?P:de).toString()).mul(f).toFixed(0)),y;if(l.lte(m))y=t?Y.getLiquidityFromTokenAmountA(m,d,g,!a):new oe(0);else if(l.lte(d)){let w=Y.getLiquidityFromTokenAmountA(l,d,g,!a),k=Y.getLiquidityFromTokenAmountB(m,l,g);y=t?w:k}else y=t?new oe(0):Y.getLiquidityFromTokenAmountB(m,d,g);return pe.getAmountsFromLiquidity({epochInfo:c,poolInfo:e,tickLower:n,tickUpper:r,liquidity:y,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:r,liquidity:o,slippage:s,add:a}){var y,b,P,w;let c=D.getSqrtPriceX64FromTick(n),u=D.getSqrtPriceX64FromTick(r),l=a?1+s:1-s,m=Y.getAmountsFromLiquidity(D.priceToSqrtPriceX64(new K(t.price),t.mintA.decimals,t.mintB.decimals),c,u,o,a),[d,f]=[me(m.amountA,(y=t.mintA.extensions)==null?void 0:y.feeConfig,e,!0),me(m.amountB,(b=t.mintB.extensions)==null?void 0:b.feeConfig,e,!0)],[p,g]=[me(m.amountA.muln(l),(P=t.mintA.extensions)==null?void 0:P.feeConfig,e,!0),me(m.amountB.muln(l),(w=t.mintB.extensions)==null?void 0:w.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:f,amountSlippageA:p,amountSlippageB:g,expirationTime:lt(d.expirationTime,f.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let r=t.filter(c=>!n[c.id]).map(c=>new Ue(c.id));(await $e(e,r)).forEach((c,u)=>{!c||(n[r[u].toBase58()]=Bn.decode(c.data))});let s=t.map(c=>Ke(new Ue(c.programId),new Ue(c.id)).publicKey),a=await pe.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((c,u)=>X(M({},c),{[u.id]:X(M({},n[u.id]),{id:new Ue(u.id),version:6,programId:new Ue(u.programId),mintA:u.mintA,mintB:u.mintB,ammConfig:X(M({},u.config),{id:new Ue(u.config.id),fundOwner:""}),currentPrice:new K(u.price),exBitmapInfo:a[Ke(new Ue(u.programId),new Ue(u.id)).publicKey.toBase58()],startTime:n[u.id].startTime.toNumber(),rewardInfos:n[u.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var ai={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]};function dr(i){return X(M({},i),{type:"Concentrated",programId:i.programId.toString(),id:i.id.toString(),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Clmm",price:i.currentPrice.toNumber(),mintAmountA:0,mintAmountB:0,feeRate:i.ammConfig.tradeFeeRate,openTime:i.startTime.toString(),tvl:0,day:ai,week:ai,month:ai,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,burnPercent:0,config:X(M({},i.ammConfig),{id:i.ammConfig.id.toString(),defaultRange:0,defaultRangePoint:[]})})}var _=class{static mulDivRoundingUp(e,t,n){let r=e.mul(t),o=r.div(n);return r.mod(n).eq(de)||(o=o.add(He)),o}static mulDivFloor(e,t,n){if(n.eq(de))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(de))throw new Error("division by 0");return e.mul(t).add(n.sub(He)).div(n)}static x64ToDecimal(e,t){return new K(e.toString()).div(K.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new G(e.mul(K.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add(An).sub(t).mod(An)}};function we(i,e){return ci(i.mul(e),64,256)}function xs(i,e,t){let n=i.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function ci(i,e,t){let n=i.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var D=class{static sqrtPriceX64ToPrice(e,t,n){return _.x64ToDecimal(e).pow(2).mul(K.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return _.decimalToX64(e.mul(K.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,r){if(!e.gt(de))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(de))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,r){if(!e.gt(de))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(de))throw new Error("liquidity must greater than 0");return r?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,r){if(n.eq(de))return e;let o=t.shln(Ut);if(r){let s=o,a=o.add(n.mul(e));return a.gte(s)?_.mulDivCeil(s,e,a):_.mulDivRoundingUp(s,He,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return _.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,r){let o=n.shln(Ut);if(r)return e.add(o.div(t));{let s=_.mulDivRoundingUp(o,He,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Be||e>Se)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new G("18445821805675395072"):new G("18446744073709551616");return(t&2)!=0&&(n=we(n,new G("18444899583751176192"))),(t&4)!=0&&(n=we(n,new G("18443055278223355904"))),(t&8)!=0&&(n=we(n,new G("18439367220385607680"))),(t&16)!=0&&(n=we(n,new G("18431993317065453568"))),(t&32)!=0&&(n=we(n,new G("18417254355718170624"))),(t&64)!=0&&(n=we(n,new G("18387811781193609216"))),(t&128)!=0&&(n=we(n,new G("18329067761203558400"))),(t&256)!=0&&(n=we(n,new G("18212142134806163456"))),(t&512)!=0&&(n=we(n,new G("17980523815641700352"))),(t&1024)!=0&&(n=we(n,new G("17526086738831433728"))),(t&2048)!=0&&(n=we(n,new G("16651378430235570176"))),(t&4096)!=0&&(n=we(n,new G("15030750278694412288"))),(t&8192)!=0&&(n=we(n,new G("12247334978884435968"))),(t&16384)!=0&&(n=we(n,new G("8131365268886854656"))),(t&32768)!=0&&(n=we(n,new G("3584323654725218816"))),(t&65536)!=0&&(n=we(n,new G("696457651848324352"))),(t&131072)!=0&&(n=we(n,new G("26294789957507116"))),(t&262144)!=0&&(n=we(n,new G("37481735321082"))),e>0&&(n=Ji.div(n)),n}static getTickFromPrice(e,t,n){return D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(je)||e.lt(Ze))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new G(t-64),r=xs(n,32,128),o=new G("8000000000000000","hex"),s=0,a=new G(0),c=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new G(0))&&s<$i;){c=c.mul(c);let p=c.shrn(127);c=c.shrn(63+p.toNumber()),a=a.add(o.mul(p)),o=o.shrn(1),s+=1}let u=a.shrn(32),m=r.add(u).mul(new G(er)),d=ci(m.sub(new G(tr)),64,128).toNumber(),f=ci(m.add(new G(nr)),64,128).toNumber();return d==f?d:D.getSqrtPriceX64FromTick(f).lte(e)?f:d}},yt=class{static getTickWithPriceAndTickspacing(e,t,n,r){let s=D.getTickFromSqrtPriceX64(D.priceToSqrtPriceX64(e,n,r))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,r){let o=yt.getTickWithPriceAndTickspacing(e,t,n,r),s=D.getSqrtPriceX64FromTick(o);return D.sqrtPriceX64ToPrice(s,n,r)}},Y=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(de))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(Ut),s=t.sub(e);return r?_.mulDivRoundingUp(_.mulDivCeil(o,s,t),He,e):_.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,r){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(de))throw new Error("sqrtPriceX64A must greater than 0");return r?_.mulDivCeil(n,t.sub(e),Oe):_.mulDivFloor(n,t.sub(e),Oe)}static getLiquidityFromTokenAmountA(e,t,n,r){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return r?_.mulDivRoundingUp(a,He,ti):a.shrn(Ut)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),_.mulDivFloor(n,ti,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return Y.getLiquidityFromTokenAmountA(t,n,r,!1);if(e.lt(n)){let s=Y.getLiquidityFromTokenAmountA(e,n,r,!1),a=Y.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return Y.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,r,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:Y.getTokenAmountAFromLiquidity(t,n,r,o),amountB:new G(0)};if(e.lt(n)){let s=Y.getTokenAmountAFromLiquidity(e,n,r,o),a=Y.getTokenAmountBFromLiquidity(t,e,r,o);return{amountA:s,amountB:a}}else return{amountA:new G(0),amountB:Y.getTokenAmountBFromLiquidity(t,n,r,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,r,o,s,a){let{amountA:c,amountB:u}=Y.getAmountsFromLiquidity(e,t,n,r,s),l=o?1+a:1-a,m=new G(new K(c.toString()).mul(l).toFixed(0)),d=new G(new K(u.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:r,slippage:o,add:s,epochInfo:a,amountAddFee:c}){var P,w,k,A;let u=D.priceToSqrtPriceX64(new K(e.price),e.mintA.decimals,e.mintB.decimals),l=D.getSqrtPriceX64FromTick(t),m=D.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,f=Y.getAmountsFromLiquidity(u,l,m,r,s),[p,g]=[me(f.amountA,(P=e.mintA.extensions)==null?void 0:P.feeConfig,a,c),me(f.amountB,(w=e.mintB.extensions)==null?void 0:w.feeConfig,a,c)],[y,b]=[me(new G(new K(f.amountA.toString()).mul(d).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,c),me(new G(new K(f.amountB.toString()).mul(d).toFixed(0)),(A=e.mintB.extensions)==null?void 0:A.feeConfig,a,c)];return{liquidity:r,amountA:p,amountB:g,amountSlippageA:y,amountSlippageB:b,expirationTime:lt(p.expirationTime,g.expirationTime)}}},bt=class{static swapCompute(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g=!1){if(d.eq(de))throw new Error("amountSpecified must not be 0");if(p||(p=s?Ze.add(He):je.sub(He)),s){if(p.lt(Ze))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(p.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(p.gt(je))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(p.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let y=d.gt(de),b={amountSpecifiedRemaining:d,amountCalculated:de,sqrtPriceX64:m,tick:u>f?Math.min(f+Z.tickCount(l)-1,u):f,accounts:[],liquidity:c,feeAmount:new G(0)},P=f,w=n[f],k=0,A=!s&&w.startTickIndex===b.tick;for(;!b.amountSpecifiedRemaining.eq(de)&&!b.sqrtPriceX64.eq(p);){k>10;let h={};h.sqrtPriceStartX64=b.sqrtPriceX64;let T=L.nextInitTick(w,b.tick,l,s,A),B=T||null,R=null;if(!(B!=null&&B.liquidityGross.gtn(0))){let C=pe.nextInitializedTickArrayStartIndex({tickCurrent:b.tick,tickSpacing:l,tickArrayBitmap:r,exBitmapInfo:o},P,s);if(!C.isExist){if(g)return{allTrade:!1,amountSpecifiedRemaining:b.amountSpecifiedRemaining,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts};throw Error("swapCompute LiquidityInsufficient")}P=C.nextStartIndex;let{publicKey:V}=z(e,t,P);R=V,w=n[P];try{B=L.firstInitializedTick(w,s)}catch{throw Error("not found next tick info")}}h.tickNext=B.tick,h.initialized=B.liquidityGross.gtn(0),f!==P&&R&&(b.accounts.push(R),f=P),h.tickNext<Be?h.tickNext=Be:h.tickNext>Se&&(h.tickNext=Se),h.sqrtPriceNextX64=D.getSqrtPriceX64FromTick(h.tickNext);let S;if(s&&h.sqrtPriceNextX64.lt(p)||!s&&h.sqrtPriceNextX64.gt(p)?S=p:S=h.sqrtPriceNextX64,[b.sqrtPriceX64,h.amountIn,h.amountOut,h.feeAmount]=bt.swapStepCompute(b.sqrtPriceX64,S,b.liquidity,b.amountSpecifiedRemaining,a),b.feeAmount=b.feeAmount.add(h.feeAmount),y?(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.sub(h.amountIn.add(h.feeAmount)),b.amountCalculated=b.amountCalculated.sub(h.amountOut)):(b.amountSpecifiedRemaining=b.amountSpecifiedRemaining.add(h.amountOut),b.amountCalculated=b.amountCalculated.add(h.amountIn.add(h.feeAmount))),b.sqrtPriceX64.eq(h.sqrtPriceNextX64)){if(h.initialized){let C=B.liquidityNet;s&&(C=C.mul(tt)),b.liquidity=Y.addDelta(b.liquidity,C)}A=h.tickNext!=b.tick&&!s&&w.startTickIndex===h.tickNext,b.tick=s?h.tickNext-1:h.tickNext}else if(b.sqrtPriceX64!=h.sqrtPriceStartX64){let C=D.getTickFromSqrtPriceX64(b.sqrtPriceX64);A=C!=b.tick&&!s&&w.startTickIndex===C,b.tick=C}++k}try{let{nextStartIndex:h,isExist:T}=Z.nextInitializedTickArray(b.tick,l,s,r,o);T&&f!==h&&(b.accounts.push(z(e,t,h).publicKey),f=h)}catch{}return{allTrade:!0,amountSpecifiedRemaining:de,amountCalculated:b.amountCalculated,feeAmount:b.feeAmount,sqrtPriceX64:b.sqrtPriceX64,liquidity:b.liquidity,tickCurrent:b.tick,accounts:b.accounts}}static swapStepCompute(e,t,n,r,o){let s={sqrtPriceX64Next:new G(0),amountIn:new G(0),amountOut:new G(0),feeAmount:new G(0)},a=e.gte(t),c=r.gte(de);if(c){let l=_.mulDivFloor(r,Tn.sub(new G(o.toString())),Tn);s.amountIn=a?Y.getTokenAmountAFromLiquidity(t,e,n,!0):Y.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?Y.getTokenAmountBFromLiquidity(t,e,n,!1):Y.getTokenAmountAFromLiquidity(e,t,n,!1),r.mul(tt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=D.getNextSqrtPriceX64FromOutput(e,n,r.mul(tt),a);let u=t.eq(s.sqrtPriceX64Next);return a?(u&&c||(s.amountIn=Y.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),u&&!c||(s.amountOut=Y.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=u&&c?s.amountIn:Y.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=u&&!c?s.amountOut:Y.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!c&&s.amountOut.gt(r.mul(tt))&&(s.amountOut=r.mul(tt)),c&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=r.sub(s.amountIn):s.feeAmount=_.mulDivCeil(s.amountIn,new G(o),Tn.sub(new G(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var be=60,gt=512,L=class{static getTickArrayAddressByTick(e,t,n,r){let o=L.getTickArrayStartIndexByTick(n,r),{publicKey:s}=z(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=L.getTickArrayStartIndexByTick(e,t),r=Math.floor((e-n)/t);if(r<0||r>=be)throw new Error("tick offset in array overflow");return r}static getTickArrayBitIndex(e,t){let n=Z.tickCount(t),r=e/n;return e<0&&e%n!=0?r=Math.ceil(r)-1:r=Math.floor(r),r}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*Z.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*be,r=Math.floor(e/n)+512;return Math.abs(r)}static checkTickArrayIsInitialized(e,t,n){let r=n*be,o=Math.floor(t/r)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*r}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*be:e+t*be}static mergeTickArrayBitmap(e){let t=new Bs(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,r,o){let s=Math.floor(r/(n*be));return[...L.searchLowBitFromStart(e,t,s-1,o,n),...L.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return L.searchHightBitFromStart(e,t,0,gt,n)}static getAllInitializedTickArrayInfo(e,t,n,r,o){let s=[],a=L.getAllInitializedTickArrayStartIndex(n,r,o);for(let c of a){let{publicKey:u}=z(e,t,c);s.push({tickArrayStartIndex:c,tickArrayAddress:u})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>L.mergeTickArrayBitmap(u)),a=[];for(;n>=-7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n--,a.length===r)break}let c=Z.tickCount(o);return a.map(u=>u*c)}static searchHightBitFromStart(e,t,n,r,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(u=>L.mergeTickArrayBitmap(u)),a=[];for(;n<7680;){let u=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[u].testn(l)&&a.push(n),n++,a.length===r)break}let c=Z.tickCount(o);return a.map(u=>u*c)}static checkIsOutOfBoundary(e){return e<Be||e>Se}static nextInitTick(e,t,n,r,o){if(Z.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(r)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<be;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=be-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<be;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new K(1).div(o),tickSqrtPriceX64:r}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let r=n?t:new K(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new K(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let r=D.getSqrtPriceX64FromTick(t),o=D.sqrtPriceX64ToPrice(r,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:r}:{tick:t,price:new K(1).div(o),tickSqrtPriceX64:r}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let r=n?t:new K(1).div(t),o=yt.getTickWithPriceAndTickspacing(r,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=D.getSqrtPriceX64FromTick(o),a=D.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new K(1).div(a)}}};var pr=ne([Me(8),fe("bump"),Vt("index"),te(""),Bt("protocolFeeRate"),Bt("tradeFeeRate"),Vt("tickSpacing"),ue(E(),8,"")]),Is=ne([Bt("blockTimestamp"),Yi("tickCumulative"),ue(E(),4)]),gr=ne([Me(8),qe("initialized"),E("recentEpoch"),Vt("observationIndex"),te("poolId"),ue(Is,100,"observations"),ue(E(),4)]),Ss=ne([fe("rewardState"),E("openTime"),E("endTime"),E("lastUpdateTime"),j("emissionsPerSecondX64"),E("rewardTotalEmissioned"),E("rewardClaimed"),te("tokenMint"),te("tokenVault"),te("creator"),j("rewardGrowthGlobalX64")]),Bn=ne([Me(8),fe("bump"),te("ammConfig"),te("creator"),te("mintA"),te("mintB"),te("vaultA"),te("vaultB"),te("observationId"),fe("mintDecimalsA"),fe("mintDecimalsB"),Vt("tickSpacing"),j("liquidity"),j("sqrtPriceX64"),Ae("tickCurrent"),Bt(),j("feeGrowthGlobalX64A"),j("feeGrowthGlobalX64B"),E("protocolFeesTokenA"),E("protocolFeesTokenB"),j("swapInAmountTokenA"),j("swapOutAmountTokenB"),j("swapInAmountTokenB"),j("swapOutAmountTokenA"),fe("status"),ue(fe(),7,""),ue(Ss,3,"rewardInfos"),ue(E(),16,"tickArrayBitmap"),E("totalFeesTokenA"),E("totalFeesClaimedTokenA"),E("totalFeesTokenB"),E("totalFeesClaimedTokenB"),E("fundFeesTokenA"),E("fundFeesTokenB"),E("startTime"),ue(E(),15*4-3,"padding")]),Cs=ne([j("growthInsideLastX64"),E("rewardAmountOwed")]),Qt=ne([Me(8),fe("bump"),te("nftMint"),te("poolId"),Ae("tickLower"),Ae("tickUpper"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ue(Cs,3,"rewardInfos"),ue(E(),8,"")]),Dd=ne([Me(8),fe("bump"),te("poolId"),Ae("tickLowerIndex"),Ae("tickUpperIndex"),j("liquidity"),j("feeGrowthInsideLastX64A"),j("feeGrowthInsideLastX64B"),E("tokenFeesOwedA"),E("tokenFeesOwedB"),ue(j(),3,"rewardGrowthInside"),ue(E(),8,"")]),Ks=ne([Ae("tick"),Qi("liquidityNet"),j("liquidityGross"),j("feeGrowthOutsideX64A"),j("feeGrowthOutsideX64B"),ue(j(),3,"rewardGrowthsOutsideX64"),ue(Bt(),13,"")]),jt=ne([Me(8),te("poolId"),Ae("startTickIndex"),ue(Ks,be,"ticks"),fe("initializedTickCount"),ue(fe(),115,"")]),br=ne([Me(329),ue(te(),100,"whitelistMints")]),fr=ne([Me(8),te("poolId"),ue(ue(E(),8),si,"positiveTickArrayBitmap"),ue(ue(E(),8),si,"negativeTickArrayBitmap")]),_d=ne([E(),fe("bump"),te("owner"),te("poolId"),te("positionId"),te("nftAccount"),ue(E(),8)]),vd=ne([Me(8),fe("bump"),te("lockOwner"),te("poolId"),te("positionId"),te("nftAccount"),te("lockNftMint"),E("recentEpoch"),ue(E(),8)]);gr.span;var wr=ke("Raydium_Clmm"),Ge={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},hr=[188,37,179,131,82,150,84,73],kr=[16,72,250,198,14,162,212,19],ae=class{static createPoolInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p){let g=ne([j("sqrtPriceX64"),E("startTime")]),y=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],b=Buffer.alloc(g.span);g.encode({sqrtPriceX64:f,startTime:p},b);let P=Buffer.from([...Ge.createPool,...b]);return new Ne({keys:y,programId:e,data:P})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:r,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:c}=e,[u,l]=[new I(r.address),new I(o.address)],{publicKey:m}=ar(t,s,u,l),{publicKey:d}=ur(t,m),{publicKey:f}=ri(t,m,u),{publicKey:p}=ri(t,m,l),g=[this.createPoolInstruction(t,m,n,s,d,u,f,new I(r.programId||se),l,p,new I(o.programId||se),Ke(t,m).publicKey,a,c)];return{signers:[],instructions:g,instructionTypes:[le.CreateAccount,le.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:f,mintBVault:p},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b,P,w,k,A,h,T,B,R,S){let C=ne([Ae("tickLowerIndex"),Ae("tickUpperIndex"),Ae("tickArrayLowerStartIndex"),Ae("tickArrayUpperStartIndex"),j("liquidity"),E("amountMaxA"),E("amountMaxB"),qe("withMetadata"),fe("optionBaseFlag"),qe("baseFlag")]),V=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],Q=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...V],re=Buffer.alloc(C.span);C.encode({tickLowerIndex:P,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:A,liquidity:h,amountMaxA:T,amountMaxB:B,withMetadata:R==="create",baseFlag:!1,optionBaseFlag:0},re);let $=Buffer.from([...Ge.openPosition,...re]);return new Ne({keys:Q,programId:e,data:$})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],p;if(l)p=new I((await l(1))[0]);else{let B=In.generate();m.push(B),p=B.publicKey}let g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(d,f,g),{publicKey:P}=z(d,f,y),{publicKey:w}=xe(n.wallet,p,se),{publicKey:k}=Xt(p),{publicKey:A}=Ce(d,p),{publicKey:h}=Ve(d,f,r,o),T=this.openPositionFromLiquidityInstruction(d,n.feePayer,f,n.wallet,p,w,k,h,b,P,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,g,y,s,a,c,u);return{signers:m,instructions:[T],instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:p,tickArrayLower:b,tickArrayUpper:P,positionNftAccount:w,metadataAccount:k,personalPosition:A,protocolPosition:h}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:u,getEphemeralSigners:l}){let m=[],[d,f]=[new I(e.programId),new I(e.id)],p;if(l)p=new I((await l(1))[0]);else{let B=In.generate();m.push(B),p=B.publicKey}let g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(d,f,g),{publicKey:P}=z(d,f,y),{publicKey:w}=xe(n.wallet,p,se),{publicKey:k}=Xt(p),{publicKey:A}=Ce(d,p),{publicKey:h}=Ve(d,f,r,o),T=this.openPositionFromBaseInstruction(d,n.feePayer,f,n.wallet,p,w,k,h,b,P,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),r,o,g,y,u,s,a,c,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(d,f).publicKey:void 0);return{address:{nftMint:p,tickArrayLower:b,tickArrayUpper:P,positionNftAccount:w,metadataAccount:k,personalPosition:A,protocolPosition:h},instructions:[T],signers:m,instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b,P,w,k,A,h,T,B,R,S){let C=ne([Ae("tickLowerIndex"),Ae("tickUpperIndex"),Ae("tickArrayLowerStartIndex"),Ae("tickArrayUpperStartIndex"),j("liquidity"),E("amountMaxA"),E("amountMaxB"),qe("withMetadata"),fe("optionBaseFlag"),qe("baseFlag")]),V=[...S?[{pubkey:S,isSigner:!1,isWritable:!0}]:[]],Q=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},{pubkey:b,isSigner:!1,isWritable:!1},...V],re=Buffer.alloc(C.span);C.encode({tickLowerIndex:P,tickUpperIndex:w,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:A,liquidity:new yr(0),amountMaxA:T==="MintA"?B:R,amountMaxB:T==="MintA"?R:B,withMetadata:h==="create",baseFlag:T==="MintA",optionBaseFlag:1},re);let $=Buffer.from([...Ge.openPosition,...re]);return new Ne({keys:Q,programId:e,data:$})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:c,withMetadata:u,getEphemeralSigners:l}){let m,d=[];if(l)m=new I((await l(1))[0]);else{let B=In.generate();d.push(B),m=B.publicKey}let[f,p]=[new I(e.programId),new I(e.id)],g=L.getTickArrayStartIndexByTick(r,e.config.tickSpacing),y=L.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:b}=z(f,p,g),{publicKey:P}=z(f,p,y),{publicKey:w}=xe(n.wallet,m,se),{publicKey:k}=Xt(m),{publicKey:A}=Ce(f,m),{publicKey:h}=Ve(f,p,r,o),T=this.openPositionFromLiquidityInstruction(f,n.wallet,p,n.wallet,m,w,k,h,b,P,A,n.tokenAccountA,n.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(t.mintA.address),new I(t.mintB.address),r,o,g,y,s,a,c,u,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[g,y])?Ke(f,p).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:b,tickArrayUpper:P,positionNftAccount:w,metadataAccount:k,personalPosition:A,protocolPosition:h},instructions:[T],signers:d,instructionTypes:[le.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,r,o){let s=ne([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1}],c=Buffer.alloc(s.span);s.encode({},c);let u=Buffer.from([...Ge.closePosition,...c]);return new Ne({keys:a,programId:e,data:u})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:r}){let o=new I(e.programId),{publicKey:s}=xe(n.wallet,r.nftMint,se),{publicKey:a}=Ce(o,r.nftMint),c=[];return c.push(this.closePositionInstruction(o,n.wallet,r.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:c,instructionTypes:[le.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b,P){let w=ne([j("liquidity"),E("amountMaxA"),E("amountMaxB"),fe("optionBaseFlag"),qe("baseFlag")]),k=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...k],h=Buffer.alloc(w.span);w.encode({liquidity:g,amountMaxA:y,amountMaxB:b,optionBaseFlag:0,baseFlag:!1},h);let T=Buffer.from([...Ge.increaseLiquidity,...h]);return new Ne({keys:A,programId:e,data:T})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMaxA:s,amountMaxB:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=z(c,u,l),{publicKey:f}=z(c,u,m),{publicKey:p}=xe(r.wallet,n.nftMint,se),{publicKey:g}=Ce(c,n.nftMint),{publicKey:y}=Ve(c,u,n.tickLower,n.tickUpper),b=this.increasePositionFromLiquidityInstruction(c,r.wallet,p,g,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(c,u).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:g,protocolPosition:y},signers:[],instructions:[b],instructionTypes:[le.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,base:o,baseAmount:s,otherAmountMax:a}){let[c,u]=[new I(e.programId),new I(e.id)],l=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=z(c,u,l),{publicKey:f}=z(c,u,m),{publicKey:p}=xe(r.wallet,n.nftMint,se),{publicKey:g}=Ce(c,n.nftMint),{publicKey:y}=Ve(c,u,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:f,positionNftAccount:p,personalPosition:g,protocolPosition:y},instructions:[this.increasePositionFromBaseInstruction(c,r.wallet,p,g,u,y,d,f,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ke(c,u).publicKey:void 0)],signers:[],instructionTypes:[le.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b,P){let w=ne([j("liquidity"),E("amountMaxA"),E("amountMaxB"),fe("optionBaseFlag"),qe("baseFlag")]),k=[...P?[{pubkey:P,isSigner:!1,isWritable:!0}]:[]],A=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...k],h=Buffer.alloc(w.span);w.encode({liquidity:new yr(0),amountMaxA:g==="MintA"?y:b,amountMaxB:g==="MintA"?b:y,baseFlag:g==="MintA",optionBaseFlag:1},h);let T=Buffer.from([...Ge.increaseLiquidity,...h]);return new Ne({keys:A,programId:e,data:T})}static decreaseLiquidityInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b,P,w){let k=ne([j("liquidity"),E("amountMinA"),E("amountMinB")]),A=[...w?[{pubkey:w,isSigner:!1,isWritable:!0}]:[],...g.map(R=>[{pubkey:R.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:R.rewardMint,isSigner:!1,isWritable:!1}]).flat()],h=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:f,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},...A],T=Buffer.alloc(k.span);k.encode({liquidity:y,amountMinA:b,amountMinB:P},T);let B=Buffer.from([...Ge.decreaseLiquidity,...T]);return new Ne({keys:h,programId:e,data:B})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:r,liquidity:o,amountMinA:s,amountMinB:a,programId:c}){let[u,l]=[new I(e.programId),new I(e.id)],m=L.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=L.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:f}=z(u,l,m),{publicKey:p}=z(u,l,d),{publicKey:g}=xe(r.wallet,n.nftMint,c),{publicKey:y}=Ce(u,n.nftMint),{publicKey:b}=Ve(u,l,n.tickLower,n.tickUpper),P=[];for(let A=0;A<e.rewardDefaultInfos.length;A++)P.push({poolRewardVault:new I(t.rewardInfos[A].vault),ownerRewardVault:r.rewardAccounts[A],rewardMint:new I(e.rewardDefaultInfos[A].mint.address)});let w=[],k=this.decreaseLiquidityInstruction(u,r.wallet,g,y,l,b,f,p,r.tokenAccountA,r.tokenAccountB,new I(t.vault.A),new I(t.vault.B),new I(e.mintA.address),new I(e.mintB.address),P,o,s,a,pe.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ke(u,l).publicKey:void 0);return w.push(k),{address:{tickArrayLower:f,tickArrayUpper:p,positionNftAccount:g,personalPosition:y,protocolPosition:b},signers:[],instructions:w,instructionTypes:[le.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,r,o,s,a,c,u,l,m,d,f,p,g,y,b){let P=ne([E("amount"),E("otherAmountThreshold"),j("sqrtPriceLimitX64"),qe("isBaseInput")]),w=[...b?[{pubkey:b,isSigner:!1,isWritable:!0}]:[],...m.map(T=>({pubkey:T,isSigner:!1,isWritable:!0}))],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...w],A=Buffer.alloc(P.span);P.encode({amount:f,otherAmountThreshold:p,sqrtPriceLimitX64:g,isBaseInput:y},A);let h=Buffer.from([...Ge.swap,...A]);return new Ne({keys:k,programId:e,data:h})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[p,g]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toString(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountA:r.tokenAccountB,y?r.tokenAccountB:r.tokenAccountA,y?d:f,y?f:d,y?p:g,y?g:p,u,n,s,a,c,!0,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[le.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:r,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:c,remainingAccounts:u}){let[l,m]=[new I(e.programId),new I(e.id)],[d,f]=[new I(t.vault.A),new I(t.vault.B)],[p,g]=[new I(e.mintA.address),new I(e.mintB.address)],y=e.mintA.address===o.toBase58(),b=[this.swapInstruction(l,r.wallet,m,new I(e.config.id),y?r.tokenAccountB:r.tokenAccountA,y?r.tokenAccountA:r.tokenAccountB,y?f:d,y?d:f,y?g:p,y?p:g,u,n,s,a,c,!1,Ke(l,m).publicKey)];return{signers:[],instructions:b,instructionTypes:[le.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ne([E("openTime"),E("endTime"),j("emissionsPerSecondX64")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({openTime:ye(l),endTime:ye(m),emissionsPerSecondX64:d},g);let y=Buffer.from([...Ge.initReward,...g]);return new Ne({keys:p,programId:e,data:y})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a=cr(o,s,r.mint).publicKey,c=zt(o).publicKey,u=[this.initRewardInstruction(o,n.wallet,s,c,new I(e.config.id),n.tokenAccount,r.programId,r.mint,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:c},signers:[],instructions:u,instructionTypes:[le.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,r,o,s,a,c,u,l,m,d){let f=ne([fe("rewardIndex"),j("emissionsPerSecondX64"),E("openTime"),E("endTime")]),p=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0}],g=Buffer.alloc(f.span);f.encode({rewardIndex:u,emissionsPerSecondX64:d,openTime:ye(l),endTime:ye(m)},g);let y=Buffer.from([...Ge.setRewardEmissions,...g]);return new Ne({keys:p,programId:e,data:y})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c,u;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===r.mint.toString()&&(a=d,c=new I(t.rewardInfos[d].vault),u=new I(t.rewardInfos[d].mint.address));(a===void 0||c===void 0)&&wr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=zt(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new I(e.config.id),n.tokenAccount,c,u,a,r.openTime,r.endTime,r.emissionsPerSecondX64)];return{address:{rewardVault:c,operationId:l},signers:[],instructions:m,instructionTypes:[le.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,r,o,s,a){let c=ne([fe("rewardIndex")]),u=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:dn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(c.span);c.encode({rewardIndex:a},l);let m=Buffer.from([...Ge.collectReward,...l]);return new Ne({keys:u,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:r}){let[o,s]=[new I(e.programId),new I(e.id)],a,c;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===r.toString()&&(a=l,c=new I(t.rewardInfos[l].vault));(a===void 0||c===void 0)&&wr.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let u=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,c,r,a)];return{address:{rewardVault:c},signers:[],instructions:u,instructionTypes:[le.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:r,wallet:o,nftMint:s,getEphemeralSigners:a}){let c=[],u;if(a)u=new I((await a(1))[0]);else{let y=In.generate();c.push(y),u=y.publicKey}let{publicKey:l}=xe(o,s,se),{publicKey:m}=Ce(n,s),d=Ht(e,u).publicKey,f=xe(o,u,se).publicKey,p=Xt(u).publicKey,g=ae.lockPositionInstructionV2({programId:e,auth:t,payer:r,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:u,lockNftAccount:f,metadataAccount:p,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:f,lockNftMint:u,positionNftAccount:l,metadataAccount:p},instructions:[g],signers:c,instructionTypes:[le.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:r,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:c,lockNftMint:u,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let f=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:r,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:ft,isSigner:!1,isWritable:!1},{pubkey:ui,isSigner:!1,isWritable:!1},{pubkey:At,isSigner:!1,isWritable:!1},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1}],p=ne([qe("withMetadata")]),g=Buffer.alloc(p.span);p.encode({withMetadata:d},g);let y=Buffer.from([...hr,...g]);return new Ne({keys:f,programId:e,data:y})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:r,positionNft:o}){let{publicKey:s}=xe(r,o,se),{publicKey:a}=Ce(n,o),c=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:oi(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:wt.programId,isSigner:!1,isWritable:!1}];return new Ne({keys:c,programId:e,data:Buffer.from(hr)})}static harvestLockPositionInstruction(e){let[t,n]=[new I(e.poolKeys.programId),new I(e.poolKeys.id)],r=L.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=L.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=z(t,n,r),{publicKey:a}=z(t,n,o),{publicKey:c}=xe(e.owner,e.ownerPosition.nftMint,se),{publicKey:u}=Ce(t,e.ownerPosition.nftMint),{publicKey:l}=Ve(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let p=0;p<e.poolKeys.rewardInfos.length;p++)m.push({poolRewardVault:new I(e.poolKeys.rewardInfos[p].vault),ownerRewardVault:e.ownerRewardAccounts[p],rewardMint:new I(e.poolKeys.rewardInfos[p].mint.address)});let d=[...m.map(p=>[{pubkey:p.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:p.rewardMint,isSigner:!1,isWritable:!1}]).flat()],f=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:oi(e.programId,u).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new I(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Vn,isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new I(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ne({keys:f,programId:e.programId,data:Buffer.from(kr)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:r,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:c,positionId:u,poolId:l,protocolPosition:m,vaultA:d,vaultB:f,tickArrayLower:p,tickArrayUpper:g,userVaultA:y,userVaultB:b,mintA:P,mintB:w,rewardAccounts:k,exTickArrayBitmap:A}){let h=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[],...k.map(B=>[{pubkey:B.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:B.rewardMint,isSigner:!1,isWritable:!1}]).flat()],T=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:r,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:b,isSigner:!1,isWritable:!0},{pubkey:se,isSigner:!1,isWritable:!1},{pubkey:Qe,isSigner:!1,isWritable:!1},{pubkey:Vn,isSigner:!1,isWritable:!1},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},...h];return new Ne({keys:T,programId:e,data:Buffer.from(kr)})}};var Ar=class extends qt{constructor(e){super(e)}async getClmmPoolKeys(e){return(await this.scope.api.fetchPoolKeysById({idList:[e]}))[0]}async createPool(e){var w;let{programId:t,owner:n=((w=this.scope.owner)==null?void 0:w.publicKey)||N.default,mint1:r,mint2:o,ammConfig:s,initialPrice:a,startTime:c,computeBudgetConfig:u,forerunCreate:l,getObserveState:m,txVersion:d}=e,f=this.createTxBuilder(),[p,g,y]=new Re(new N(r.address).toBuffer()).gt(new Re(new N(o.address).toBuffer()))?[o,r,new K(1).div(a)]:[r,o,a],b=D.priceToSqrtPriceX64(y,p.decimals,g.decimals),P=await ae.createPoolInstructions({connection:this.scope.connection,programId:t,owner:n,mintA:p,mintB:g,ammConfigId:s.id,initialPriceX64:b,startTime:c,forerunCreate:!m&&l});return f.addInstruction(P),f.addCustomComputeBudget(u),f.versionBuild({txVersion:d,extInfo:{address:X(M({},P.address),{programId:t.toString(),id:P.address.poolId.toString(),mintA:p,mintB:g,openTime:c.toString(),vault:{A:P.address.mintAVault.toString(),B:P.address.mintBVault.toString()},rewardInfos:[],config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]}}),mockPoolInfo:M({type:"Concentrated",rewardDefaultPoolInfos:"Clmm",id:P.address.poolId.toString(),mintA:p,mintB:g,feeRate:s.tradeFeeRate,openTime:c.toString(),programId:t.toString(),price:y.toNumber(),config:{id:s.id.toString(),index:s.index,protocolFeeRate:s.protocolFeeRate,tradeFeeRate:s.tradeFeeRate,tickSpacing:s.tickSpacing,fundFeeRate:s.fundFeeRate,description:s.description,defaultRange:0,defaultRangePoint:[]},burnPercent:0},ir),forerunCreate:l}})}async openPositionFromBase({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",getEphemeralSigners:d,computeBudgetConfig:f,txVersion:p}){this.scope.availability.addConcentratedPosition===!1&&this.logAndCreateError("add position feature disabled in your region"),this.scope.checkOwner();let g=this.createTxBuilder(),y=null,b=null,P=n.useSOLBalance&&e.mintA.address===J.toString(),w=n.useSOLBalance&&e.mintB.address===J.toString(),[k,A]=s==="MintA"?[a,c]:[c,a],{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:P||k.isZero()?{payer:this.scope.ownerPubKey,amount:k}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:P?!1:u,checkCreateATAOwner:l});h&&(y=h),g.addInstruction(T||{});let{account:B,instructionParams:R}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||A.isZero()?{payer:this.scope.ownerPubKey,amount:A}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});B&&(b=B),g.addInstruction(R||{}),(!y||!b)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",{ownerTokenAccountA:y==null?void 0:y.toBase58(),ownerTokenAccountB:b==null?void 0:b.toBase58()});let S=t||await this.getClmmPoolKeys(e.id),C=await ae.openPositionFromBaseInstructions({poolInfo:e,poolKeys:S,ownerInfo:X(M({},n),{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b}),tickLower:r,tickUpper:o,base:s,baseAmount:a,otherAmountMax:c,withMetadata:m,getEphemeralSigners:d});return g.addInstruction(C),g.addCustomComputeBudget(f),g.versionBuild({txVersion:p,extInfo:M({},C.address)})}async openPositionFromLiquidity({poolInfo:e,poolKeys:t,ownerInfo:n,amountMaxA:r,amountMaxB:o,tickLower:s,tickUpper:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,withMetadata:m="create",txVersion:d,computeBudgetConfig:f,getEphemeralSigners:p}){this.scope.availability.createConcentratedPosition===!1&&this.logAndCreateError("open position feature disabled in your region");let g=this.createTxBuilder(),y=null,b=null,P=n.useSOLBalance&&e.mintA.address===J.toBase58(),w=n.useSOLBalance&&e.mintB.address===J.toBase58(),{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),owner:this.scope.ownerPubKey,createInfo:P||r.isZero()?{payer:this.scope.ownerPubKey,amount:r}:void 0,skipCloseAccount:!P,notUseTokenAccount:P,associatedOnly:P?!1:u,checkCreateATAOwner:l});k&&(y=k),g.addInstruction(A||{});let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),owner:this.scope.ownerPubKey,createInfo:w||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!w,notUseTokenAccount:w,associatedOnly:w?!1:u,checkCreateATAOwner:l});h&&(b=h),g.addInstruction(T||{}),(y===void 0||b===void 0)&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let B=t||await this.getClmmPoolKeys(e.id),R=await ae.openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:B,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b},tickLower:s,tickUpper:a,liquidity:c,amountMaxA:r,amountMaxB:o,withMetadata:m,getEphemeralSigners:p});return g.addInstruction(R),g.addCustomComputeBudget(f),g.versionBuild({txVersion:d,extInfo:{address:R.address}})}async increasePositionFromLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,amountMaxA:o,amountMaxB:s,liquidity:a,ownerInfo:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e,f=this.createTxBuilder(),p,g,y=c.useSOLBalance&&t.mintA.address===J.toString(),b=c.useSOLBalance&&t.mintB.address===J.toString(),{account:P,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:y||o.isZero()?{payer:this.scope.ownerPubKey,amount:o}:void 0,skipCloseAccount:!y,associatedOnly:y?!1:u,checkCreateATAOwner:l});P&&(p=P),f.addInstruction(w||{});let{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:b||s.isZero()?{payer:this.scope.ownerPubKey,amount:s}:void 0,notUseTokenAccount:b,skipCloseAccount:!b,associatedOnly:b?!1:u,checkCreateATAOwner:l});k&&(g=k),f.addInstruction(A||{}),!p&&!g&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let h=n!=null?n:await this.getClmmPoolKeys(t.id),T=ae.increasePositionFromLiquidityInstructions({poolInfo:t,poolKeys:h,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:p,tokenAccountB:g},liquidity:a,amountMaxA:o,amountMaxB:s});return f.addInstruction(T),f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:T.address}})}async increasePositionFromBase(e){let{poolInfo:t,ownerPosition:n,base:r,baseAmount:o,otherAmountMax:s,ownerInfo:a,associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=this.createTxBuilder(),f,p,g=a.useSOLBalance&&t.mintA.address===J.toString(),y=a.useSOLBalance&&t.mintB.address===J.toString(),{account:b,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:g||(r==="MintA"?o:s).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?o:s}:void 0,skipCloseAccount:!g,associatedOnly:g?!1:c,checkCreateATAOwner:u});b&&(f=b),d.addInstruction(P||{});let{account:w,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:y||(r==="MintA"?s:o).isZero()?{payer:this.scope.ownerPubKey,amount:r==="MintA"?s:o}:void 0,notUseTokenAccount:y,skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});w&&(p=w),d.addInstruction(k||{}),!f&&!p&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccounts);let A=await this.getClmmPoolKeys(t.id),h=ae.increasePositionFromBaseInstructions({poolInfo:t,poolKeys:A,ownerPosition:n,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:f,tokenAccountB:p},base:r,baseAmount:o,otherAmountMax:s});return d.addInstruction(h),d.addCustomComputeBudget(l),d.versionBuild({txVersion:m,extInfo:{address:h.address}})}async decreaseLiquidity(e){let{poolInfo:t,poolKeys:n,ownerPosition:r,ownerInfo:o,amountMinA:s,amountMinB:a,liquidity:c,associatedOnly:u=!0,checkCreateATAOwner:l=!1,computeBudgetConfig:m,txVersion:d}=e;this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let f=this.createTxBuilder(),p=o.useSOLBalance&&t.mintA.address===J.toString(),g=o.useSOLBalance&&t.mintB.address===J.toString(),y,b,{account:P,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintA.programId,mint:new N(t.mintA.address),notUseTokenAccount:p,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!p,associatedOnly:p?!1:u,checkCreateATAOwner:l});y=P,w&&f.addInstruction(w);let{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:t.mintB.programId,mint:new N(t.mintB.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!g,associatedOnly:g?!1:u,checkCreateATAOwner:l});b=k,A&&f.addInstruction(A);let h=[];for(let S of t.rewardDefaultInfos){let C=o.useSOLBalance&&S.mint.address===J.toString(),V;if(S.mint.address===t.mintA.address)V=y;else if(S.mint.address===t.mintB.address)V=b;else{let{account:Q,instructionParams:re}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(S.mint.programId),mint:new N(S.mint.address),notUseTokenAccount:C,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!C,associatedOnly:C?!1:u,checkCreateATAOwner:l});V=Q,re&&f.addInstruction(re)}h.push(V)}!y&&!b&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",this.scope.account.tokenAccountRawInfos);let T=n!=null?n:await this.getClmmPoolKeys(t.id),B=await ae.decreaseLiquidityInstructions({poolInfo:t,poolKeys:T,ownerPosition:r,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:y,tokenAccountB:b,rewardAccounts:h},liquidity:c,amountMinA:s,amountMinB:a});f.addInstruction({instructions:B.instructions,instructionTypes:[le.ClmmDecreasePosition]});let R=M({},B.address);if(o.closePosition){let S=await ae.closePositionInstructions({poolInfo:t,poolKeys:T,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:r});f.addInstruction({endInstructions:S.instructions,endInstructionTypes:S.instructionTypes}),R=M(M({},R),S.address)}return f.addCustomComputeBudget(m),f.versionBuild({txVersion:d,extInfo:{address:R}})}async lockPosition(e){let{programId:t=Et,authProgramId:n=bn,poolProgramId:r=Ot,ownerPosition:o,payer:s,computeBudgetConfig:a,txVersion:c,getEphemeralSigners:u}=e,l=this.createTxBuilder(),m=await ae.makeLockPositions({programId:t,authProgramId:n,poolProgramId:r,wallet:this.scope.ownerPubKey,payer:s!=null?s:this.scope.ownerPubKey,nftMint:o.nftMint,getEphemeralSigners:u});return l.addInstruction(m),l.addCustomComputeBudget(a),l.versionBuild({txVersion:c,extInfo:m.address})}async harvestLockPosition(e){let{programId:t=Et,authProgramId:n=bn,clmmProgram:r=Ot,poolKeys:o,lockData:s,ownerInfo:a={useSOLBalance:!0},associatedOnly:c=!0,checkCreateATAOwner:u=!1,computeBudgetConfig:l,txVersion:m}=e,d=o||await this.getClmmPoolKeys(s.poolId.toString()),f=this.createTxBuilder(),p=await this.scope.connection.getAccountInfo(s.positionId);p||this.logger.logWithError("position not found",s.positionId);let g=Qt.decode(p.data),y=a.useSOLBalance&&d.mintA.address===J.toString(),b=a.useSOLBalance&&d.mintB.address===J.toString(),P,w,{account:k,instructionParams:A}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintA.programId,mint:new N(d.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,associatedOnly:y?!1:c,checkCreateATAOwner:u});P=k,A&&f.addInstruction(A);let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:d.mintB.programId,mint:new N(d.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!b,associatedOnly:b?!1:c,checkCreateATAOwner:u});w=h,T&&f.addInstruction(T);let B={},R=[];for(let Fe of d.rewardInfos){let Sn=a.useSOLBalance&&Fe.mint.address===J.toString(),$t=B[Fe.mint.address];if(!$t){let{account:xr,instructionParams:li}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(Fe.mint.programId),mint:new N(Fe.mint.address),notUseTokenAccount:Sn,owner:this.scope.ownerPubKey,skipCloseAccount:!Sn,createInfo:{payer:this.scope.ownerPubKey,amount:0},associatedOnly:Sn?!1:c});$t=xr,li&&f.addInstruction(li)}B[Fe.mint.address]=$t,R.push($t)}let S=Ht(t,s.lockNftMint).publicKey,C=xe(this.scope.ownerPubKey,s.lockNftMint,Jt).publicKey,V=L.getTickArrayStartIndexByTick(g.tickLower,d.config.tickSpacing),Q=L.getTickArrayStartIndexByTick(g.tickUpper,d.config.tickSpacing),{publicKey:re}=z(new N(d.programId),s.poolId,V),{publicKey:$}=z(new N(d.programId),s.poolId,Q),{publicKey:H}=Ve(new N(d.programId),s.poolId,g.tickLower,g.tickUpper),mt=[];for(let Fe=0;Fe<d.rewardInfos.length;Fe++)mt.push({poolRewardVault:new N(d.rewardInfos[Fe].vault),ownerRewardVault:R[Fe],rewardMint:new N(d.rewardInfos[Fe].mint.address)});let Tr=await ae.harvestLockPositionInstructionV2({programId:t,auth:n,lockPositionId:S,clmmProgram:r,lockOwner:this.scope.ownerPubKey,lockNftMint:s.lockNftMint,lockNftAccount:C,positionNftAccount:s.nftAccount,positionId:s.positionId,poolId:s.poolId,protocolPosition:H,vaultA:new N(d.vault.A),vaultB:new N(d.vault.B),tickArrayLower:re,tickArrayUpper:$,userVaultA:P,userVaultB:w,mintA:new N(d.mintA.address),mintB:new N(d.mintB.address),rewardAccounts:mt,exTickArrayBitmap:Ke(r,s.poolId).publicKey});return f.addInstruction({instructions:[Tr],instructionTypes:[le.ClmmHarvestLockPosition]}),f.addCustomComputeBudget(l),f.versionBuild({txVersion:m})}async closePosition({poolInfo:e,poolKeys:t,ownerPosition:n,txVersion:r}){this.scope.availability.removeConcentratedPosition===!1&&this.logAndCreateError("remove position feature disabled in your region");let o=this.createTxBuilder(),s=t!=null?t:await this.getClmmPoolKeys(e.id),a=ae.closePositionInstructions({poolInfo:e,poolKeys:s,ownerInfo:{wallet:this.scope.ownerPubKey},ownerPosition:n});return o.addInstruction(a).versionBuild({txVersion:r,extInfo:{address:a.address}})}async initReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.address.toString()===J.toString(),l=n.perSecond.mul(n.endTime-n.openTime),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(n.mint.address),mint:new N(n.mint.address),notUseTokenAccount:!!u,skipCloseAccount:!u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Re(new K(l.toFixed(0)).gte(l)?l.toFixed(0):l.add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});d&&c.addInstruction(d),m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let f=await this.getClmmPoolKeys(e.id),p=ae.initRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardInfo:{programId:new N(n.mint.programId),mint:new N(n.mint.address),openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:_.decimalToX64(n.perSecond)}});return c.addInstruction(p),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:p.address}})}async initRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){for(let m of r)m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let u=this.createTxBuilder(),l={};for(let m of r){let d=n.useSOLBalance&&m.mint.address===J.toString(),f=m.perSecond.mul(m.endTime-m.openTime),{account:p,instructionParams:g}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(m.mint.programId),mint:new N(m.mint.address),notUseTokenAccount:!!d,skipCloseAccount:!d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Re(new K(f.toFixed(0)).gte(f)?f.toFixed(0):f.add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});g&&u.addInstruction(g),p||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let y=t!=null?t:await this.getClmmPoolKeys(e.id),b=ae.initRewardInstructions({poolInfo:e,poolKeys:y,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:p},rewardInfo:{programId:new N(m.mint.programId),mint:new N(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:_.decimalToX64(m.perSecond)}});l=M(M({},l),b.address),u.addInstruction(b)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async setReward({poolInfo:e,ownerInfo:t,rewardInfo:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1,computeBudgetConfig:s,txVersion:a}){n.endTime<=n.openTime&&this.logAndCreateError("reward time error","rewardInfo",n);let c=this.createTxBuilder(),u=t.useSOLBalance&&n.mint.equals(J),{account:l,instructionParams:m}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:n.programId,mint:n.mint,notUseTokenAccount:u,owner:this.scope.ownerPubKey,createInfo:u?{payer:t.feePayer||this.scope.ownerPubKey,amount:new Re(new K(n.perSecond.sub(n.endTime-n.openTime).toFixed(0)).gte(n.perSecond.sub(n.endTime-n.openTime))?n.perSecond.sub(n.endTime-n.openTime).toFixed(0):n.perSecond.sub(n.endTime-n.openTime).add(1).toFixed(0))}:void 0,associatedOnly:u?!1:r,checkCreateATAOwner:o});m&&c.addInstruction(m),l||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let d=await this.getClmmPoolKeys(e.id),f=ae.setRewardInstructions({poolInfo:e,poolKeys:d,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:l},rewardInfo:{mint:n.mint,openTime:n.openTime,endTime:n.endTime,emissionsPerSecondX64:_.decimalToX64(n.perSecond)}});return c.addInstruction(f),c.addCustomComputeBudget(s),c.versionBuild({txVersion:a,extInfo:{address:f.address}})}async setRewards({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfos:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,computeBudgetConfig:a,txVersion:c}){let u=this.createTxBuilder(),l={};for(let m of r){m.endTime<=m.openTime&&this.logAndCreateError("reward time error","rewardInfo",m);let d=n.useSOLBalance&&m.mint.address===J.toString(),{account:f,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(m.mint.programId),mint:new N(m.mint.address),notUseTokenAccount:d,owner:this.scope.ownerPubKey,createInfo:d?{payer:n.feePayer||this.scope.ownerPubKey,amount:new Re(new K(m.perSecond.sub(m.endTime-m.openTime).toFixed(0)).gte(m.perSecond.sub(m.endTime-m.openTime))?m.perSecond.sub(m.endTime-m.openTime).toFixed(0):m.perSecond.sub(m.endTime-m.openTime).add(1).toFixed(0))}:void 0,associatedOnly:d?!1:o,checkCreateATAOwner:s});p&&u.addInstruction(p),f||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let g=t!=null?t:await this.getClmmPoolKeys(e.id),y=ae.setRewardInstructions({poolInfo:e,poolKeys:g,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:f},rewardInfo:{mint:new N(m.mint.address),openTime:m.openTime,endTime:m.endTime,emissionsPerSecondX64:_.decimalToX64(m.perSecond)}});u.addInstruction(y),l=M(M({},l),y.address)}return u.addCustomComputeBudget(a),u.versionBuild({txVersion:c,extInfo:{address:l}})}async collectReward({poolInfo:e,ownerInfo:t,rewardMint:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=e.rewardDefaultInfos.find(f=>f.mint.address===n.toString());s||this.logAndCreateError("reward mint error","not found reward mint",n);let a=this.createTxBuilder(),c=t.useSOLBalance&&n.equals(J),{account:u,instructionParams:l}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(s.mint.programId),mint:n,notUseTokenAccount:c,owner:this.scope.ownerPubKey,skipCloseAccount:!c,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:c?!1:r,checkCreateATAOwner:o});l&&a.addInstruction(l),u||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos);let m=await this.getClmmPoolKeys(e.id),d=ae.collectRewardInstructions({poolInfo:e,poolKeys:m,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:u},rewardMint:n});return a.addInstruction(d),a.build({address:d.address})}async collectRewards({poolInfo:e,ownerInfo:t,rewardMints:n,associatedOnly:r=!0,checkCreateATAOwner:o=!1}){let s=this.createTxBuilder(),a={};for(let c of n){let u=e.rewardDefaultInfos.find(g=>g.mint.address===c.toString());if(!u){this.logAndCreateError("reward mint error","not found reward mint",c);continue}let l=t.useSOLBalance&&c.equals(J),{account:m,instructionParams:d}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(u.mint.programId),mint:c,notUseTokenAccount:l,owner:this.scope.ownerPubKey,skipCloseAccount:!l,createInfo:{payer:t.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:l?!1:r,checkCreateATAOwner:o});m||this.logAndCreateError("no money","ownerRewardAccount",this.scope.account.tokenAccountRawInfos),d&&s.addInstruction(d);let f=await this.getClmmPoolKeys(e.id),p=ae.collectRewardInstructions({poolInfo:e,poolKeys:f,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccount:m},rewardMint:c});s.addInstruction(p),a=M(M({},a),p.address)}return s.build({address:a})}async swap({poolInfo:e,poolKeys:t,inputMint:n,amountIn:r,amountOutMin:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let p=this.createTxBuilder(),g=n.toString()===e.mintA.address,y=c.useSOLBalance&&e.mintA.address===J.toBase58(),b=c.useSOLBalance&&e.mintB.address===J.toBase58(),P;!s||s.equals(new K(0))?P=g?Ze.add(new Re(1)):je.sub(new Re(1)):P=D.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?r:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=h,T&&p.addInstruction(T)}let k;if(!k){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?0:r}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});k=h,T&&p.addInstruction(T)}(!w||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:k,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let A=t!=null?t:await this.getClmmPoolKeys(e.id);return p.addInstruction(ae.makeSwapBaseInInstructions({poolInfo:e,poolKeys:A,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:k},inputMint:new N(n),amountIn:r,amountOutMin:o,sqrtPriceLimitX64:P,remainingAccounts:u})),p.addCustomComputeBudget(f),p.versionBuild({txVersion:d})}async swapBaseOut({poolInfo:e,poolKeys:t,outputMint:n,amountOut:r,amountInMax:o,priceLimit:s,observationId:a,ownerInfo:c,remainingAccounts:u,associatedOnly:l=!0,checkCreateATAOwner:m=!1,txVersion:d,computeBudgetConfig:f}){let p=this.createTxBuilder(),g=n.toString()===e.mintB.address,y=c.useSOLBalance&&e.mintA.address===J.toBase58(),b=c.useSOLBalance&&e.mintB.address===J.toBase58(),P;!s||s.equals(new K(0))?P=n.toString()===e.mintB.address?Ze.add(new Re(1)):je.sub(new Re(1)):P=D.priceToSqrtPriceX64(s,e.mintA.decimals,e.mintB.decimals);let w;if(!w){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintA.programId,mint:new N(e.mintA.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:y||!g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?o:0}:void 0,associatedOnly:y?!1:l,checkCreateATAOwner:m});w=h,T&&p.addInstruction(T)}let k;if(!k){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:e.mintB.programId,mint:new N(e.mintB.address),notUseTokenAccount:b,owner:this.scope.ownerPubKey,skipCloseAccount:!b,createInfo:b||g?{payer:c.feePayer||this.scope.ownerPubKey,amount:g?0:o}:void 0,associatedOnly:b?!1:l,checkCreateATAOwner:m});k=h,T&&p.addInstruction(T)}(!w||!k)&&this.logAndCreateError("user do not have token account",{tokenA:e.mintA.symbol||e.mintA.address,tokenB:e.mintB.symbol||e.mintB.address,ownerTokenAccountA:w,ownerTokenAccountB:k,mintAUseSOLBalance:y,mintBUseSOLBalance:b,associatedOnly:l});let A=t!=null?t:await this.getClmmPoolKeys(e.id);return p.addInstruction(ae.makeSwapBaseOutInstructions({poolInfo:e,poolKeys:A,observationId:a,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:w,tokenAccountB:k},outputMint:new N(n),amountOut:r,amountInMax:o,sqrtPriceLimitX64:P,remainingAccounts:u})),p.addCustomComputeBudget(f),p.versionBuild({txVersion:d})}async harvestAllRewards({allPoolInfo:e,allPositions:t,lockInfo:n,ownerInfo:r,associatedOnly:o=!0,checkCreateATAOwner:s=!1,programId:a,txVersion:c,computeBudgetConfig:u}){var d;let l={};for(let f of this.scope.account.tokenAccountRawInfos)o?xe(this.scope.ownerPubKey,f.accountInfo.mint,a).publicKey.equals(f.pubkey)&&(l[f.accountInfo.mint.toString()]=f.pubkey):l[f.accountInfo.mint.toString()]=f.pubkey;let m=this.createTxBuilder();for(let f of Object.values(e)){if(t[f.id]===void 0||!t[f.id].find(h=>!h.liquidity.isZero()||h.rewardInfos.find(T=>!T.rewardAmountOwed.isZero())))continue;let p=f,g=r.useSOLBalance&&p.mintA.address===J.toString(),y=r.useSOLBalance&&p.mintB.address===J.toString(),b=l[p.mintA.address];if(!b){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintA.programId,mint:new N(p.mintA.address),notUseTokenAccount:g,owner:this.scope.ownerPubKey,skipCloseAccount:!g,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:g?!1:o,checkCreateATAOwner:s});b=h,T&&m.addInstruction(T)}let P=l[p.mintB.address];if(!P){let{account:h,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:p.mintB.programId,mint:new N(p.mintB.address),notUseTokenAccount:y,owner:this.scope.ownerPubKey,skipCloseAccount:!y,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:y?!1:o,checkCreateATAOwner:s});P=h,T&&m.addInstruction(T)}l[p.mintA.address]=b,l[p.mintB.address]=P;let w=[];for(let h of p.rewardDefaultInfos){let T=r.useSOLBalance&&h.mint.address===J.toString(),B=l[h.mint.address];if(!B){let{account:R,instructionParams:S}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:new N(h.mint.programId),mint:new N(h.mint.address),notUseTokenAccount:T,owner:this.scope.ownerPubKey,skipCloseAccount:!T,createInfo:{payer:r.feePayer||this.scope.ownerPubKey,amount:0},associatedOnly:T?!1:o});B=R,S&&m.addInstruction(S)}l[h.mint.address]=B,w.push(B)}let k=await this.getClmmPoolKeys(p.id),A=[];for(let h=0;h<k.rewardInfos.length;h++)A.push({poolRewardVault:new N(k.rewardInfos[h].vault),ownerRewardVault:w[h],rewardMint:new N(k.rewardInfos[h].mint.address)});for(let h of t[f.id]){let T=(d=n==null?void 0:n[f.id])==null?void 0:d[h.nftMint.toBase58()];if(T){let B=xe(this.scope.ownerPubKey,T.lockNftMint,Jt).publicKey,R=L.getTickArrayStartIndexByTick(h.tickLower,k.config.tickSpacing),S=L.getTickArrayStartIndexByTick(h.tickUpper,k.config.tickSpacing),{publicKey:C}=z(new N(k.programId),T.poolId,R),{publicKey:V}=z(new N(k.programId),T.poolId,S),{publicKey:Q}=Ve(new N(k.programId),T.poolId,h.tickLower,h.tickUpper),re=Ht(Et,T.lockNftMint).publicKey,$=ae.harvestLockPositionInstructionV2({programId:Et,auth:bn,lockPositionId:re,clmmProgram:Ot,lockOwner:this.scope.ownerPubKey,lockNftMint:T.lockNftMint,lockNftAccount:B,positionNftAccount:T.nftAccount,positionId:T.positionId,poolId:T.poolId,protocolPosition:Q,vaultA:new N(k.vault.A),vaultB:new N(k.vault.B),tickArrayLower:C,tickArrayUpper:V,userVaultA:b,userVaultB:P,mintA:new N(k.mintA.address),mintB:new N(k.mintB.address),rewardAccounts:A,exTickArrayBitmap:Ke(Ot,T.poolId).publicKey});m.addInstruction({instructions:[$],instructionTypes:[le.ClmmHarvestLockPosition],lookupTableAddress:k.lookupTableAccount?[k.lookupTableAccount]:[]})}else{let B=ae.decreaseLiquidityInstructions({poolInfo:p,poolKeys:k,ownerPosition:h,ownerInfo:{wallet:this.scope.ownerPubKey,tokenAccountA:b,tokenAccountB:P,rewardAccounts:w},liquidity:new Re(0),amountMinA:new Re(0),amountMinB:new Re(0)});m.addInstruction(B)}}}return c===0?m.sizeCheckBuildV0({computeBudgetConfig:u}):m.sizeCheckBuild({computeBudgetConfig:u})}async getWhiteListMint({programId:e}){let t=await this.scope.connection.getAccountInfo(zt(e).publicKey);return t?br.decode(t.data).whitelistMints.filter(r=>!r.equals(N.default)):[]}async getOwnerPositionInfo({programId:e}){await this.scope.account.fetchWalletTokenAccounts();let n=this.scope.account.tokenAccountRawInfos.filter(s=>s.accountInfo.amount.eq(new Re(1))).map(s=>Ce(new N(e),s.accountInfo.mint).publicKey),r=await this.scope.connection.getMultipleAccountsInfo(n),o=[];return r.forEach(s=>{if(!s)return;let a=Qt.decode(s.data);o.push(a)}),o}async getRpcClmmPoolInfo({poolId:e}){return(await this.getRpcClmmPoolInfos({poolIds:[e]}))[String(e)]}async getRpcClmmPoolInfos({poolIds:e,config:t}){let n=await at(this.scope.connection,e.map(o=>({pubkey:new N(o)})),t),r={};for(let o=0;o<e.length;o++){let s=n[o];if(s===null||!s.accountInfo)throw Error("fetch pool info error: "+String(e[o]));let a=Bn.decode(s.accountInfo.data),c=D.sqrtPriceX64ToPrice(a.sqrtPriceX64,a.mintDecimalsA,a.mintDecimalsB).toNumber();r[String(e[o])]=X(M({},a),{currentPrice:c,programId:s.accountInfo.owner})}return r}async getComputeClmmPoolInfos({clmmPoolsRpcInfo:e,mintInfos:t}){let n=new Set(Object.keys(e).map(c=>e[c].ammConfig.toBase58())),r=await at(this.scope.connection,Array.from(n).map(c=>({pubkey:new N(c)}))),o={};r.forEach(c=>{!c.accountInfo||(o[c.pubkey.toBase58()]=pr.decode(c.accountInfo.data))});let s=await pe.fetchComputeMultipleClmmInfo({connection:this.scope.connection,rpcDataMap:e,poolList:Object.keys(e).map(c=>{var m,d,f,p;let[u,l]=[e[c].mintA.toBase58(),e[c].mintB.toBase58()];return{id:c,programId:e[c].programId.toBase58(),mintA:kn({address:u,decimals:e[c].mintDecimalsA,programId:t[u].programId.toBase58()||Jt.toBase58(),extensions:{feeConfig:(m=t[u])!=null&&m.feeConfig?Yn((d=t[u])==null?void 0:d.feeConfig):void 0}}),mintB:kn({address:l,decimals:e[c].mintDecimalsB,programId:t[l].programId.toBase58()||Jt.toBase58(),extensions:{feeConfig:(f=t[l])!=null&&f.feeConfig?Yn((p=t[l])==null?void 0:p.feeConfig):void 0}}),price:e[c].currentPrice,config:X(M({},o[e[c].ammConfig.toBase58()]),{id:e[c].ammConfig.toBase58(),fundFeeRate:0,description:"",defaultRange:0,defaultRangePoint:[]})}})}),a=await pe.fetchMultiplePoolTickArrays({connection:this.scope.connection,poolKeys:Object.values(s)});return{computeClmmPoolInfo:s,computePoolTickData:a}}async getPoolInfoFromRpc(e){var l;let t=await this.getRpcClmmPoolInfo({poolId:e}),n=new Set([t.mintA.toBase58(),t.mintB.toBase58()]),r=await Li({connection:this.scope.connection,mints:Array.from(n).map(m=>new N(m))}),{computeClmmPoolInfo:o,computePoolTickData:s}=await this.scope.clmm.getComputeClmmPoolInfos({clmmPoolsRpcInfo:{[e]:t},mintInfos:r}),a=await at(this.scope.connection,[{pubkey:t.vaultA},{pubkey:t.vaultB}]),c=dr(o[e]);if(!a[0].accountInfo||!a[1].accountInfo)throw new Error("pool vault data not found");c.mintAmountA=Number(Pr.decode(a[0].accountInfo.data).amount.toString()),c.mintAmountB=Number(Pr.decode((l=a[1].accountInfo)==null?void 0:l.data).amount.toString());let u=X(M({},o[e]),{id:e,programId:t.programId.toBase58(),openTime:t.startTime.toString(),vault:{A:t.vaultA.toBase58(),B:t.vaultB.toBase58()},config:c.config,rewardInfos:o[e].rewardInfos.filter(m=>!m.tokenVault.equals(N.default)).map(m=>({mint:kn({address:m.tokenMint.toBase58(),programId:Jt.toBase58(),decimals:10}),vault:m.tokenVault.toBase58()}))});return{poolInfo:c,poolKeys:u,computePoolInfo:o[e],tickData:s}}};export{Ar as Clmm};
//# sourceMappingURL=clmm.mjs.map