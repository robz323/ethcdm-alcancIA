var dn=Object.defineProperty,gn=Object.defineProperties;var hn=Object.getOwnPropertyDescriptors;var Me=Object.getOwnPropertySymbols;var St=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var kt=(e,t,n)=>t in e?dn(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,W=(e,t)=>{for(var n in t||(t={}))St.call(t,n)&&kt(e,n,t[n]);if(Me)for(var n of Me(t))Bt.call(t,n)&&kt(e,n,t[n]);return e},Z=(e,t)=>gn(e,hn(t));var Ee=(e,t)=>{var n={};for(var r in e)St.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(e!=null&&Me)for(var r of Me(e))t.indexOf(r)<0&&Bt.call(e,r)&&(n[r]=e[r]);return n};import{PublicKey as Ne}from"@solana/web3.js";import mn from"bn.js";import{PublicKey as C}from"@solana/web3.js";var ni=new C("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),ri=new C("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),ii=new C("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),oi=new C("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),si=new C("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ai=new C("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),ui=new C("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),ci=new C("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),li=new C("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),fi=new C("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),mi=new C("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),pi=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),di=new C("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),gi=new C("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),hi=new C("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),bn=new C("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),yn=new C("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),wn=new C("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Tn=new C("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),bi=new C("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),yi=new C("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),wi=new C("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),xn=new C("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Pn=new C("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),An=new C("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Ti=new C("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),kn=new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),xi=new C("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Sn=new C("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix"),he={IDO_PROGRAM_ID_V1:bn,IDO_PROGRAM_ID_V2:yn,IDO_PROGRAM_ID_V3:wn,IDO_PROGRAM_ID_V4:Tn};var Pi={SERUM_MARKET:C.default,OPENBOOK_MARKET:new C("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:C.default,FarmV3:new C("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new C("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new C("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new C("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new C("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new C("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new C("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new C("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new C("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:xn,CREATE_CPMM_POOL_AUTH:Pn,CREATE_CPMM_POOL_FEE_ACC:An,FEE_DESTINATION_ID:new C("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:kn,LCOK_CPMM_AUTH:Sn};import{PublicKey as O,SystemProgram as Ct,SYSVAR_RENT_PUBKEY as Bn}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Cn}from"@solana/spl-token";function Je({pubkey:e,isSigner:t=!1,isWritable:n=!0}){return{pubkey:e,isWritable:n,isSigner:t}}var Ci=[Je({pubkey:Cn,isWritable:!1}),Je({pubkey:Ct.programId,isWritable:!1}),Je({pubkey:Bn,isWritable:!1})];function Lt({publicKey:e,transformSol:t}){let n=$e(e.toString());if(n instanceof O)return t&&n.equals(be)?fe:n;if(t&&n.toString()===be.toBase58())return fe;if(typeof n=="string"){if(n===O.default.toBase58())return O.default;try{return new O(n)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function $e(e){try{return new O(e)}catch{return e}}var Li=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ii=new O("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Ln=new O("SysvarRent111111111111111111111111111111111"),It=new O("SysvarC1ock11111111111111111111111111111111"),Ni=new O("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),Mi=new O("Sysvar1nstructions1111111111111111111111111"),In=Ct.programId,Ei=new O("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),Ri=new O("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),Di=new O("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),_i=new O("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),Oi=new O("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),vi=new O("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),Fi=new O("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),Vi=new O("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),Ki=new O("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),Wi=new O("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),Ui=new O("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),fe=new O("So11111111111111111111111111111111111111112"),be=O.default;import{PublicKey as jr}from"@solana/web3.js";import zr from"bn.js";import qr from"big.js";import Ye from"bn.js";import ne from"bn.js";var me=9e15,ae=1e9,et="0123456789abcdef",De="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",_e="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",tt={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-me,maxE:me,crypto:!1},Rt,$,B=!0,ve="[DecimalError] ",se=ve+"Invalid argument: ",Dt=ve+"Precision limit exceeded",_t=ve+"crypto unavailable",Ot="[object Decimal]",G=Math.floor,K=Math.pow,Nn=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,Mn=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,En=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,vt=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Q=1e7,k=7,Rn=9007199254740991,Dn=De.length-1,nt=_e.length-1,d={toStringTag:Ot};d.absoluteValue=d.abs=function(){var e=new this.constructor(this);return e.s<0&&(e.s=1),x(e)};d.ceil=function(){return x(new this.constructor(this),this.e+1,2)};d.clampedTo=d.clamp=function(e,t){var n,r=this,i=r.constructor;if(e=new i(e),t=new i(t),!e.s||!t.s)return new i(NaN);if(e.gt(t))throw Error(se+t);return n=r.cmp(e),n<0?e:r.cmp(t)>0?t:new i(r)};d.comparedTo=d.cmp=function(e){var t,n,r,i,o=this,s=o.d,a=(e=new o.constructor(e)).d,u=o.s,c=e.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==e.e)return o.e>e.e^u<0?1:-1;for(r=s.length,i=a.length,t=0,n=r<i?r:i;t<n;++t)if(s[t]!==a[t])return s[t]>a[t]^u<0?1:-1;return r===i?0:r>i^u<0?1:-1};d.cosine=d.cos=function(){var e,t,n=this,r=n.constructor;return n.d?n.d[0]?(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+k,r.rounding=1,n=_n(r,Ut(r,n)),r.precision=e,r.rounding=t,x($==2||$==3?n.neg():n,e,t,!0)):new r(1):new r(NaN)};d.cubeRoot=d.cbrt=function(){var e,t,n,r,i,o,s,a,u,c,l=this,f=l.constructor;if(!l.isFinite()||l.isZero())return new f(l);for(B=!1,o=l.s*K(l.s*l,1/3),!o||Math.abs(o)==1/0?(n=q(l.d),e=l.e,(o=(e-n.length+1)%3)&&(n+=o==1||o==-2?"0":"00"),o=K(n,1/3),e=G((e+1)/3)-(e%3==(e<0?-1:2)),o==1/0?n="5e"+e:(n=o.toExponential(),n=n.slice(0,n.indexOf("e")+1)+e),r=new f(n),r.s=l.s):r=new f(o.toString()),s=(e=f.precision)+3;;)if(a=r,u=a.times(a).times(a),c=u.plus(l),r=R(c.plus(l).times(a),c.plus(u),s+2,1),q(a.d).slice(0,s)===(n=q(r.d)).slice(0,s))if(n=n.slice(s-3,s+1),n=="9999"||!i&&n=="4999"){if(!i&&(x(a,e+1,0),a.times(a).times(a).eq(l))){r=a;break}s+=4,i=1}else{(!+n||!+n.slice(1)&&n.charAt(0)=="5")&&(x(r,e+1,1),t=!r.times(r).times(r).eq(l));break}return B=!0,x(r,e,f.rounding,t)};d.decimalPlaces=d.dp=function(){var e,t=this.d,n=NaN;if(t){if(e=t.length-1,n=(e-G(this.e/k))*k,e=t[e],e)for(;e%10==0;e/=10)n--;n<0&&(n=0)}return n};d.dividedBy=d.div=function(e){return R(this,new this.constructor(e))};d.dividedToIntegerBy=d.divToInt=function(e){var t=this,n=t.constructor;return x(R(t,new n(e),0,1,1),n.precision,n.rounding)};d.equals=d.eq=function(e){return this.cmp(e)===0};d.floor=function(){return x(new this.constructor(this),this.e+1,3)};d.greaterThan=d.gt=function(e){return this.cmp(e)>0};d.greaterThanOrEqualTo=d.gte=function(e){var t=this.cmp(e);return t==1||t===0};d.hyperbolicCosine=d.cosh=function(){var e,t,n,r,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;n=s.precision,r=s.rounding,s.precision=n+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(e=Math.ceil(i/3),t=(1/Ve(4,e)).toString()):(e=16,t="2.3283064365386962890625e-10"),o=pe(s,1,o.times(t),new s(1),!0);for(var u,c=e,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return x(o,s.precision=n,s.rounding=r,!0)};d.hyperbolicSine=d.sinh=function(){var e,t,n,r,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(t=o.precision,n=o.rounding,o.precision=t+Math.max(i.e,i.sd())+4,o.rounding=1,r=i.d.length,r<3)i=pe(o,2,i,i,!0);else{e=1.4*Math.sqrt(r),e=e>16?16:e|0,i=i.times(1/Ve(5,e)),i=pe(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);e--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=t,o.rounding=n,x(i,t,n,!0)};d.hyperbolicTangent=d.tanh=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+7,r.rounding=1,R(n.sinh(),n.cosh(),r.precision=e,r.rounding=t)):new r(n.s)};d.inverseCosine=d.acos=function(){var e,t=this,n=t.constructor,r=t.abs().cmp(1),i=n.precision,o=n.rounding;return r!==-1?r===0?t.isNeg()?Y(n,i,o):new n(0):new n(NaN):t.isZero()?Y(n,i+4,o).times(.5):(n.precision=i+6,n.rounding=1,t=t.asin(),e=Y(n,i+4,o).times(.5),n.precision=i,n.rounding=o,e.minus(t))};d.inverseHyperbolicCosine=d.acosh=function(){var e,t,n=this,r=n.constructor;return n.lte(1)?new r(n.eq(1)?0:NaN):n.isFinite()?(e=r.precision,t=r.rounding,r.precision=e+Math.max(Math.abs(n.e),n.sd())+4,r.rounding=1,B=!1,n=n.times(n).minus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln()):new r(n)};d.inverseHyperbolicSine=d.asinh=function(){var e,t,n=this,r=n.constructor;return!n.isFinite()||n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+2*Math.max(Math.abs(n.e),n.sd())+6,r.rounding=1,B=!1,n=n.times(n).plus(1).sqrt().plus(n),B=!0,r.precision=e,r.rounding=t,n.ln())};d.inverseHyperbolicTangent=d.atanh=function(){var e,t,n,r,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(e=o.precision,t=o.rounding,r=i.sd(),Math.max(r,e)<2*-i.e-1?x(new o(i),e,t,!0):(o.precision=n=r-i.e,i=R(i.plus(1),new o(1).minus(i),n+e,1),o.precision=e+4,o.rounding=1,i=i.ln(),o.precision=e,o.rounding=t,i.times(.5))):new o(NaN)};d.inverseSine=d.asin=function(){var e,t,n,r,i=this,o=i.constructor;return i.isZero()?new o(i):(t=i.abs().cmp(1),n=o.precision,r=o.rounding,t!==-1?t===0?(e=Y(o,n+4,r).times(.5),e.s=i.s,e):new o(NaN):(o.precision=n+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=n,o.rounding=r,i.times(2)))};d.inverseTangent=d.atan=function(){var e,t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&f+4<=nt)return s=Y(l,f+4,m).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(f+4<=nt)return s=Y(l,f+4,m).times(.5),s.s=c.s,s}for(l.precision=a=f+10,l.rounding=1,n=Math.min(28,a/k+2|0),e=n;e;--e)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(B=!1,t=Math.ceil(a/k),r=1,u=c.times(c),s=new l(c),i=c;e!==-1;)if(i=i.times(u),o=s.minus(i.div(r+=2)),i=i.times(u),s=o.plus(i.div(r+=2)),s.d[t]!==void 0)for(e=t;s.d[e]===o.d[e]&&e--;);return n&&(s=s.times(2<<n-1)),B=!0,x(s,l.precision=f,l.rounding=m,!0)};d.isFinite=function(){return!!this.d};d.isInteger=d.isInt=function(){return!!this.d&&G(this.e/k)>this.d.length-2};d.isNaN=function(){return!this.s};d.isNegative=d.isNeg=function(){return this.s<0};d.isPositive=d.isPos=function(){return this.s>0};d.isZero=function(){return!!this.d&&this.d[0]===0};d.lessThan=d.lt=function(e){return this.cmp(e)<0};d.lessThanOrEqualTo=d.lte=function(e){return this.cmp(e)<1};d.logarithm=d.log=function(e){var t,n,r,i,o,s,a,u,c=this,l=c.constructor,f=l.precision,m=l.rounding,p=5;if(e==null)e=new l(10),t=!0;else{if(e=new l(e),n=e.d,e.s<0||!n||!n[0]||e.eq(1))return new l(NaN);t=e.eq(10)}if(n=c.d,c.s<0||!n||!n[0]||c.eq(1))return new l(n&&!n[0]?-1/0:c.s!=1?NaN:n?0:1/0);if(t)if(n.length>1)o=!0;else{for(i=n[0];i%10===0;)i/=10;o=i!==1}if(B=!1,a=f+p,s=oe(c,a),r=t?Oe(l,a+10):oe(e,a),u=R(s,r,a,1),ye(u.d,i=f,m))do if(a+=10,s=oe(c,a),r=t?Oe(l,a+10):oe(e,a),u=R(s,r,a,1),!o){+q(u.d).slice(i+1,i+15)+1==1e14&&(u=x(u,f+1,0));break}while(ye(u.d,i+=10,m));return B=!0,x(u,f,m)};d.minus=d.sub=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,p=this,y=p.constructor;if(e=new y(e),!p.d||!e.d)return!p.s||!e.s?e=new y(NaN):p.d?e.s=-e.s:e=new y(e.d||p.s!==e.s?p:NaN),e;if(p.s!=e.s)return e.s=-e.s,p.plus(e);if(c=p.d,m=e.d,a=y.precision,u=y.rounding,!c[0]||!m[0]){if(m[0])e.s=-e.s;else if(c[0])e=new y(p);else return new y(u===3?-0:0);return B?x(e,a,u):e}if(n=G(e.e/k),l=G(p.e/k),c=c.slice(),o=l-n,o){for(f=o<0,f?(t=c,o=-o,s=m.length):(t=m,n=l,s=c.length),r=Math.max(Math.ceil(a/k),s)+2,o>r&&(o=r,t.length=1),t.reverse(),r=o;r--;)t.push(0);t.reverse()}else{for(r=c.length,s=m.length,f=r<s,f&&(s=r),r=0;r<s;r++)if(c[r]!=m[r]){f=c[r]<m[r];break}o=0}for(f&&(t=c,c=m,m=t,e.s=-e.s),s=c.length,r=m.length-s;r>0;--r)c[s++]=0;for(r=m.length;r>o;){if(c[--r]<m[r]){for(i=r;i&&c[--i]===0;)c[i]=Q-1;--c[i],c[r]+=Q}c[r]-=m[r]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--n;return c[0]?(e.d=c,e.e=Fe(c,n),B?x(e,a,u):e):new y(u===3?-0:0)};d.modulo=d.mod=function(e){var t,n=this,r=n.constructor;return e=new r(e),!n.d||!e.s||e.d&&!e.d[0]?new r(NaN):!e.d||n.d&&!n.d[0]?x(new r(n),r.precision,r.rounding):(B=!1,r.modulo==9?(t=R(n,e.abs(),0,3,1),t.s*=e.s):t=R(n,e,0,r.modulo,1),t=t.times(e),B=!0,n.minus(t))};d.naturalExponential=d.exp=function(){return rt(this)};d.naturalLogarithm=d.ln=function(){return oe(this)};d.negated=d.neg=function(){var e=new this.constructor(this);return e.s=-e.s,x(e)};d.plus=d.add=function(e){var t,n,r,i,o,s,a,u,c,l,f=this,m=f.constructor;if(e=new m(e),!f.d||!e.d)return!f.s||!e.s?e=new m(NaN):f.d||(e=new m(e.d||f.s===e.s?f:NaN)),e;if(f.s!=e.s)return e.s=-e.s,f.minus(e);if(c=f.d,l=e.d,a=m.precision,u=m.rounding,!c[0]||!l[0])return l[0]||(e=new m(f)),B?x(e,a,u):e;if(o=G(f.e/k),r=G(e.e/k),c=c.slice(),i=o-r,i){for(i<0?(n=c,i=-i,s=l.length):(n=l,r=o,s=c.length),o=Math.ceil(a/k),s=o>s?o+1:s+1,i>s&&(i=s,n.length=1),n.reverse();i--;)n.push(0);n.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,n=l,l=c,c=n),t=0;i;)t=(c[--i]=c[i]+l[i]+t)/Q|0,c[i]%=Q;for(t&&(c.unshift(t),++r),s=c.length;c[--s]==0;)c.pop();return e.d=c,e.e=Fe(c,r),B?x(e,a,u):e};d.precision=d.sd=function(e){var t,n=this;if(e!==void 0&&e!==!!e&&e!==1&&e!==0)throw Error(se+e);return n.d?(t=Ft(n.d),e&&n.e+1>t&&(t=n.e+1)):t=NaN,t};d.round=function(){var e=this,t=e.constructor;return x(new t(e),e.e+1,t.rounding)};d.sine=d.sin=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+Math.max(n.e,n.sd())+k,r.rounding=1,n=vn(r,Ut(r,n)),r.precision=e,r.rounding=t,x($>2?n.neg():n,e,t,!0)):new r(NaN)};d.squareRoot=d.sqrt=function(){var e,t,n,r,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(B=!1,c=Math.sqrt(+s),c==0||c==1/0?(t=q(a),(t.length+u)%2==0&&(t+="0"),c=Math.sqrt(t),u=G((u+1)/2)-(u<0||u%2),c==1/0?t="5e"+u:(t=c.toExponential(),t=t.slice(0,t.indexOf("e")+1)+u),r=new l(t)):r=new l(c.toString()),n=(u=l.precision)+3;;)if(o=r,r=o.plus(R(s,o,n+2,1)).times(.5),q(o.d).slice(0,n)===(t=q(r.d)).slice(0,n))if(t=t.slice(n-3,n+1),t=="9999"||!i&&t=="4999"){if(!i&&(x(o,u+1,0),o.times(o).eq(s))){r=o;break}n+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(x(r,u+1,1),e=!r.times(r).eq(s));break}return B=!0,x(r,u,l.rounding,e)};d.tangent=d.tan=function(){var e,t,n=this,r=n.constructor;return n.isFinite()?n.isZero()?new r(n):(e=r.precision,t=r.rounding,r.precision=e+10,r.rounding=1,n=n.sin(),n.s=1,n=R(n,new r(1).minus(n.times(n)).sqrt(),e+10,0),r.precision=e,r.rounding=t,x($==2||$==4?n.neg():n,e,t,!0)):new r(NaN)};d.times=d.mul=function(e){var t,n,r,i,o,s,a,u,c,l=this,f=l.constructor,m=l.d,p=(e=new f(e)).d;if(e.s*=l.s,!m||!m[0]||!p||!p[0])return new f(!e.s||m&&!m[0]&&!p||p&&!p[0]&&!m?NaN:!m||!p?e.s/0:e.s*0);for(n=G(l.e/k)+G(e.e/k),u=m.length,c=p.length,u<c&&(o=m,m=p,p=o,s=u,u=c,c=s),o=[],s=u+c,r=s;r--;)o.push(0);for(r=c;--r>=0;){for(t=0,i=u+r;i>r;)a=o[i]+p[r]*m[i-r-1]+t,o[i--]=a%Q|0,t=a/Q|0;o[i]=(o[i]+t)%Q|0}for(;!o[--s];)o.pop();return t?++n:o.shift(),e.d=o,e.e=Fe(o,n),B?x(e,f.precision,f.rounding):e};d.toBinary=function(e,t){return ot(this,2,e,t)};d.toDecimalPlaces=d.toDP=function(e,t){var n=this,r=n.constructor;return n=new r(n),e===void 0?n:(j(e,0,ae),t===void 0?t=r.rounding:j(t,0,8),x(n,e+n.e+1,t))};d.toExponential=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=J(r,!0):(j(e,0,ae),t===void 0?t=i.rounding:j(t,0,8),r=x(new i(r),e+1,t),n=J(r,!0,e+1)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toFixed=function(e,t){var n,r,i=this,o=i.constructor;return e===void 0?n=J(i):(j(e,0,ae),t===void 0?t=o.rounding:j(t,0,8),r=x(new o(i),e+i.e+1,t),n=J(r,!1,e+r.e+1)),i.isNeg()&&!i.isZero()?"-"+n:n};d.toFraction=function(e){var t,n,r,i,o,s,a,u,c,l,f,m,p=this,y=p.d,g=p.constructor;if(!y)return new g(p);if(c=n=new g(1),r=u=new g(0),t=new g(r),o=t.e=Ft(y)-p.e-1,s=o%k,t.d[0]=K(10,s<0?k+s:s),e==null)e=o>0?t:c;else{if(a=new g(e),!a.isInt()||a.lt(c))throw Error(se+a);e=a.gt(t)?o>0?t:c:a}for(B=!1,a=new g(q(y)),l=g.precision,g.precision=o=y.length*k*2;f=R(a,t,0,1,1),i=n.plus(f.times(r)),i.cmp(e)!=1;)n=r,r=i,i=c,c=u.plus(f.times(i)),u=i,i=t,t=a.minus(f.times(i)),a=i;return i=R(e.minus(n),r,0,1,1),u=u.plus(i.times(c)),n=n.plus(i.times(r)),u.s=c.s=p.s,m=R(c,r,o,1).minus(p).abs().cmp(R(u,n,o,1).minus(p).abs())<1?[c,r]:[u,n],g.precision=l,B=!0,m};d.toHexadecimal=d.toHex=function(e,t){return ot(this,16,e,t)};d.toNearest=function(e,t){var n=this,r=n.constructor;if(n=new r(n),e==null){if(!n.d)return n;e=new r(1),t=r.rounding}else{if(e=new r(e),t===void 0?t=r.rounding:j(t,0,8),!n.d)return e.s?n:e;if(!e.d)return e.s&&(e.s=n.s),e}return e.d[0]?(B=!1,n=R(n,e,0,t,1).times(e),B=!0,x(n)):(e.s=n.s,n=e),n};d.toNumber=function(){return+this};d.toOctal=function(e,t){return ot(this,8,e,t)};d.toPower=d.pow=function(e){var t,n,r,i,o,s,a=this,u=a.constructor,c=+(e=new u(e));if(!a.d||!e.d||!a.d[0]||!e.d[0])return new u(K(+a,c));if(a=new u(a),a.eq(1))return a;if(r=u.precision,o=u.rounding,e.eq(1))return x(a,r,o);if(t=G(e.e/k),t>=e.d.length-1&&(n=c<0?-c:c)<=Rn)return i=Vt(u,a,n,r),e.s<0?new u(1).div(i):x(i,r,o);if(s=a.s,s<0){if(t<e.d.length-1)return new u(NaN);if((e.d[t]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return n=K(+a,c),t=n==0||!isFinite(n)?G(c*(Math.log("0."+q(a.d))/Math.LN10+a.e+1)):new u(n+"").e,t>u.maxE+1||t<u.minE-1?new u(t>0?s/0:0):(B=!1,u.rounding=a.s=1,n=Math.min(12,(t+"").length),i=rt(e.times(oe(a,r+n)),r),i.d&&(i=x(i,r+5,1),ye(i.d,r,o)&&(t=r+10,i=x(rt(e.times(oe(a,t+n)),t),t+5,1),+q(i.d).slice(r+1,r+15)+1==1e14&&(i=x(i,r+1,0)))),i.s=s,B=!0,u.rounding=o,x(i,r,o))};d.toPrecision=function(e,t){var n,r=this,i=r.constructor;return e===void 0?n=J(r,r.e<=i.toExpNeg||r.e>=i.toExpPos):(j(e,1,ae),t===void 0?t=i.rounding:j(t,0,8),r=x(new i(r),e,t),n=J(r,e<=r.e||r.e<=i.toExpNeg,e)),r.isNeg()&&!r.isZero()?"-"+n:n};d.toSignificantDigits=d.toSD=function(e,t){var n=this,r=n.constructor;return e===void 0?(e=r.precision,t=r.rounding):(j(e,1,ae),t===void 0?t=r.rounding:j(t,0,8)),x(new r(n),e,t)};d.toString=function(){var e=this,t=e.constructor,n=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()&&!e.isZero()?"-"+n:n};d.truncated=d.trunc=function(){return x(new this.constructor(this),this.e+1,1)};d.valueOf=d.toJSON=function(){var e=this,t=e.constructor,n=J(e,e.e<=t.toExpNeg||e.e>=t.toExpPos);return e.isNeg()?"-"+n:n};function q(e){var t,n,r,i=e.length-1,o="",s=e[0];if(i>0){for(o+=s,t=1;t<i;t++)r=e[t]+"",n=k-r.length,n&&(o+=ie(n)),o+=r;s=e[t],r=s+"",n=k-r.length,n&&(o+=ie(n))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function j(e,t,n){if(e!==~~e||e<t||e>n)throw Error(se+e)}function ye(e,t,n,r){var i,o,s,a;for(o=e[0];o>=10;o/=10)--t;return--t<0?(t+=k,i=0):(i=Math.ceil((t+1)/k),t%=k),o=K(10,k-t),a=e[i]%o|0,r==null?t<3?(t==0?a=a/100|0:t==1&&(a=a/10|0),s=n<4&&a==99999||n>3&&a==49999||a==5e4||a==0):s=(n<4&&a+1==o||n>3&&a+1==o/2)&&(e[i+1]/o/100|0)==K(10,t-2)-1||(a==o/2||a==0)&&(e[i+1]/o/100|0)==0:t<4?(t==0?a=a/1e3|0:t==1?a=a/100|0:t==2&&(a=a/10|0),s=(r||n<4)&&a==9999||!r&&n>3&&a==4999):s=((r||n<4)&&a+1==o||!r&&n>3&&a+1==o/2)&&(e[i+1]/o/1e3|0)==K(10,t-3)-1,s}function Re(e,t,n){for(var r,i=[0],o,s=0,a=e.length;s<a;){for(o=i.length;o--;)i[o]*=t;for(i[0]+=et.indexOf(e.charAt(s++)),r=0;r<i.length;r++)i[r]>n-1&&(i[r+1]===void 0&&(i[r+1]=0),i[r+1]+=i[r]/n|0,i[r]%=n)}return i.reverse()}function _n(e,t){var n,r,i;if(t.isZero())return t;r=t.d.length,r<32?(n=Math.ceil(r/3),i=(1/Ve(4,n)).toString()):(n=16,i="2.3283064365386962890625e-10"),e.precision+=n,t=pe(e,1,t.times(i),new e(1));for(var o=n;o--;){var s=t.times(t);t=s.times(s).minus(s).times(8).plus(1)}return e.precision-=n,t}var R=function(){function e(r,i,o){var s,a=0,u=r.length;for(r=r.slice();u--;)s=r[u]*i+a,r[u]=s%o|0,a=s/o|0;return a&&r.unshift(a),r}function t(r,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(r[a]!=i[a]){u=r[a]>i[a]?1:-1;break}return u}function n(r,i,o,s){for(var a=0;o--;)r[o]-=a,a=r[o]<i[o]?1:0,r[o]=a*s+r[o]-i[o];for(;!r[0]&&r.length>1;)r.shift()}return function(r,i,o,s,a,u){var c,l,f,m,p,y,g,w,T,P,b,h,S,A,M,U,v,_,D,F,X=r.constructor,re=r.s==i.s?1:-1,V=r.d,E=i.d;if(!V||!V[0]||!E||!E[0])return new X(!r.s||!i.s||(V?E&&V[0]==E[0]:!E)?NaN:V&&V[0]==0||!E?re*0:re/0);for(u?(p=1,l=r.e-i.e):(u=Q,p=k,l=G(r.e/p)-G(i.e/p)),D=E.length,v=V.length,T=new X(re),P=T.d=[],f=0;E[f]==(V[f]||0);f++);if(E[f]>(V[f]||0)&&l--,o==null?(A=o=X.precision,s=X.rounding):a?A=o+(r.e-i.e)+1:A=o,A<0)P.push(1),y=!0;else{if(A=A/p+2|0,f=0,D==1){for(m=0,E=E[0],A++;(f<v||m)&&A--;f++)M=m*u+(V[f]||0),P[f]=M/E|0,m=M%E|0;y=m||f<v}else{for(m=u/(E[0]+1)|0,m>1&&(E=e(E,m,u),V=e(V,m,u),D=E.length,v=V.length),U=D,b=V.slice(0,D),h=b.length;h<D;)b[h++]=0;F=E.slice(),F.unshift(0),_=E[0],E[1]>=u/2&&++_;do m=0,c=t(E,b,D,h),c<0?(S=b[0],D!=h&&(S=S*u+(b[1]||0)),m=S/_|0,m>1?(m>=u&&(m=u-1),g=e(E,m,u),w=g.length,h=b.length,c=t(g,b,w,h),c==1&&(m--,n(g,D<w?F:E,w,u))):(m==0&&(c=m=1),g=E.slice()),w=g.length,w<h&&g.unshift(0),n(b,g,h,u),c==-1&&(h=b.length,c=t(E,b,D,h),c<1&&(m++,n(b,D<h?F:E,h,u))),h=b.length):c===0&&(m++,b=[0]),P[f++]=m,c&&b[0]?b[h++]=V[U]||0:(b=[V[U]],h=1);while((U++<v||b[0]!==void 0)&&A--);y=b[0]!==void 0}P[0]||P.shift()}if(p==1)T.e=l,Rt=y;else{for(f=1,m=P[0];m>=10;m/=10)f++;T.e=f+l*p-1,x(T,a?o+T.e+1:o,s,y)}return T}}();function x(e,t,n,r){var i,o,s,a,u,c,l,f,m,p=e.constructor;e:if(t!=null){if(f=e.d,!f)return e;for(i=1,a=f[0];a>=10;a/=10)i++;if(o=t-i,o<0)o+=k,s=t,l=f[m=0],u=l/K(10,i-s-1)%10|0;else if(m=Math.ceil((o+1)/k),a=f.length,m>=a)if(r){for(;a++<=m;)f.push(0);l=u=0,i=1,o%=k,s=o-k+1}else break e;else{for(l=a=f[m],i=1;a>=10;a/=10)i++;o%=k,s=o-k+i,u=s<0?0:l/K(10,i-s-1)%10|0}if(r=r||t<0||f[m+1]!==void 0||(s<0?l:l%K(10,i-s-1)),c=n<4?(u||r)&&(n==0||n==(e.s<0?3:2)):u>5||u==5&&(n==4||r||n==6&&(o>0?s>0?l/K(10,i-s):0:f[m-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,c?(t-=e.e+1,f[0]=K(10,(k-t%k)%k),e.e=-t||0):f[0]=e.e=0,e;if(o==0?(f.length=m,a=1,m--):(f.length=m+1,a=K(10,k-o),f[m]=s>0?(l/K(10,i-s)%K(10,s)|0)*a:0),c)for(;;)if(m==0){for(o=1,s=f[0];s>=10;s/=10)o++;for(s=f[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(e.e++,f[0]==Q&&(f[0]=1));break}else{if(f[m]+=a,f[m]!=Q)break;f[m--]=0,a=1}for(o=f.length;f[--o]===0;)f.pop()}return B&&(e.e>p.maxE?(e.d=null,e.e=NaN):e.e<p.minE&&(e.e=0,e.d=[0])),e}function J(e,t,n){if(!e.isFinite())return Wt(e);var r,i=e.e,o=q(e.d),s=o.length;return t?(n&&(r=n-s)>0?o=o.charAt(0)+"."+o.slice(1)+ie(r):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(e.e<0?"e":"e+")+e.e):i<0?(o="0."+ie(-i-1)+o,n&&(r=n-s)>0&&(o+=ie(r))):i>=s?(o+=ie(i+1-s),n&&(r=n-i-1)>0&&(o=o+"."+ie(r))):((r=i+1)<s&&(o=o.slice(0,r)+"."+o.slice(r)),n&&(r=n-s)>0&&(i+1===s&&(o+="."),o+=ie(r))),o}function Fe(e,t){var n=e[0];for(t*=k;n>=10;n/=10)t++;return t}function Oe(e,t,n){if(t>Dn)throw B=!0,n&&(e.precision=n),Error(Dt);return x(new e(De),t,1,!0)}function Y(e,t,n){if(t>nt)throw Error(Dt);return x(new e(_e),t,n,!0)}function Ft(e){var t=e.length-1,n=t*k+1;if(t=e[t],t){for(;t%10==0;t/=10)n--;for(t=e[0];t>=10;t/=10)n++}return n}function ie(e){for(var t="";e--;)t+="0";return t}function Vt(e,t,n,r){var i,o=new e(1),s=Math.ceil(r/k+4);for(B=!1;;){if(n%2&&(o=o.times(t),Mt(o.d,s)&&(i=!0)),n=G(n/2),n===0){n=o.d.length-1,i&&o.d[n]===0&&++o.d[n];break}t=t.times(t),Mt(t.d,s)}return B=!0,o}function Nt(e){return e.d[e.d.length-1]&1}function Kt(e,t,n){for(var r,i=new e(t[0]),o=0;++o<t.length;)if(r=new e(t[o]),r.s)i[n](r)&&(i=r);else{i=r;break}return i}function rt(e,t){var n,r,i,o,s,a,u,c=0,l=0,f=0,m=e.constructor,p=m.rounding,y=m.precision;if(!e.d||!e.d[0]||e.e>17)return new m(e.d?e.d[0]?e.s<0?0:1/0:1:e.s?e.s<0?0:e:0/0);for(t==null?(B=!1,u=y):u=t,a=new m(.03125);e.e>-2;)e=e.times(a),f+=5;for(r=Math.log(K(2,f))/Math.LN10*2+5|0,u+=r,n=o=s=new m(1),m.precision=u;;){if(o=x(o.times(e),u,1),n=n.times(++l),a=s.plus(R(o,n,u,1)),q(a.d).slice(0,u)===q(s.d).slice(0,u)){for(i=f;i--;)s=x(s.times(s),u,1);if(t==null)if(c<3&&ye(s.d,u-r,p,c))m.precision=u+=10,n=o=a=new m(1),l=0,c++;else return x(s,m.precision=y,p,B=!0);else return m.precision=y,s}s=a}}function oe(e,t){var n,r,i,o,s,a,u,c,l,f,m,p=1,y=10,g=e,w=g.d,T=g.constructor,P=T.rounding,b=T.precision;if(g.s<0||!w||!w[0]||!g.e&&w[0]==1&&w.length==1)return new T(w&&!w[0]?-1/0:g.s!=1?NaN:w?0:g);if(t==null?(B=!1,l=b):l=t,T.precision=l+=y,n=q(w),r=n.charAt(0),Math.abs(o=g.e)<15e14){for(;r<7&&r!=1||r==1&&n.charAt(1)>3;)g=g.times(e),n=q(g.d),r=n.charAt(0),p++;o=g.e,r>1?(g=new T("0."+n),o++):g=new T(r+"."+n.slice(1))}else return c=Oe(T,l+2,b).times(o+""),g=oe(new T(r+"."+n.slice(1)),l-y).plus(c),T.precision=b,t==null?x(g,b,P,B=!0):g;for(f=g,u=s=g=R(g.minus(1),g.plus(1),l,1),m=x(g.times(g),l,1),i=3;;){if(s=x(s.times(m),l,1),c=u.plus(R(s,new T(i),l,1)),q(c.d).slice(0,l)===q(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Oe(T,l+2,b).times(o+""))),u=R(u,new T(p),l,1),t==null)if(ye(u.d,l-y,P,a))T.precision=l+=y,c=s=g=R(f.minus(1),f.plus(1),l,1),m=x(g.times(g),l,1),i=a=1;else return x(u,T.precision=b,P,B=!0);else return T.precision=b,u;u=c,i+=2}}function Wt(e){return String(e.s*e.s/0)}function it(e,t){var n,r,i;for((n=t.indexOf("."))>-1&&(t=t.replace(".","")),(r=t.search(/e/i))>0?(n<0&&(n=r),n+=+t.slice(r+1),t=t.substring(0,r)):n<0&&(n=t.length),r=0;t.charCodeAt(r)===48;r++);for(i=t.length;t.charCodeAt(i-1)===48;--i);if(t=t.slice(r,i),t){if(i-=r,e.e=n=n-r-1,e.d=[],r=(n+1)%k,n<0&&(r+=k),r<i){for(r&&e.d.push(+t.slice(0,r)),i-=k;r<i;)e.d.push(+t.slice(r,r+=k));t=t.slice(r),r=k-t.length}else r-=i;for(;r--;)t+="0";e.d.push(+t),B&&(e.e>e.constructor.maxE?(e.d=null,e.e=NaN):e.e<e.constructor.minE&&(e.e=0,e.d=[0]))}else e.e=0,e.d=[0];return e}function On(e,t){var n,r,i,o,s,a,u,c,l;if(t.indexOf("_")>-1){if(t=t.replace(/(\d)_(?=\d)/g,"$1"),vt.test(t))return it(e,t)}else if(t==="Infinity"||t==="NaN")return+t||(e.s=NaN),e.e=NaN,e.d=null,e;if(Mn.test(t))n=16,t=t.toLowerCase();else if(Nn.test(t))n=2;else if(En.test(t))n=8;else throw Error(se+t);for(o=t.search(/p/i),o>0?(u=+t.slice(o+1),t=t.substring(2,o)):t=t.slice(2),o=t.indexOf("."),s=o>=0,r=e.constructor,s&&(t=t.replace(".",""),a=t.length,o=a-o,i=Vt(r,new r(n),o,o*2)),c=Re(t,n,Q),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new r(e.s*0):(e.e=Fe(c,l),e.d=c,B=!1,s&&(e=R(e,i,a*4)),u&&(e=e.times(Math.abs(u)<54?K(2,u):Ke.pow(2,u))),B=!0,e)}function vn(e,t){var n,r=t.d.length;if(r<3)return t.isZero()?t:pe(e,2,t,t);n=1.4*Math.sqrt(r),n=n>16?16:n|0,t=t.times(1/Ve(5,n)),t=pe(e,2,t,t);for(var i,o=new e(5),s=new e(16),a=new e(20);n--;)i=t.times(t),t=t.times(o.plus(i.times(s.times(i).minus(a))));return t}function pe(e,t,n,r,i){var o,s,a,u,c=1,l=e.precision,f=Math.ceil(l/k);for(B=!1,u=n.times(n),a=new e(r);;){if(s=R(a.times(u),new e(t++*t++),l,1),a=i?r.plus(s):r.minus(s),r=R(s.times(u),new e(t++*t++),l,1),s=a.plus(r),s.d[f]!==void 0){for(o=f;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=r,r=s,s=o,c++}return B=!0,s.d.length=f+1,s}function Ve(e,t){for(var n=e;--t;)n*=e;return n}function Ut(e,t){var n,r=t.s<0,i=Y(e,e.precision,1),o=i.times(.5);if(t=t.abs(),t.lte(o))return $=r?4:1,t;if(n=t.divToInt(i),n.isZero())$=r?3:2;else{if(t=t.minus(n.times(i)),t.lte(o))return $=Nt(n)?r?2:3:r?4:1,t;$=Nt(n)?r?1:4:r?3:2}return t.minus(i).abs()}function ot(e,t,n,r){var i,o,s,a,u,c,l,f,m,p=e.constructor,y=n!==void 0;if(y?(j(n,1,ae),r===void 0?r=p.rounding:j(r,0,8)):(n=p.precision,r=p.rounding),!e.isFinite())l=Wt(e);else{for(l=J(e),s=l.indexOf("."),y?(i=2,t==16?n=n*4-3:t==8&&(n=n*3-2)):i=t,s>=0&&(l=l.replace(".",""),m=new p(1),m.e=l.length-s,m.d=Re(J(m),10,i),m.e=m.d.length),f=Re(l,10,i),o=u=f.length;f[--u]==0;)f.pop();if(!f[0])l=y?"0p+0":"0";else{if(s<0?o--:(e=new p(e),e.d=f,e.e=o,e=R(e,m,n,r,0,i),f=e.d,o=e.e,c=Rt),s=f[n],a=i/2,c=c||f[n+1]!==void 0,c=r<4?(s!==void 0||c)&&(r===0||r===(e.s<0?3:2)):s>a||s===a&&(r===4||c||r===6&&f[n-1]&1||r===(e.s<0?8:7)),f.length=n,c)for(;++f[--n]>i-1;)f[n]=0,n||(++o,f.unshift(1));for(u=f.length;!f[u-1];--u);for(s=0,l="";s<u;s++)l+=et.charAt(f[s]);if(y){if(u>1)if(t==16||t==8){for(s=t==16?4:3,--u;u%s;u++)l+="0";for(f=Re(l,i,t),u=f.length;!f[u-1];--u);for(s=1,l="1.";s<u;s++)l+=et.charAt(f[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(t==16?"0x":t==2?"0b":t==8?"0o":"")+l}return e.s<0?"-"+l:l}function Mt(e,t){if(e.length>t)return e.length=t,!0}function Fn(e){return new this(e).abs()}function Vn(e){return new this(e).acos()}function Kn(e){return new this(e).acosh()}function Wn(e,t){return new this(e).plus(t)}function Un(e){return new this(e).asin()}function qn(e){return new this(e).asinh()}function Gn(e){return new this(e).atan()}function Hn(e){return new this(e).atanh()}function jn(e,t){e=new this(e),t=new this(t);var n,r=this.precision,i=this.rounding,o=r+4;return!e.s||!t.s?n=new this(NaN):!e.d&&!t.d?(n=Y(this,o,1).times(t.s>0?.25:.75),n.s=e.s):!t.d||e.isZero()?(n=t.s<0?Y(this,r,i):new this(0),n.s=e.s):!e.d||t.isZero()?(n=Y(this,o,1).times(.5),n.s=e.s):t.s<0?(this.precision=o,this.rounding=1,n=this.atan(R(e,t,o,1)),t=Y(this,o,1),this.precision=r,this.rounding=i,n=e.s<0?n.minus(t):n.plus(t)):n=this.atan(R(e,t,o,1)),n}function zn(e){return new this(e).cbrt()}function Zn(e){return x(e=new this(e),e.e+1,2)}function Yn(e,t,n){return new this(e).clamp(t,n)}function Qn(e){if(!e||typeof e!="object")throw Error(ve+"Object expected");var t,n,r,i=e.defaults===!0,o=["precision",1,ae,"rounding",0,8,"toExpNeg",-me,0,"toExpPos",0,me,"maxE",0,me,"minE",-me,0,"modulo",0,9];for(t=0;t<o.length;t+=3)if(n=o[t],i&&(this[n]=tt[n]),(r=e[n])!==void 0)if(G(r)===r&&r>=o[t+1]&&r<=o[t+2])this[n]=r;else throw Error(se+n+": "+r);if(n="crypto",i&&(this[n]=tt[n]),(r=e[n])!==void 0)if(r===!0||r===!1||r===0||r===1)if(r)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[n]=!0;else throw Error(_t);else this[n]=!1;else throw Error(se+n+": "+r);return this}function Xn(e){return new this(e).cos()}function Jn(e){return new this(e).cosh()}function qt(e){var t,n,r;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,Et(o)){c.s=o.s,B?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;B?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return it(c,o.toString())}else if(u!=="string")throw Error(se+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),vt.test(o)?it(c,o):On(c,o)}if(i.prototype=d,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=Qn,i.clone=qt,i.isDecimal=Et,i.abs=Fn,i.acos=Vn,i.acosh=Kn,i.add=Wn,i.asin=Un,i.asinh=qn,i.atan=Gn,i.atanh=Hn,i.atan2=jn,i.cbrt=zn,i.ceil=Zn,i.clamp=Yn,i.cos=Xn,i.cosh=Jn,i.div=$n,i.exp=er,i.floor=tr,i.hypot=nr,i.ln=rr,i.log=ir,i.log10=sr,i.log2=or,i.max=ar,i.min=ur,i.mod=cr,i.mul=lr,i.pow=fr,i.random=mr,i.round=pr,i.sign=dr,i.sin=gr,i.sinh=hr,i.sqrt=br,i.sub=yr,i.sum=wr,i.tan=Tr,i.tanh=xr,i.trunc=Pr,e===void 0&&(e={}),e&&e.defaults!==!0)for(r=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],t=0;t<r.length;)e.hasOwnProperty(n=r[t++])||(e[n]=this[n]);return i.config(e),i}function $n(e,t){return new this(e).div(t)}function er(e){return new this(e).exp()}function tr(e){return x(e=new this(e),e.e+1,3)}function nr(){var e,t,n=new this(0);for(B=!1,e=0;e<arguments.length;)if(t=new this(arguments[e++]),t.d)n.d&&(n=n.plus(t.times(t)));else{if(t.s)return B=!0,new this(1/0);n=t}return B=!0,n.sqrt()}function Et(e){return e instanceof Ke||e&&e.toStringTag===Ot||!1}function rr(e){return new this(e).ln()}function ir(e,t){return new this(e).log(t)}function or(e){return new this(e).log(2)}function sr(e){return new this(e).log(10)}function ar(){return Kt(this,arguments,"lt")}function ur(){return Kt(this,arguments,"gt")}function cr(e,t){return new this(e).mod(t)}function lr(e,t){return new this(e).mul(t)}function fr(e,t){return new this(e).pow(t)}function mr(e){var t,n,r,i,o=0,s=new this(1),a=[];if(e===void 0?e=this.precision:j(e,1,ae),r=Math.ceil(e/k),this.crypto)if(crypto.getRandomValues)for(t=crypto.getRandomValues(new Uint32Array(r));o<r;)i=t[o],i>=429e7?t[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(t=crypto.randomBytes(r*=4);o<r;)i=t[o]+(t[o+1]<<8)+(t[o+2]<<16)+((t[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(t,o):(a.push(i%1e7),o+=4);o=r/4}else throw Error(_t);else for(;o<r;)a[o++]=Math.random()*1e7|0;for(r=a[--o],e%=k,r&&e&&(i=K(10,k-e),a[o]=(r/i|0)*i);a[o]===0;o--)a.pop();if(o<0)n=0,a=[0];else{for(n=-1;a[0]===0;n-=k)a.shift();for(r=1,i=a[0];i>=10;i/=10)r++;r<k&&(n-=k-r)}return s.e=n,s.d=a,s}function pr(e){return x(e=new this(e),e.e+1,this.rounding)}function dr(e){return e=new this(e),e.d?e.d[0]?e.s:0*e.s:e.s||NaN}function gr(e){return new this(e).sin()}function hr(e){return new this(e).sinh()}function br(e){return new this(e).sqrt()}function yr(e,t){return new this(e).sub(t)}function wr(){var e=0,t=arguments,n=new this(t[e]);for(B=!1;n.s&&++e<t.length;)n=n.plus(t[e]);return B=!0,x(n,this.precision,this.rounding)}function Tr(e){return new this(e).tan()}function xr(e){return new this(e).tanh()}function Pr(e){return x(e=new this(e),e.e+1,1)}d[Symbol.for("nodejs.util.inspect.custom")]=d.toString;d[Symbol.toStringTag]="Decimal";var Ke=d.constructor=qt(tt);De=new Ke(De);_e=new Ke(_e);import{PublicKey as Ar}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Gt}from"@solana/spl-token";var Ht={chainId:101,address:Ar.default.toBase58(),programId:Gt.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},ue={chainId:101,address:"So11111111111111111111111111111111111111112",programId:Gt.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as st}from"@solana/web3.js";var at=class{constructor({mint:t,decimals:n,symbol:r,name:i,skipMint:o=!1,isToken2022:s=!1}){if(t===be.toBase58()||t instanceof st&&be.equals(t)){this.decimals=ue.decimals,this.symbol=ue.symbol,this.name=ue.name,this.mint=new st(ue.address),this.isToken2022=!1;return}this.decimals=n,this.symbol=r||t.toString().substring(0,6),this.name=i||t.toString().substring(0,6),this.mint=o?st.default:Lt({publicKey:t}),this.isToken2022=s}equals(t){return this===t?!0:this.mint.equals(t.mint)}},ce=at;ce.WSOL=new at(Z(W({},ue),{mint:ue.address}));var ut=class{constructor({decimals:t,symbol:n="UNKNOWN",name:r="UNKNOWN"}){this.decimals=t,this.symbol=n,this.name=r}equals(t){return this===t}},We=ut;We.SOL=new ut(Ht);import qe from"big.js";import Ir from"bn.js";import Nr from"decimal.js-light";import{get as jt,set as kr}from"lodash";var ct=class{constructor(t){this.logLevel=t.logLevel!==void 0?t.logLevel:0,this.name=t.name}set level(t){this.logLevel=t}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(t){return t<=this.logLevel}error(...t){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...t),this):this}logWithError(...t){let n=t.map(r=>typeof r=="object"?JSON.stringify(r):r).join(", ");throw new Error(n)}warning(...t){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...t),this):this}info(...t){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...t),this):this}debug(...t){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...t),this):this}},zt={},Sr={};function H(e){let t=jt(zt,e);if(!t){let n=jt(Sr,e);t=new ct({name:e,logLevel:n}),kr(zt,e,t)}return t}import we from"bn.js";var Zt=9007199254740991;function z(e){let t=H("Raydium_parseBigNumberish");if(e instanceof we)return e;if(typeof e=="string"){if(e.match(/^-?[0-9]+$/))return new we(e);t.logWithError(`invalid BigNumberish string: ${e}`)}return typeof e=="number"?(e%1&&t.logWithError(`BigNumberish number underflow: ${e}`),(e>=Zt||e<=-Zt)&&t.logWithError(`BigNumberish number overflow: ${e}`),new we(String(e))):typeof e=="bigint"?new we(e.toString()):(t.error(`invalid BigNumberish value: ${e}`),new we(0))}import Br from"toformat";var Cr=Br,Te=Cr;var Ue=H("module/fraction"),lt=Te(qe),xe=Te(Nr),Mr={[0]:xe.ROUND_DOWN,[1]:xe.ROUND_HALF_UP,[2]:xe.ROUND_UP},Er={[0]:qe.roundDown,[1]:qe.roundHalfUp,[2]:qe.roundUp},N=class{constructor(t,n=new Ir(1)){this.numerator=z(t),this.denominator=z(n)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new N(this.denominator,this.numerator)}add(t){let n=t instanceof N?t:new N(z(t));return this.denominator.eq(n.denominator)?new N(this.numerator.add(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).add(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}sub(t){let n=t instanceof N?t:new N(z(t));return this.denominator.eq(n.denominator)?new N(this.numerator.sub(n.numerator),this.denominator):new N(this.numerator.mul(n.denominator).sub(n.numerator.mul(this.denominator)),this.denominator.mul(n.denominator))}mul(t){let n=t instanceof N?t:new N(z(t));return new N(this.numerator.mul(n.numerator),this.denominator.mul(n.denominator))}div(t){let n=t instanceof N?t:new N(z(t));return new N(this.numerator.mul(n.denominator),this.denominator.mul(n.numerator))}toSignificant(t,n={groupSeparator:""},r=1){Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<=0&&Ue.logWithError(`${t} is not positive.`),xe.set({precision:t+1,rounding:Mr[r]});let i=new xe(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(t);return i.toFormat(i.decimalPlaces(),n)}toFixed(t,n={groupSeparator:""},r=1){return Number.isInteger(t)||Ue.logWithError(`${t} is not an integer.`),t<0&&Ue.logWithError(`${t} is negative.`),lt.DP=t,lt.RM=Er[r]||1,new lt(this.numerator.toString()).div(this.denominator.toString()).toFormat(t,n)}isZero(){return this.numerator.isZero()}};import Rr from"bn.js";var Yt=new N(new Rr(100)),de=class extends N{toSignificant(t=5,n,r){return this.mul(Yt).toSignificant(t,n,r)}toFixed(t=2,n,r){return this.mul(Yt).toFixed(t,n,r)}};var Dr=H("Raydium_price"),ee=class extends N{constructor(n){let{baseToken:r,quoteToken:i,numerator:o,denominator:s}=n;super(o,s);this.baseToken=r,this.quoteToken=i,this.scalar=new N(ft(r.decimals),ft(i.decimals))}get raw(){return new N(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new ee({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(n){this.quoteToken!==n.baseToken&&Dr.logWithError("mul token not equals");let r=super.mul(n);return new ee({baseToken:this.baseToken,quoteToken:n.quoteToken,denominator:r.denominator,numerator:r.numerator})}toSignificant(n=this.quoteToken.decimals,r,i){return this.adjusted.toSignificant(n,r,i)}toFixed(n=this.quoteToken.decimals,r,i){return this.adjusted.toFixed(n,r,i)}};var _r=new ne(0),Go=new ne(1),Ho=new ne(2),jo=new ne(3),zo=new ne(5),mt=new ne(10),Zo=new ne(100),Yo=new ne(1e3),Qo=new ne(1e4);function ft(e){return mt.pow(z(e))}import{PublicKey as Or}from"@solana/web3.js";import{MINT_SIZE as as,TOKEN_PROGRAM_ID as us,getTransferFeeConfig as cs,unpackMint as ls}from"@solana/spl-token";var pt=H("Raydium_accountInfo_util");async function Xt(e,t,n){let{batchRequest:r,commitment:i="confirmed",chunkCount:o=100}=W({batchRequest:!1},n),s=dt(t,o),a=new Array(s.length).fill([]);if(r){let u=s.map(f=>{let m=e._buildArgs([f.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:m}}),c=dt(u,10);a=(await(await Promise.all(c.map(async f=>await e._rpcBatchRequest(f)))).flat()).map(f=>(f.error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${f.error.message}`),f.result.value.map(m=>{if(m){let{data:p,executable:y,lamports:g,owner:w,rentEpoch:T}=m;return p.length!==2&&p[1]!=="base64"&&pt.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:g,owner:new Or(w),rentEpoch:T}}return null})))}else try{a=await Promise.all(s.map(u=>e.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&pt.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}function dt(e,t=1,n=[]){let r=[...e];if(t<=0)return n;for(;r.length;)n.push(r.splice(0,t));return n}import{PublicKey as Is}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Ms}from"@solana/spl-token";import{ComputeBudgetProgram as Jt,Keypair as en,PublicKey as Ts,Transaction as tn,TransactionMessage as vr,VersionedTransaction as nn}from"@solana/web3.js";var gt={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Fr}from"@solana/spl-token";var $t=H("Raydium_txUtil"),rn=1644;function Ge(e){let t=[],n=[];return e.microLamports&&(t.push(Jt.setComputeUnitPrice({microLamports:e.microLamports})),n.push(gt.SetComputeUnitPrice)),e.units&&(t.push(Jt.setComputeUnitLimit({units:e.units})),n.push(gt.SetComputeUnitLimit)),{instructions:t,instructionTypes:n}}async function ge(e,t){var r,i;let n=t!=null?t:"confirmed";return(i=await((r=e.getLatestBlockhash)==null?void 0:r.call(e,{commitment:n})))==null?void 0:i.blockhash}async function He(e,t){return e.getSignatureStatuses([t]),new Promise((n,r)=>{let i=setTimeout(r,6e4);e.onSignature(t,o=>{if(clearTimeout(i),!o.err){n("");return}r(o.err.toString())},"confirmed")})}function Vr(e,t){e.length<1&&$t.logWithError(`no instructions provided: ${e.toString()}`),t.length<1&&$t.logWithError(`no signers provided:, ${t.toString()}`);let n=new tn;n.recentBlockhash="11111111111111111111111111111111",n.feePayer=t[0],n.add(...e);try{return Buffer.from(n.serialize({verifySignatures:!1})).toString("base64").length<rn}catch{return!1}}function Pe({instructions:e,payer:t,signers:n}){return Vr(e,[t,...n])}function Ae({instructions:e,payer:t,lookupTableAddressAccount:n,recentBlockhash:r=en.generate().publicKey.toString()}){let o=new vr({payerKey:t,recentBlockhash:r,instructions:e}).compileToV0Message(Object.values(n!=null?n:{}));try{return Buffer.from(new nn(o).serialize()).toString("base64").length<rn}catch{return!1}}var Kr=e=>Buffer.isBuffer(e)?e:e instanceof Uint8Array?Buffer.from(e.buffer,e.byteOffset,e.byteLength):Buffer.from(e),Wr=e=>{let t=e.serialize({requireAllSignatures:!1,verifySignatures:!1});e instanceof nn&&(t=Kr(t));try{return t instanceof Buffer?t.toString("base64"):Buffer.from(t).toString("base64")}catch{return t.toString("base64")}};function le(e){let t=[];return e.forEach(n=>{n instanceof tn&&(n.recentBlockhash||(n.recentBlockhash=Fr.toBase58()),n.feePayer||(n.feePayer=en.generate().publicKey)),t.push(Wr(n))}),console.log("simulate tx string:",t),t}import _s from"bn.js";import{PublicKey as on,AddressLookupTableAccount as je}from"@solana/web3.js";async function ht({connection:e,address:t}){let n=await Xt(e,[...new Set(t.map(i=>i.toString()))].map(i=>new on(i))),r={};for(let i=0;i<t.length;i++){let o=n[i],s=t[i];if(!o)continue;let a=new je({key:s,state:je.deserialize(o.data)});r[s.toString()]=a,ze[s.toString()]=a}return r}var ze={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new je({key:new on("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:je.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as ke,sendAndConfirmTransaction as bt,Transaction as Se,TransactionMessage as Be,VersionedTransaction as Ce}from"@solana/web3.js";import Ur from"axios";var Ze=class{constructor(t){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=t.connection,this.feePayer=t.feePayer,this.signAllTransactions=t.signAllTransactions,this.owner=t.owner,this.cluster=t.cluster,this.blockhashCommitment=t.blockhashCommitment,this.api=t.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var r;let t=(await Ur.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:n}=(r=t==null?void 0:t[15])!=null?r:{};if(!!n)return{units:6e5,microLamports:Math.min(Math.ceil(n*1e6/6e5),25e3)}}addCustomComputeBudget(t){if(t){let{instructions:n,instructionTypes:r}=Ge(t);return this.instructions.unshift(...n),this.instructionTypes.unshift(...r),!0}return!1}async calComputeBudget({config:t,defaultIns:n}){try{let r=t||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(r))return;n&&this.instructions.unshift(...n)}catch{n&&this.instructions.unshift(...n)}}addInstruction({instructions:t=[],endInstructions:n=[],signers:r=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...t),this.endInstructions.push(...n),this.signers.push(...r),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==ke.default.toString())),this}async versionBuild({txVersion:t,extInfo:n}){return t===0?await this.buildV0(W({},n||{})):this.build(n)}build(t){var r;let n=new Se;return this.allInstructions.length&&n.add(...this.allInstructions),n.feePayer=this.feePayer,((r=this.owner)==null?void 0:r.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:n,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await ge(this.connection,this.blockhashCommitment);if(n.recentBlockhash=u,this.signers.length&&n.sign(...this.signers),le([n]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await bt(this.connection,n,this.signers.find(f=>f.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(n.serialize(),{skipPreflight:s}),signedTx:n};if(this.signAllTransactions){let l=await this.signAllTransactions([n]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:t||{}}}buildMultiTx(t){var c;let{extraPreBuildData:n=[],extInfo:r}=t,{transaction:i}=this.build(r),o=n.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var T;let{sequentially:f,onTxUpdate:m,skipTxCount:p=0,recentBlockHash:y,skipPreflight:g=!0}=l||{},w=y!=null?y:await ge(this.connection,this.blockhashCommitment);if((T=this.owner)!=null&&T.isKeyPair){if(f){let P=[],b=0;for(let h of s){if(++b,b<=p)continue;let S=await bt(this.connection,h,this.signers.find(A=>A.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:g});P.push(S)}return{txIds:P,signedTxs:s}}return{txIds:await await Promise.all(s.map(async P=>(P.recentBlockhash=w,await this.connection.sendRawTransaction(P.serialize(),{skipPreflight:g})))),signedTxs:s}}if(this.signAllTransactions){let P=s.map((h,S)=>(h.recentBlockhash=w,a[S].length&&h.sign(...a[S]),h));le(P);let b=await this.signAllTransactions(P);if(f){let h=0,S=[],A=async()=>{if(!b[h])return;let M=await this.connection.sendRawTransaction(b[h].serialize(),{skipPreflight:g});S.push({txId:M,status:"sent",signedTx:b[h]}),m==null||m([...S]),h++,this.connection.onSignature(M,U=>{let v=S.findIndex(_=>_.txId===M);v>-1&&(S[v].status=U.err?"error":"success"),m==null||m([...S]),U.err||A()},"processed"),this.connection.getSignatureStatus(M)};return await A(),{txIds:S.map(M=>M.txId),signedTxs:b}}else{let h=[];for(let S=0;S<b.length;S+=1){let A=await this.connection.sendRawTransaction(b[S].serialize(),{skipPreflight:g});h.push(A)}return{txIds:h,signedTxs:b}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async versionMultiBuild({extraPreBuildData:t,txVersion:n,extInfo:r}){return n===0?await this.buildV0MultiTx({extraPreBuildData:t,buildProps:r||{}}):this.buildMultiTx({extraPreBuildData:t,extInfo:r})}async buildV0(t){var g;let y=t||{},{lookupTableCache:n={},lookupTableAddress:r=[],forerunCreate:i,recentBlockhash:o}=y,s=Ee(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=W(W({},this.cluster==="devnet"?{}:ze),n),u=Array.from(new Set([...r,...this.lookupTableAddress])),c=[];for(let w of u)a[w]===void 0&&c.push(new ke(w));let l=await ht({connection:this.connection,address:c});for(let[w,T]of Object.entries(l))a[w]=T;let f=i?ke.default.toBase58():o!=null?o:await ge(this.connection,this.blockhashCommitment),m=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((g=this.owner)==null?void 0:g.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new Ce(m);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var b;let{skipPreflight:T=!0,sendAndConfirm:P}=w||{};if(le([p]),(b=this.owner)!=null&&b.isKeyPair){let h=await this.connection.sendTransaction(p,{skipPreflight:T});return P&&await He(this.connection,h),{txId:h,signedTx:p}}if(this.signAllTransactions){let h=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(h[0],{skipPreflight:T}),signedTx:h[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(t){var c;let{extraPreBuildData:n=[],buildProps:r}=t,{transaction:i}=await this.buildV0(r),o=n.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(f=>f.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,f)=>{l.sign(a[f])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:r,execute:async l=>{var g;let{sequentially:f,onTxUpdate:m,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(w=>w.message.recentBlockhash=p),le(s),(g=this.owner)!=null&&g.isKeyPair){if(f){let w=[];for(let T of s){let P=await this.connection.sendTransaction(T,{skipPreflight:y});await He(this.connection,P),w.push(P)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(f){let T=0,P=[],b=async()=>{if(!w[T])return;let h=await this.connection.sendTransaction(w[T],{skipPreflight:y});P.push({txId:h,status:"sent",signedTx:w[T]}),m==null||m([...P]),T++,this.connection.onSignature(h,S=>{let A=P.findIndex(M=>M.txId===h);A>-1&&(P[A].status=S.err?"error":"success"),m==null||m([...P]),S.err||b()},"processed"),this.connection.getSignatureStatus(h)};return b(),{txIds:[],signedTxs:w}}else{let T=[];for(let P=0;P<w.length;P+=1){let b=await this.connection.sendTransaction(w[P],{skipPreflight:y});T.push(b)}return{txIds:T,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuild(t){var l;let c=t||{},{computeBudgetConfig:n}=c,r=Ee(c,["computeBudgetConfig"]),i=n?Ge(n):{instructions:[],instructionTypes:[]},o=this.signers.reduce((f,m)=>Z(W({},f),{[m.publicKey.toBase58()]:m}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(f=>{let m=[...u,f],p=n?[...i.instructions,...m]:m,g=[...new Set(m.map(w=>w.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(w=>new ke(w));if(u.length<12&&Pe({instructions:p,payer:this.feePayer,signers:g})||Pe({instructions:m,payer:this.feePayer,signers:g}))u.push(f);else{if(u.length===0)throw Error("item ins too big");Pe({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:g})?s.push(new Se().add(...i.instructions,...u)):s.push(new Se().add(...u)),a.push(Array.from(new Set(u.map(w=>w.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat())).map(w=>o[w]).filter(w=>w!==void 0)),u=[f]}}),u.length>0){let m=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);Pe({instructions:n?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:m.map(p=>p.publicKey)})?s.push(new Se().add(...i.instructions,...u)):s.push(new Se().add(...u)),a.push(m)}return s.forEach(f=>f.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(f=>{f.some(m=>m.publicKey.equals(this.owner.publicKey))||f.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async f=>{var P;let{sequentially:m,onTxUpdate:p,skipTxCount:y=0,recentBlockHash:g,skipPreflight:w=!0}=f||{},T=g!=null?g:await ge(this.connection,this.blockhashCommitment);if(s.forEach(async(b,h)=>{b.recentBlockhash=T,a[h].length&&b.sign(...a[h])}),le(s),(P=this.owner)!=null&&P.isKeyPair){if(m){let b=0,h=[];for(let S of s){if(++b,b<=y){h.push("tx skipped");continue}let A=await bt(this.connection,S,this.signers.find(M=>M.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});h.push(A)}return{txIds:h,signedTxs:s}}return{txIds:await Promise.all(s.map(async b=>await this.connection.sendRawTransaction(b.serialize(),{skipPreflight:w}))),signedTxs:s}}if(this.signAllTransactions){let b=await this.signAllTransactions(s.slice(y,s.length)),h=[...s.slice(0,y),...b];if(m){let S=0,A=[],M=async()=>{if(!h[S])return;S<y&&(A.push({txId:"",status:"success",signedTx:h[S]}),p==null||p([...A]),S++,M());let U=await this.connection.sendRawTransaction(h[S].serialize(),{skipPreflight:w});A.push({txId:U,status:"sent",signedTx:h[S]}),p==null||p([...A]),S++,this.connection.onSignature(U,v=>{let _=A.findIndex(D=>D.txId===U);_>-1&&(A[_].status=v.err?"error":"success"),p==null||p([...A]),v.err||M()},"processed"),this.connection.getSignatureStatus(U)};return await M(),{txIds:A.map(U=>U.txId),signedTxs:h}}else{let S=[];for(let A=0;A<h.length;A+=1){let M=await this.connection.sendRawTransaction(h[A].serialize(),{skipPreflight:w});S.push(M)}return{txIds:S,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:r||{}}}async sizeCheckBuildV0(t){var T;let w=t||{},{computeBudgetConfig:n,lookupTableCache:r={},lookupTableAddress:i=[]}=w,o=Ee(w,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=W(W({},this.cluster==="devnet"?{}:ze),r),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let P of a)s[P]===void 0&&u.push(new ke(P));let c=await ht({connection:this.connection,address:u});for(let[P,b]of Object.entries(c))s[P]=b;let l=n?Ge(n):{instructions:[],instructionTypes:[]},f=await ge(this.connection,this.blockhashCommitment),m=this.signers.reduce((P,b)=>Z(W({},P),{[b.publicKey.toBase58()]:b}),{}),p=[],y=[],g=[];if(this.allInstructions.forEach(P=>{let b=[...g,P],h=n?[...l.instructions,...b]:b;if(g.length<12&&Ae({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s})||Ae({instructions:b,payer:this.feePayer,lookupTableAddressAccount:s}))g.push(P);else{if(g.length===0)throw Error("item ins too big");let S={};for(let A of[...new Set(a)])s[A]!==void 0&&(S[A]=s[A]);if(n&&Ae({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let A=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Ce(A))}else{let A=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Ce(A))}y.push(Array.from(new Set(g.map(A=>A.keys.filter(M=>M.isSigner).map(M=>M.pubkey.toString())).flat())).map(A=>m[A]).filter(A=>A!==void 0)),g=[P]}}),g.length>0){let b=[...new Set(g.map(h=>h.keys.filter(S=>S.isSigner).map(S=>S.pubkey.toString())).flat()).values()].map(h=>m[h]).filter(h=>h!==void 0);if(n&&Ae({instructions:[...l.instructions,...g],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:f})){let h=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...l.instructions,...g]}).compileToV0Message(Object.values(s));p.push(new Ce(h))}else{let h=new Be({payerKey:this.feePayer,recentBlockhash:f,instructions:[...g]}).compileToV0Message(Object.values(s));p.push(new Ce(h))}y.push(b)}return(T=this.owner)!=null&&T.signer&&y.forEach(P=>{P.some(b=>b.publicKey.equals(this.owner.publicKey))||P.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:t,signers:y,instructionTypes:this.instructionTypes,execute:async P=>{var U;let{sequentially:b,onTxUpdate:h,skipTxCount:S=0,recentBlockHash:A,skipPreflight:M=!0}=P||{};if(p.map(async(v,_)=>{y[_].length&&v.sign(y[_]),A&&(v.message.recentBlockhash=A)}),le(p),(U=this.owner)!=null&&U.isKeyPair){if(b){let v=0,_=[];for(let D of p){if(++v,v<=S){console.log("skip tx: ",v),_.push("tx skipped");continue}let F=await this.connection.sendTransaction(D,{skipPreflight:M});await He(this.connection,F),_.push(F)}return{txIds:_,signedTxs:p}}return{txIds:await Promise.all(p.map(async v=>await this.connection.sendTransaction(v,{skipPreflight:M}))),signedTxs:p}}if(this.signAllTransactions){let v=await this.signAllTransactions(p.slice(S,p.length)),_=[...p.slice(0,S),...v];if(b){let D=0,F=[],X=async()=>{if(!_[D])return;if(D<S){F.push({txId:"",status:"success",signedTx:_[D]}),h==null||h([...F]),D++,X();return}let re=await this.connection.sendTransaction(_[D],{skipPreflight:M});F.push({txId:re,status:"sent",signedTx:_[D]}),h==null||h([...F]),D++,this.connection.onSignature(re,V=>{let E=F.findIndex(pn=>pn.txId===re);E>-1&&(F[E].status=V.err?"error":"success"),h==null||h([...F]),V.err||X()},"processed"),this.connection.getSignatureStatus(re)};return X(),{txIds:[],signedTxs:_}}else{let D=[];for(let F=0;F<_.length;F+=1){let X=await this.connection.sendTransaction(_[F],{skipPreflight:M});D.push(X)}return{txIds:D,signedTxs:_}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};var Gr=H("Raydium_amount"),sn=Te(qr);function Hr(e,t){let n="0",r="0";if(e.includes(".")){let i=e.split(".");i.length===2?([n,r]=i,r=r.padEnd(t,"0")):Gr.logWithError(`invalid number string, num: ${e}`)}else n=e;return[n,r.slice(0,t)||r]}var te=class extends N{constructor(n,r,i=!0,o){let s=new Ye(0),a=mt.pow(new Ye(n.decimals));if(i)s=z(r);else{let u=new Ye(0),c=new Ye(0);if(typeof r=="string"||typeof r=="number"||typeof r=="bigint"){let[l,f]=Hr(r.toString(),n.decimals);u=z(l),c=z(f)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=H(o||"TokenAmount"),this.token=n}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(n){return this.token.equals(n.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(n.raw)}lt(n){return this.token.equals(n.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(n.raw)}add(n){return this.token.equals(n.token)||this.logger.logWithError("add token not equals"),new te(this.token,this.raw.add(n.raw))}subtract(n){return this.token.equals(n.token)||this.logger.logWithError("sub token not equals"),new te(this.token,this.raw.sub(n.raw))}toSignificant(n=this.token.decimals,r,i=0){return super.toSignificant(n,r,i)}toFixed(n=this.token.decimals,r,i=0){return n>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(n,r,i)}toExact(n={groupSeparator:""}){return sn.DP=this.token.decimals,new sn(this.numerator.toString()).div(this.denominator.toString()).toFormat(n)}};function Qt(e){return typeof e=="object"&&e!==null&&![ce,te,jr,N,zr,ee,de].some(t=>typeof t=="object"&&e instanceof t)}function Qe(e){return typeof e=="string"?$e(e):Array.isArray(e)?e.map(t=>Qe(t)):Qt(e)?Object.fromEntries(Object.entries(e).map(([t,n])=>[t,Qe(n)])):e}var yt=(...e)=>e.map(t=>{try{return typeof t=="object"?JSON.stringify(t):t}catch{return t}}).join(", "),Le=class{constructor({scope:t,moduleName:n}){this.disabled=!1;this.scope=t,this.logger=H(n)}createTxBuilder(t){return this.scope.checkOwner(),new Ze({connection:this.scope.connection,feePayer:t||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...t){this.logger.debug(yt(t))}logInfo(...t){this.logger.info(yt(t))}logAndCreateError(...t){let n=yt(t);throw new Error(n)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};import{SYSVAR_CLOCK_PUBKEY as Jr,TransactionInstruction as ln}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as fn}from"@solana/spl-token";import{PublicKey as zu}from"@solana/web3.js";import Yu,{isBN as Qu}from"bn.js";import{bits as ja,BitStructure as za,blob as Za,Blob as Ya,cstr as Qa,f32 as Xa,f32be as Ja,f64 as $a,f64be as eu,greedy as tu,Layout as nu,ns64 as ru,ns64be as iu,nu64 as Zr,nu64be as ou,offset as su,s16 as au,s16be as uu,s24 as cu,s24be as lu,s32 as fu,s32be as mu,s40 as pu,s40be as du,s48 as gu,s48be as hu,s8 as bu,seq as yu,struct as wu,Structure as Yr,u16 as Tu,u16be as xu,u24 as Pu,u24be as Au,u32 as ku,u32be as Su,u40 as Bu,u40be as Cu,u48 as Lu,u48be as Iu,u8 as Nu,UInt as Qr,union as Mu,Union as Eu,unionLayoutDiscriminator as Ru,utf8 as Du}from"@solana/buffer-layout";var an=Yr;var un=Qr;var cn=Zr;function Tt(e){return new un(1,e)}var wt=class extends an{decode(t,n){return super.decode(t,n)}};function xt(e,t,n){return new wt(e,t,n)}var Xr=xt([Tt("instruction"),cn("amount")]),Ie=xt([Tt("instruction")]);function Xe({programId:e},t){let n=[{pubkey:fn,isSigner:!1,isWritable:!1},{pubkey:It,isSigner:!1,isWritable:!1},...Object.entries(t).map(([i,o])=>({pubkey:o,isSigner:i==="userOwner",isWritable:!["authority","userOwner"].includes(i)}))],r=Buffer.alloc(Ie.span);return Ie.encode({instruction:2},r),new ln({keys:n,programId:e,data:r})}function Pt(e){let{poolConfig:t,userKeys:n,side:r}=e,i=r==="base"?n.baseTokenAccount:n.quoteTokenAccount,o=r==="base"?t.baseVault:t.quoteVault,s=Buffer.alloc(Ie.span);Ie.encode({instruction:2},s);let a=[{pubkey:fn,isWritable:!1,isSigner:!1},{pubkey:Jr,isWritable:!1,isSigner:!1},{pubkey:t.id,isWritable:!0,isSigner:!1},{pubkey:t.authority,isWritable:!1,isSigner:!1},{pubkey:o,isWritable:!0,isSigner:!1},{pubkey:i,isWritable:!0,isSigner:!1},{pubkey:n.ledgerAccount,isWritable:!0,isSigner:!1},{pubkey:n.owner,isWritable:!1,isSigner:!0}];return new ln({programId:t.programId,keys:a,data:s})}var $r={[he.IDO_PROGRAM_ID_V1.toString()]:1,[he.IDO_PROGRAM_ID_V2.toString()]:2,[he.IDO_PROGRAM_ID_V3.toString()]:3,[he.IDO_PROGRAM_ID_V4.toString()]:4},At=class extends Le{async claim({ownerInfo:t,idoKeys:n,associatedOnly:r=!0,checkCreateATAOwner:i=!1,txVersion:o}){let s=this.createTxBuilder(),a=$r[n.programId];a||this.logAndCreateError("invalid version",a);let u=Qe(n),[c,l]=[!new mn(t.coin).isZero(),!new mn(t.pc).isZero()],f=u.projectInfo.mint.address.equals(fe),{account:m,instructionParams:p}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.projectInfo.mint.programId,mint:u.projectInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!f,notUseTokenAccount:f,associatedOnly:f?!1:r,checkCreateATAOwner:i});!m&&c&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),c&&p&&s.addInstruction(p);let y=u.buyInfo.mint.address.equals(fe),{account:g,instructionParams:w}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:u.buyInfo.mint.programId,mint:u.buyInfo.mint.address,owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!y,notUseTokenAccount:y,associatedOnly:y?!1:r,checkCreateATAOwner:i});if(!m&&l&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address),l&&w&&s.addInstruction(w),(!m||!g)&&this.logAndCreateError("target token accounts not found","mint",n.projectInfo.mint.address,n.buyInfo.mint.address),a===3)return s.addInstruction({instructions:[...c?[Xe({programId:u.programId},{idoId:u.id,authority:u.authority,poolTokenAccount:u.projectInfo.vault,userTokenAccount:m,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[],...l?[Xe({programId:new Ne(n.programId)},{idoId:u.id,authority:u.authority,poolTokenAccount:u.buyInfo.vault,userTokenAccount:g,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]:[]]}).versionBuild({txVersion:o});if(a<3)return!c&&!l&&this.logAndCreateError("no claimable rewards"),s.addInstruction({instructions:[Xe({programId:u.programId},{idoId:u.id,authority:u.authority,poolQuoteTokenAccount:u.buyInfo.vault,poolBaseTokenAccount:u.projectInfo.vault,userQuoteTokenAccount:g,userBaseTokenAccount:m,userIdoInfo:new Ne(t.userIdoInfo),userOwner:this.scope.ownerPubKey})]}).versionBuild({txVersion:o});let T={poolConfig:{id:u.id,programId:u.programId,authority:u.authority,baseVault:u.projectInfo.vault,quoteVault:u.buyInfo.vault,baseToken:n.projectInfo.mint,quoteToken:n.buyInfo.mint},userKeys:{baseTokenAccount:m,quoteTokenAccount:g,ledgerAccount:new Ne(t.userIdoInfo),owner:this.scope.ownerPubKey}};return s.addInstruction({instructions:[...c?[Pt(Z(W({},T),{side:"base"}))]:[],...l?[Pt(Z(W({},T),{side:"quote"}))]:[]]}).versionBuild({txVersion:o})}};export{At as default};
//# sourceMappingURL=ido.mjs.map