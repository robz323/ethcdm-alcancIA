var ds=Object.defineProperty,ps=Object.defineProperties;var fs=Object.getOwnPropertyDescriptors;var Kn=Object.getOwnPropertySymbols;var bi=Object.prototype.hasOwnProperty,yi=Object.prototype.propertyIsEnumerable;var fi=(r,e,t)=>e in r?ds(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,W=(r,e)=>{for(var t in e||(e={}))bi.call(e,t)&&fi(r,t,e[t]);if(Kn)for(var t of Kn(e))yi.call(e,t)&&fi(r,t,e[t]);return r},J=(r,e)=>ps(r,fs(e));var Fe=(r,e)=>{var t={};for(var n in r)bi.call(r,n)&&e.indexOf(n)<0&&(t[n]=r[n]);if(r!=null&&Kn)for(var n of Kn(r))e.indexOf(n)<0&&yi.call(r,n)&&(t[n]=r[n]);return t};import{PublicKey as ge}from"@solana/web3.js";import{AccountLayout as hc,NATIVE_MINT as ur,TOKEN_PROGRAM_ID as Tt}from"@solana/spl-token";import{PublicKey as Ga}from"@solana/web3.js";import ut from"bn.js";var Qt=9e15,gt=1e9,lr="0123456789abcdef",Nn="2.3025850929940456840179914546843642076011014886287729760333279009675726096773524802359972050895982983419677840422862486334095254650828067566662873690987816894829072083255546808437998948262331985283935053089653777326288461633662222876982198867465436674744042432743651550489343149393914796194044002221051017141748003688084012647080685567743216228355220114804663715659121373450747856947683463616792101806445070648000277502684916746550586856935673420670581136429224554405758925724208241314695689016758940256776311356919292033376587141660230105703089634572075440370847469940168269282808481184289314848524948644871927809676271275775397027668605952496716674183485704422507197965004714951050492214776567636938662976979522110718264549734772662425709429322582798502585509785265383207606726317164309505995087807523710333101197857547331541421808427543863591778117054309827482385045648019095610299291824318237525357709750539565187697510374970888692180205189339507238539205144634197265287286965110862571492198849978748873771345686209167058",Rn="3.1415926535897932384626433832795028841971693993751058209749445923078164062862089986280348253421170679821480865132823066470938446095505822317253594081284811174502841027019385211055596446229489549303819644288109756659334461284756482337867831652712019091456485669234603486104543266482133936072602491412737245870066063155881748815209209628292540917153643678925903600113305305488204665213841469519415116094330572703657595919530921861173819326117931051185480744623799627495673518857527248912279381830119491298336733624406566430860213949463952247371907021798609437027705392171762931767523846748184676694051320005681271452635608277857713427577896091736371787214684409012249534301465495853710507922796892589235420199561121290219608640344181598136297747713099605187072113499999983729780499510597317328160963185950244594553469083026425223082533446850352619311881710100031378387528865875332083814206171776691473035982534904287554687311595628638823537875937519577818577805321712268066130019278766111959092164201989380952572010654858632789",mr={precision:20,rounding:4,modulo:1,toExpNeg:-7,toExpPos:21,minE:-Qt,maxE:Qt,crypto:!1},ki,ot,z=!0,Mn="[DecimalError] ",yt=Mn+"Invalid argument: ",Ai=Mn+"Precision limit exceeded",Pi=Mn+"crypto unavailable",Ti="[object Decimal]",Ie=Math.floor,ke=Math.pow,bs=/^0b([01]+(\.[01]*)?|\.[01]+)(p[+-]?\d+)?$/i,ys=/^0x([0-9a-f]+(\.[0-9a-f]*)?|\.[0-9a-f]+)(p[+-]?\d+)?$/i,gs=/^0o([0-7]+(\.[0-7]*)?|\.[0-7]+)(p[+-]?\d+)?$/i,xi=/^(\d+(\.\d*)?|\.\d+)(e[+-]?\d+)?$/i,Qe=1e7,G=7,ws=9007199254740991,hs=Nn.length-1,dr=Rn.length-1,B={toStringTag:Ti};B.absoluteValue=B.abs=function(){var r=new this.constructor(this);return r.s<0&&(r.s=1),F(r)};B.ceil=function(){return F(new this.constructor(this),this.e+1,2)};B.clampedTo=B.clamp=function(r,e){var t,n=this,i=n.constructor;if(r=new i(r),e=new i(e),!r.s||!e.s)return new i(NaN);if(r.gt(e))throw Error(yt+e);return t=n.cmp(r),t<0?r:n.cmp(e)>0?e:new i(n)};B.comparedTo=B.cmp=function(r){var e,t,n,i,o=this,s=o.d,a=(r=new o.constructor(r)).d,u=o.s,c=r.s;if(!s||!a)return!u||!c?NaN:u!==c?u:s===a?0:!s^u<0?1:-1;if(!s[0]||!a[0])return s[0]?u:a[0]?-c:0;if(u!==c)return u;if(o.e!==r.e)return o.e>r.e^u<0?1:-1;for(n=s.length,i=a.length,e=0,t=n<i?n:i;e<t;++e)if(s[e]!==a[e])return s[e]>a[e]^u<0?1:-1;return n===i?0:n>i^u<0?1:-1};B.cosine=B.cos=function(){var r,e,t=this,n=t.constructor;return t.d?t.d[0]?(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+G,n.rounding=1,t=ks(n,Li(n,t)),n.precision=r,n.rounding=e,F(ot==2||ot==3?t.neg():t,r,e,!0)):new n(1):new n(NaN)};B.cubeRoot=B.cbrt=function(){var r,e,t,n,i,o,s,a,u,c,l=this,m=l.constructor;if(!l.isFinite()||l.isZero())return new m(l);for(z=!1,o=l.s*ke(l.s*l,1/3),!o||Math.abs(o)==1/0?(t=xe(l.d),r=l.e,(o=(r-t.length+1)%3)&&(t+=o==1||o==-2?"0":"00"),o=ke(t,1/3),r=Ie((r+1)/3)-(r%3==(r<0?-1:2)),o==1/0?t="5e"+r:(t=o.toExponential(),t=t.slice(0,t.indexOf("e")+1)+r),n=new m(t),n.s=l.s):n=new m(o.toString()),s=(r=m.precision)+3;;)if(a=n,u=a.times(a).times(a),c=u.plus(l),n=ue(c.plus(l).times(a),c.plus(u),s+2,1),xe(a.d).slice(0,s)===(t=xe(n.d)).slice(0,s))if(t=t.slice(s-3,s+1),t=="9999"||!i&&t=="4999"){if(!i&&(F(a,r+1,0),a.times(a).times(a).eq(l))){n=a;break}s+=4,i=1}else{(!+t||!+t.slice(1)&&t.charAt(0)=="5")&&(F(n,r+1,1),e=!n.times(n).times(n).eq(l));break}return z=!0,F(n,r,m.rounding,e)};B.decimalPlaces=B.dp=function(){var r,e=this.d,t=NaN;if(e){if(r=e.length-1,t=(r-Ie(this.e/G))*G,r=e[r],r)for(;r%10==0;r/=10)t--;t<0&&(t=0)}return t};B.dividedBy=B.div=function(r){return ue(this,new this.constructor(r))};B.dividedToIntegerBy=B.divToInt=function(r){var e=this,t=e.constructor;return F(ue(e,new t(r),0,1,1),t.precision,t.rounding)};B.equals=B.eq=function(r){return this.cmp(r)===0};B.floor=function(){return F(new this.constructor(this),this.e+1,3)};B.greaterThan=B.gt=function(r){return this.cmp(r)>0};B.greaterThanOrEqualTo=B.gte=function(r){var e=this.cmp(r);return e==1||e===0};B.hyperbolicCosine=B.cosh=function(){var r,e,t,n,i,o=this,s=o.constructor,a=new s(1);if(!o.isFinite())return new s(o.s?1/0:NaN);if(o.isZero())return a;t=s.precision,n=s.rounding,s.precision=t+Math.max(o.e,o.sd())+4,s.rounding=1,i=o.d.length,i<32?(r=Math.ceil(i/3),e=(1/vn(4,r)).toString()):(r=16,e="2.3283064365386962890625e-10"),o=Ht(s,1,o.times(e),new s(1),!0);for(var u,c=r,l=new s(8);c--;)u=o.times(o),o=a.minus(u.times(l.minus(u.times(l))));return F(o,s.precision=t,s.rounding=n,!0)};B.hyperbolicSine=B.sinh=function(){var r,e,t,n,i=this,o=i.constructor;if(!i.isFinite()||i.isZero())return new o(i);if(e=o.precision,t=o.rounding,o.precision=e+Math.max(i.e,i.sd())+4,o.rounding=1,n=i.d.length,n<3)i=Ht(o,2,i,i,!0);else{r=1.4*Math.sqrt(n),r=r>16?16:r|0,i=i.times(1/vn(5,r)),i=Ht(o,2,i,i,!0);for(var s,a=new o(5),u=new o(16),c=new o(20);r--;)s=i.times(i),i=i.times(a.plus(s.times(u.times(s).plus(c))))}return o.precision=e,o.rounding=t,F(i,e,t,!0)};B.hyperbolicTangent=B.tanh=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+7,n.rounding=1,ue(t.sinh(),t.cosh(),n.precision=r,n.rounding=e)):new n(t.s)};B.inverseCosine=B.acos=function(){var r,e=this,t=e.constructor,n=e.abs().cmp(1),i=t.precision,o=t.rounding;return n!==-1?n===0?e.isNeg()?ze(t,i,o):new t(0):new t(NaN):e.isZero()?ze(t,i+4,o).times(.5):(t.precision=i+6,t.rounding=1,e=e.asin(),r=ze(t,i+4,o).times(.5),t.precision=i,t.rounding=o,r.minus(e))};B.inverseHyperbolicCosine=B.acosh=function(){var r,e,t=this,n=t.constructor;return t.lte(1)?new n(t.eq(1)?0:NaN):t.isFinite()?(r=n.precision,e=n.rounding,n.precision=r+Math.max(Math.abs(t.e),t.sd())+4,n.rounding=1,z=!1,t=t.times(t).minus(1).sqrt().plus(t),z=!0,n.precision=r,n.rounding=e,t.ln()):new n(t)};B.inverseHyperbolicSine=B.asinh=function(){var r,e,t=this,n=t.constructor;return!t.isFinite()||t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+2*Math.max(Math.abs(t.e),t.sd())+6,n.rounding=1,z=!1,t=t.times(t).plus(1).sqrt().plus(t),z=!0,n.precision=r,n.rounding=e,t.ln())};B.inverseHyperbolicTangent=B.atanh=function(){var r,e,t,n,i=this,o=i.constructor;return i.isFinite()?i.e>=0?new o(i.abs().eq(1)?i.s/0:i.isZero()?i:NaN):(r=o.precision,e=o.rounding,n=i.sd(),Math.max(n,r)<2*-i.e-1?F(new o(i),r,e,!0):(o.precision=t=n-i.e,i=ue(i.plus(1),new o(1).minus(i),t+r,1),o.precision=r+4,o.rounding=1,i=i.ln(),o.precision=r,o.rounding=e,i.times(.5))):new o(NaN)};B.inverseSine=B.asin=function(){var r,e,t,n,i=this,o=i.constructor;return i.isZero()?new o(i):(e=i.abs().cmp(1),t=o.precision,n=o.rounding,e!==-1?e===0?(r=ze(o,t+4,n).times(.5),r.s=i.s,r):new o(NaN):(o.precision=t+6,o.rounding=1,i=i.div(new o(1).minus(i.times(i)).sqrt().plus(1)).atan(),o.precision=t,o.rounding=n,i.times(2)))};B.inverseTangent=B.atan=function(){var r,e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding;if(c.isFinite()){if(c.isZero())return new l(c);if(c.abs().eq(1)&&m+4<=dr)return s=ze(l,m+4,d).times(.25),s.s=c.s,s}else{if(!c.s)return new l(NaN);if(m+4<=dr)return s=ze(l,m+4,d).times(.5),s.s=c.s,s}for(l.precision=a=m+10,l.rounding=1,t=Math.min(28,a/G+2|0),r=t;r;--r)c=c.div(c.times(c).plus(1).sqrt().plus(1));for(z=!1,e=Math.ceil(a/G),n=1,u=c.times(c),s=new l(c),i=c;r!==-1;)if(i=i.times(u),o=s.minus(i.div(n+=2)),i=i.times(u),s=o.plus(i.div(n+=2)),s.d[e]!==void 0)for(r=e;s.d[r]===o.d[r]&&r--;);return t&&(s=s.times(2<<t-1)),z=!0,F(s,l.precision=m,l.rounding=d,!0)};B.isFinite=function(){return!!this.d};B.isInteger=B.isInt=function(){return!!this.d&&Ie(this.e/G)>this.d.length-2};B.isNaN=function(){return!this.s};B.isNegative=B.isNeg=function(){return this.s<0};B.isPositive=B.isPos=function(){return this.s>0};B.isZero=function(){return!!this.d&&this.d[0]===0};B.lessThan=B.lt=function(r){return this.cmp(r)<0};B.lessThanOrEqualTo=B.lte=function(r){return this.cmp(r)<1};B.logarithm=B.log=function(r){var e,t,n,i,o,s,a,u,c=this,l=c.constructor,m=l.precision,d=l.rounding,p=5;if(r==null)r=new l(10),e=!0;else{if(r=new l(r),t=r.d,r.s<0||!t||!t[0]||r.eq(1))return new l(NaN);e=r.eq(10)}if(t=c.d,c.s<0||!t||!t[0]||c.eq(1))return new l(t&&!t[0]?-1/0:c.s!=1?NaN:t?0:1/0);if(e)if(t.length>1)o=!0;else{for(i=t[0];i%10===0;)i/=10;o=i!==1}if(z=!1,a=m+p,s=bt(c,a),n=e?Cn(l,a+10):bt(r,a),u=ue(s,n,a,1),sn(u.d,i=m,d))do if(a+=10,s=bt(c,a),n=e?Cn(l,a+10):bt(r,a),u=ue(s,n,a,1),!o){+xe(u.d).slice(i+1,i+15)+1==1e14&&(u=F(u,m+1,0));break}while(sn(u.d,i+=10,d));return z=!0,F(u,m,d)};B.minus=B.sub=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.constructor;if(r=new y(r),!p.d||!r.d)return!p.s||!r.s?r=new y(NaN):p.d?r.s=-r.s:r=new y(r.d||p.s!==r.s?p:NaN),r;if(p.s!=r.s)return r.s=-r.s,p.plus(r);if(c=p.d,d=r.d,a=y.precision,u=y.rounding,!c[0]||!d[0]){if(d[0])r.s=-r.s;else if(c[0])r=new y(p);else return new y(u===3?-0:0);return z?F(r,a,u):r}if(t=Ie(r.e/G),l=Ie(p.e/G),c=c.slice(),o=l-t,o){for(m=o<0,m?(e=c,o=-o,s=d.length):(e=d,t=l,s=c.length),n=Math.max(Math.ceil(a/G),s)+2,o>n&&(o=n,e.length=1),e.reverse(),n=o;n--;)e.push(0);e.reverse()}else{for(n=c.length,s=d.length,m=n<s,m&&(s=n),n=0;n<s;n++)if(c[n]!=d[n]){m=c[n]<d[n];break}o=0}for(m&&(e=c,c=d,d=e,r.s=-r.s),s=c.length,n=d.length-s;n>0;--n)c[s++]=0;for(n=d.length;n>o;){if(c[--n]<d[n]){for(i=n;i&&c[--i]===0;)c[i]=Qe-1;--c[i],c[n]+=Qe}c[n]-=d[n]}for(;c[--s]===0;)c.pop();for(;c[0]===0;c.shift())--t;return c[0]?(r.d=c,r.e=En(c,t),z?F(r,a,u):r):new y(u===3?-0:0)};B.modulo=B.mod=function(r){var e,t=this,n=t.constructor;return r=new n(r),!t.d||!r.s||r.d&&!r.d[0]?new n(NaN):!r.d||t.d&&!t.d[0]?F(new n(t),n.precision,n.rounding):(z=!1,n.modulo==9?(e=ue(t,r.abs(),0,3,1),e.s*=r.s):e=ue(t,r,0,n.modulo,1),e=e.times(r),z=!0,t.minus(e))};B.naturalExponential=B.exp=function(){return pr(this)};B.naturalLogarithm=B.ln=function(){return bt(this)};B.negated=B.neg=function(){var r=new this.constructor(this);return r.s=-r.s,F(r)};B.plus=B.add=function(r){var e,t,n,i,o,s,a,u,c,l,m=this,d=m.constructor;if(r=new d(r),!m.d||!r.d)return!m.s||!r.s?r=new d(NaN):m.d||(r=new d(r.d||m.s===r.s?m:NaN)),r;if(m.s!=r.s)return r.s=-r.s,m.minus(r);if(c=m.d,l=r.d,a=d.precision,u=d.rounding,!c[0]||!l[0])return l[0]||(r=new d(m)),z?F(r,a,u):r;if(o=Ie(m.e/G),n=Ie(r.e/G),c=c.slice(),i=o-n,i){for(i<0?(t=c,i=-i,s=l.length):(t=l,n=o,s=c.length),o=Math.ceil(a/G),s=o>s?o+1:s+1,i>s&&(i=s,t.length=1),t.reverse();i--;)t.push(0);t.reverse()}for(s=c.length,i=l.length,s-i<0&&(i=s,t=l,l=c,c=t),e=0;i;)e=(c[--i]=c[i]+l[i]+e)/Qe|0,c[i]%=Qe;for(e&&(c.unshift(e),++n),s=c.length;c[--s]==0;)c.pop();return r.d=c,r.e=En(c,n),z?F(r,a,u):r};B.precision=B.sd=function(r){var e,t=this;if(r!==void 0&&r!==!!r&&r!==1&&r!==0)throw Error(yt+r);return t.d?(e=Si(t.d),r&&t.e+1>e&&(e=t.e+1)):e=NaN,e};B.round=function(){var r=this,e=r.constructor;return F(new e(r),r.e+1,e.rounding)};B.sine=B.sin=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+Math.max(t.e,t.sd())+G,n.rounding=1,t=Ps(n,Li(n,t)),n.precision=r,n.rounding=e,F(ot>2?t.neg():t,r,e,!0)):new n(NaN)};B.squareRoot=B.sqrt=function(){var r,e,t,n,i,o,s=this,a=s.d,u=s.e,c=s.s,l=s.constructor;if(c!==1||!a||!a[0])return new l(!c||c<0&&(!a||a[0])?NaN:a?s:1/0);for(z=!1,c=Math.sqrt(+s),c==0||c==1/0?(e=xe(a),(e.length+u)%2==0&&(e+="0"),c=Math.sqrt(e),u=Ie((u+1)/2)-(u<0||u%2),c==1/0?e="5e"+u:(e=c.toExponential(),e=e.slice(0,e.indexOf("e")+1)+u),n=new l(e)):n=new l(c.toString()),t=(u=l.precision)+3;;)if(o=n,n=o.plus(ue(s,o,t+2,1)).times(.5),xe(o.d).slice(0,t)===(e=xe(n.d)).slice(0,t))if(e=e.slice(t-3,t+1),e=="9999"||!i&&e=="4999"){if(!i&&(F(o,u+1,0),o.times(o).eq(s))){n=o;break}t+=4,i=1}else{(!+e||!+e.slice(1)&&e.charAt(0)=="5")&&(F(n,u+1,1),r=!n.times(n).eq(s));break}return z=!0,F(n,u,l.rounding,r)};B.tangent=B.tan=function(){var r,e,t=this,n=t.constructor;return t.isFinite()?t.isZero()?new n(t):(r=n.precision,e=n.rounding,n.precision=r+10,n.rounding=1,t=t.sin(),t.s=1,t=ue(t,new n(1).minus(t.times(t)).sqrt(),r+10,0),n.precision=r,n.rounding=e,F(ot==2||ot==4?t.neg():t,r,e,!0)):new n(NaN)};B.times=B.mul=function(r){var e,t,n,i,o,s,a,u,c,l=this,m=l.constructor,d=l.d,p=(r=new m(r)).d;if(r.s*=l.s,!d||!d[0]||!p||!p[0])return new m(!r.s||d&&!d[0]&&!p||p&&!p[0]&&!d?NaN:!d||!p?r.s/0:r.s*0);for(t=Ie(l.e/G)+Ie(r.e/G),u=d.length,c=p.length,u<c&&(o=d,d=p,p=o,s=u,u=c,c=s),o=[],s=u+c,n=s;n--;)o.push(0);for(n=c;--n>=0;){for(e=0,i=u+n;i>n;)a=o[i]+p[n]*d[i-n-1]+e,o[i--]=a%Qe|0,e=a/Qe|0;o[i]=(o[i]+e)%Qe|0}for(;!o[--s];)o.pop();return e?++t:o.shift(),r.d=o,r.e=En(o,t),z?F(r,m.precision,m.rounding):r};B.toBinary=function(r,e){return br(this,2,r,e)};B.toDecimalPlaces=B.toDP=function(r,e){var t=this,n=t.constructor;return t=new n(t),r===void 0?t:(ve(r,0,gt),e===void 0?e=n.rounding:ve(e,0,8),F(t,r+t.e+1,e))};B.toExponential=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=Je(n,!0):(ve(r,0,gt),e===void 0?e=i.rounding:ve(e,0,8),n=F(new i(n),r+1,e),t=Je(n,!0,r+1)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toFixed=function(r,e){var t,n,i=this,o=i.constructor;return r===void 0?t=Je(i):(ve(r,0,gt),e===void 0?e=o.rounding:ve(e,0,8),n=F(new o(i),r+i.e+1,e),t=Je(n,!1,r+n.e+1)),i.isNeg()&&!i.isZero()?"-"+t:t};B.toFraction=function(r){var e,t,n,i,o,s,a,u,c,l,m,d,p=this,y=p.d,f=p.constructor;if(!y)return new f(p);if(c=t=new f(1),n=u=new f(0),e=new f(n),o=e.e=Si(y)-p.e-1,s=o%G,e.d[0]=ke(10,s<0?G+s:s),r==null)r=o>0?e:c;else{if(a=new f(r),!a.isInt()||a.lt(c))throw Error(yt+a);r=a.gt(e)?o>0?e:c:a}for(z=!1,a=new f(xe(y)),l=f.precision,f.precision=o=y.length*G*2;m=ue(a,e,0,1,1),i=t.plus(m.times(n)),i.cmp(r)!=1;)t=n,n=i,i=c,c=u.plus(m.times(i)),u=i,i=e,e=a.minus(m.times(i)),a=i;return i=ue(r.minus(t),n,0,1,1),u=u.plus(i.times(c)),t=t.plus(i.times(n)),u.s=c.s=p.s,d=ue(c,n,o,1).minus(p).abs().cmp(ue(u,t,o,1).minus(p).abs())<1?[c,n]:[u,t],f.precision=l,z=!0,d};B.toHexadecimal=B.toHex=function(r,e){return br(this,16,r,e)};B.toNearest=function(r,e){var t=this,n=t.constructor;if(t=new n(t),r==null){if(!t.d)return t;r=new n(1),e=n.rounding}else{if(r=new n(r),e===void 0?e=n.rounding:ve(e,0,8),!t.d)return r.s?t:r;if(!r.d)return r.s&&(r.s=t.s),r}return r.d[0]?(z=!1,t=ue(t,r,0,e,1).times(r),z=!0,F(t)):(r.s=t.s,t=r),t};B.toNumber=function(){return+this};B.toOctal=function(r,e){return br(this,8,r,e)};B.toPower=B.pow=function(r){var e,t,n,i,o,s,a=this,u=a.constructor,c=+(r=new u(r));if(!a.d||!r.d||!a.d[0]||!r.d[0])return new u(ke(+a,c));if(a=new u(a),a.eq(1))return a;if(n=u.precision,o=u.rounding,r.eq(1))return F(a,n,o);if(e=Ie(r.e/G),e>=r.d.length-1&&(t=c<0?-c:c)<=ws)return i=Bi(u,a,t,n),r.s<0?new u(1).div(i):F(i,n,o);if(s=a.s,s<0){if(e<r.d.length-1)return new u(NaN);if((r.d[e]&1)==0&&(s=1),a.e==0&&a.d[0]==1&&a.d.length==1)return a.s=s,a}return t=ke(+a,c),e=t==0||!isFinite(t)?Ie(c*(Math.log("0."+xe(a.d))/Math.LN10+a.e+1)):new u(t+"").e,e>u.maxE+1||e<u.minE-1?new u(e>0?s/0:0):(z=!1,u.rounding=a.s=1,t=Math.min(12,(e+"").length),i=pr(r.times(bt(a,n+t)),n),i.d&&(i=F(i,n+5,1),sn(i.d,n,o)&&(e=n+10,i=F(pr(r.times(bt(a,e+t)),e),e+5,1),+xe(i.d).slice(n+1,n+15)+1==1e14&&(i=F(i,n+1,0)))),i.s=s,z=!0,u.rounding=o,F(i,n,o))};B.toPrecision=function(r,e){var t,n=this,i=n.constructor;return r===void 0?t=Je(n,n.e<=i.toExpNeg||n.e>=i.toExpPos):(ve(r,1,gt),e===void 0?e=i.rounding:ve(e,0,8),n=F(new i(n),r,e),t=Je(n,r<=n.e||n.e<=i.toExpNeg,r)),n.isNeg()&&!n.isZero()?"-"+t:t};B.toSignificantDigits=B.toSD=function(r,e){var t=this,n=t.constructor;return r===void 0?(r=n.precision,e=n.rounding):(ve(r,1,gt),e===void 0?e=n.rounding:ve(e,0,8)),F(new n(t),r,e)};B.toString=function(){var r=this,e=r.constructor,t=Je(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()&&!r.isZero()?"-"+t:t};B.truncated=B.trunc=function(){return F(new this.constructor(this),this.e+1,1)};B.valueOf=B.toJSON=function(){var r=this,e=r.constructor,t=Je(r,r.e<=e.toExpNeg||r.e>=e.toExpPos);return r.isNeg()?"-"+t:t};function xe(r){var e,t,n,i=r.length-1,o="",s=r[0];if(i>0){for(o+=s,e=1;e<i;e++)n=r[e]+"",t=G-n.length,t&&(o+=ft(t)),o+=n;s=r[e],n=s+"",t=G-n.length,t&&(o+=ft(t))}else if(s===0)return"0";for(;s%10===0;)s/=10;return o+s}function ve(r,e,t){if(r!==~~r||r<e||r>t)throw Error(yt+r)}function sn(r,e,t,n){var i,o,s,a;for(o=r[0];o>=10;o/=10)--e;return--e<0?(e+=G,i=0):(i=Math.ceil((e+1)/G),e%=G),o=ke(10,G-e),a=r[i]%o|0,n==null?e<3?(e==0?a=a/100|0:e==1&&(a=a/10|0),s=t<4&&a==99999||t>3&&a==49999||a==5e4||a==0):s=(t<4&&a+1==o||t>3&&a+1==o/2)&&(r[i+1]/o/100|0)==ke(10,e-2)-1||(a==o/2||a==0)&&(r[i+1]/o/100|0)==0:e<4?(e==0?a=a/1e3|0:e==1?a=a/100|0:e==2&&(a=a/10|0),s=(n||t<4)&&a==9999||!n&&t>3&&a==4999):s=((n||t<4)&&a+1==o||!n&&t>3&&a+1==o/2)&&(r[i+1]/o/1e3|0)==ke(10,e-3)-1,s}function Ln(r,e,t){for(var n,i=[0],o,s=0,a=r.length;s<a;){for(o=i.length;o--;)i[o]*=e;for(i[0]+=lr.indexOf(r.charAt(s++)),n=0;n<i.length;n++)i[n]>t-1&&(i[n+1]===void 0&&(i[n+1]=0),i[n+1]+=i[n]/t|0,i[n]%=t)}return i.reverse()}function ks(r,e){var t,n,i;if(e.isZero())return e;n=e.d.length,n<32?(t=Math.ceil(n/3),i=(1/vn(4,t)).toString()):(t=16,i="2.3283064365386962890625e-10"),r.precision+=t,e=Ht(r,1,e.times(i),new r(1));for(var o=t;o--;){var s=e.times(e);e=s.times(s).minus(s).times(8).plus(1)}return r.precision-=t,e}var ue=function(){function r(n,i,o){var s,a=0,u=n.length;for(n=n.slice();u--;)s=n[u]*i+a,n[u]=s%o|0,a=s/o|0;return a&&n.unshift(a),n}function e(n,i,o,s){var a,u;if(o!=s)u=o>s?1:-1;else for(a=u=0;a<o;a++)if(n[a]!=i[a]){u=n[a]>i[a]?1:-1;break}return u}function t(n,i,o,s){for(var a=0;o--;)n[o]-=a,a=n[o]<i[o]?1:0,n[o]=a*s+n[o]-i[o];for(;!n[0]&&n.length>1;)n.shift()}return function(n,i,o,s,a,u){var c,l,m,d,p,y,f,w,g,A,h,k,T,P,K,x,_,E,v,Q,H=n.constructor,ie=n.s==i.s?1:-1,ee=n.d,D=i.d;if(!ee||!ee[0]||!D||!D[0])return new H(!n.s||!i.s||(ee?D&&ee[0]==D[0]:!D)?NaN:ee&&ee[0]==0||!D?ie*0:ie/0);for(u?(p=1,l=n.e-i.e):(u=Qe,p=G,l=Ie(n.e/p)-Ie(i.e/p)),v=D.length,_=ee.length,g=new H(ie),A=g.d=[],m=0;D[m]==(ee[m]||0);m++);if(D[m]>(ee[m]||0)&&l--,o==null?(P=o=H.precision,s=H.rounding):a?P=o+(n.e-i.e)+1:P=o,P<0)A.push(1),y=!0;else{if(P=P/p+2|0,m=0,v==1){for(d=0,D=D[0],P++;(m<_||d)&&P--;m++)K=d*u+(ee[m]||0),A[m]=K/D|0,d=K%D|0;y=d||m<_}else{for(d=u/(D[0]+1)|0,d>1&&(D=r(D,d,u),ee=r(ee,d,u),v=D.length,_=ee.length),x=v,h=ee.slice(0,v),k=h.length;k<v;)h[k++]=0;Q=D.slice(),Q.unshift(0),E=D[0],D[1]>=u/2&&++E;do d=0,c=e(D,h,v,k),c<0?(T=h[0],v!=k&&(T=T*u+(h[1]||0)),d=T/E|0,d>1?(d>=u&&(d=u-1),f=r(D,d,u),w=f.length,k=h.length,c=e(f,h,w,k),c==1&&(d--,t(f,v<w?Q:D,w,u))):(d==0&&(c=d=1),f=D.slice()),w=f.length,w<k&&f.unshift(0),t(h,f,k,u),c==-1&&(k=h.length,c=e(D,h,v,k),c<1&&(d++,t(h,v<k?Q:D,k,u))),k=h.length):c===0&&(d++,h=[0]),A[m++]=d,c&&h[0]?h[k++]=ee[x]||0:(h=[ee[x]],k=1);while((x++<_||h[0]!==void 0)&&P--);y=h[0]!==void 0}A[0]||A.shift()}if(p==1)g.e=l,ki=y;else{for(m=1,d=A[0];d>=10;d/=10)m++;g.e=m+l*p-1,F(g,a?o+g.e+1:o,s,y)}return g}}();function F(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor;e:if(e!=null){if(m=r.d,!m)return r;for(i=1,a=m[0];a>=10;a/=10)i++;if(o=e-i,o<0)o+=G,s=e,l=m[d=0],u=l/ke(10,i-s-1)%10|0;else if(d=Math.ceil((o+1)/G),a=m.length,d>=a)if(n){for(;a++<=d;)m.push(0);l=u=0,i=1,o%=G,s=o-G+1}else break e;else{for(l=a=m[d],i=1;a>=10;a/=10)i++;o%=G,s=o-G+i,u=s<0?0:l/ke(10,i-s-1)%10|0}if(n=n||e<0||m[d+1]!==void 0||(s<0?l:l%ke(10,i-s-1)),c=t<4?(u||n)&&(t==0||t==(r.s<0?3:2)):u>5||u==5&&(t==4||n||t==6&&(o>0?s>0?l/ke(10,i-s):0:m[d-1])%10&1||t==(r.s<0?8:7)),e<1||!m[0])return m.length=0,c?(e-=r.e+1,m[0]=ke(10,(G-e%G)%G),r.e=-e||0):m[0]=r.e=0,r;if(o==0?(m.length=d,a=1,d--):(m.length=d+1,a=ke(10,G-o),m[d]=s>0?(l/ke(10,i-s)%ke(10,s)|0)*a:0),c)for(;;)if(d==0){for(o=1,s=m[0];s>=10;s/=10)o++;for(s=m[0]+=a,a=1;s>=10;s/=10)a++;o!=a&&(r.e++,m[0]==Qe&&(m[0]=1));break}else{if(m[d]+=a,m[d]!=Qe)break;m[d--]=0,a=1}for(o=m.length;m[--o]===0;)m.pop()}return z&&(r.e>p.maxE?(r.d=null,r.e=NaN):r.e<p.minE&&(r.e=0,r.d=[0])),r}function Je(r,e,t){if(!r.isFinite())return Ki(r);var n,i=r.e,o=xe(r.d),s=o.length;return e?(t&&(n=t-s)>0?o=o.charAt(0)+"."+o.slice(1)+ft(n):s>1&&(o=o.charAt(0)+"."+o.slice(1)),o=o+(r.e<0?"e":"e+")+r.e):i<0?(o="0."+ft(-i-1)+o,t&&(n=t-s)>0&&(o+=ft(n))):i>=s?(o+=ft(i+1-s),t&&(n=t-i-1)>0&&(o=o+"."+ft(n))):((n=i+1)<s&&(o=o.slice(0,n)+"."+o.slice(n)),t&&(n=t-s)>0&&(i+1===s&&(o+="."),o+=ft(n))),o}function En(r,e){var t=r[0];for(e*=G;t>=10;t/=10)e++;return e}function Cn(r,e,t){if(e>hs)throw z=!0,t&&(r.precision=t),Error(Ai);return F(new r(Nn),e,1,!0)}function ze(r,e,t){if(e>dr)throw Error(Ai);return F(new r(Rn),e,t,!0)}function Si(r){var e=r.length-1,t=e*G+1;if(e=r[e],e){for(;e%10==0;e/=10)t--;for(e=r[0];e>=10;e/=10)t++}return t}function ft(r){for(var e="";r--;)e+="0";return e}function Bi(r,e,t,n){var i,o=new r(1),s=Math.ceil(n/G+4);for(z=!1;;){if(t%2&&(o=o.times(e),wi(o.d,s)&&(i=!0)),t=Ie(t/2),t===0){t=o.d.length-1,i&&o.d[t]===0&&++o.d[t];break}e=e.times(e),wi(e.d,s)}return z=!0,o}function gi(r){return r.d[r.d.length-1]&1}function Ii(r,e,t){for(var n,i=new r(e[0]),o=0;++o<e.length;)if(n=new r(e[o]),n.s)i[t](n)&&(i=n);else{i=n;break}return i}function pr(r,e){var t,n,i,o,s,a,u,c=0,l=0,m=0,d=r.constructor,p=d.rounding,y=d.precision;if(!r.d||!r.d[0]||r.e>17)return new d(r.d?r.d[0]?r.s<0?0:1/0:1:r.s?r.s<0?0:r:0/0);for(e==null?(z=!1,u=y):u=e,a=new d(.03125);r.e>-2;)r=r.times(a),m+=5;for(n=Math.log(ke(2,m))/Math.LN10*2+5|0,u+=n,t=o=s=new d(1),d.precision=u;;){if(o=F(o.times(r),u,1),t=t.times(++l),a=s.plus(ue(o,t,u,1)),xe(a.d).slice(0,u)===xe(s.d).slice(0,u)){for(i=m;i--;)s=F(s.times(s),u,1);if(e==null)if(c<3&&sn(s.d,u-n,p,c))d.precision=u+=10,t=o=a=new d(1),l=0,c++;else return F(s,d.precision=y,p,z=!0);else return d.precision=y,s}s=a}}function bt(r,e){var t,n,i,o,s,a,u,c,l,m,d,p=1,y=10,f=r,w=f.d,g=f.constructor,A=g.rounding,h=g.precision;if(f.s<0||!w||!w[0]||!f.e&&w[0]==1&&w.length==1)return new g(w&&!w[0]?-1/0:f.s!=1?NaN:w?0:f);if(e==null?(z=!1,l=h):l=e,g.precision=l+=y,t=xe(w),n=t.charAt(0),Math.abs(o=f.e)<15e14){for(;n<7&&n!=1||n==1&&t.charAt(1)>3;)f=f.times(r),t=xe(f.d),n=t.charAt(0),p++;o=f.e,n>1?(f=new g("0."+t),o++):f=new g(n+"."+t.slice(1))}else return c=Cn(g,l+2,h).times(o+""),f=bt(new g(n+"."+t.slice(1)),l-y).plus(c),g.precision=h,e==null?F(f,h,A,z=!0):f;for(m=f,u=s=f=ue(f.minus(1),f.plus(1),l,1),d=F(f.times(f),l,1),i=3;;){if(s=F(s.times(d),l,1),c=u.plus(ue(s,new g(i),l,1)),xe(c.d).slice(0,l)===xe(u.d).slice(0,l))if(u=u.times(2),o!==0&&(u=u.plus(Cn(g,l+2,h).times(o+""))),u=ue(u,new g(p),l,1),e==null)if(sn(u.d,l-y,A,a))g.precision=l+=y,c=s=f=ue(m.minus(1),m.plus(1),l,1),d=F(f.times(f),l,1),i=a=1;else return F(u,g.precision=h,A,z=!0);else return g.precision=h,u;u=c,i+=2}}function Ki(r){return String(r.s*r.s/0)}function fr(r,e){var t,n,i;for((t=e.indexOf("."))>-1&&(e=e.replace(".","")),(n=e.search(/e/i))>0?(t<0&&(t=n),t+=+e.slice(n+1),e=e.substring(0,n)):t<0&&(t=e.length),n=0;e.charCodeAt(n)===48;n++);for(i=e.length;e.charCodeAt(i-1)===48;--i);if(e=e.slice(n,i),e){if(i-=n,r.e=t=t-n-1,r.d=[],n=(t+1)%G,t<0&&(n+=G),n<i){for(n&&r.d.push(+e.slice(0,n)),i-=G;n<i;)r.d.push(+e.slice(n,n+=G));e=e.slice(n),n=G-e.length}else n-=i;for(;n--;)e+="0";r.d.push(+e),z&&(r.e>r.constructor.maxE?(r.d=null,r.e=NaN):r.e<r.constructor.minE&&(r.e=0,r.d=[0]))}else r.e=0,r.d=[0];return r}function As(r,e){var t,n,i,o,s,a,u,c,l;if(e.indexOf("_")>-1){if(e=e.replace(/(\d)_(?=\d)/g,"$1"),xi.test(e))return fr(r,e)}else if(e==="Infinity"||e==="NaN")return+e||(r.s=NaN),r.e=NaN,r.d=null,r;if(ys.test(e))t=16,e=e.toLowerCase();else if(bs.test(e))t=2;else if(gs.test(e))t=8;else throw Error(yt+e);for(o=e.search(/p/i),o>0?(u=+e.slice(o+1),e=e.substring(2,o)):e=e.slice(2),o=e.indexOf("."),s=o>=0,n=r.constructor,s&&(e=e.replace(".",""),a=e.length,o=a-o,i=Bi(n,new n(t),o,o*2)),c=Ln(e,t,Qe),l=c.length-1,o=l;c[o]===0;--o)c.pop();return o<0?new n(r.s*0):(r.e=En(c,l),r.d=c,z=!1,s&&(r=ue(r,i,a*4)),u&&(r=r.times(Math.abs(u)<54?ke(2,u):an.pow(2,u))),z=!0,r)}function Ps(r,e){var t,n=e.d.length;if(n<3)return e.isZero()?e:Ht(r,2,e,e);t=1.4*Math.sqrt(n),t=t>16?16:t|0,e=e.times(1/vn(5,t)),e=Ht(r,2,e,e);for(var i,o=new r(5),s=new r(16),a=new r(20);t--;)i=e.times(e),e=e.times(o.plus(i.times(s.times(i).minus(a))));return e}function Ht(r,e,t,n,i){var o,s,a,u,c=1,l=r.precision,m=Math.ceil(l/G);for(z=!1,u=t.times(t),a=new r(n);;){if(s=ue(a.times(u),new r(e++*e++),l,1),a=i?n.plus(s):n.minus(s),n=ue(s.times(u),new r(e++*e++),l,1),s=a.plus(n),s.d[m]!==void 0){for(o=m;s.d[o]===a.d[o]&&o--;);if(o==-1)break}o=a,a=n,n=s,s=o,c++}return z=!0,s.d.length=m+1,s}function vn(r,e){for(var t=r;--e;)t*=r;return t}function Li(r,e){var t,n=e.s<0,i=ze(r,r.precision,1),o=i.times(.5);if(e=e.abs(),e.lte(o))return ot=n?4:1,e;if(t=e.divToInt(i),t.isZero())ot=n?3:2;else{if(e=e.minus(t.times(i)),e.lte(o))return ot=gi(t)?n?2:3:n?4:1,e;ot=gi(t)?n?1:4:n?3:2}return e.minus(i).abs()}function br(r,e,t,n){var i,o,s,a,u,c,l,m,d,p=r.constructor,y=t!==void 0;if(y?(ve(t,1,gt),n===void 0?n=p.rounding:ve(n,0,8)):(t=p.precision,n=p.rounding),!r.isFinite())l=Ki(r);else{for(l=Je(r),s=l.indexOf("."),y?(i=2,e==16?t=t*4-3:e==8&&(t=t*3-2)):i=e,s>=0&&(l=l.replace(".",""),d=new p(1),d.e=l.length-s,d.d=Ln(Je(d),10,i),d.e=d.d.length),m=Ln(l,10,i),o=u=m.length;m[--u]==0;)m.pop();if(!m[0])l=y?"0p+0":"0";else{if(s<0?o--:(r=new p(r),r.d=m,r.e=o,r=ue(r,d,t,n,0,i),m=r.d,o=r.e,c=ki),s=m[t],a=i/2,c=c||m[t+1]!==void 0,c=n<4?(s!==void 0||c)&&(n===0||n===(r.s<0?3:2)):s>a||s===a&&(n===4||c||n===6&&m[t-1]&1||n===(r.s<0?8:7)),m.length=t,c)for(;++m[--t]>i-1;)m[t]=0,t||(++o,m.unshift(1));for(u=m.length;!m[u-1];--u);for(s=0,l="";s<u;s++)l+=lr.charAt(m[s]);if(y){if(u>1)if(e==16||e==8){for(s=e==16?4:3,--u;u%s;u++)l+="0";for(m=Ln(l,i,e),u=m.length;!m[u-1];--u);for(s=1,l="1.";s<u;s++)l+=lr.charAt(m[s])}else l=l.charAt(0)+"."+l.slice(1);l=l+(o<0?"p":"p+")+o}else if(o<0){for(;++o;)l="0"+l;l="0."+l}else if(++o>u)for(o-=u;o--;)l+="0";else o<u&&(l=l.slice(0,o)+"."+l.slice(o))}l=(e==16?"0x":e==2?"0b":e==8?"0o":"")+l}return r.s<0?"-"+l:l}function wi(r,e){if(r.length>e)return r.length=e,!0}function Ts(r){return new this(r).abs()}function xs(r){return new this(r).acos()}function Ss(r){return new this(r).acosh()}function Bs(r,e){return new this(r).plus(e)}function Is(r){return new this(r).asin()}function Ks(r){return new this(r).asinh()}function Ls(r){return new this(r).atan()}function Ns(r){return new this(r).atanh()}function Rs(r,e){r=new this(r),e=new this(e);var t,n=this.precision,i=this.rounding,o=n+4;return!r.s||!e.s?t=new this(NaN):!r.d&&!e.d?(t=ze(this,o,1).times(e.s>0?.25:.75),t.s=r.s):!e.d||r.isZero()?(t=e.s<0?ze(this,n,i):new this(0),t.s=r.s):!r.d||e.isZero()?(t=ze(this,o,1).times(.5),t.s=r.s):e.s<0?(this.precision=o,this.rounding=1,t=this.atan(ue(r,e,o,1)),e=ze(this,o,1),this.precision=n,this.rounding=i,t=r.s<0?t.minus(e):t.plus(e)):t=this.atan(ue(r,e,o,1)),t}function Cs(r){return new this(r).cbrt()}function Ms(r){return F(r=new this(r),r.e+1,2)}function Es(r,e,t){return new this(r).clamp(e,t)}function vs(r){if(!r||typeof r!="object")throw Error(Mn+"Object expected");var e,t,n,i=r.defaults===!0,o=["precision",1,gt,"rounding",0,8,"toExpNeg",-Qt,0,"toExpPos",0,Qt,"maxE",0,Qt,"minE",-Qt,0,"modulo",0,9];for(e=0;e<o.length;e+=3)if(t=o[e],i&&(this[t]=mr[t]),(n=r[t])!==void 0)if(Ie(n)===n&&n>=o[e+1]&&n<=o[e+2])this[t]=n;else throw Error(yt+t+": "+n);if(t="crypto",i&&(this[t]=mr[t]),(n=r[t])!==void 0)if(n===!0||n===!1||n===0||n===1)if(n)if(typeof crypto<"u"&&crypto&&(crypto.getRandomValues||crypto.randomBytes))this[t]=!0;else throw Error(Pi);else this[t]=!1;else throw Error(yt+t+": "+n);return this}function _s(r){return new this(r).cos()}function Os(r){return new this(r).cosh()}function Ni(r){var e,t,n;function i(o){var s,a,u,c=this;if(!(c instanceof i))return new i(o);if(c.constructor=i,hi(o)){c.s=o.s,z?!o.d||o.e>i.maxE?(c.e=NaN,c.d=null):o.e<i.minE?(c.e=0,c.d=[0]):(c.e=o.e,c.d=o.d.slice()):(c.e=o.e,c.d=o.d?o.d.slice():o.d);return}if(u=typeof o,u==="number"){if(o===0){c.s=1/o<0?-1:1,c.e=0,c.d=[0];return}if(o<0?(o=-o,c.s=-1):c.s=1,o===~~o&&o<1e7){for(s=0,a=o;a>=10;a/=10)s++;z?s>i.maxE?(c.e=NaN,c.d=null):s<i.minE?(c.e=0,c.d=[0]):(c.e=s,c.d=[o]):(c.e=s,c.d=[o]);return}else if(o*0!==0){o||(c.s=NaN),c.e=NaN,c.d=null;return}return fr(c,o.toString())}else if(u!=="string")throw Error(yt+o);return(a=o.charCodeAt(0))===45?(o=o.slice(1),c.s=-1):(a===43&&(o=o.slice(1)),c.s=1),xi.test(o)?fr(c,o):As(c,o)}if(i.prototype=B,i.ROUND_UP=0,i.ROUND_DOWN=1,i.ROUND_CEIL=2,i.ROUND_FLOOR=3,i.ROUND_HALF_UP=4,i.ROUND_HALF_DOWN=5,i.ROUND_HALF_EVEN=6,i.ROUND_HALF_CEIL=7,i.ROUND_HALF_FLOOR=8,i.EUCLID=9,i.config=i.set=vs,i.clone=Ni,i.isDecimal=hi,i.abs=Ts,i.acos=xs,i.acosh=Ss,i.add=Bs,i.asin=Is,i.asinh=Ks,i.atan=Ls,i.atanh=Ns,i.atan2=Rs,i.cbrt=Cs,i.ceil=Ms,i.clamp=Es,i.cos=_s,i.cosh=Os,i.div=Vs,i.exp=Fs,i.floor=Ws,i.hypot=Ds,i.ln=qs,i.log=Gs,i.log10=Xs,i.log2=Us,i.max=zs,i.min=Qs,i.mod=Hs,i.mul=Ys,i.pow=js,i.random=Zs,i.round=$s,i.sign=Js,i.sin=ea,i.sinh=ta,i.sqrt=na,i.sub=ra,i.sum=ia,i.tan=oa,i.tanh=sa,i.trunc=aa,r===void 0&&(r={}),r&&r.defaults!==!0)for(n=["precision","rounding","toExpNeg","toExpPos","maxE","minE","modulo","crypto"],e=0;e<n.length;)r.hasOwnProperty(t=n[e++])||(r[t]=this[t]);return i.config(r),i}function Vs(r,e){return new this(r).div(e)}function Fs(r){return new this(r).exp()}function Ws(r){return F(r=new this(r),r.e+1,3)}function Ds(){var r,e,t=new this(0);for(z=!1,r=0;r<arguments.length;)if(e=new this(arguments[r++]),e.d)t.d&&(t=t.plus(e.times(e)));else{if(e.s)return z=!0,new this(1/0);t=e}return z=!0,t.sqrt()}function hi(r){return r instanceof an||r&&r.toStringTag===Ti||!1}function qs(r){return new this(r).ln()}function Gs(r,e){return new this(r).log(e)}function Us(r){return new this(r).log(2)}function Xs(r){return new this(r).log(10)}function zs(){return Ii(this,arguments,"lt")}function Qs(){return Ii(this,arguments,"gt")}function Hs(r,e){return new this(r).mod(e)}function Ys(r,e){return new this(r).mul(e)}function js(r,e){return new this(r).pow(e)}function Zs(r){var e,t,n,i,o=0,s=new this(1),a=[];if(r===void 0?r=this.precision:ve(r,1,gt),n=Math.ceil(r/G),this.crypto)if(crypto.getRandomValues)for(e=crypto.getRandomValues(new Uint32Array(n));o<n;)i=e[o],i>=429e7?e[o]=crypto.getRandomValues(new Uint32Array(1))[0]:a[o++]=i%1e7;else if(crypto.randomBytes){for(e=crypto.randomBytes(n*=4);o<n;)i=e[o]+(e[o+1]<<8)+(e[o+2]<<16)+((e[o+3]&127)<<24),i>=214e7?crypto.randomBytes(4).copy(e,o):(a.push(i%1e7),o+=4);o=n/4}else throw Error(Pi);else for(;o<n;)a[o++]=Math.random()*1e7|0;for(n=a[--o],r%=G,n&&r&&(i=ke(10,G-r),a[o]=(n/i|0)*i);a[o]===0;o--)a.pop();if(o<0)t=0,a=[0];else{for(t=-1;a[0]===0;t-=G)a.shift();for(n=1,i=a[0];i>=10;i/=10)n++;n<G&&(t-=G-n)}return s.e=t,s.d=a,s}function $s(r){return F(r=new this(r),r.e+1,this.rounding)}function Js(r){return r=new this(r),r.d?r.d[0]?r.s:0*r.s:r.s||NaN}function ea(r){return new this(r).sin()}function ta(r){return new this(r).sinh()}function na(r){return new this(r).sqrt()}function ra(r,e){return new this(r).sub(e)}function ia(){var r=0,e=arguments,t=new this(e[r]);for(z=!1;t.s&&++r<e.length;)t=t.plus(e[r]);return z=!0,F(t,this.precision,this.rounding)}function oa(r){return new this(r).tan()}function sa(r){return new this(r).tanh()}function aa(r){return F(r=new this(r),r.e+1,1)}B[Symbol.for("nodejs.util.inspect.custom")]=B.toString;B[Symbol.toStringTag]="Decimal";var an=B.constructor=Ni(mr);Nn=new an(Nn);Rn=new an(Rn);var L=an;import ga from"big.js";import Vn from"bn.js";import{get as Ri,set as ua}from"lodash";var yr=class{constructor(e){this.logLevel=e.logLevel!==void 0?e.logLevel:0,this.name=e.name}set level(e){this.logLevel=e}get time(){return Date.now().toString()}get moduleName(){return this.name}isLogLevel(e){return e<=this.logLevel}error(...e){return this.isLogLevel(0)?(console.error(this.time,this.name,"sdk logger error",...e),this):this}logWithError(...e){let t=e.map(n=>typeof n=="object"?JSON.stringify(n):n).join(", ");throw new Error(t)}warning(...e){return this.isLogLevel(1)?(console.warn(this.time,this.name,"sdk logger warning",...e),this):this}info(...e){return this.isLogLevel(2)?(console.info(this.time,this.name,"sdk logger info",...e),this):this}debug(...e){return this.isLogLevel(3)?(console.debug(this.time,this.name,"sdk logger debug",...e),this):this}},Ci={},ca={};function ae(r){let e=Ri(Ci,r);if(!e){let t=Ri(ca,r);e=new yr({name:r,logLevel:t}),ua(Ci,r,e)}return e}import la from"toformat";var ma=la,un=ma;import On from"big.js";import pa from"bn.js";import fa from"decimal.js-light";import cn from"bn.js";var Mi=9007199254740991;function te(r){let e=ae("Raydium_parseBigNumberish");if(r instanceof cn)return r;if(typeof r=="string"){if(r.match(/^-?[0-9]+$/))return new cn(r);e.logWithError(`invalid BigNumberish string: ${r}`)}return typeof r=="number"?(r%1&&e.logWithError(`BigNumberish number underflow: ${r}`),(r>=Mi||r<=-Mi)&&e.logWithError(`BigNumberish number overflow: ${r}`),new cn(String(r))):typeof r=="bigint"?new cn(r.toString()):(e.error(`invalid BigNumberish value: ${r}`),new cn(0))}var _n=ae("module/fraction"),gr=un(On),ln=un(fa),ba={[0]:ln.ROUND_DOWN,[1]:ln.ROUND_HALF_UP,[2]:ln.ROUND_UP},ya={[0]:On.roundDown,[1]:On.roundHalfUp,[2]:On.roundUp},oe=class{constructor(e,t=new pa(1)){this.numerator=te(e),this.denominator=te(t)}get quotient(){return this.numerator.div(this.denominator)}invert(){return new oe(this.denominator,this.numerator)}add(e){let t=e instanceof oe?e:new oe(te(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.add(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).add(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}sub(e){let t=e instanceof oe?e:new oe(te(e));return this.denominator.eq(t.denominator)?new oe(this.numerator.sub(t.numerator),this.denominator):new oe(this.numerator.mul(t.denominator).sub(t.numerator.mul(this.denominator)),this.denominator.mul(t.denominator))}mul(e){let t=e instanceof oe?e:new oe(te(e));return new oe(this.numerator.mul(t.numerator),this.denominator.mul(t.denominator))}div(e){let t=e instanceof oe?e:new oe(te(e));return new oe(this.numerator.mul(t.denominator),this.denominator.mul(t.numerator))}toSignificant(e,t={groupSeparator:""},n=1){Number.isInteger(e)||_n.logWithError(`${e} is not an integer.`),e<=0&&_n.logWithError(`${e} is not positive.`),ln.set({precision:e+1,rounding:ba[n]});let i=new ln(this.numerator.toString()).div(this.denominator.toString()).toSignificantDigits(e);return i.toFormat(i.decimalPlaces(),t)}toFixed(e,t={groupSeparator:""},n=1){return Number.isInteger(e)||_n.logWithError(`${e} is not an integer.`),e<0&&_n.logWithError(`${e} is negative.`),gr.DP=e,gr.RM=ya[n]||1,new gr(this.numerator.toString()).div(this.denominator.toString()).toFormat(e,t)}isZero(){return this.numerator.isZero()}};var wa=ae("Raydium_amount"),Ei=un(ga);function ha(r,e){let t="0",n="0";if(r.includes(".")){let i=r.split(".");i.length===2?([t,n]=i,n=n.padEnd(e,"0")):wa.logWithError(`invalid number string, num: ${r}`)}else t=r;return[t,n.slice(0,e)||n]}var fe=class extends oe{constructor(t,n,i=!0,o){let s=new Vn(0),a=wr.pow(new Vn(t.decimals));if(i)s=te(n);else{let u=new Vn(0),c=new Vn(0);if(typeof n=="string"||typeof n=="number"||typeof n=="bigint"){let[l,m]=ha(n.toString(),t.decimals);u=te(l),c=te(m)}u=u.mul(a),s=u.add(c)}super(s,a);this.logger=ae(o||"TokenAmount"),this.token=t}get raw(){return this.numerator}isZero(){return this.raw.isZero()}gt(t){return this.token.equals(t.token)||this.logger.logWithError("gt token not equals"),this.raw.gt(t.raw)}lt(t){return this.token.equals(t.token)||this.logger.logWithError("lt token not equals"),this.raw.lt(t.raw)}add(t){return this.token.equals(t.token)||this.logger.logWithError("add token not equals"),new fe(this.token,this.raw.add(t.raw))}subtract(t){return this.token.equals(t.token)||this.logger.logWithError("sub token not equals"),new fe(this.token,this.raw.sub(t.raw))}toSignificant(t=this.token.decimals,n,i=0){return super.toSignificant(t,n,i)}toFixed(t=this.token.decimals,n,i=0){return t>this.token.decimals&&this.logger.logWithError("decimals overflow"),super.toFixed(t,n,i)}toExact(t={groupSeparator:""}){return Ei.DP=this.token.decimals,new Ei(this.numerator.toString()).div(this.denominator.toString()).toFormat(t)}};import{PublicKey as ka}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as vi}from"@solana/spl-token";var hr={chainId:101,address:ka.default.toBase58(),programId:vi.toBase58(),decimals:9,symbol:"SOL",name:"solana",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}},st={chainId:101,address:"So11111111111111111111111111111111111111112",programId:vi.toBase58(),decimals:9,symbol:"WSOL",name:"Wrapped SOL",logoURI:"https://img-v1.raydium.io/icon/So11111111111111111111111111111111111111112.png",tags:[],priority:2,type:"raydium",extensions:{coingeckoId:"solana"}};import{PublicKey as Tr}from"@solana/web3.js";import{PublicKey as me,SystemProgram as _i,SYSVAR_RENT_PUBKEY as Aa}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as Pa}from"@solana/spl-token";function S({pubkey:r,isSigner:e=!1,isWritable:t=!0}){return{pubkey:r,isWritable:t,isSigner:e}}var Ta=[S({pubkey:Pa,isWritable:!1}),S({pubkey:_i.programId,isWritable:!1}),S({pubkey:Aa,isWritable:!1})];function kr({publicKey:r,transformSol:e}){let t=Ar(r.toString());if(t instanceof me)return e&&t.equals(jt)?Yt:t;if(e&&t.toString()===jt.toBase58())return Yt;if(typeof t=="string"){if(t===me.default.toBase58())return me.default;try{return new me(t)}catch{throw new Error("invalid public key")}}throw new Error("invalid public key")}function Ar(r){try{return new me(r)}catch{return r}}var Fn=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),Pr=new me("MemoSq4gqABAXKb96qnH8TysNcWxMyWCqXgDLGmfcHr"),at=new me("SysvarRent111111111111111111111111111111111"),el=new me("SysvarC1ock11111111111111111111111111111111"),Bt=new me("metaqbxxUerdq28cj1RbAWkYQm3ybzjb6a8bt518x1s"),xa=new me("Sysvar1nstructions1111111111111111111111111"),tl=_i.programId,nl=new me("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),rl=new me("Ea5SjE2Y6yvCeW5dYTn7PYMuW5ikXkvbGdcmSnXeaLjS"),il=new me("SRMuApVNdxXokk5GT7XD5cUUgXMBCoAz2LHeuAoKWRt"),ol=new me("EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v"),sl=new me("Es9vMFrzaCERmJfrF4H2FYD4KCoNkY11McCe8BenwNYB"),al=new me("mSoLzYCxHdYgdzU16g5QSh3i5K3z3KZK7ytfqcJm7So"),ul=new me("7dHbWXmci3dT8UFYWYZweBLXgycu7Y3iL6trKn1Y7ARj"),cl=new me("USDH1SM1ojwWUga67PGrgFWUHibbjqMvuMaDkRJTgkX"),ll=new me("NRVwhjBQiUPYtfDT5zRBVJajzFQHaBUNtC7SNVvqRFa"),ml=new me("ANAxByE6G2WjFp7A4NqtWYXb3mgruyzZYg3spfxe6Lbo"),dl=new me("7vfCXTUXx5WJV5JADk17DUJ4ksgau7utNKj4b963voxs"),Yt=new me("So11111111111111111111111111111111111111112"),jt=me.default;function Zt(r){return kr({publicKey:r,transformSol:!0})}var xr=class{constructor({mint:e,decimals:t,symbol:n,name:i,skipMint:o=!1,isToken2022:s=!1}){if(e===jt.toBase58()||e instanceof Tr&&jt.equals(e)){this.decimals=st.decimals,this.symbol=st.symbol,this.name=st.name,this.mint=new Tr(st.address),this.isToken2022=!1;return}this.decimals=t,this.symbol=n||e.toString().substring(0,6),this.name=i||e.toString().substring(0,6),this.mint=o?Tr.default:kr({publicKey:e}),this.isToken2022=s}equals(e){return this===e?!0:this.mint.equals(e.mint)}},Ke=xr;Ke.WSOL=new xr(J(W({},st),{mint:st.address}));var Sr=class{constructor({decimals:e,symbol:t="UNKNOWN",name:n="UNKNOWN"}){this.decimals=e,this.symbol=t,this.name=n}equals(e){return this===e}},Wn=Sr;Wn.SOL=new Sr(hr);import Sa from"bn.js";var Oi=new oe(new Sa(100)),We=class extends oe{toSignificant(e=5,t,n){return this.mul(Oi).toSignificant(e,t,n)}toFixed(e=2,t,n){return this.mul(Oi).toFixed(e,t,n)}};var Ba=ae("Raydium_price"),De=class extends oe{constructor(t){let{baseToken:n,quoteToken:i,numerator:o,denominator:s}=t;super(o,s);this.baseToken=n,this.quoteToken=i,this.scalar=new oe(Br(n.decimals),Br(i.decimals))}get raw(){return new oe(this.numerator,this.denominator)}get adjusted(){return super.mul(this.scalar)}invert(){return new De({baseToken:this.quoteToken,quoteToken:this.baseToken,denominator:this.numerator,numerator:this.denominator})}mul(t){this.quoteToken!==t.baseToken&&Ba.logWithError("mul token not equals");let n=super.mul(t);return new De({baseToken:this.baseToken,quoteToken:t.quoteToken,denominator:n.denominator,numerator:n.numerator})}toSignificant(t=this.quoteToken.decimals,n,i){return this.adjusted.toSignificant(t,n,i)}toFixed(t=this.quoteToken.decimals,n,i){return this.adjusted.toFixed(t,n,i)}};import{PublicKey as Ia}from"@solana/web3.js";import Ka from"bn.js";function Vi(r){return typeof r=="object"&&r!==null&&![Ke,fe,Ia,oe,Ka,De,We].some(e=>typeof e=="object"&&r instanceof e)}function It(r){return typeof r=="string"?Ar(r):Array.isArray(r)?r.map(e=>It(e)):Vi(r)?Object.fromEntries(Object.entries(r).map(([e,t])=>[e,It(t)])):r}var wt=new ut(0),Fi=new ut(1),am=new ut(2),um=new ut(3),cm=new ut(5),wr=new ut(10),lm=new ut(100),mm=new ut(1e3),dm=new ut(1e4);function Br(r){return wr.pow(te(r))}function Dn(r,e){let t=r.divmod(e);return t.mod.isZero()?t.div:t.div.isNeg()?t.div.isubn(1):t.div.iaddn(1)}function Ir(r,e=1,t=[]){let n=[...r];if(e<=0)return t;for(;n.length;)t.push(n.splice(0,e));return t}import{PublicKey as va}from"@solana/web3.js";import{TOKEN_PROGRAM_ID as _a}from"@solana/spl-token";import{ComputeBudgetProgram as Wi,Keypair as qi,PublicKey as La,Transaction as Gi,TransactionMessage as Na,VersionedTransaction as Ui}from"@solana/web3.js";var X={CreateAccount:"CreateAccount",InitAccount:"InitAccount",CreateATA:"CreateATA",CloseAccount:"CloseAccount",TransferAmount:"TransferAmount",InitMint:"InitMint",MintTo:"MintTo",InitMarket:"InitMarket",Util1216OwnerClaim:"Util1216OwnerClaim",SetComputeUnitPrice:"SetComputeUnitPrice",SetComputeUnitLimit:"SetComputeUnitLimit",ClmmCreatePool:"ClmmCreatePool",ClmmOpenPosition:"ClmmOpenPosition",ClmmIncreasePosition:"ClmmIncreasePosition",ClmmDecreasePosition:"ClmmDecreasePosition",ClmmClosePosition:"ClmmClosePosition",ClmmSwapBaseIn:"ClmmSwapBaseIn",ClmmSwapBaseOut:"ClmmSwapBaseOut",ClmmInitReward:"ClmmInitReward",ClmmSetReward:"ClmmSetReward",ClmmCollectReward:"ClmmCollectReward",ClmmLockPosition:"ClmmLockPosition",ClmmHarvestLockPosition:"ClmmHarvestLockPosition",AmmV4Swap:"AmmV4Swap",AmmV4AddLiquidity:"AmmV4AddLiquidity",AmmV4RemoveLiquidity:"AmmV4RemoveLiquidity",AmmV4SimulatePoolInfo:"AmmV4SimulatePoolInfo",AmmV4SwapBaseIn:"AmmV4SwapBaseIn",AmmV4SwapBaseOut:"AmmV4SwapBaseOut",AmmV4CreatePool:"AmmV4CreatePool",AmmV4InitPool:"AmmV4InitPool",AmmV5AddLiquidity:"AmmV5AddLiquidity",AmmV5RemoveLiquidity:"AmmV5RemoveLiquidity",AmmV5SimulatePoolInfo:"AmmV5SimulatePoolInfo",AmmV5SwapBaseIn:"AmmV5SwapBaseIn",AmmV5SwapBaseOut:"AmmV5SwapBaseOut",RouteSwap:"RouteSwap",RouteSwap1:"RouteSwap1",RouteSwap2:"RouteSwap2",FarmV3Deposit:"FarmV3Deposit",FarmV3Withdraw:"FarmV3Withdraw",FarmV3CreateLedger:"FarmV3CreateLedger",FarmV4Withdraw:"FarmV4Withdraw",FarmV5Deposit:"FarmV5Deposit",FarmV5Withdraw:"FarmV5Withdraw",FarmV5CreateLedger:"FarmV5CreateLedger",FarmV6Deposit:"FarmV6Deposit",FarmV6Withdraw:"FarmV6Withdraw",FarmV6Create:"FarmV6Create",FarmV6Restart:"FarmV6Restart",FarmV6CreatorAddReward:"FarmV6CreatorAddReward",FarmV6CreatorWithdraw:"FarmV6CreatorWithdraw",CpmmCreatePool:"CpmmCreatePool",CpmmAddLiquidity:"CpmmAddLiquidity",CpmmWithdrawLiquidity:"CpmmWithdrawLiquidity",CpmmSwapBaseIn:"CpmmSwapBaseIn",CpmmSwapBaseOut:"CpmmSwapBaseOut",CpmmLockLp:"CpmmLockLp",CpmmCollectLockFee:"CpmmCollectLockFee"};import{TOKEN_PROGRAM_ID as Ra}from"@solana/spl-token";var Di=ae("Raydium_txUtil"),Xi=1644;function qn(r){let e=[],t=[];return r.microLamports&&(e.push(Wi.setComputeUnitPrice({microLamports:r.microLamports})),t.push(X.SetComputeUnitPrice)),r.units&&(e.push(Wi.setComputeUnitLimit({units:r.units})),t.push(X.SetComputeUnitLimit)),{instructions:e,instructionTypes:t}}async function $t(r,e){var n,i;let t=e!=null?e:"confirmed";return(i=await((n=r.getLatestBlockhash)==null?void 0:n.call(r,{commitment:t})))==null?void 0:i.blockhash}async function Gn(r,e){return r.getSignatureStatuses([e]),new Promise((t,n)=>{let i=setTimeout(n,6e4);r.onSignature(e,o=>{if(clearTimeout(i),!o.err){t("");return}n(o.err.toString())},"confirmed")})}function Ca(r,e){r.length<1&&Di.logWithError(`no instructions provided: ${r.toString()}`),e.length<1&&Di.logWithError(`no signers provided:, ${e.toString()}`);let t=new Gi;t.recentBlockhash="11111111111111111111111111111111",t.feePayer=e[0],t.add(...r);try{return Buffer.from(t.serialize({verifySignatures:!1})).toString("base64").length<Xi}catch{return!1}}function de(r,e){let[t,n]=La.findProgramAddressSync(r,e);return{publicKey:t,nonce:n}}function mn({instructions:r,payer:e,signers:t}){return Ca(r,[e,...t])}function dn({instructions:r,payer:e,lookupTableAddressAccount:t,recentBlockhash:n=qi.generate().publicKey.toString()}){let o=new Na({payerKey:e,recentBlockhash:n,instructions:r}).compileToV0Message(Object.values(t!=null?t:{}));try{return Buffer.from(new Ui(o).serialize()).toString("base64").length<Xi}catch{return!1}}var Ma=r=>Buffer.isBuffer(r)?r:r instanceof Uint8Array?Buffer.from(r.buffer,r.byteOffset,r.byteLength):Buffer.from(r),Ea=r=>{let e=r.serialize({requireAllSignatures:!1,verifySignatures:!1});r instanceof Ui&&(e=Ma(e));try{return e instanceof Buffer?e.toString("base64"):Buffer.from(e).toString("base64")}catch{return e.toString("base64")}};function Kt(r){let e=[];return r.forEach(t=>{t instanceof Gi&&(t.recentBlockhash||(t.recentBlockhash=Ra.toBase58()),t.feePayer||(t.feePayer=qi.generate().publicKey)),e.push(Ea(t))}),console.log("simulate tx string:",e),e}function Pe(r,e,t){return de([r.toBuffer(),(t!=null?t:_a).toBuffer(),e.toBuffer()],new va("ATokenGPvbdGVxr1b2hvZbsiqW5xWH25efTNsLJA8knL"))}import{PublicKey as j}from"@solana/web3.js";var zi=new j("EhhTKczWMGQt46ynNeRX1WfeagwwJd7ufHvCDjRxjo5Q"),Qi=new j("CBuCnLe26faBpcBP2fktp4rp8abpcAnTWft6ZrP5Q4T"),Hi=new j("9KEPoZmtHUrBbhWN1v1KWLMkkvwY6WLtAVUCPRtRjP4z"),Yi=new j("FarmqiPv5eAj3j1GMdMCMUGXqPUvmquZtMy86QH6rzhG"),Mm=new j("CLaimxFqjHzgTJtAGHU47NPhg6qrc5sCnpC4tBLyABQS"),ji=new j("srmqPvymJeFKQ4zGQed1GFppgkRHL9kaELCbyksJtPX"),Em=new j("9xQeWvG816bUx9EPjHmaT23yvVM2ZWbrrpZb9PusVFin"),Zi=new j("675kPX9MHTjS2zt1qfr1NYHuzeLXfQM9H24wFSUt1Mp8"),vm=new j("5quBtoiQqxF9Jv6KYKctB59NT3gtJD2Y65kdnB1Uev3h"),_m=new j("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Om=new j("CAMMCzo5YL8w4VFF8KVHrK22GGUsp5VTaW7grrKgrWqK"),Vm=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Fm=new j("kN1kEznaF5Xbd8LYuqtEFcxzWSBk5Fv6ygX6SqEGJVy"),Wm=new j("routeUGWgWzqBWFcrCfv8tritsqukccJPu3q5GPP3xS"),$i=new j("7YttLkHDoNj9wyDur5pM1ejNaAvT9X4eqaYcHQqtj2G5"),Dm=new j("6FJon3QE27qgPVggARueB22hLvoh22VzJpXv4rBEoSLF"),qm=new j("CC12se5To1CdEuw7fDS27B7Geo5jJyL7t5UK2B44NgiH"),Gm=new j("9HzJyW1qZsEiSfMUf6L2jo3CcTKAyBmSyKdwQeYisHrC"),Um=new j("DropEU8AvevN3UrXWXTMuz3rqnMczQVNjq3kcSdW2SQi"),Xm=new j("CPMMoo8L3F4NbTegBCKVNunggL7H1ZpdTHKxQB5qKP1C"),zm=new j("GpMZbSM2GgvTKHJirzeGfMFoaZ8UR2X7F4v8vHTvxFbL"),Qm=new j("DNXgeM9EiiaAbaWvwjHj9fQQLAX5ZsfHyvmYUNRAdNC8"),Oa=new j("CPMDWBwJDtYax9qW7AyRuVC19Cc4L4Vcy4n2BHAbHkCW"),Va=new j("7rQ1QFNosMkUCuh7Z7fPbTHvh73b68sQYdirycEzJVuw"),Fa=new j("G11FKBRaAkHAKuLCgLM6K6NUc9rTjPAznRCjZifrTQe2"),Hm=new j("LockrWmn6K5twhz3y9w1dQERbmgSaRkfnTeTKbpofwE"),Wa=new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),Ym=new j("3f7GcQFG397GAaEnv51zR6tsTVihYRydnydDD1cXekxH"),Da=new j("7AFUeLVRjBfzqK3tTGw8hN48KLQWSk6DTE8xprWdPqix");var jm={SERUM_MARKET:j.default,OPENBOOK_MARKET:new j("EoTcMgcDRTJVZDMZWBoU6rhYHZfkNTVEAfz3uUJRcYGj"),UTIL1216:j.default,FarmV3:new j("85BFyr98MbCUU9MVTEgzx1nbhWACbJqLzho6zd6DZcWL"),FarmV5:new j("EcLzTrNg9V7qhcdyXDe2qjtPkiGzDM2UbdRaeaadU5r2"),FarmV6:new j("Farm2hJLcqPtPg8M4rR6DMrsRNc5TPm5Cs4bVQrMe2T7"),AmmV4:new j("HWy1jotHpo6UqeQxx49dpYYdQB8wj9Qk9MdxwjLvDHB8"),AmmStable:new j("DDg4VmQaJV9ogWce7LpcjBA9bv22wRp5uaTPa5pGjijF"),CLMM:new j("devi51mZmdwUJGU9hjN27vEz64Gps7uUefqxg27EAtH"),CLMM_LOCK_PROGRAM_ID:new j("DLockwT7X7sxtLmGH9g5kmfcjaBtncdbUmi738m5bvQC"),CLMM_LOCK_AUTH_ID:new j("8qmHNvu2Kr2C7U8mJL4Vz1vTDxMhVuXKREwU7TNoaVEo"),Router:new j("BVChZ3XFEwTMUk1o9i3HAf91H6mFxSwa5X2wFAWhYPhU"),CREATE_CPMM_POOL_PROGRAM:Oa,CREATE_CPMM_POOL_AUTH:Va,CREATE_CPMM_POOL_FEE_ACC:Fa,FEE_DESTINATION_ID:new j("3XMrhbv989VxAMi3DErLV9eJht1pHppW5LbKxe9fkEFR"),LOCK_CPMM_PROGRAM:Wa,LCOK_CPMM_AUTH:Da};import He from"bn.js";var pn=1e4;function be(r,e,t,n){if(e===void 0)return{amount:r,fee:void 0,expirationTime:void 0};let i=J(W({},e),{olderTransferFee:{epoch:BigInt(e.olderTransferFee.epoch),maximumFee:BigInt(e.olderTransferFee.maximumFee),transferFeeBasisPoints:e.olderTransferFee.transferFeeBasisPoints},newerTransferFee:{epoch:BigInt(e.newerTransferFee.epoch),maximumFee:BigInt(e.newerTransferFee.maximumFee),transferFeeBasisPoints:e.newerTransferFee.transferFeeBasisPoints}}),o=t.epoch<i.newerTransferFee.epoch?i.olderTransferFee:i.newerTransferFee,s=new He(o.maximumFee.toString()),a=t.epoch<i.newerTransferFee.epoch?(Number(i.newerTransferFee.epoch)*t.slotsInEpoch-t.absoluteSlot)*400/1e3:void 0;if(n)if(o.transferFeeBasisPoints===pn){let u=new He(o.maximumFee.toString());return{amount:r.add(u),fee:u,expirationTime:a}}else{let u=fn(r.mul(new He(pn)),new He(pn-o.transferFeeBasisPoints)),c=new He(o.maximumFee.toString()),l=u.sub(r).gt(c)?r.add(c):u,m=fn(l.mul(new He(o.transferFeeBasisPoints)),new He(pn)),d=m.gt(s)?s:m;return{amount:l,fee:d,expirationTime:a}}else{let u=fn(r.mul(new He(o.transferFeeBasisPoints)),new He(pn)),c=u.gt(s)?s:u;return{amount:r,fee:c,expirationTime:a}}}function ht(r,e){return r===void 0?e:e===void 0?r:Math.min(r,e)}function fn(r,e){let{div:t,mod:n}=r.divmod(e);return n.gt(new He(0))?t.add(new He(1)):t}import{PublicKey as Ji,AddressLookupTableAccount as Un}from"@solana/web3.js";async function Kr({connection:r,address:e}){let t=await ct(r,[...new Set(e.map(i=>i.toString()))].map(i=>new Ji(i))),n={};for(let i=0;i<e.length;i++){let o=t[i],s=e[i];if(!o)continue;let a=new Un({key:s,state:Un.deserialize(o.data)});n[s.toString()]=a,Xn[s.toString()]=a}return n}var Xn={"2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17":new Un({key:new Ji("2immgwYNHBbyVQKVGCEkgWpi53bLwWNRMB5G2nbgYV17"),state:Un.deserialize(Buffer.from("AQAAAP//////////d49+DAAAAAAAAQZMWvw7GUNJdaccNBVnb57OKakxL2BHLYvhRwVILRsgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMGRm/lIRcy/+ytunLDm+e8jOW7xfcSayxDmzpAAAAABt324ddloZPZy+FGzut5rBy0he1fWzeROoz1hX7/AKkG3fbh7nWP3hhCXbzkbM3athr8TYO5DSf+vfko2KGL/AVKU1D4XciC1hSlVnJ4iilt3x6rq9CmBniISTL07vagBqfVFxksXFEhjMlMPUrxf1ja7gibof1E49vZigAAAAAGp9UXGMd0yShWY5hpHV62i164o5tLbVxzVVshAAAAAIyXJY9OJInxuz0QKRSODYMLWhOZ2v8QhASOe9jb6fhZC3BlsePRfEU4nVJ/awTDzVi4bHMaoP21SbbRvAP4KUbIScv+6Yw2LHF/6K0ZjUPibbSWXCirYPGuuVl7zT789IUPLW4CpHr4JNCatp3ELXDLKMv6JJ+37le50lbBJ2LvDQdRqCgtphMF/imcN7mY5YRx2xE1A3MQ+L4QRaYK9u4GRfZP3LsAd00a+IkCpA22UNQMKdq5BFbJuwuOLqc8zxCTDlqxBG8J0HcxtfogQHDK06ukzfaXiNDKAob1MqBHS9lJxDYCwz8gd5DtFqNSTKG5l1zxIaKpDP/sffi2is1H9aKveyXSu5StXElYRl9SD5As0DHE4N0GLnf84/siiKXVyp4Ez121kLcUui/jLLFZEz/BwZK3Ilf9B9OcsEAeDMKAy2vjGSxQODgBz0QwGA+eP4ZjIjrIAQaXENv31QfLlOdXSRCkaybRniDHF4C8YcwhcvsqrOVuTP4B2Na+9wLdtrB31uz2rtlFI5kahdsnp/d1SrASDInYCtTYtdoke4kX+hoKWcEWM4Tle8pTUkUVv4BxS6fje/EzKBE4Qu9N9LMnrw/JNO0hqMVB4rk/2ou4AB1loQ7FZoPwut2o4KZB+0p9xnbrQKw038qjpHar+PyDwvxBRcu5hpHw3dguezeWv+IwvgW5icu8EGkhGa9AkFPPJT7VMSFb8xowveU=","base64"))})};import{PublicKey as bn,sendAndConfirmTransaction as Lr,Transaction as yn,TransactionMessage as gn,VersionedTransaction as wn}from"@solana/web3.js";import qa from"axios";var zn=class{constructor(e){this.instructions=[];this.endInstructions=[];this.lookupTableAddress=[];this.signers=[];this.instructionTypes=[];this.endInstructionTypes=[];this.connection=e.connection,this.feePayer=e.feePayer,this.signAllTransactions=e.signAllTransactions,this.owner=e.owner,this.cluster=e.cluster,this.blockhashCommitment=e.blockhashCommitment,this.api=e.api}get AllTxData(){return{instructions:this.instructions,endInstructions:this.endInstructions,signers:this.signers,instructionTypes:this.instructionTypes,endInstructionTypes:this.endInstructionTypes,lookupTableAddress:this.lookupTableAddress}}get allInstructions(){return[...this.instructions,...this.endInstructions]}async getComputeBudgetConfig(){var n;let e=(await qa.get(`https://solanacompass.com/api/fees?cacheFreshTime=${3e5}`)).data,{avg:t}=(n=e==null?void 0:e[15])!=null?n:{};if(!!t)return{units:6e5,microLamports:Math.min(Math.ceil(t*1e6/6e5),25e3)}}addCustomComputeBudget(e){if(e){let{instructions:t,instructionTypes:n}=qn(e);return this.instructions.unshift(...t),this.instructionTypes.unshift(...n),!0}return!1}async calComputeBudget({config:e,defaultIns:t}){try{let n=e||await this.getComputeBudgetConfig();if(this.addCustomComputeBudget(n))return;t&&this.instructions.unshift(...t)}catch{t&&this.instructions.unshift(...t)}}addInstruction({instructions:e=[],endInstructions:t=[],signers:n=[],instructionTypes:i=[],endInstructionTypes:o=[],lookupTableAddress:s=[]}){return this.instructions.push(...e),this.endInstructions.push(...t),this.signers.push(...n),this.instructionTypes.push(...i),this.endInstructionTypes.push(...o),this.lookupTableAddress.push(...s.filter(a=>a!==bn.default.toString())),this}async versionBuild({txVersion:e,extInfo:t}){return e===0?await this.buildV0(W({},t||{})):this.build(t)}build(e){var n;let t=new yn;return this.allInstructions.length&&t.add(...this.allInstructions),t.feePayer=this.feePayer,((n=this.owner)==null?void 0:n.signer)&&!this.signers.some(i=>i.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer),{builder:this,transaction:t,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async i=>{var c;let{recentBlockHash:o,skipPreflight:s=!0,sendAndConfirm:a}=i||{},u=o!=null?o:await $t(this.connection,this.blockhashCommitment);if(t.recentBlockhash=u,this.signers.length&&t.sign(...this.signers),Kt([t]),(c=this.owner)!=null&&c.isKeyPair)return{txId:a?await Lr(this.connection,t,this.signers.find(m=>m.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:s}):await this.connection.sendRawTransaction(t.serialize(),{skipPreflight:s}),signedTx:t};if(this.signAllTransactions){let l=await this.signAllTransactions([t]);return{txId:await this.connection.sendRawTransaction(l[0].serialize(),{skipPreflight:s}),signedTx:l[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:e||{}}}buildMultiTx(e){var c;let{extraPreBuildData:t=[],extInfo:n}=e,{transaction:i}=this.build(n),o=t.filter(l=>l.transaction.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:u,execute:async l=>{var g;let{sequentially:m,onTxUpdate:d,skipTxCount:p=0,recentBlockHash:y,skipPreflight:f=!0}=l||{},w=y!=null?y:await $t(this.connection,this.blockhashCommitment);if((g=this.owner)!=null&&g.isKeyPair){if(m){let A=[],h=0;for(let k of s){if(++h,h<=p)continue;let T=await Lr(this.connection,k,this.signers.find(P=>P.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:f});A.push(T)}return{txIds:A,signedTxs:s}}return{txIds:await await Promise.all(s.map(async A=>(A.recentBlockhash=w,await this.connection.sendRawTransaction(A.serialize(),{skipPreflight:f})))),signedTxs:s}}if(this.signAllTransactions){let A=s.map((k,T)=>(k.recentBlockhash=w,a[T].length&&k.sign(...a[T]),k));Kt(A);let h=await this.signAllTransactions(A);if(m){let k=0,T=[],P=async()=>{if(!h[k])return;let K=await this.connection.sendRawTransaction(h[k].serialize(),{skipPreflight:f});T.push({txId:K,status:"sent",signedTx:h[k]}),d==null||d([...T]),k++,this.connection.onSignature(K,x=>{let _=T.findIndex(E=>E.txId===K);_>-1&&(T[_].status=x.err?"error":"success"),d==null||d([...T]),x.err||P()},"processed"),this.connection.getSignatureStatus(K)};return await P(),{txIds:T.map(K=>K.txId),signedTxs:h}}else{let k=[];for(let T=0;T<h.length;T+=1){let P=await this.connection.sendRawTransaction(h[T].serialize(),{skipPreflight:f});k.push(P)}return{txIds:k,signedTxs:h}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async versionMultiBuild({extraPreBuildData:e,txVersion:t,extInfo:n}){return t===0?await this.buildV0MultiTx({extraPreBuildData:e,buildProps:n||{}}):this.buildMultiTx({extraPreBuildData:e,extInfo:n})}async buildV0(e){var f;let y=e||{},{lookupTableCache:t={},lookupTableAddress:n=[],forerunCreate:i,recentBlockhash:o}=y,s=Fe(y,["lookupTableCache","lookupTableAddress","forerunCreate","recentBlockhash"]),a=W(W({},this.cluster==="devnet"?{}:Xn),t),u=Array.from(new Set([...n,...this.lookupTableAddress])),c=[];for(let w of u)a[w]===void 0&&c.push(new bn(w));let l=await Kr({connection:this.connection,address:c});for(let[w,g]of Object.entries(l))a[w]=g;let m=i?bn.default.toBase58():o!=null?o:await $t(this.connection,this.blockhashCommitment),d=new gn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...this.allInstructions]}).compileToV0Message(Object.values(a));((f=this.owner)==null?void 0:f.signer)&&!this.signers.some(w=>w.publicKey.equals(this.owner.publicKey))&&this.signers.push(this.owner.signer);let p=new wn(d);return p.sign(this.signers),{builder:this,transaction:p,signers:this.signers,instructionTypes:[...this.instructionTypes,...this.endInstructionTypes],execute:async w=>{var h;let{skipPreflight:g=!0,sendAndConfirm:A}=w||{};if(Kt([p]),(h=this.owner)!=null&&h.isKeyPair){let k=await this.connection.sendTransaction(p,{skipPreflight:g});return A&&await Gn(this.connection,k),{txId:k,signedTx:p}}if(this.signAllTransactions){let k=await this.signAllTransactions([p]);return{txId:await this.connection.sendTransaction(k[0],{skipPreflight:g}),signedTx:k[0]}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:s||{}}}async buildV0MultiTx(e){var c;let{extraPreBuildData:t=[],buildProps:n}=e,{transaction:i}=await this.buildV0(n),o=t.filter(l=>l.builder.instructions.length>0),s=[i,...o.map(l=>l.transaction)],a=[this.signers,...o.map(l=>l.signers)],u=[...this.instructionTypes,...o.map(l=>l.instructionTypes).flat()];return(c=this.owner)!=null&&c.signer&&a.forEach(l=>{l.some(m=>m.publicKey.equals(this.owner.publicKey))||this.signers.push(this.owner.signer)}),s.forEach(async(l,m)=>{l.sign(a[m])}),{builder:this,transactions:s,signers:a,instructionTypes:u,buildProps:n,execute:async l=>{var f;let{sequentially:m,onTxUpdate:d,recentBlockHash:p,skipPreflight:y=!0}=l||{};if(p&&s.forEach(w=>w.message.recentBlockhash=p),Kt(s),(f=this.owner)!=null&&f.isKeyPair){if(m){let w=[];for(let g of s){let A=await this.connection.sendTransaction(g,{skipPreflight:y});await Gn(this.connection,A),w.push(A)}return{txIds:w,signedTxs:s}}return{txIds:await Promise.all(s.map(async w=>await this.connection.sendTransaction(w,{skipPreflight:y}))),signedTxs:s}}if(this.signAllTransactions){let w=await this.signAllTransactions(s);if(m){let g=0,A=[],h=async()=>{if(!w[g])return;let k=await this.connection.sendTransaction(w[g],{skipPreflight:y});A.push({txId:k,status:"sent",signedTx:w[g]}),d==null||d([...A]),g++,this.connection.onSignature(k,T=>{let P=A.findIndex(K=>K.txId===k);P>-1&&(A[P].status=T.err?"error":"success"),d==null||d([...A]),T.err||h()},"processed"),this.connection.getSignatureStatus(k)};return h(),{txIds:[],signedTxs:w}}else{let g=[];for(let A=0;A<w.length;A+=1){let h=await this.connection.sendTransaction(w[A],{skipPreflight:y});g.push(h)}return{txIds:g,signedTxs:w}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuild(e){var l;let c=e||{},{computeBudgetConfig:t}=c,n=Fe(c,["computeBudgetConfig"]),i=t?qn(t):{instructions:[],instructionTypes:[]},o=this.signers.reduce((m,d)=>J(W({},m),{[d.publicKey.toBase58()]:d}),{}),s=[],a=[],u=[];if(this.allInstructions.forEach(m=>{let d=[...u,m],p=t?[...i.instructions,...d]:d,f=[...new Set(d.map(w=>w.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat()).values()].map(w=>new bn(w));if(u.length<12&&mn({instructions:p,payer:this.feePayer,signers:f})||mn({instructions:d,payer:this.feePayer,signers:f}))u.push(m);else{if(u.length===0)throw Error("item ins too big");mn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:f})?s.push(new yn().add(...i.instructions,...u)):s.push(new yn().add(...u)),a.push(Array.from(new Set(u.map(w=>w.keys.filter(g=>g.isSigner).map(g=>g.pubkey.toString())).flat())).map(w=>o[w]).filter(w=>w!==void 0)),u=[m]}}),u.length>0){let d=[...new Set(u.map(p=>p.keys.filter(y=>y.isSigner).map(y=>y.pubkey.toString())).flat()).values()].map(p=>o[p]).filter(p=>p!==void 0);mn({instructions:t?[...i.instructions,...u]:[...u],payer:this.feePayer,signers:d.map(p=>p.publicKey)})?s.push(new yn().add(...i.instructions,...u)):s.push(new yn().add(...u)),a.push(d)}return s.forEach(m=>m.feePayer=this.feePayer),(l=this.owner)!=null&&l.signer&&a.forEach(m=>{m.some(d=>d.publicKey.equals(this.owner.publicKey))||m.push(this.owner.signer)}),{builder:this,transactions:s,signers:a,instructionTypes:this.instructionTypes,execute:async m=>{var A;let{sequentially:d,onTxUpdate:p,skipTxCount:y=0,recentBlockHash:f,skipPreflight:w=!0}=m||{},g=f!=null?f:await $t(this.connection,this.blockhashCommitment);if(s.forEach(async(h,k)=>{h.recentBlockhash=g,a[k].length&&h.sign(...a[k])}),Kt(s),(A=this.owner)!=null&&A.isKeyPair){if(d){let h=0,k=[];for(let T of s){if(++h,h<=y){k.push("tx skipped");continue}let P=await Lr(this.connection,T,this.signers.find(K=>K.publicKey.equals(this.owner.publicKey))?this.signers:[...this.signers,this.owner.signer],{skipPreflight:w});k.push(P)}return{txIds:k,signedTxs:s}}return{txIds:await Promise.all(s.map(async h=>await this.connection.sendRawTransaction(h.serialize(),{skipPreflight:w}))),signedTxs:s}}if(this.signAllTransactions){let h=await this.signAllTransactions(s.slice(y,s.length)),k=[...s.slice(0,y),...h];if(d){let T=0,P=[],K=async()=>{if(!k[T])return;T<y&&(P.push({txId:"",status:"success",signedTx:k[T]}),p==null||p([...P]),T++,K());let x=await this.connection.sendRawTransaction(k[T].serialize(),{skipPreflight:w});P.push({txId:x,status:"sent",signedTx:k[T]}),p==null||p([...P]),T++,this.connection.onSignature(x,_=>{let E=P.findIndex(v=>v.txId===x);E>-1&&(P[E].status=_.err?"error":"success"),p==null||p([...P]),_.err||K()},"processed"),this.connection.getSignatureStatus(x)};return await K(),{txIds:P.map(x=>x.txId),signedTxs:k}}else{let T=[];for(let P=0;P<k.length;P+=1){let K=await this.connection.sendRawTransaction(k[P].serialize(),{skipPreflight:w});T.push(K)}return{txIds:T,signedTxs:k}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:n||{}}}async sizeCheckBuildV0(e){var g;let w=e||{},{computeBudgetConfig:t,lookupTableCache:n={},lookupTableAddress:i=[]}=w,o=Fe(w,["computeBudgetConfig","lookupTableCache","lookupTableAddress"]),s=W(W({},this.cluster==="devnet"?{}:Xn),n),a=Array.from(new Set([...this.lookupTableAddress,...i])),u=[];for(let A of a)s[A]===void 0&&u.push(new bn(A));let c=await Kr({connection:this.connection,address:u});for(let[A,h]of Object.entries(c))s[A]=h;let l=t?qn(t):{instructions:[],instructionTypes:[]},m=await $t(this.connection,this.blockhashCommitment),d=this.signers.reduce((A,h)=>J(W({},A),{[h.publicKey.toBase58()]:h}),{}),p=[],y=[],f=[];if(this.allInstructions.forEach(A=>{let h=[...f,A],k=t?[...l.instructions,...h]:h;if(f.length<12&&dn({instructions:k,payer:this.feePayer,lookupTableAddressAccount:s})||dn({instructions:h,payer:this.feePayer,lookupTableAddressAccount:s}))f.push(A);else{if(f.length===0)throw Error("item ins too big");let T={};for(let P of[...new Set(a)])s[P]!==void 0&&(T[P]=s[P]);if(t&&dn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let P=new gn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new wn(P))}else{let P=new gn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new wn(P))}y.push(Array.from(new Set(f.map(P=>P.keys.filter(K=>K.isSigner).map(K=>K.pubkey.toString())).flat())).map(P=>d[P]).filter(P=>P!==void 0)),f=[A]}}),f.length>0){let h=[...new Set(f.map(k=>k.keys.filter(T=>T.isSigner).map(T=>T.pubkey.toString())).flat()).values()].map(k=>d[k]).filter(k=>k!==void 0);if(t&&dn({instructions:[...l.instructions,...f],payer:this.feePayer,lookupTableAddressAccount:s,recentBlockhash:m})){let k=new gn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...l.instructions,...f]}).compileToV0Message(Object.values(s));p.push(new wn(k))}else{let k=new gn({payerKey:this.feePayer,recentBlockhash:m,instructions:[...f]}).compileToV0Message(Object.values(s));p.push(new wn(k))}y.push(h)}return(g=this.owner)!=null&&g.signer&&y.forEach(A=>{A.some(h=>h.publicKey.equals(this.owner.publicKey))||A.push(this.owner.signer)}),{builder:this,transactions:p,buildProps:e,signers:y,instructionTypes:this.instructionTypes,execute:async A=>{var x;let{sequentially:h,onTxUpdate:k,skipTxCount:T=0,recentBlockHash:P,skipPreflight:K=!0}=A||{};if(p.map(async(_,E)=>{y[E].length&&_.sign(y[E]),P&&(_.message.recentBlockhash=P)}),Kt(p),(x=this.owner)!=null&&x.isKeyPair){if(h){let _=0,E=[];for(let v of p){if(++_,_<=T){console.log("skip tx: ",_),E.push("tx skipped");continue}let Q=await this.connection.sendTransaction(v,{skipPreflight:K});await Gn(this.connection,Q),E.push(Q)}return{txIds:E,signedTxs:p}}return{txIds:await Promise.all(p.map(async _=>await this.connection.sendTransaction(_,{skipPreflight:K}))),signedTxs:p}}if(this.signAllTransactions){let _=await this.signAllTransactions(p.slice(T,p.length)),E=[...p.slice(0,T),..._];if(h){let v=0,Q=[],H=async()=>{if(!E[v])return;if(v<T){Q.push({txId:"",status:"success",signedTx:E[v]}),k==null||k([...Q]),v++,H();return}let ie=await this.connection.sendTransaction(E[v],{skipPreflight:K});Q.push({txId:ie,status:"sent",signedTx:E[v]}),k==null||k([...Q]),v++,this.connection.onSignature(ie,ee=>{let D=Q.findIndex(Ue=>Ue.txId===ie);D>-1&&(Q[D].status=ee.err?"error":"success"),k==null||k([...Q]),ee.err||H()},"processed"),this.connection.getSignatureStatus(ie)};return H(),{txIds:[],signedTxs:E}}else{let v=[];for(let Q=0;Q<E.length;Q+=1){let H=await this.connection.sendTransaction(E[Q],{skipPreflight:K});v.push(H)}return{txIds:v,signedTxs:E}}}throw new Error("please provide owner in keypair format or signAllTransactions function")},extInfo:o||{}}}};import{MINT_SIZE as Wd,TOKEN_PROGRAM_ID as Dd,getTransferFeeConfig as qd,unpackMint as Gd}from"@solana/spl-token";var Nr=ae("Raydium_accountInfo_util");async function ct(r,e,t){let{batchRequest:n,commitment:i="confirmed",chunkCount:o=100}=W({batchRequest:!1},t),s=Ir(e,o),a=new Array(s.length).fill([]);if(n){let u=s.map(m=>{let d=r._buildArgs([m.map(p=>p.toBase58())],i,"base64");return{methodName:"getMultipleAccounts",args:d}}),c=Ir(u,10);a=(await(await Promise.all(c.map(async m=>await r._rpcBatchRequest(m)))).flat()).map(m=>(m.error&&Nr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${m.error.message}`),m.result.value.map(d=>{if(d){let{data:p,executable:y,lamports:f,owner:w,rentEpoch:g}=d;return p.length!==2&&p[1]!=="base64"&&Nr.logWithError("info must be base64 encoded, RPC_ERROR"),{data:Buffer.from(p[0],"base64"),executable:y,lamports:f,owner:new Ga(w),rentEpoch:g}}return null})))}else try{a=await Promise.all(s.map(u=>r.getMultipleAccountsInfo(u,i)))}catch(u){u instanceof Error&&Nr.logWithError(`failed to get info for multiple accounts, RPC_ERROR, ${u.message}`)}return a.flat()}async function Lt(r,e,t){let n=await ct(r,e.map(i=>i.pubkey),t);return e.map((i,o)=>J(W({},i),{accountInfo:n[o]}))}import{PublicKey as eu}from"@solana/web3.js";import io,{isBN as oo}from"bn.js";import{bits as Ua,BitStructure as zd,blob as Xa,Blob as Qd,cstr as Hd,f32 as Yd,f32be as jd,f64 as Zd,f64be as $d,greedy as Jd,Layout as za,ns64 as ep,ns64be as tp,nu64 as np,nu64be as rp,offset as ip,s16 as op,s16be as sp,s24 as ap,s24be as up,s32 as Qa,s32be as cp,s40 as lp,s40be as mp,s48 as dp,s48be as pp,s8 as fp,seq as Ha,struct as bp,Structure as Ya,u16 as ja,u16be as yp,u24 as gp,u24be as wp,u32 as Za,u32be as hp,u40 as kp,u40be as Ap,u48 as Pp,u48be as Tp,u8 as $a,UInt as Ja,union as xp,Union as Sp,unionLayoutDiscriminator as Bp,utf8 as Ip}from"@solana/buffer-layout";var Qn=za,to=Ya;var Rr=Ja;var no=$a,Nt=ja;var Cr=Za;var Se=Qa;var ro=Ha;var we=Xa;var Mr=Ua;var Rt=class extends Qn{constructor(t,n,i){super(t,i);this.blob=we(t),this.signed=n}decode(t,n=0){let i=new io(this.blob.decode(t,n),10,"le");return this.signed?i.fromTwos(this.span*8).clone():i}encode(t,n,i=0){return typeof t=="number"&&(t=new io(t)),this.signed&&(t=t.toTwos(this.span*8)),this.blob.encode(t.toArrayLike(Buffer,"le",this.span),n,i)}},Hn=class extends Qn{constructor(t){super(8,t);this._lower=Mr(Cr(),!1),this._upper=Mr(Cr(),!1)}addBoolean(t){this._lower.fields.length<32?this._lower.addBoolean(t):this._upper.addBoolean(t)}decode(t,n=0){let i=this._lower.decode(t,n),o=this._upper.decode(t,n+this._lower.span);return W(W({},i),o)}encode(t,n,i=0){return this._lower.encode(t,n,i)+this._upper.encode(t,n,i+this._lower.span)}};function O(r){return new Rr(1,r)}function Le(r){return new Rr(4,r)}function b(r){return new Rt(8,!1,r)}function U(r){return new Rt(16,!1,r)}function so(r){return new Rt(1,!0,r)}function Jt(r){return new Rt(8,!0,r)}function ao(r){return new Rt(16,!0,r)}var Yn=class extends Qn{constructor(t,n,i,o){super(t.span,o);this.layout=t,this.decoder=n,this.encoder=i}decode(t,n){return this.decoder(this.layout.decode(t,n))}encode(t,n,i){return this.layout.encode(this.encoder(t),n,i)}getSpan(t,n){return this.layout.getSpan(t,n)}};function I(r){return new Yn(we(32),e=>new eu(e),e=>e.toBuffer(),r)}function Ce(r){return new Yn(no(),tu,nu,r)}function tu(r){if(r===0)return!1;if(r===1)return!0;throw new Error("Invalid bool: "+r)}function nu(r){return r?1:0}var Er=class extends to{decode(e,t){return super.decode(e,t)}};function R(r,e,t){return new Er(r,e,t)}function q(r,e,t){let n,i=typeof e=="number"?e:oo(e)?e.toNumber():new Proxy(e,{get(o,s){if(!n){let a=Reflect.get(o,"count");n=oo(a)?a.toNumber():a,Reflect.set(o,"count",n)}return Reflect.get(o,s)},set(o,s,a){return s==="count"&&(n=a),Reflect.set(o,s,a)}});return ro(r,i,t)}import{PublicKey as uo}from"@solana/web3.js";var Up=ae("Raydium_farm_config"),Xp=new uo("4k3Dyjzvzp8eMZWUXbBCjEvwSkkk59S5iCNLY3QrkX6R"),zp=new uo("FrspKwj8i3pNmKwXreTveC4fu7KL5ZbGeXdZBe2XViu1");var co={3:_r,5:lo,6:mo};var jn={"Standard SPL":0,"Option tokens":1},vr={[zi.toString()]:3,[Qi.toString()]:4,[Hi.toString()]:5,[Yi.toString()]:6};var Or=R([O("instruction")]),su=R([O("instruction")]),au=R([b("rewardState"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardLastUpdateTime"),b("totalReward"),b("totalRewardEmissioned"),b("rewardClaimed"),b("rewardPerSecond"),U("accRewardPerShare"),I("rewardVault"),I("rewardMint"),I("rewardSender"),b("rewardType"),q(b(),15,"padding")]),uu=R([b("state"),b("nonce"),I("lpVault"),I("rewardVault"),I(),I(),b(),b(),b("totalReward"),U("perShareReward"),b("lastSlot"),b("perSlotReward")]),cu=R([b("state"),b("nonce"),I("lpVault"),I("rewardVaultA"),b("totalRewardA"),U("perShareRewardA"),b("perSlotRewardA"),O("option"),I("rewardVaultB"),we(7),b("totalRewardB"),U("perShareRewardB"),b("perSlotRewardB"),b("lastSlot"),I()]),lu=R([b(),b("state"),b("nonce"),b("validRewardTokenNum"),U("rewardMultiplier"),b("rewardPeriodMax"),b("rewardPeriodMin"),b("rewardPeriodExtend"),I("lpMint"),I("lpVault"),q(au,5,"rewardInfos"),I("creator"),I(),q(b(),32,"padding")]),ru=new Proxy(uu,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return J(W({},i),{version:3,rewardInfos:[{rewardVault:i.rewardVault,totalReward:i.totalReward,perSlotReward:i.perSlotReward,perShareReward:i.perShareReward}]})}:Reflect.get(r,e,t)}}),iu=new Proxy(cu,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return J(W({},i),{version:5,rewardInfos:[{rewardVault:i.rewardVaultA,totalReward:i.totalRewardA,perSlotReward:i.perSlotRewardA,perShareReward:i.perShareRewardA},{rewardVault:i.rewardVaultB,totalReward:i.totalRewardB,perSlotReward:i.perSlotRewardB,perShareReward:i.perShareRewardB}]})}:Reflect.get(r,e,t)}}),ou=new Proxy(lu,{get(r,e,t){return e==="decode"?(...n)=>{let i=r.decode(...n);return J(W({},i),{version:6,rewardInfos:i.rewardInfos.map(o=>{var s;return J(W({},o),{rewardType:((s=Object.entries(jn).find(a=>String(a[1])===o.rewardType.toString()))!=null?s:["Standard SPL"])[0]})})})}:Reflect.get(r,e,t)}}),mu=R([b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),du=R([O("instruction"),b("nonce"),q(mu,5,"rewardTimeInfo")]),pu=R([O("instruction"),b("rewardReopenTime"),b("rewardEndTime"),b("rewardPerSecond")]),fu=R([O("instruction"),b("isSet"),b("rewardPerSecond"),b("rewardOpenTime"),b("rewardEndTime"),b("rewardType")]),Jp=R([b("state"),I("id"),I("owner"),b("deposited"),q(b(),1,"rewardDebts")]),_r=R([b("state"),I("id"),I("owner"),b("deposited"),q(U(),1,"rewardDebts"),b(""),b("voteLockedBalance"),q(b(),15)]),ef=R([b("state"),I("id"),I("owner"),b("deposited"),q(b(),2,"rewardDebts")]),lo=R([b("state"),I("id"),I("owner"),b("deposited"),q(U(),2,"rewardDebts"),q(b(),17)]),mo=R([b(),b("state"),I("id"),I("owner"),b("deposited"),q(U(),5,"rewardDebts"),q(b(),16)]),Ct=R([O("instruction"),b("amount")]),bu=R([I("mint"),I("grantAuthority"),b("baselineVoteWeightScaledFactor"),b("maxExtraLockupVoteWeightScaledFactor"),b("lockupSaturationSecs"),so("digitShift"),q(O(),7,"reserved1"),q(b(),7,"reserved2")]),yu=R([we(8),I("governanceProgramId"),I("realm"),I("realmGoverningTokenMint"),I("realmAuthority"),q(O(),32,"reserved1"),q(bu,4,"votingMints"),Jt("timeOffset"),O("bump"),q(O(),7,"reserved2"),q(b(),11,"reserved3")]),gu=R([Jt("startTime"),Jt("endTime"),O("kind"),q(O(),15,"reserved")]),wu=R([q(gu,1,"lockup"),b("amountDeposited_native"),b("amountInitiallyLockedNative"),Ce("isUsed"),Ce("allowClawback"),O("votingMintConfigIdx"),q(O(),29,"reserved")]),hu=R([we(8),I("voterAuthority"),I("registrar"),q(wu,32,"deposits"),O("voterBump"),O("voterWweightRecordBump"),q(O(),94,"reserved")]);import cf from"bn.js";var Vr=R([I("mint"),I("owner"),b("amount"),Le("delegateOption"),I("delegate"),O("state"),Le("isNativeOption"),b("isNative"),b("delegatedAmount"),Le("closeAuthorityOption"),I("closeAuthority")]);var ku=ae("Raydium.farm.util");function en({programId:r,poolId:e,owner:t,version:n}){let{publicKey:i}=de([e.toBuffer(),t.toBuffer(),Buffer.from(n===6?"farmer_info_associated_seed":"staker_info_v2_associated_seed","utf-8")],r);return i}function po(r){let e=co[r];return e||ku.logWithError("invalid version",r),e}import{PublicKey as Ne,SystemProgram as Au,SYSVAR_CLOCK_PUBKEY as fo,SYSVAR_RENT_PUBKEY as Pu,TransactionInstruction as Zn}from"@solana/web3.js";import vf from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Of,createAssociatedTokenAccountInstruction as Vf,TOKEN_PROGRAM_ID as Fr}from"@solana/spl-token";var Tu=ae("Raydium_farm_instruction"),Yf={voterStakeRegistryCreateVoter:Buffer.from([6,24,245,52,243,255,148,25]),voterStakeRegistryCreateDepositEntry:Buffer.from([185,131,167,186,159,125,19,67]),voterStakeRegistryDeposit:Buffer.from([242,35,198,137,82,225,242,182]),voterStakeRegistryWithdraw:Buffer.from([183,18,70,156,148,109,161,34]),voterStakeRegistryUpdateVoterWeightRecord:Buffer.from([45,185,3,36,109,190,115,169])};function bo(r){let{version:e,id:t,ledger:n,programId:i,owner:o}=r,s={3:9,5:10}[e];s||Tu.logWithError(`invalid farm pool version: ${e}`);let a=Buffer.alloc(Or.span);Or.encode({instruction:s},a);let u=[S({pubkey:t}),S({pubkey:n}),S({pubkey:o,isWritable:!1}),S({pubkey:Au.programId,isWritable:!1}),S({pubkey:Pu,isWritable:!1})];return{instruction:new Zn({programId:i,keys:u,data:a}),instructionType:X.FarmV3CreateLedger}}function yo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s}=r,[a,u]=[new Ne(e.programId),new Ne(e.id)],c=en({programId:a,poolId:u,owner:o,version:6}),l=Buffer.alloc(Ct.span);Ct.encode({instruction:2,amount:te(s)},l);let m=[S({pubkey:Fr,isWritable:!1}),S({pubkey:u}),S({pubkey:new Ne(t.authority),isWritable:!1}),S({pubkey:new Ne(t.lpVault)}),S({pubkey:c}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n})];for(let d=0;d<t.rewardInfos.length;d++)m.push(S({pubkey:new Ne(t.rewardInfos[d].vault)})),m.push(S({pubkey:i[d]}));return new Zn({programId:a,keys:m,data:l})}function go(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Ne(e.programId),new Ne(e.id)],l=en({programId:u,poolId:c,owner:o,version:5}),m=Buffer.alloc(Ct.span);Ct.encode({instruction:12,amount:te(s)},m);let d=[S({pubkey:c}),S({pubkey:new Ne(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new Ne(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new Ne(t.rewardInfos[0].vault)}),S({pubkey:fo,isWritable:!1}),S({pubkey:Fr,isWritable:!1})];for(let p=1;p<t.rewardInfos.length;p++)d.push(S({pubkey:i[p]})),d.push(S({pubkey:new Ne(t.rewardInfos[p].vault)}));if(a)for(let p of a)d.push(S({pubkey:p}));return new Zn({programId:u,keys:d,data:m})}function wo(r){let{farmInfo:e,farmKeys:t,lpAccount:n,rewardAccounts:i,owner:o,amount:s,userAuxiliaryLedgers:a}=r,[u,c]=[new Ne(e.programId),new Ne(e.id)],l=en({programId:u,poolId:c,owner:o,version:3}),m=Buffer.alloc(Ct.span);Ct.encode({instruction:11,amount:te(s)},m);let d=[S({pubkey:c}),S({pubkey:new Ne(t.authority),isWritable:!1}),S({pubkey:l}),S({pubkey:o,isWritable:!1,isSigner:!0}),S({pubkey:n}),S({pubkey:new Ne(t.lpVault)}),S({pubkey:i[0]}),S({pubkey:new Ne(t.rewardInfos[0].vault)}),S({pubkey:fo,isWritable:!1}),S({pubkey:Fr,isWritable:!1})];if(a)for(let p of a)d.push(S({pubkey:p}));return new Zn({programId:u,keys:d,data:m})}import{Keypair as tr,PublicKey as N,SystemProgram as Vt,TransactionInstruction as Ee}from"@solana/web3.js";import Oo from"bn.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as Hr,TOKEN_2022_PROGRAM_ID as nt,TOKEN_PROGRAM_ID as le}from"@solana/spl-token";import Mu from"bn.js";import qe from"bn.js";var ye=new qe(0),et=new qe(1),lt=new qe(-1),_e=new qe(1).shln(64),$n=new qe(1).shln(128),Wr=_e.sub(et),hn=64,ho=$n.subn(1),Re=-443636,Me=-Re,Mt=new qe("4295048016"),Et=new qe("79226673521066979257578248091"),ob=new qe("4295048017"),sb=new qe("79226673521066979257578248090"),ko=16,Ao="59543866431248",Po="184467440737095516",To="15793534762490258745",Jn=new qe(10).pow(new qe(6));var ab=new qe("18446744073700000000");import $ from"bn.js";function er(r){let e=new ArrayBuffer(4);return new DataView(e).setInt32(0,r,!1),new Uint8Array(e)}function Dr(r,e){let t=0;for(let n=r-1;n>=0&&!e.testn(n);n--)t++;return t}function qr(r,e){let t=0;for(let n=0;n<r&&!e.testn(n);n++)t++;return t}function kn(r,e){for(let t=0;t<r;t++)if(e.testn(t))return!1;return!0}function xo(r,e){return kn(r,e)?null:Dr(r,e)}function So(r,e){return kn(r,e)?null:qr(r,e)}var pb=Buffer.from("amm_config","utf8"),xu=Buffer.from("pool","utf8"),Su=Buffer.from("pool_vault","utf8"),Bu=Buffer.from("pool_reward_vault","utf8"),Bo=Buffer.from("position","utf8"),Iu=Buffer.from("tick_array","utf8"),Ku=Buffer.from("operation","utf8"),Lu=Buffer.from("pool_tick_array_bitmap_extension","utf8"),Nu=Buffer.from("observation","utf8");function Io(r,e,t,n){return de([xu,e.toBuffer(),t.toBuffer(),n.toBuffer()],r)}function Gr(r,e,t){return de([Su,e.toBuffer(),t.toBuffer()],r)}function Ko(r,e,t){return de([Bu,e.toBuffer(),t.toBuffer()],r)}function se(r,e,t){return de([Iu,e.toBuffer(),er(t)],r)}function kt(r,e,t,n){return de([Bo,e.toBuffer(),er(t),er(n)],r)}function Oe(r,e){return de([Bo,e.toBuffer()],r)}function An(r){return de([Buffer.from("metadata","utf8"),Bt.toBuffer(),r.toBuffer()],Bt)}function Ur(r){return de([Ku],r)}function Ge(r,e){return de([Lu,e.toBuffer()],r)}function Lo(r,e){return de([Nu,e.toBuffer()],r)}var No=Buffer.from("locked_position","utf8");function Xr(r,e){return de([No,e.toBuffer()],r)}function Ro(r,e){return de([No,e.toBuffer()],r)}import{PublicKey as Ye}from"@solana/web3.js";import{TOKEN_2022_PROGRAM_ID as Co}from"@solana/spl-token";import ce from"bn.js";import tt from"bn.js";var Pn=class{static getfeeGrowthInside(e,t,n){let i=new tt(0),o=new tt(0);e.tickCurrent>=t.tick?(i=t.feeGrowthOutsideX64A,o=t.feeGrowthOutsideX64B):(i=e.feeGrowthGlobalX64A.sub(t.feeGrowthOutsideX64A),o=e.feeGrowthGlobalX64B.sub(t.feeGrowthOutsideX64B));let s=new tt(0),a=new tt(0);e.tickCurrent<n.tick?(s=n.feeGrowthOutsideX64A,a=n.feeGrowthOutsideX64B):(s=e.feeGrowthGlobalX64A.sub(n.feeGrowthOutsideX64A),a=e.feeGrowthGlobalX64B.sub(n.feeGrowthOutsideX64B));let u=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64A,i),s),c=Z.wrappingSubU128(Z.wrappingSubU128(e.feeGrowthGlobalX64B,o),a);return{feeGrowthInsideX64A:u,feeGrowthInsideBX64:c}}static GetPositionFees(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),u=t.tokenFeesOwedA.add(a),c=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionFeesV2(e,t,n,i){let{feeGrowthInsideX64A:o,feeGrowthInsideBX64:s}=this.getfeeGrowthInside(e,n,i),a=Z.mulDivFloor(Z.wrappingSubU128(o,t.feeGrowthInsideLastX64A),t.liquidity,_e),u=t.tokenFeesOwedA.add(a),c=Z.mulDivFloor(Z.wrappingSubU128(s,t.feeGrowthInsideLastX64B),t.liquidity,_e),l=t.tokenFeesOwedB.add(c);return{tokenFeeAmountA:u,tokenFeeAmountB:l}}static GetPositionRewardsV2(e,t,n,i){let o=[],s=this.getRewardGrowthInsideV2(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=Z.wrappingSubU128(u,c.growthInsideLastX64),m=Z.mulDivFloor(l,t.liquidity,_e),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static GetPositionRewards(e,t,n,i){let o=[],s=this.getRewardGrowthInside(e.tickCurrent,n,i,e.rewardInfos);for(let a=0;a<s.length;a++){let u=s[a],c=t.rewardInfos[a],l=Z.wrappingSubU128(u,c.growthInsideLastX64),m=Z.mulDivFloor(l,t.liquidity,_e),d=c.rewardAmountOwed.add(m);o.push(d)}return o}static getRewardGrowthInside(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new tt(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new tt(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getRewardGrowthInsideV2(e,t,n,i){let o=[];for(let s=0;s<i.length;s++){let a=new tt(0);t.liquidityGross.eqn(0)?a=i[s].rewardGrowthGlobalX64:e<t.tick?a=i[s].rewardGrowthGlobalX64.sub(t.rewardGrowthsOutsideX64[s]):a=t.rewardGrowthsOutsideX64[s];let u=new tt(0);n.liquidityGross.eqn(0)||(e<n.tick?u=n.rewardGrowthsOutsideX64[s]:u=i[s].rewardGrowthGlobalX64.sub(n.rewardGrowthsOutsideX64[s])),o.push(Z.wrappingSubU128(Z.wrappingSubU128(i[s].rewardGrowthGlobalX64,a),u))}return o}static getAmountsFromLiquidity({poolInfo:e,ownerPosition:t,liquidity:n,slippage:i,add:o,epochInfo:s}){var w,g,A,h;let a=Y.priceToSqrtPriceX64(new L(e.price),e.mintA.decimals,e.mintB.decimals),u=Y.getSqrtPriceX64FromTick(t.tickLower),c=Y.getSqrtPriceX64FromTick(t.tickUpper),l=o?1+i:1-i,m=re.getAmountsFromLiquidity(a,u,c,n,o),[d,p]=[be(m.amountA,(w=e.mintA.extensions)==null?void 0:w.feeConfig,s,!0),be(m.amountB,(g=e.mintB.extensions)==null?void 0:g.feeConfig,s,!0)],[y,f]=[be(new tt(new L(m.amountA.toString()).mul(l).toFixed(0)),(A=e.mintA.extensions)==null?void 0:A.feeConfig,s,!0),be(new tt(new L(m.amountB.toString()).mul(l).toFixed(0)),(h=e.mintB.extensions)==null?void 0:h.feeConfig,s,!0)];return{liquidity:n,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ht(d.expirationTime,p.expirationTime)}}};var Ru=15,ne=class{static async getTickArrays(e,t,n,i,o,s,a){let u=[],c=V.getTickArrayStartIndexByTick(i,o),l=V.getInitializedTickArrayInRange(s,a,o,c,Math.floor(Ru/2));for(let p=0;p<l.length;p++){let{publicKey:y}=se(t,n,l[p]);u.push(y)}let m=(await ct(e,u)).map(p=>p!==null?Tn.decode(p.data):null),d={};for(let p=0;p<u.length;p++){let y=m[p];y!==null&&(d[y.startTickIndex]=J(W({},y),{address:u[p]}))}return d}static nextInitializedTick(e,t,n,i,o,s){let{initializedTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}=this.nextInitializedTickInOneArray(e,t,n,i,o,s);for(;a==null||a.liquidityGross.lten(0);){if(c=V.getNextTickArrayStartIndex(c,o,s),this.checkIsValidStartIndex(c,o))throw new Error("No enough initialized tickArray");let l=n[c];if(l===void 0)continue;let{nextTick:m,tickArrayAddress:d,tickArrayStartTickIndex:p}=this.firstInitializedTickInOneArray(e,t,l,s);[a,u,c]=[m,d,p]}if(a==null)throw new Error("No invaild tickArray cache");return{nextTick:a,tickArrayAddress:u,tickArrayStartTickIndex:c}}static nextInitializedTickArray(e,t,n,i,o){let s=Math.floor(e/ne.tickCount(t)),a=n?V.searchLowBitFromStart(i,o,s-1,1,t):V.searchHightBitFromStart(i,o,s+1,1,t);return a.length>0?{isExist:!0,nextStartIndex:a[0]}:{isExist:!1,nextStartIndex:0}}static firstInitializedTickInOneArray(e,t,n,i){let o;if(i){let a=Ae-1;for(;a>=0;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a-1}}else{let a=0;for(;a<Ae;){let u=n.ticks[a];if(u.liquidityGross.gtn(0)){o=u;break}a=a+1}}let{publicKey:s}=se(e,t,n.startTickIndex);return{nextTick:o,tickArrayAddress:s,tickArrayStartTickIndex:n.startTickIndex}}static nextInitializedTickInOneArray(e,t,n,i,o,s){let a=V.getTickArrayStartIndexByTick(i,o),u=Math.floor((i-a)/o),c=n[a];if(c==null)return{initializedTick:void 0,tickArrayAddress:void 0,tickArrayStartTickIndex:a};let l;if(s)for(;u>=0;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u-1}else for(u=u+1;u<Ae;){let d=c.ticks[u];if(d.liquidityGross.gtn(0)){l=d;break}u=u+1}let{publicKey:m}=se(e,t,a);return{initializedTick:l,tickArrayAddress:m,tickArrayStartTickIndex:c.startTickIndex}}static getArrayStartIndex(e,t){let n=this.tickCount(t);return Math.floor(e/n)*n}static checkIsValidStartIndex(e,t){if(V.checkIsOutOfBoundary(e)){if(e>Me)return!1;let n=V.getTickArrayStartIndexByTick(Re,t);return e==n}return e%this.tickCount(t)==0}static tickCount(e){return Ae*e}};var zr=14,mt=class{static maxTickInTickarrayBitmap(e){return e*Ae*vt}static getBitmapTickBoundary(e,t){let n=this.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n);e<0&&Math.abs(e)%n!=0&&(i+=1);let o=n*i;return e<0?{minValue:-o,maxValue:-o+n}:{minValue:o,maxValue:o+n}}static nextInitializedTickArrayStartIndex(e,t,n,i){if(!ne.checkIsValidStartIndex(t,n))throw Error("nextInitializedTickArrayStartIndex check error");let o=this.maxTickInTickarrayBitmap(n),s=i?t-ne.tickCount(n):t+ne.tickCount(n);if(s<-o||s>=o)return{isInit:!1,tickIndex:t};let a=n*Ae,u=s/a+512;s<0&&s%a!=0&&u--;let c=Math.abs(u);if(i){let l=e.shln(1024-c-1),m=xo(1024,l);if(m!==null){let d=(c-m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:-o}}else{let l=e.shrn(c),m=So(1024,l);if(m!==null){let d=(c+m-512)*a;return{isInit:!0,tickIndex:d}}else return{isInit:!1,tickIndex:o-ne.tickCount(n)}}}},xn=class{static getBitmapOffset(e,t){if(!ne.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");this.checkExtensionBoundary(e,t);let n=mt.maxTickInTickarrayBitmap(t),i=Math.floor(Math.abs(e)/n)-1;return e<0&&Math.abs(e)%n===0&&i--,i}static getBitmap(e,t,n){let i=this.getBitmapOffset(e,t);return e<0?{offset:i,tickarrayBitmap:n.negativeTickArrayBitmap[i]}:{offset:i,tickarrayBitmap:n.positiveTickArrayBitmap[i]}}static checkExtensionBoundary(e,t){let{positiveTickBoundary:n,negativeTickBoundary:i}=this.extensionTickBoundary(t);if(e>=i&&e<n)throw Error("checkExtensionBoundary -> InvalidTickArrayBoundary")}static extensionTickBoundary(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;if(Me<=t)throw Error(`extensionTickBoundary check error: ${Me}, ${t}`);if(n<=Re)throw Error(`extensionTickBoundary check error: ${n}, ${Re}`);return{positiveTickBoundary:t,negativeTickBoundary:n}}static checkTickArrayIsInit(e,t,n){let{tickarrayBitmap:i}=this.getBitmap(e,t,n),o=this.tickArrayOffsetInBitmap(e,t);return{isInitialized:V.mergeTickArrayBitmap(i).testn(o),startIndex:e}}static nextInitializedTickArrayFromOneBitmap(e,t,n,i){let o=ne.tickCount(t),s=n?e-o:e+o,{tickarrayBitmap:a}=this.getBitmap(s,t,i);return this.nextInitializedTickArrayInBitmap(a,s,t,n)}static nextInitializedTickArrayInBitmap(e,t,n,i){let{minValue:o,maxValue:s}=mt.getBitmapTickBoundary(t,n),a=this.tickArrayOffsetInBitmap(t,n);if(i){let u=V.mergeTickArrayBitmap(e).shln(vt-1-a),c=kn(512,u)?null:Dr(512,u);if(c!==null){let l=t-c*ne.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:o}}else{let u=V.mergeTickArrayBitmap(e).shrn(a),c=kn(512,u)?null:qr(512,u);if(c!==null){let l=t+c*ne.tickCount(n);return{isInit:!0,tickIndex:l}}else return{isInit:!1,tickIndex:s-ne.tickCount(n)}}}static tickArrayOffsetInBitmap(e,t){let n=Math.abs(e)%mt.maxTickInTickarrayBitmap(t),i=Math.floor(n/ne.tickCount(t));return e<0&&n!=0&&(i=vt-i),i}};var Be=class{static getOutputAmountAndRemainAccounts(e,t,n,i,o,s=!1){let a=n.toBase58()===e.mintA.address,u=[],{isExist:c,startIndex:l,nextAccountMeta:m}=this.getFirstInitializedTickArray(e,a);if(!c||l===void 0||!m)throw new Error("Invalid tick array");u.push(m);let{allTrade:d,amountCalculated:p,accounts:y,sqrtPriceX64:f,feeAmount:w}=_t.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,a,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i,l,o,s);return u.push(...y),{allTrade:d,expectedAmountOut:p.mul(lt),remainingAccounts:u,executionPrice:f,feeAmount:w}}static getInputAmountAndRemainAccounts(e,t,n,i,o){let s=n.toBase58()===e.mintB.address,a=[],{isExist:u,startIndex:c,nextAccountMeta:l}=this.getFirstInitializedTickArray(e,s);if(!u||c===void 0||!l)throw new Error("Invalid tick array");try{let f=this.preInitializedTickArrayStartIndex(e,s);if(f.isExist){let{publicKey:w}=se(e.programId,e.id,f.nextStartIndex);a.push(w)}}catch{}a.push(l);let{amountCalculated:m,accounts:d,sqrtPriceX64:p,feeAmount:y}=_t.swapCompute(e.programId,e.id,t,e.tickArrayBitmap,e.exBitmapInfo,s,e.ammConfig.tradeFeeRate,e.liquidity,e.tickCurrent,e.tickSpacing,e.sqrtPriceX64,i.mul(lt),c,o);return a.push(...d),{expectedAmountIn:m,remainingAccounts:a,executionPrice:p,feeAmount:y}}static getFirstInitializedTickArray(e,t){let{isInitialized:n,startIndex:i}=Be.isOverflowDefaultTickarrayBitmap(e.tickSpacing,[e.tickCurrent])?xn.checkTickArrayIsInit(ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing),e.tickSpacing,e.exBitmapInfo):V.checkTickArrayIsInitialized(V.mergeTickArrayBitmap(e.tickArrayBitmap),e.tickCurrent,e.tickSpacing);if(n){let{publicKey:a}=se(e.programId,e.id,i);return{isExist:!0,startIndex:i,nextAccountMeta:a}}let{isExist:o,nextStartIndex:s}=this.nextInitializedTickArrayStartIndex(e,ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing),t);if(o){let{publicKey:a}=se(e.programId,e.id,s);return{isExist:!0,startIndex:s,nextAccountMeta:a}}return{isExist:!1,nextAccountMeta:void 0,startIndex:void 0}}static preInitializedTickArrayStartIndex(e,t){let n=Math.floor(e.tickCurrent/ne.tickCount(e.tickSpacing)),i=t?V.searchHightBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n+1,1,e.tickSpacing):V.searchLowBitFromStart(e.tickArrayBitmap,e.exBitmapInfo,n-1,1,e.tickSpacing);return i.length>0?{isExist:!0,nextStartIndex:i[0]}:{isExist:!1,nextStartIndex:0}}static nextInitializedTickArrayStartIndex(e,t,n){for(t=ne.getArrayStartIndex(e.tickCurrent,e.tickSpacing);;){let{isInit:i,tickIndex:o}=mt.nextInitializedTickArrayStartIndex(V.mergeTickArrayBitmap(e.tickArrayBitmap),t,e.tickSpacing,n);if(i)return{isExist:!0,nextStartIndex:o};t=o;let{isInit:s,tickIndex:a}=xn.nextInitializedTickArrayFromOneBitmap(t,e.tickSpacing,n,e.exBitmapInfo);if(s)return{isExist:!0,nextStartIndex:a};if(t=a,t<Re||t>Me)return{isExist:!1,nextStartIndex:0}}}static async updatePoolRewardInfos({connection:e,apiPoolInfo:t,chainTime:n,poolLiquidity:i,rewardInfos:o}){var a,u,c;let s=[];for(let l=0;l<o.length;l++){let m=o[l],d=(c=(a=t.rewardDefaultInfos[l])==null?void 0:a.mint.programId)!=null?c:(u=await e.getAccountInfo(m.tokenMint))==null?void 0:u.owner;if(d===void 0)throw Error("get new reward mint info error");let p=J(W({},m),{perSecond:Z.x64ToDecimal(m.emissionsPerSecondX64),remainingRewards:void 0,tokenProgramId:new Ye(d)});if(p.tokenMint.equals(Ye.default))continue;if(n<=p.openTime.toNumber()||i.eq(ye)){s.push(p);continue}let y=new ce(Math.min(p.endTime.toNumber(),n)),f=y.sub(p.lastUpdateTime),w=Z.mulDivFloor(f,p.emissionsPerSecondX64,i),g=p.rewardGrowthGlobalX64.add(w),A=Z.mulDivFloor(f,p.emissionsPerSecondX64,_e),h=p.rewardTotalEmissioned.add(A);s.push(J(W({},p),{rewardGrowthGlobalX64:g,rewardTotalEmissioned:h,lastUpdateTime:y}))}return s}static isOverflowDefaultTickarrayBitmap(e,t){let{maxTickBoundary:n,minTickBoundary:i}=this.tickRange(e);for(let o of t){let s=V.getTickArrayStartIndexByTick(o,e);if(s>=n||s<i)return!0}return!1}static tickRange(e){let t=mt.maxTickInTickarrayBitmap(e),n=-t;return t>Me&&(t=ne.getArrayStartIndex(Me,e)+ne.tickCount(e)),n<Re&&(n=ne.getArrayStartIndex(Re,e)),{maxTickBoundary:t,minTickBoundary:n}}static get_tick_array_offset(e,t){if(!ne.checkIsValidStartIndex(e,t))throw new Error("No enough initialized tickArray");return e/ne.tickCount(t)*vt}static async fetchExBitmaps({connection:e,exBitmapAddress:t,batchRequest:n}){let i=await Lt(e,t.map(s=>({pubkey:s})),{batchRequest:n}),o={};for(let s of i)s.accountInfo!==null&&(o[s.pubkey.toString()]=vo.decode(s.accountInfo.data));return o}static async fetchMultiplePoolTickArrays({connection:e,poolKeys:t,batchRequest:n}){let i={},o=[];for(let u of t){let c=V.getTickArrayStartIndexByTick(u.tickCurrent,u.tickSpacing),l=V.getInitializedTickArrayInRange(u.tickArrayBitmap,u.exBitmapInfo,u.tickSpacing,c,7);for(let m of l){let{publicKey:d}=se(u.programId,u.id,m);o.push({pubkey:d}),i[d.toString()]=u.id}}let s=await Lt(e,o,{batchRequest:n}),a={};for(let u of s){if(!u.accountInfo)continue;let c=i[u.pubkey.toString()];if(!c)continue;a[c.toString()]===void 0&&(a[c.toString()]={});let l=Tn.decode(u.accountInfo.data);a[c.toString()][l.startTickIndex]=J(W({},l),{address:u.pubkey})}return a}static async fetchPoolsAccountPosition({pools:e,connection:t,ownerInfo:n,batchRequest:i=!1,updateOwnerRewardAndFee:o=!0}){var a;let s=[];for(let u=0;u<e.length;u++){let c=e[u];c!==null&&(s.find(l=>l.equals(c.state.programId))||s.push(c.state.programId))}if(n){let u=n.tokenAccounts.map(d=>d.accountInfo.mint),c=[];for(let d of u)for(let p of s)c.push(Oe(p,d).publicKey);let l=await ct(t,c,{batchRequest:i}),m={};for(let d of l){if(d===null)continue;let p=Eo.decode(d.data),y=p.poolId.toString(),f=e.find(x=>x.state.id.toBase58()===y);if(f===void 0)continue;let w=f.state,g=V._getTickPriceLegacy({poolInfo:w,tick:p.tickLower,baseIn:!0}),A=V._getTickPriceLegacy({poolInfo:w,tick:p.tickUpper,baseIn:!0}),{amountA:h,amountB:k}=re.getAmountsFromLiquidity(w.sqrtPriceX64,g.tickSqrtPriceX64,A.tickSqrtPriceX64,p.liquidity,!1),T=1/(1-Math.sqrt(Math.sqrt(g.price.div(A.price).toNumber())));f.positionAccount=[...(a=f.positionAccount)!=null?a:[],{poolId:p.poolId,nftMint:p.nftMint,priceLower:g.price,priceUpper:A.price,amountA:h,amountB:k,tickLower:p.tickLower,tickUpper:p.tickUpper,liquidity:p.liquidity,feeGrowthInsideLastX64A:p.feeGrowthInsideLastX64A,feeGrowthInsideLastX64B:p.feeGrowthInsideLastX64B,tokenFeesOwedA:p.tokenFeesOwedA,tokenFeesOwedB:p.tokenFeesOwedB,rewardInfos:p.rewardInfos.map(x=>J(W({},x),{pendingReward:new ce(0)})),leverage:T,tokenFeeAmountA:new ce(0),tokenFeeAmountB:new ce(0)}];let P=await V.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickLower,f.state.tickSpacing),K=await V.getTickArrayAddressByTick(f.state.programId,p.poolId,p.tickUpper,f.state.tickSpacing);m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickLower}`]=P,m[`${f.state.programId.toString()}-${p.poolId.toString()}-${p.tickUpper}`]=K}if(o){let d=Object.values(m),p=await ct(t,d,{batchRequest:i}),y={};for(let f=0;f<d.length;f++){let w=p[f];if(w===null)continue;let g=d[f].toString();y[g]=Tn.decode(w.data)}for(let{state:f,positionAccount:w}of e)if(!!w)for(let g of w){let A=`${f.programId.toString()}-${f.id.toString()}-${g.tickLower}`,h=`${f.programId.toString()}-${f.id.toString()}-${g.tickUpper}`,k=y[m[A].toString()],T=y[m[h].toString()],P=k.ticks[V.getTickOffsetInArray(g.tickLower,f.tickSpacing)],K=T.ticks[V.getTickOffsetInArray(g.tickUpper,f.tickSpacing)],{tokenFeeAmountA:x,tokenFeeAmountB:_}=await Pn.GetPositionFees(f,g,P,K),E=await Pn.GetPositionRewards(f,g,P,K);g.tokenFeeAmountA=x.gte(new ce(0))?x:new ce(0),g.tokenFeeAmountB=_.gte(new ce(0))?_:new ce(0);for(let v=0;v<E.length;v++)g.rewardInfos[v].pendingReward=E[v].gte(new ce(0))?E[v]:new ce(0)}}}return e}static computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountIn:o,slippage:s,priceLimit:a=new L(0),catchLiquidityInsufficient:u=!1}){var Q;let c,l=n.toBase58()===e.mintA.address,[m,d]=l?[e.mintA.extensions.feeConfig,e.mintB.extensions.feeConfig]:[e.mintB.extensions.feeConfig,e.mintA.extensions.feeConfig];a.equals(new L(0))?c=l?Mt.add(new ce(1)):Et.sub(new ce(1)):c=Y.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let p=be(o,m,i,!1),{allTrade:y,expectedAmountOut:f,remainingAccounts:w,executionPrice:g,feeAmount:A}=Be.getOutputAmountAndRemainAccounts(e,t,n,p.amount.sub((Q=p.fee)!=null?Q:ye),c,u),h=be(f,d,i,!1),k=Y.sqrtPriceX64ToPrice(g,e.mintA.decimals,e.mintB.decimals),T=l?k:new L(1).div(k),P=f.mul(new ce(Math.floor((1-s)*1e10))).div(new ce(1e10)),K=be(P,d,i,!1),x=l?e.currentPrice:new L(1).div(e.currentPrice),_=new L(T).sub(x).abs(),E=x,v=new We(new L(_).mul(10**15).toFixed(0),new L(E).mul(10**15).toFixed(0));return{allTrade:y,realAmountIn:p,amountOut:h,minAmountOut:K,expirationTime:ht(p.expirationTime,h.expirationTime),currentPrice:e.currentPrice,executionPrice:T,priceImpact:v,fee:A,remainingAccounts:w,executionPriceX64:g}}static computeAmountOutFormat({poolInfo:e,tickArrayCache:t,amountIn:n,tokenOut:i,slippage:o,epochInfo:s,catchLiquidityInsufficient:a=!1}){let u=i.address===e.mintB.address,[c,l]=u?[e.mintA,e.mintB]:[e.mintB,e.mintA],[m,d]=[new Ke(J(W({},c),{mint:c.address,isToken2022:c.programId===Co.toBase58()})),new Ke(J(W({},l),{mint:l.address,isToken2022:l.programId===Co.toBase58()}))],{allTrade:p,realAmountIn:y,amountOut:f,minAmountOut:w,expirationTime:g,currentPrice:A,executionPrice:h,priceImpact:k,fee:T,remainingAccounts:P,executionPriceX64:K}=Be.computeAmountOut({poolInfo:e,tickArrayCache:t,baseMint:new Ye(c.address),amountIn:n,slippage:o,epochInfo:s,catchLiquidityInsufficient:a}),x=J(W({},y),{amount:new fe(m,y.amount),fee:y.fee===void 0?void 0:new fe(m,y.fee)}),_=J(W({},f),{amount:new fe(d,f.amount),fee:f.fee===void 0?void 0:new fe(d,f.fee)}),E=J(W({},w),{amount:new fe(d,w.amount),fee:w.fee===void 0?void 0:new fe(d,w.fee)}),v=new De({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:A.mul(new L(10**(20+d.decimals))).toFixed(0)}),Q=new De({baseToken:m,denominator:new ce(10).pow(new ce(20+m.decimals)),quoteToken:d,numerator:h.mul(new L(10**(20+d.decimals))).toFixed(0)}),H=new fe(m,T);return{allTrade:p,realAmountIn:x,amountOut:_,minAmountOut:E,expirationTime:g,currentPrice:v,executionPrice:Q,priceImpact:k,fee:H,remainingAccounts:P,executionPriceX64:K}}static computeAmountIn({poolInfo:e,tickArrayCache:t,baseMint:n,epochInfo:i,amountOut:o,slippage:s,priceLimit:a=new L(0)}){var E;let u=n.toBase58()===e.mintA.address,c={[e.mintA.address]:e.mintA.extensions.feeConfig,[e.mintB.address]:e.mintB.extensions.feeConfig},l;a.equals(new L(0))?l=u?Et.sub(new ce(1)):Mt.add(new ce(1)):l=Y.priceToSqrtPriceX64(a,e.mintA.decimals,e.mintB.decimals);let m=be(o,c[n.toString()],i,!0),{expectedAmountIn:d,remainingAccounts:p,executionPrice:y,feeAmount:f}=Be.getInputAmountAndRemainAccounts(e,t,n,m.amount.sub((E=m.fee)!=null?E:ye),l),w=u?e.mintB.address:e.mintA.address,g=be(d,c[w],i,!1),A=Y.sqrtPriceX64ToPrice(y,e.mintA.decimals,e.mintB.decimals),h=u?A:new L(1).div(A),k=d.mul(new ce(Math.floor((1+s)*1e10))).div(new ce(1e10)),T=be(k,c[w],i,!0),P=u?e.currentPrice:new L(1).div(e.currentPrice),K=new L(h).sub(P).abs(),x=P,_=new We(new L(K).mul(10**15).toFixed(0),new L(x).mul(10**15).toFixed(0));return{amountIn:g,maxAmountIn:T,realAmountOut:m,expirationTime:ht(g.expirationTime,m.expirationTime),currentPrice:e.currentPrice,executionPrice:h,priceImpact:_,fee:f,remainingAccounts:p}}static estimateAprsForPriceRangeMultiplier({poolInfo:e,aprType:t,positionTickLowerIndex:n,positionTickUpperIndex:i}){var y,f,w;let o=e[t],s=V.getTickPrice({poolInfo:e,tick:n,baseIn:!0}).price.toNumber(),a=V.getTickPrice({poolInfo:e,tick:i,baseIn:!0}).price.toNumber(),u=Math.max(s,o.priceMin),l=Math.min(a,o.priceMax)-u,m=a-s,d=o.priceMax-o.priceMin,p;return l<=0?p=0:m===l?p=d/l:d===l?p=l/m:p=l/d*(l/m),{feeApr:o.feeApr*p,rewardsApr:[((y=o.rewardApr[0])!=null?y:0)*p,((f=o.rewardApr[1])!=null?f:0)*p,((w=o.rewardApr[2])!=null?w:0)*p],apr:o.apr*p}}static estimateAprsForPriceRangeDelta({poolInfo:e,poolLiquidity:t,aprType:n,mintPrice:i,liquidity:o,positionTickLowerIndex:s,positionTickUpperIndex:a,chainTime:u}){let c=n==="day"?1:n==="week"?7:n==="month"?30:0,l=e[n],m=i[Zt(e.mintA.address).toString()],d=i[Zt(e.mintB.address).toString()],p=e.mintA.decimals,y=e.mintB.decimals;if(!l||!m||!d)return{feeApr:0,rewardsApr:[0,0,0],apr:0};let f=Y.priceToSqrtPriceX64(new L(e.price),e.mintA.decimals,e.mintB.decimals),w=Y.getSqrtPriceX64FromTick(s),g=Y.getSqrtPriceX64FromTick(a),{amountSlippageA:A,amountSlippageB:h}=re.getAmountsFromLiquidityWithSlippage(f,w,g,t,!1,!1,0),{amountSlippageA:k,amountSlippageB:T}=re.getAmountsFromLiquidityWithSlippage(f,w,g,o,!1,!1,0),P=new L(A.toString()).div(new L(10).pow(p)).mul(m.value).add(new L(h.toString()).div(new L(10).pow(y)).mul(d.value)),K=new L(k.toString()).div(new L(10).pow(p)).mul(m.value).add(new L(T.toString()).div(new L(10).pow(y)).mul(d.value)),x=new L(1).div(P.add(K)),E=new L(l.volumeFee).mul(365).div(c).mul(x).mul(100).toNumber(),v=3600*24*365,Q=e.rewardDefaultInfos.map(H=>{var D,Ue;let ie=H.mint.decimals,ee=i[H.mint.address];return u<((D=H.startTime)!=null?D:0)||u>((Ue=H.endTime)!=null?Ue:0)||!H.perSecond||!ee||ie===void 0?0:new L(ee.value).mul(new L(H.perSecond).mul(v)).div(new L(10).pow(ie)).mul(x).mul(100).toNumber()});return{feeApr:E,rewardsApr:Q,apr:E+Q.reduce((H,ie)=>H+ie,0)}}static getLiquidityAmountOutFromAmountIn({poolInfo:e,inputA:t,tickLower:n,tickUpper:i,amount:o,slippage:s,add:a,epochInfo:u,amountHasFee:c}){var g,A;let l=Y.priceToSqrtPriceX64(new L(e.price),e.mintA.decimals,e.mintB.decimals),m=Y.getSqrtPriceX64FromTick(n),d=Y.getSqrtPriceX64FromTick(i),p=a?1-s:1+s,y=be(o,(g=e[t?"mintA":"mintB"].extensions)==null?void 0:g.feeConfig,u,!c),f=new ce(new L(y.amount.sub((A=y.fee)!=null?A:ye).toString()).mul(p).toFixed(0)),w;if(l.lte(m))w=t?re.getLiquidityFromTokenAmountA(m,d,f,!a):new ce(0);else if(l.lte(d)){let h=re.getLiquidityFromTokenAmountA(l,d,f,!a),k=re.getLiquidityFromTokenAmountB(m,l,f);w=t?h:k}else w=t?new ce(0):re.getLiquidityFromTokenAmountB(m,d,f);return Be.getAmountsFromLiquidity({epochInfo:u,poolInfo:e,tickLower:n,tickUpper:i,liquidity:w,slippage:s,add:a})}static async getAmountsFromLiquidity({epochInfo:e,poolInfo:t,tickLower:n,tickUpper:i,liquidity:o,slippage:s,add:a}){var w,g,A,h;let u=Y.getSqrtPriceX64FromTick(n),c=Y.getSqrtPriceX64FromTick(i),l=a?1+s:1-s,m=re.getAmountsFromLiquidity(Y.priceToSqrtPriceX64(new L(t.price),t.mintA.decimals,t.mintB.decimals),u,c,o,a),[d,p]=[be(m.amountA,(w=t.mintA.extensions)==null?void 0:w.feeConfig,e,!0),be(m.amountB,(g=t.mintB.extensions)==null?void 0:g.feeConfig,e,!0)],[y,f]=[be(m.amountA.muln(l),(A=t.mintA.extensions)==null?void 0:A.feeConfig,e,!0),be(m.amountB.muln(l),(h=t.mintB.extensions)==null?void 0:h.feeConfig,e,!0)];return{liquidity:o,amountA:d,amountB:p,amountSlippageA:y,amountSlippageB:f,expirationTime:ht(d.expirationTime,p.expirationTime)}}static async fetchComputeMultipleClmmInfo({connection:e,poolList:t,rpcDataMap:n={}}){let i=t.filter(u=>!n[u.id]).map(u=>new Ye(u.id));(await ct(e,i)).forEach((u,c)=>{!u||(n[i[c].toBase58()]=Mo.decode(u.data))});let s=t.map(u=>Ge(new Ye(u.programId),new Ye(u.id)).publicKey),a=await Be.fetchExBitmaps({connection:e,exBitmapAddress:s,batchRequest:!1});return t.reduce((u,c)=>J(W({},u),{[c.id]:J(W({},n[c.id]),{id:new Ye(c.id),version:6,programId:new Ye(c.programId),mintA:c.mintA,mintB:c.mintB,ammConfig:J(W({},c.config),{id:new Ye(c.config.id),fundOwner:""}),currentPrice:new L(c.price),exBitmapInfo:a[Ge(new Ye(c.programId),new Ye(c.id)).publicKey.toBase58()],startTime:n[c.id].startTime.toNumber(),rewardInfos:n[c.id].rewardInfos})}),{})}static async fetchComputeClmmInfo({connection:e,poolInfo:t,rpcData:n}){return(await this.fetchComputeMultipleClmmInfo({connection:e,rpcDataMap:n?{[t.id]:n}:void 0,poolList:[t]}))[t.id]}};var Z=class{static mulDivRoundingUp(e,t,n){let i=e.mul(t),o=i.div(n);return i.mod(n).eq(ye)||(o=o.add(et)),o}static mulDivFloor(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).div(n)}static mulDivCeil(e,t,n){if(n.eq(ye))throw new Error("division by 0");return e.mul(t).add(n.sub(et)).div(n)}static x64ToDecimal(e,t){return new L(e.toString()).div(L.pow(2,64)).toDecimalPlaces(t)}static decimalToX64(e){return new $(e.mul(L.pow(2,64)).floor().toFixed())}static wrappingSubU128(e,t){return e.add($n).sub(t).mod($n)}};function Te(r,e){return Qr(r.mul(e),64,256)}function Cu(r,e,t){let n=r.toTwos(t).shln(e);return n.imaskn(t+1),n.fromTwos(t)}function Qr(r,e,t){let n=r.toTwos(t).shrn(e);return n.imaskn(t-e+1),n.fromTwos(t-e)}var Y=class{static sqrtPriceX64ToPrice(e,t,n){return Z.x64ToDecimal(e).pow(2).mul(L.pow(10,t-n))}static priceToSqrtPriceX64(e,t,n){return Z.decimalToX64(e.mul(L.pow(10,n-t)).sqrt())}static getNextSqrtPriceX64FromInput(e,t,n,i){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!0):this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!0)}static getNextSqrtPriceX64FromOutput(e,t,n,i){if(!e.gt(ye))throw new Error("sqrtPriceX64 must greater than 0");if(!t.gt(ye))throw new Error("liquidity must greater than 0");return i?this.getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,!1):this.getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,!1)}static getNextSqrtPriceFromTokenAmountARoundingUp(e,t,n,i){if(n.eq(ye))return e;let o=t.shln(hn);if(i){let s=o,a=o.add(n.mul(e));return a.gte(s)?Z.mulDivCeil(s,e,a):Z.mulDivRoundingUp(s,et,s.div(e).add(n))}else{let s=n.mul(e);if(!o.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountARoundingUp,liquidityLeftShift must gt amountMulSqrtPrice");let a=o.sub(s);return Z.mulDivCeil(o,e,a)}}static getNextSqrtPriceFromTokenAmountBRoundingDown(e,t,n,i){let o=n.shln(hn);if(i)return e.add(o.div(t));{let s=Z.mulDivRoundingUp(o,et,t);if(!e.gt(s))throw new Error("getNextSqrtPriceFromTokenAmountBRoundingDown sqrtPriceX64 must gt amountDivLiquidity");return e.sub(s)}}static getSqrtPriceX64FromTick(e){if(!Number.isInteger(e))throw new Error("tick must be integer");if(e<Re||e>Me)throw new Error("tick must be in MIN_TICK and MAX_TICK");let t=e<0?e*-1:e,n=(t&1)!=0?new $("18445821805675395072"):new $("18446744073709551616");return(t&2)!=0&&(n=Te(n,new $("18444899583751176192"))),(t&4)!=0&&(n=Te(n,new $("18443055278223355904"))),(t&8)!=0&&(n=Te(n,new $("18439367220385607680"))),(t&16)!=0&&(n=Te(n,new $("18431993317065453568"))),(t&32)!=0&&(n=Te(n,new $("18417254355718170624"))),(t&64)!=0&&(n=Te(n,new $("18387811781193609216"))),(t&128)!=0&&(n=Te(n,new $("18329067761203558400"))),(t&256)!=0&&(n=Te(n,new $("18212142134806163456"))),(t&512)!=0&&(n=Te(n,new $("17980523815641700352"))),(t&1024)!=0&&(n=Te(n,new $("17526086738831433728"))),(t&2048)!=0&&(n=Te(n,new $("16651378430235570176"))),(t&4096)!=0&&(n=Te(n,new $("15030750278694412288"))),(t&8192)!=0&&(n=Te(n,new $("12247334978884435968"))),(t&16384)!=0&&(n=Te(n,new $("8131365268886854656"))),(t&32768)!=0&&(n=Te(n,new $("3584323654725218816"))),(t&65536)!=0&&(n=Te(n,new $("696457651848324352"))),(t&131072)!=0&&(n=Te(n,new $("26294789957507116"))),(t&262144)!=0&&(n=Te(n,new $("37481735321082"))),e>0&&(n=ho.div(n)),n}static getTickFromPrice(e,t,n){return Y.getTickFromSqrtPriceX64(Y.priceToSqrtPriceX64(e,t,n))}static getTickFromSqrtPriceX64(e){if(e.gt(Et)||e.lt(Mt))throw new Error("Provided sqrtPrice is not within the supported sqrtPrice range.");let t=e.bitLength()-1,n=new $(t-64),i=Cu(n,32,128),o=new $("8000000000000000","hex"),s=0,a=new $(0),u=t>=64?e.shrn(t-63):e.shln(63-t);for(;o.gt(new $(0))&&s<ko;){u=u.mul(u);let y=u.shrn(127);u=u.shrn(63+y.toNumber()),a=a.add(o.mul(y)),o=o.shrn(1),s+=1}let c=a.shrn(32),m=i.add(c).mul(new $(Ao)),d=Qr(m.sub(new $(Po)),64,128).toNumber(),p=Qr(m.add(new $(To)),64,128).toNumber();return d==p?d:Y.getSqrtPriceX64FromTick(p).lte(e)?p:d}},Ot=class{static getTickWithPriceAndTickspacing(e,t,n,i){let s=Y.getTickFromSqrtPriceX64(Y.priceToSqrtPriceX64(e,n,i))/t;return s<0?s=Math.floor(s):s=Math.ceil(s),s*t}static roundPriceWithTickspacing(e,t,n,i){let o=Ot.getTickWithPriceAndTickspacing(e,t,n,i),s=Y.getSqrtPriceX64FromTick(o);return Y.sqrtPriceX64ToPrice(s,n,i)}},re=class{static addDelta(e,t){return e.add(t)}static getTokenAmountAFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");let o=n.ushln(hn),s=t.sub(e);return i?Z.mulDivRoundingUp(Z.mulDivCeil(o,s,t),et,e):Z.mulDivFloor(o,s,t).div(e)}static getTokenAmountBFromLiquidity(e,t,n,i){if(e.gt(t)&&([e,t]=[t,e]),!e.gt(ye))throw new Error("sqrtPriceX64A must greater than 0");return i?Z.mulDivCeil(n,t.sub(e),_e):Z.mulDivFloor(n,t.sub(e),_e)}static getLiquidityFromTokenAmountA(e,t,n,i){e.gt(t)&&([e,t]=[t,e]);let o=n.mul(e).mul(t),s=t.sub(e),a=o.div(s);return i?Z.mulDivRoundingUp(a,et,Wr):a.shrn(hn)}static getLiquidityFromTokenAmountB(e,t,n){return e.gt(t)&&([e,t]=[t,e]),Z.mulDivFloor(n,Wr,t.sub(e))}static getLiquidityFromTokenAmounts(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return re.getLiquidityFromTokenAmountA(t,n,i,!1);if(e.lt(n)){let s=re.getLiquidityFromTokenAmountA(e,n,i,!1),a=re.getLiquidityFromTokenAmountB(t,e,o);return s.lt(a)?s:a}else return re.getLiquidityFromTokenAmountB(t,n,o)}static getAmountsFromLiquidity(e,t,n,i,o){if(t.gt(n)&&([t,n]=[n,t]),e.lte(t))return{amountA:re.getTokenAmountAFromLiquidity(t,n,i,o),amountB:new $(0)};if(e.lt(n)){let s=re.getTokenAmountAFromLiquidity(e,n,i,o),a=re.getTokenAmountBFromLiquidity(t,e,i,o);return{amountA:s,amountB:a}}else return{amountA:new $(0),amountB:re.getTokenAmountBFromLiquidity(t,n,i,o)}}static getAmountsFromLiquidityWithSlippage(e,t,n,i,o,s,a){let{amountA:u,amountB:c}=re.getAmountsFromLiquidity(e,t,n,i,s),l=o?1+a:1-a,m=new $(new L(u.toString()).mul(l).toFixed(0)),d=new $(new L(c.toString()).mul(l).toFixed(0));return{amountSlippageA:m,amountSlippageB:d}}static getAmountsOutFromLiquidity({poolInfo:e,tickLower:t,tickUpper:n,liquidity:i,slippage:o,add:s,epochInfo:a,amountAddFee:u}){var A,h,k,T;let c=Y.priceToSqrtPriceX64(new L(e.price),e.mintA.decimals,e.mintB.decimals),l=Y.getSqrtPriceX64FromTick(t),m=Y.getSqrtPriceX64FromTick(n),d=s?1+o:1-o,p=re.getAmountsFromLiquidity(c,l,m,i,s),[y,f]=[be(p.amountA,(A=e.mintA.extensions)==null?void 0:A.feeConfig,a,u),be(p.amountB,(h=e.mintB.extensions)==null?void 0:h.feeConfig,a,u)],[w,g]=[be(new $(new L(p.amountA.toString()).mul(d).toFixed(0)),(k=e.mintA.extensions)==null?void 0:k.feeConfig,a,u),be(new $(new L(p.amountB.toString()).mul(d).toFixed(0)),(T=e.mintB.extensions)==null?void 0:T.feeConfig,a,u)];return{liquidity:i,amountA:y,amountB:f,amountSlippageA:w,amountSlippageB:g,expirationTime:ht(y.expirationTime,f.expirationTime)}}},_t=class{static swapCompute(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f=!1){if(d.eq(ye))throw new Error("amountSpecified must not be 0");if(y||(y=s?Mt.add(et):Et.sub(et)),s){if(y.lt(Mt))throw new Error("sqrtPriceX64 must greater than MIN_SQRT_PRICE_X64");if(y.gte(m))throw new Error("sqrtPriceX64 must smaller than current")}else{if(y.gt(Et))throw new Error("sqrtPriceX64 must smaller than MAX_SQRT_PRICE_X64");if(y.lte(m))throw new Error("sqrtPriceX64 must greater than current")}let w=d.gt(ye),g={amountSpecifiedRemaining:d,amountCalculated:ye,sqrtPriceX64:m,tick:c>p?Math.min(p+ne.tickCount(l)-1,c):p,accounts:[],liquidity:u,feeAmount:new $(0)},A=p,h=n[p],k=0,T=!s&&h.startTickIndex===g.tick;for(;!g.amountSpecifiedRemaining.eq(ye)&&!g.sqrtPriceX64.eq(y);){k>10;let P={};P.sqrtPriceStartX64=g.sqrtPriceX64;let K=V.nextInitTick(h,g.tick,l,s,T),x=K||null,_=null;if(!(x!=null&&x.liquidityGross.gtn(0))){let v=Be.nextInitializedTickArrayStartIndex({tickCurrent:g.tick,tickSpacing:l,tickArrayBitmap:i,exBitmapInfo:o},A,s);if(!v.isExist){if(f)return{allTrade:!1,amountSpecifiedRemaining:g.amountSpecifiedRemaining,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts};throw Error("swapCompute LiquidityInsufficient")}A=v.nextStartIndex;let{publicKey:Q}=se(e,t,A);_=Q,h=n[A];try{x=V.firstInitializedTick(h,s)}catch{throw Error("not found next tick info")}}P.tickNext=x.tick,P.initialized=x.liquidityGross.gtn(0),p!==A&&_&&(g.accounts.push(_),p=A),P.tickNext<Re?P.tickNext=Re:P.tickNext>Me&&(P.tickNext=Me),P.sqrtPriceNextX64=Y.getSqrtPriceX64FromTick(P.tickNext);let E;if(s&&P.sqrtPriceNextX64.lt(y)||!s&&P.sqrtPriceNextX64.gt(y)?E=y:E=P.sqrtPriceNextX64,[g.sqrtPriceX64,P.amountIn,P.amountOut,P.feeAmount]=_t.swapStepCompute(g.sqrtPriceX64,E,g.liquidity,g.amountSpecifiedRemaining,a),g.feeAmount=g.feeAmount.add(P.feeAmount),w?(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.sub(P.amountIn.add(P.feeAmount)),g.amountCalculated=g.amountCalculated.sub(P.amountOut)):(g.amountSpecifiedRemaining=g.amountSpecifiedRemaining.add(P.amountOut),g.amountCalculated=g.amountCalculated.add(P.amountIn.add(P.feeAmount))),g.sqrtPriceX64.eq(P.sqrtPriceNextX64)){if(P.initialized){let v=x.liquidityNet;s&&(v=v.mul(lt)),g.liquidity=re.addDelta(g.liquidity,v)}T=P.tickNext!=g.tick&&!s&&h.startTickIndex===P.tickNext,g.tick=s?P.tickNext-1:P.tickNext}else if(g.sqrtPriceX64!=P.sqrtPriceStartX64){let v=Y.getTickFromSqrtPriceX64(g.sqrtPriceX64);T=v!=g.tick&&!s&&h.startTickIndex===v,g.tick=v}++k}try{let{nextStartIndex:P,isExist:K}=ne.nextInitializedTickArray(g.tick,l,s,i,o);K&&p!==P&&(g.accounts.push(se(e,t,P).publicKey),p=P)}catch{}return{allTrade:!0,amountSpecifiedRemaining:ye,amountCalculated:g.amountCalculated,feeAmount:g.feeAmount,sqrtPriceX64:g.sqrtPriceX64,liquidity:g.liquidity,tickCurrent:g.tick,accounts:g.accounts}}static swapStepCompute(e,t,n,i,o){let s={sqrtPriceX64Next:new $(0),amountIn:new $(0),amountOut:new $(0),feeAmount:new $(0)},a=e.gte(t),u=i.gte(ye);if(u){let l=Z.mulDivFloor(i,Jn.sub(new $(o.toString())),Jn);s.amountIn=a?re.getTokenAmountAFromLiquidity(t,e,n,!0):re.getTokenAmountBFromLiquidity(e,t,n,!0),l.gte(s.amountIn)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Y.getNextSqrtPriceX64FromInput(e,n,l,a)}else s.amountOut=a?re.getTokenAmountBFromLiquidity(t,e,n,!1):re.getTokenAmountAFromLiquidity(e,t,n,!1),i.mul(lt).gte(s.amountOut)?s.sqrtPriceX64Next=t:s.sqrtPriceX64Next=Y.getNextSqrtPriceX64FromOutput(e,n,i.mul(lt),a);let c=t.eq(s.sqrtPriceX64Next);return a?(c&&u||(s.amountIn=re.getTokenAmountAFromLiquidity(s.sqrtPriceX64Next,e,n,!0)),c&&!u||(s.amountOut=re.getTokenAmountBFromLiquidity(s.sqrtPriceX64Next,e,n,!1))):(s.amountIn=c&&u?s.amountIn:re.getTokenAmountBFromLiquidity(e,s.sqrtPriceX64Next,n,!0),s.amountOut=c&&!u?s.amountOut:re.getTokenAmountAFromLiquidity(e,s.sqrtPriceX64Next,n,!1)),!u&&s.amountOut.gt(i.mul(lt))&&(s.amountOut=i.mul(lt)),u&&!s.sqrtPriceX64Next.eq(t)?s.feeAmount=i.sub(s.amountIn):s.feeAmount=Z.mulDivCeil(s.amountIn,new $(o),Jn.sub(new $(o))),[s.sqrtPriceX64Next,s.amountIn,s.amountOut,s.feeAmount]}};var Ae=60,vt=512,V=class{static getTickArrayAddressByTick(e,t,n,i){let o=V.getTickArrayStartIndexByTick(n,i),{publicKey:s}=se(e,t,o);return s}static getTickOffsetInArray(e,t){if(e%t!=0)throw new Error("tickIndex % tickSpacing not equal 0");let n=V.getTickArrayStartIndexByTick(e,t),i=Math.floor((e-n)/t);if(i<0||i>=Ae)throw new Error("tick offset in array overflow");return i}static getTickArrayBitIndex(e,t){let n=ne.tickCount(t),i=e/n;return e<0&&e%n!=0?i=Math.ceil(i)-1:i=Math.floor(i),i}static getTickArrayStartIndexByTick(e,t){return this.getTickArrayBitIndex(e,t)*ne.tickCount(t)}static getTickArrayOffsetInBitmapByTick(e,t){let n=t*Ae,i=Math.floor(e/n)+512;return Math.abs(i)}static checkTickArrayIsInitialized(e,t,n){let i=n*Ae,o=Math.floor(t/i)+512,s=Math.abs(o);return{isInitialized:e.testn(s),startIndex:(s-512)*i}}static getNextTickArrayStartIndex(e,t,n){return n?e-t*Ae:e+t*Ae}static mergeTickArrayBitmap(e){let t=new Mu(0);for(let n=0;n<e.length;n++)t=t.add(e[n].shln(64*n));return t}static getInitializedTickArrayInRange(e,t,n,i,o){let s=Math.floor(i/(n*Ae));return[...V.searchLowBitFromStart(e,t,s-1,o,n),...V.searchHightBitFromStart(e,t,s,o,n)]}static getAllInitializedTickArrayStartIndex(e,t,n){return V.searchHightBitFromStart(e,t,0,vt,n)}static getAllInitializedTickArrayInfo(e,t,n,i,o){let s=[],a=V.getAllInitializedTickArrayStartIndex(n,i,o);for(let u of a){let{publicKey:c}=se(e,t,u);s.push({tickArrayStartIndex:u,tickArrayAddress:c})}return s}static getAllInitializedTickInTickArray(e){return e.ticks.filter(t=>t.liquidityGross.gtn(0))}static searchLowBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>V.mergeTickArrayBitmap(c)),a=[];for(;n>=-7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n--,a.length===i)break}let u=ne.tickCount(o);return a.map(c=>c*u)}static searchHightBitFromStart(e,t,n,i,o){let s=[...[...t.negativeTickArrayBitmap].reverse(),e.slice(0,8),e.slice(8,16),...t.positiveTickArrayBitmap].map(c=>V.mergeTickArrayBitmap(c)),a=[];for(;n<7680;){let c=Math.floor((n+7680)/512),l=(n+7680)%512;if(s[c].testn(l)&&a.push(n),n++,a.length===i)break}let u=ne.tickCount(o);return a.map(c=>c*u)}static checkIsOutOfBoundary(e){return e<Re||e>Me}static nextInitTick(e,t,n,i,o){if(ne.getArrayStartIndex(t,n)!=e.startTickIndex)return null;let a=Math.floor((t-e.startTickIndex)/n);if(i)for(;a>=0;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a-1}else for(o||(a=a+1);a<Ae;){if(e.ticks[a].liquidityGross.gtn(0))return e.ticks[a];a=a+1}return null}static firstInitializedTick(e,t){if(t){let n=Ae-1;for(;n>=0;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n-1}}else{let n=0;for(;n<Ae;){if(e.ticks[n].liquidityGross.gtn(0))return e.ticks[n];n=n+1}}throw Error(`firstInitializedTick check error: ${e} - ${t}`)}static _getTickPriceLegacy({poolInfo:e,tick:t,baseIn:n}){let i=Y.getSqrtPriceX64FromTick(t),o=Y.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new L(1).div(o),tickSqrtPriceX64:i}}static _getPriceAndTickLegacy({poolInfo:e,price:t,baseIn:n}){let i=n?t:new L(1).div(t),o=Ot.getTickWithPriceAndTickspacing(i,e.ammConfig.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Y.getSqrtPriceX64FromTick(o),a=Y.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new L(1).div(a)}}static getTickPrice({poolInfo:e,tick:t,baseIn:n}){let i=Y.getSqrtPriceX64FromTick(t),o=Y.sqrtPriceX64ToPrice(i,e.mintA.decimals,e.mintB.decimals);return n?{tick:t,price:o,tickSqrtPriceX64:i}:{tick:t,price:new L(1).div(o),tickSqrtPriceX64:i}}static getPriceAndTick({poolInfo:e,price:t,baseIn:n}){let i=n?t:new L(1).div(t),o=Ot.getTickWithPriceAndTickspacing(i,e.config.tickSpacing,e.mintA.decimals,e.mintB.decimals),s=Y.getSqrtPriceX64FromTick(o),a=Y.sqrtPriceX64ToPrice(s,e.mintA.decimals,e.mintB.decimals);return n?{tick:o,price:a}:{tick:o,price:new L(1).div(a)}}};var Ay=R([we(8),O("bump"),Nt("index"),I(""),Le("protocolFeeRate"),Le("tradeFeeRate"),Nt("tickSpacing"),q(b(),8,"")]),Eu=R([Le("blockTimestamp"),Jt("tickCumulative"),q(b(),4)]),_o=R([we(8),Ce("initialized"),b("recentEpoch"),Nt("observationIndex"),I("poolId"),q(Eu,100,"observations"),q(b(),4)]),vu=R([O("rewardState"),b("openTime"),b("endTime"),b("lastUpdateTime"),U("emissionsPerSecondX64"),b("rewardTotalEmissioned"),b("rewardClaimed"),I("tokenMint"),I("tokenVault"),I("creator"),U("rewardGrowthGlobalX64")]),Mo=R([we(8),O("bump"),I("ammConfig"),I("creator"),I("mintA"),I("mintB"),I("vaultA"),I("vaultB"),I("observationId"),O("mintDecimalsA"),O("mintDecimalsB"),Nt("tickSpacing"),U("liquidity"),U("sqrtPriceX64"),Se("tickCurrent"),Le(),U("feeGrowthGlobalX64A"),U("feeGrowthGlobalX64B"),b("protocolFeesTokenA"),b("protocolFeesTokenB"),U("swapInAmountTokenA"),U("swapOutAmountTokenB"),U("swapInAmountTokenB"),U("swapOutAmountTokenA"),O("status"),q(O(),7,""),q(vu,3,"rewardInfos"),q(b(),16,"tickArrayBitmap"),b("totalFeesTokenA"),b("totalFeesClaimedTokenA"),b("totalFeesTokenB"),b("totalFeesClaimedTokenB"),b("fundFeesTokenA"),b("fundFeesTokenB"),b("startTime"),q(b(),15*4-3,"padding")]),_u=R([U("growthInsideLastX64"),b("rewardAmountOwed")]),Eo=R([we(8),O("bump"),I("nftMint"),I("poolId"),Se("tickLower"),Se("tickUpper"),U("liquidity"),U("feeGrowthInsideLastX64A"),U("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),q(_u,3,"rewardInfos"),q(b(),8,"")]),Py=R([we(8),O("bump"),I("poolId"),Se("tickLowerIndex"),Se("tickUpperIndex"),U("liquidity"),U("feeGrowthInsideLastX64A"),U("feeGrowthInsideLastX64B"),b("tokenFeesOwedA"),b("tokenFeesOwedB"),q(U(),3,"rewardGrowthInside"),q(b(),8,"")]),Ou=R([Se("tick"),ao("liquidityNet"),U("liquidityGross"),U("feeGrowthOutsideX64A"),U("feeGrowthOutsideX64B"),q(U(),3,"rewardGrowthsOutsideX64"),q(Le(),13,"")]),Tn=R([we(8),I("poolId"),Se("startTickIndex"),q(Ou,Ae,"ticks"),O("initializedTickCount"),q(O(),115,"")]),Ty=R([we(329),q(I(),100,"whitelistMints")]),vo=R([we(8),I("poolId"),q(q(b(),8),zr,"positiveTickArrayBitmap"),q(q(b(),8),zr,"negativeTickArrayBitmap")]),xy=R([b(),O("bump"),I("owner"),I("poolId"),I("positionId"),I("nftAccount"),q(b(),8)]),Sy=R([we(8),O("bump"),I("lockOwner"),I("poolId"),I("positionId"),I("nftAccount"),I("lockNftMint"),b("recentEpoch"),q(b(),8)]);_o.span;var Vo=ae("Raydium_Clmm"),je={createPool:[233,146,209,142,207,104,64,188],initReward:[95,135,192,196,242,129,230,68],setRewardEmissions:[112,52,167,75,32,201,211,137],openPosition:[77,184,74,214,112,86,241,199],closePosition:[123,134,81,0,49,68,98,98],increaseLiquidity:[133,29,89,223,69,238,176,10],decreaseLiquidity:[58,127,188,62,79,82,196,96],swap:[43,4,237,11,26,201,30,98],collectReward:[18,237,166,197,34,16,213,144]},Fo=[188,37,179,131,82,150,84,73],Wo=[16,72,250,198,14,162,212,19],tn=class{static createPoolInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y){let f=R([U("sqrtPriceX64"),b("startTime")]),w=[{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:m,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],g=Buffer.alloc(f.span);f.encode({sqrtPriceX64:p,startTime:y},g);let A=Buffer.from([...je.createPool,...g]);return new Ee({keys:w,programId:e,data:A})}static async createPoolInstructions(e){let{programId:t,owner:n,mintA:i,mintB:o,ammConfigId:s,initialPriceX64:a,startTime:u}=e,[c,l]=[new N(i.address),new N(o.address)],{publicKey:m}=Io(t,s,c,l),{publicKey:d}=Lo(t,m),{publicKey:p}=Gr(t,m,c),{publicKey:y}=Gr(t,m,l),f=[this.createPoolInstruction(t,m,n,s,d,c,p,new N(i.programId||le),l,y,new N(o.programId||le),Ge(t,m).publicKey,a,u)];return{signers:[],instructions:f,instructionTypes:[X.CreateAccount,X.ClmmCreatePool],address:{poolId:m,observationId:d,mintAVault:p,mintBVault:y},lookupTableAddress:[]}}static openPositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,A,h,k,T,P,K,x,_,E){let v=R([Se("tickLowerIndex"),Se("tickUpperIndex"),Se("tickArrayLowerStartIndex"),Se("tickArrayUpperStartIndex"),U("liquidity"),b("amountMaxA"),b("amountMaxB"),Ce("withMetadata"),O("optionBaseFlag"),Ce("baseFlag")]),Q=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],H=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:Hr,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(v.span);v.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:T,liquidity:P,amountMaxA:K,amountMaxB:x,withMetadata:_==="create",baseFlag:!1,optionBaseFlag:0},ie);let ee=Buffer.from([...je.openPosition,...ie]);return new Ee({keys:H,programId:e,data:ee})}static async openPositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new N(e.programId),new N(e.id)],y;if(l)y=new N((await l(1))[0]);else{let x=tr.generate();m.push(x),y=x.publicKey}let f=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=se(d,p,f),{publicKey:A}=se(d,p,w),{publicKey:h}=Pe(n.wallet,y,le),{publicKey:k}=An(y),{publicKey:T}=Oe(d,y),{publicKey:P}=kt(d,p,i,o),K=this.openPositionFromLiquidityInstruction(d,n.feePayer,p,n.wallet,y,h,k,P,g,A,T,n.tokenAccountA,n.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(e.mintA.address),new N(e.mintB.address),i,o,f,w,s,a,u,c);return{signers:m,instructions:[K],instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:h,metadataAccount:k,personalPosition:T,protocolPosition:P}}}static async openPositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,base:s,baseAmount:a,otherAmountMax:u,withMetadata:c,getEphemeralSigners:l}){let m=[],[d,p]=[new N(e.programId),new N(e.id)],y;if(l)y=new N((await l(1))[0]);else{let x=tr.generate();m.push(x),y=x.publicKey}let f=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=se(d,p,f),{publicKey:A}=se(d,p,w),{publicKey:h}=Pe(n.wallet,y,le),{publicKey:k}=An(y),{publicKey:T}=Oe(d,y),{publicKey:P}=kt(d,p,i,o),K=this.openPositionFromBaseInstruction(d,n.feePayer,p,n.wallet,y,h,k,P,g,A,T,n.tokenAccountA,n.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(e.mintA.address),new N(e.mintB.address),i,o,f,w,c,s,a,u,Be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,w])?Ge(d,p).publicKey:void 0);return{address:{nftMint:y,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:h,metadataAccount:k,personalPosition:T,protocolPosition:P},instructions:[K],signers:m,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static openPositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,A,h,k,T,P,K,x,_,E){let v=R([Se("tickLowerIndex"),Se("tickUpperIndex"),Se("tickArrayLowerStartIndex"),Se("tickArrayUpperStartIndex"),U("liquidity"),b("amountMaxA"),b("amountMaxB"),Ce("withMetadata"),O("optionBaseFlag"),Ce("baseFlag")]),Q=[...E?[{pubkey:E,isSigner:!1,isWritable:!0}]:[]],H=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:Hr,isSigner:!1,isWritable:!1},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:w,isSigner:!1,isWritable:!1},{pubkey:g,isSigner:!1,isWritable:!1},...Q],ie=Buffer.alloc(v.span);v.encode({tickLowerIndex:A,tickUpperIndex:h,tickArrayLowerStartIndex:k,tickArrayUpperStartIndex:T,liquidity:new Oo(0),amountMaxA:K==="MintA"?x:_,amountMaxB:K==="MintA"?_:x,withMetadata:P==="create",baseFlag:K==="MintA",optionBaseFlag:1},ie);let ee=Buffer.from([...je.openPosition,...ie]);return new Ee({keys:H,programId:e,data:ee})}static async openPositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,tickLower:i,tickUpper:o,liquidity:s,amountMaxA:a,amountMaxB:u,withMetadata:c,getEphemeralSigners:l}){let m,d=[];if(l)m=new N((await l(1))[0]);else{let x=tr.generate();d.push(x),m=x.publicKey}let[p,y]=[new N(e.programId),new N(e.id)],f=V.getTickArrayStartIndexByTick(i,e.config.tickSpacing),w=V.getTickArrayStartIndexByTick(o,e.config.tickSpacing),{publicKey:g}=se(p,y,f),{publicKey:A}=se(p,y,w),{publicKey:h}=Pe(n.wallet,m,le),{publicKey:k}=An(m),{publicKey:T}=Oe(p,m),{publicKey:P}=kt(p,y,i,o),K=this.openPositionFromLiquidityInstruction(p,n.wallet,y,n.wallet,m,h,k,P,g,A,T,n.tokenAccountA,n.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(t.mintA.address),new N(t.mintB.address),i,o,f,w,s,a,u,c,Be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[f,w])?Ge(p,y).publicKey:void 0);return{address:{nftMint:m,tickArrayLower:g,tickArrayUpper:A,positionNftAccount:h,metadataAccount:k,personalPosition:T,protocolPosition:P},instructions:[K],signers:d,instructionTypes:[X.ClmmOpenPosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static closePositionInstruction(e,t,n,i,o){let s=R([]),a=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1}],u=Buffer.alloc(s.span);s.encode({},u);let c=Buffer.from([...je.closePosition,...u]);return new Ee({keys:a,programId:e,data:c})}static closePositionInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,ownerPosition:i}){let o=new N(e.programId),{publicKey:s}=Pe(n.wallet,i.nftMint,le),{publicKey:a}=Oe(o,i.nftMint),u=[];return u.push(this.closePositionInstruction(o,n.wallet,i.nftMint,s,a)),{address:{positionNftAccount:s,personalPosition:a},signers:[],instructions:u,instructionTypes:[X.ClmmClosePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,A){let h=R([U("liquidity"),b("amountMaxA"),b("amountMaxB"),O("optionBaseFlag"),Ce("baseFlag")]),k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],P=Buffer.alloc(h.span);h.encode({liquidity:f,amountMaxA:w,amountMaxB:g,optionBaseFlag:0,baseFlag:!1},P);let K=Buffer.from([...je.increaseLiquidity,...P]);return new Ee({keys:T,programId:e,data:K})}static increasePositionFromLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMaxA:s,amountMaxB:a}){let[u,c]=[new N(e.programId),new N(e.id)],l=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,c,l),{publicKey:p}=se(u,c,m),{publicKey:y}=Pe(i.wallet,n.nftMint,le),{publicKey:f}=Oe(u,n.nftMint),{publicKey:w}=kt(u,c,n.tickLower,n.tickUpper),g=this.increasePositionFromLiquidityInstruction(u,i.wallet,y,f,c,w,d,p,i.tokenAccountA,i.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(e.mintA.address),new N(e.mintB.address),o,s,a,Be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ge(u,c).publicKey:void 0);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:w},signers:[],instructions:[g],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,base:o,baseAmount:s,otherAmountMax:a}){let[u,c]=[new N(e.programId),new N(e.id)],l=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),m=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:d}=se(u,c,l),{publicKey:p}=se(u,c,m),{publicKey:y}=Pe(i.wallet,n.nftMint,le),{publicKey:f}=Oe(u,n.nftMint),{publicKey:w}=kt(u,c,n.tickLower,n.tickUpper);return{address:{tickArrayLower:d,tickArrayUpper:p,positionNftAccount:y,personalPosition:f,protocolPosition:w},instructions:[this.increasePositionFromBaseInstruction(u,i.wallet,y,f,c,w,d,p,i.tokenAccountA,i.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(e.mintA.address),new N(e.mintB.address),o,s,a,Be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[l,m])?Ge(u,c).publicKey:void 0)],signers:[],instructionTypes:[X.ClmmIncreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static increasePositionFromBaseInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,A){let h=R([U("liquidity"),b("amountMaxA"),b("amountMaxB"),O("optionBaseFlag"),Ce("baseFlag")]),k=[...A?[{pubkey:A,isSigner:!1,isWritable:!0}]:[]],T=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...k],P=Buffer.alloc(h.span);h.encode({liquidity:new Oo(0),amountMaxA:f==="MintA"?w:g,amountMaxB:f==="MintA"?g:w,baseFlag:f==="MintA",optionBaseFlag:1},P);let K=Buffer.from([...je.increaseLiquidity,...P]);return new Ee({keys:T,programId:e,data:K})}static decreaseLiquidityInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g,A,h){let k=R([U("liquidity"),b("amountMinA"),b("amountMinB")]),T=[...h?[{pubkey:h,isSigner:!1,isWritable:!0}]:[],...f.map(_=>[{pubkey:_.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:_.rewardMint,isSigner:!1,isWritable:!1}]).flat()],P=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!1,isWritable:!1},...T],K=Buffer.alloc(k.span);k.encode({liquidity:w,amountMinA:g,amountMinB:A},K);let x=Buffer.from([...je.decreaseLiquidity,...K]);return new Ee({keys:P,programId:e,data:x})}static decreaseLiquidityInstructions({poolInfo:e,poolKeys:t,ownerPosition:n,ownerInfo:i,liquidity:o,amountMinA:s,amountMinB:a,programId:u}){let[c,l]=[new N(e.programId),new N(e.id)],m=V.getTickArrayStartIndexByTick(n.tickLower,e.config.tickSpacing),d=V.getTickArrayStartIndexByTick(n.tickUpper,e.config.tickSpacing),{publicKey:p}=se(c,l,m),{publicKey:y}=se(c,l,d),{publicKey:f}=Pe(i.wallet,n.nftMint,u),{publicKey:w}=Oe(c,n.nftMint),{publicKey:g}=kt(c,l,n.tickLower,n.tickUpper),A=[];for(let T=0;T<e.rewardDefaultInfos.length;T++)A.push({poolRewardVault:new N(t.rewardInfos[T].vault),ownerRewardVault:i.rewardAccounts[T],rewardMint:new N(e.rewardDefaultInfos[T].mint.address)});let h=[],k=this.decreaseLiquidityInstruction(c,i.wallet,f,w,l,g,p,y,i.tokenAccountA,i.tokenAccountB,new N(t.vault.A),new N(t.vault.B),new N(e.mintA.address),new N(e.mintB.address),A,o,s,a,Be.isOverflowDefaultTickarrayBitmap(e.config.tickSpacing,[m,d])?Ge(c,l).publicKey:void 0);return h.push(k),{address:{tickArrayLower:p,tickArrayUpper:y,positionNftAccount:f,personalPosition:w,protocolPosition:g},signers:[],instructions:h,instructionTypes:[X.ClmmDecreasePosition],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static swapInstruction(e,t,n,i,o,s,a,u,c,l,m,d,p,y,f,w,g){let A=R([b("amount"),b("otherAmountThreshold"),U("sqrtPriceLimitX64"),Ce("isBaseInput")]),h=[...g?[{pubkey:g,isSigner:!1,isWritable:!0}]:[],...m.map(K=>({pubkey:K,isSigner:!1,isWritable:!0}))],k=[{pubkey:t,isSigner:!0,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!1},{pubkey:l,isSigner:!1,isWritable:!1},...h],T=Buffer.alloc(A.span);A.encode({amount:p,otherAmountThreshold:y,sqrtPriceLimitX64:f,isBaseInput:w},T);let P=Buffer.from([...je.swap,...T]);return new Ee({keys:k,programId:e,data:P})}static makeSwapBaseInInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,inputMint:o,amountIn:s,amountOutMin:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new N(e.programId),new N(e.id)],[d,p]=[new N(t.vault.A),new N(t.vault.B)],[y,f]=[new N(e.mintA.address),new N(e.mintB.address)],w=e.mintA.address===o.toString(),g=[this.swapInstruction(l,i.wallet,m,new N(e.config.id),w?i.tokenAccountA:i.tokenAccountB,w?i.tokenAccountB:i.tokenAccountA,w?d:p,w?p:d,w?y:f,w?f:y,c,n,s,a,u,!0,Ge(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseIn],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static makeSwapBaseOutInstructions({poolInfo:e,poolKeys:t,observationId:n,ownerInfo:i,outputMint:o,amountOut:s,amountInMax:a,sqrtPriceLimitX64:u,remainingAccounts:c}){let[l,m]=[new N(e.programId),new N(e.id)],[d,p]=[new N(t.vault.A),new N(t.vault.B)],[y,f]=[new N(e.mintA.address),new N(e.mintB.address)],w=e.mintA.address===o.toBase58(),g=[this.swapInstruction(l,i.wallet,m,new N(e.config.id),w?i.tokenAccountB:i.tokenAccountA,w?i.tokenAccountA:i.tokenAccountB,w?p:d,w?d:p,w?f:y,w?y:f,c,n,s,a,u,!1,Ge(l,m).publicKey)];return{signers:[],instructions:g,instructionTypes:[X.ClmmSwapBaseOut],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[],address:{}}}static initRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([b("openTime"),b("endTime"),U("emissionsPerSecondX64")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!1},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1}],f=Buffer.alloc(p.span);p.encode({openTime:te(l),endTime:te(m),emissionsPerSecondX64:d},f);let w=Buffer.from([...je.initReward,...f]);return new Ee({keys:y,programId:e,data:w})}static initRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new N(e.programId),new N(e.id)],a=Ko(o,s,i.mint).publicKey,u=Ur(o).publicKey,c=[this.initRewardInstruction(o,n.wallet,s,u,new N(e.config.id),n.tokenAccount,i.programId,i.mint,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{poolRewardVault:a,operationId:u},signers:[],instructions:c,instructionTypes:[X.ClmmInitReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static setRewardInstruction(e,t,n,i,o,s,a,u,c,l,m,d){let p=R([O("rewardIndex"),U("emissionsPerSecondX64"),b("openTime"),b("endTime")]),y=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0}],f=Buffer.alloc(p.span);p.encode({rewardIndex:c,emissionsPerSecondX64:d,openTime:te(l),endTime:te(m)},f);let w=Buffer.from([...je.setRewardEmissions,...f]);return new Ee({keys:y,programId:e,data:w})}static setRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardInfo:i}){let[o,s]=[new N(e.programId),new N(e.id)],a,u,c;for(let d=0;d<e.rewardDefaultInfos.length;d++)e.rewardDefaultInfos[d].mint.address===i.mint.toString()&&(a=d,u=new N(t.rewardInfos[d].vault),c=new N(t.rewardInfos[d].mint.address));(a===void 0||u===void 0)&&Vo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let l=Ur(o).publicKey,m=[this.setRewardInstruction(o,n.wallet,s,l,new N(e.config.id),n.tokenAccount,u,c,a,i.openTime,i.endTime,i.emissionsPerSecondX64)];return{address:{rewardVault:u,operationId:l},signers:[],instructions:m,instructionTypes:[X.ClmmSetReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static collectRewardInstruction(e,t,n,i,o,s,a){let u=R([O("rewardIndex")]),c=[{pubkey:t,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Fn,isSigner:!1,isWritable:!1}],l=Buffer.alloc(u.span);u.encode({rewardIndex:a},l);let m=Buffer.from([...je.collectReward,...l]);return new Ee({keys:c,programId:e,data:m})}static collectRewardInstructions({poolInfo:e,poolKeys:t,ownerInfo:n,rewardMint:i}){let[o,s]=[new N(e.programId),new N(e.id)],a,u;for(let l=0;l<e.rewardDefaultInfos.length;l++)e.rewardDefaultInfos[l].mint.address===i.toString()&&(a=l,u=new N(t.rewardInfos[l].vault));(a===void 0||u===void 0)&&Vo.logWithError("reward mint check error","no reward mint",e.rewardDefaultInfos);let c=[this.collectRewardInstruction(o,n.wallet,s,n.tokenAccount,u,i,a)];return{address:{rewardVault:u},signers:[],instructions:c,instructionTypes:[X.ClmmCollectReward],lookupTableAddress:t.lookupTableAccount?[t.lookupTableAccount]:[]}}static async makeLockPositions({programId:e,authProgramId:t,poolProgramId:n,payer:i,wallet:o,nftMint:s,getEphemeralSigners:a}){let u=[],c;if(a)c=new N((await a(1))[0]);else{let w=tr.generate();u.push(w),c=w.publicKey}let{publicKey:l}=Pe(o,s,le),{publicKey:m}=Oe(n,s),d=Ro(e,c).publicKey,p=Pe(o,c,le).publicKey,y=An(c).publicKey,f=tn.lockPositionInstructionV2({programId:e,auth:t,payer:i,positionOwner:o,lockOwner:o,positionNftAccount:l,positionId:m,lockPositionId:d,lockNftMint:c,lockNftAccount:p,metadataAccount:y,withMetadata:!0});return{address:{positionId:m,lockPositionId:d,lockNftAccount:p,lockNftMint:c,positionNftAccount:l,metadataAccount:y},instructions:[f],signers:u,instructionTypes:[X.ClmmLockPosition],lookupTableAddress:[]}}static lockPositionInstructionV2({programId:e,auth:t,payer:n,positionOwner:i,lockOwner:o,positionNftAccount:s,positionId:a,lockPositionId:u,lockNftMint:c,lockNftAccount:l,metadataAccount:m,withMetadata:d}){let p=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!0,isWritable:!0},{pubkey:i,isSigner:!0,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!0,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:Bt,isSigner:!1,isWritable:!1},{pubkey:Hr,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1}],y=R([Ce("withMetadata")]),f=Buffer.alloc(y.span);y.encode({withMetadata:d},f);let w=Buffer.from([...Fo,...f]);return new Ee({keys:p,programId:e,data:w})}static lockPositionInstruction({programId:e,authProgramId:t,poolProgramId:n,owner:i,positionNft:o}){let{publicKey:s}=Pe(i,o,le),{publicKey:a}=Oe(n,o),u=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!0,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!1},{pubkey:Xr(e,a).publicKey,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:Vt.programId,isSigner:!1,isWritable:!1}];return new Ee({keys:u,programId:e,data:Buffer.from(Fo)})}static harvestLockPositionInstruction(e){let[t,n]=[new N(e.poolKeys.programId),new N(e.poolKeys.id)],i=V.getTickArrayStartIndexByTick(e.ownerPosition.tickLower,e.poolKeys.config.tickSpacing),o=V.getTickArrayStartIndexByTick(e.ownerPosition.tickUpper,e.poolKeys.config.tickSpacing),{publicKey:s}=se(t,n,i),{publicKey:a}=se(t,n,o),{publicKey:u}=Pe(e.owner,e.ownerPosition.nftMint,le),{publicKey:c}=Oe(t,e.ownerPosition.nftMint),{publicKey:l}=kt(t,n,e.ownerPosition.tickLower,e.ownerPosition.tickUpper),m=[];for(let y=0;y<e.poolKeys.rewardInfos.length;y++)m.push({poolRewardVault:new N(e.poolKeys.rewardInfos[y].vault),ownerRewardVault:e.ownerRewardAccounts[y],rewardMint:new N(e.poolKeys.rewardInfos[y].mint.address)});let d=[...m.map(y=>[{pubkey:y.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:y.rewardMint,isSigner:!1,isWritable:!1}]).flat()],p=[{pubkey:e.authProgramId,isSigner:!1,isWritable:!1},{pubkey:Xr(e.programId,c).publicKey,isSigner:!1,isWritable:!1},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:e.owner,isSigner:!0,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:new N(e.poolKeys.vault.A),isSigner:!1,isWritable:!0},{pubkey:new N(e.poolKeys.vault.B),isSigner:!1,isWritable:!0},{pubkey:s,isSigner:!1,isWritable:!0},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:e.userVaultA,isSigner:!1,isWritable:!0},{pubkey:e.userVaultB,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Pr,isSigner:!1,isWritable:!1},{pubkey:new N(e.poolKeys.mintA.address),isSigner:!1,isWritable:!1},{pubkey:new N(e.poolKeys.mintB.address),isSigner:!1,isWritable:!1},...d];return new Ee({keys:p,programId:e.programId,data:Buffer.from(Wo)})}static harvestLockPositionInstructionV2({programId:e,auth:t,lockPositionId:n,clmmProgram:i,lockOwner:o,lockNftMint:s,lockNftAccount:a,positionNftAccount:u,positionId:c,poolId:l,protocolPosition:m,vaultA:d,vaultB:p,tickArrayLower:y,tickArrayUpper:f,userVaultA:w,userVaultB:g,mintA:A,mintB:h,rewardAccounts:k,exTickArrayBitmap:T}){let P=[...T?[{pubkey:T,isSigner:!1,isWritable:!0}]:[],...k.map(x=>[{pubkey:x.poolRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.ownerRewardVault,isSigner:!1,isWritable:!0},{pubkey:x.rewardMint,isSigner:!1,isWritable:!1}]).flat()],K=[{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:o,isSigner:!0,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:n,isSigner:!1,isWritable:!1},{pubkey:i,isSigner:!1,isWritable:!1},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:c,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:m,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!0},{pubkey:p,isSigner:!1,isWritable:!0},{pubkey:y,isSigner:!1,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0},{pubkey:le,isSigner:!1,isWritable:!1},{pubkey:nt,isSigner:!1,isWritable:!1},{pubkey:Pr,isSigner:!1,isWritable:!1},{pubkey:A,isSigner:!1,isWritable:!1},{pubkey:h,isSigner:!1,isWritable:!1},...P];return new Ee({keys:K,programId:e,data:Buffer.from(Wo)})}};var Yr=(...r)=>r.map(e=>{try{return typeof e=="object"?JSON.stringify(e):e}catch{return e}}).join(", "),nn=class{constructor({scope:e,moduleName:t}){this.disabled=!1;this.scope=e,this.logger=ae(t)}createTxBuilder(e){return this.scope.checkOwner(),new zn({connection:this.scope.connection,feePayer:e||this.scope.ownerPubKey,cluster:this.scope.cluster,owner:this.scope.owner,blockhashCommitment:this.scope.blockhashCommitment,api:this.scope.api,signAllTransactions:this.scope.signAllTransactions})}logDebug(...e){this.logger.debug(Yr(e))}logInfo(...e){this.logger.info(Yr(e))}logAndCreateError(...e){let t=Yr(e);throw new Error(t)}checkDisabled(){(this.disabled||!this.scope)&&this.logAndCreateError("module not working")}};var Xy=R([Le("mintAuthorityOption"),I("mintAuthority"),b("supply"),O("decimals"),O("isInitialized"),Le("freezeAuthorityOption"),I("freezeAuthority")]);import{PublicKey as Yy}from"@solana/web3.js";import{MintLayout as Zy,TOKEN_PROGRAM_ID as Jy}from"@solana/spl-token";var Do=r=>new Ke({mint:r.address,decimals:r.decimals,symbol:r.symbol,name:r.name});var nr=i=>{var o=i,{address:r,programId:e,decimals:t}=o,n=Fe(o,["address","programId","decimals"]);return W({chainId:101,address:Zt(r).toBase58(),programId:e,logoURI:"",symbol:"",name:"",decimals:t,tags:[],extensions:n.extensions||{}},n)};import qo from"bn.js";var jr=new qo(25),rr=new qo(1e4);import{PublicKey as rt,SystemProgram as Zu,SYSVAR_RENT_PUBKEY as Pg,TransactionInstruction as on}from"@solana/web3.js";import{ASSOCIATED_TOKEN_PROGRAM_ID as $u,TOKEN_PROGRAM_ID as Bn}from"@solana/spl-token";var Zr=R([O("instruction"),b("amountIn"),b("minAmountOut")]),$r=R([O("instruction"),b("maxAmountIn"),b("amountOut")]),fg=R([O("instruction"),O("nonce")]),Vu=R([O("instruction"),O("nonce"),b("startTime")]),Go=R([b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalValue"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),U("swapBaseInAmount"),U("swapQuoteOutAmount"),b("swapBase2QuoteFee"),U("swapQuoteInAmount"),U("swapBaseOutAmount"),b("swapQuote2BaseFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("withdrawQueue"),I("lpVault"),I("owner"),b("lpReserve"),q(b(),3,"padding")]),bg=R([b("accountType"),b("status"),b("nonce"),b("maxOrder"),b("depth"),b("baseDecimal"),b("quoteDecimal"),b("state"),b("resetFlag"),b("minSize"),b("volMaxCutRatio"),b("amountWaveRatio"),b("baseLotSize"),b("quoteLotSize"),b("minPriceMultiplier"),b("maxPriceMultiplier"),b("systemDecimalsValue"),b("abortTradeFactor"),b("priceTickMultiplier"),b("priceTick"),b("minSeparateNumerator"),b("minSeparateDenominator"),b("tradeFeeNumerator"),b("tradeFeeDenominator"),b("pnlNumerator"),b("pnlDenominator"),b("swapFeeNumerator"),b("swapFeeDenominator"),b("baseNeedTakePnl"),b("quoteNeedTakePnl"),b("quoteTotalPnl"),b("baseTotalPnl"),b("poolOpenTime"),b("punishPcAmount"),b("punishCoinAmount"),b("orderbookToInitTime"),U("swapBaseInAmount"),U("swapQuoteOutAmount"),U("swapQuoteInAmount"),U("swapBaseOutAmount"),b("swapQuote2BaseFee"),b("swapBase2QuoteFee"),I("baseVault"),I("quoteVault"),I("baseMint"),I("quoteMint"),I("lpMint"),I("modelDataAccount"),I("openOrders"),I("marketId"),I("marketProgramId"),I("targetOrders"),I("owner"),q(b(),64,"padding")]),Jr=R([O("instruction"),b("baseAmountIn"),b("quoteAmountIn"),b("fixedSide"),b("otherAmountMin")]),ei=R([O("instruction"),b("lpAmount"),b("baseAmountMin"),b("quoteAmountMin")]);var Uo=R([b("fee")]);import{PublicKey as Fu}from"@solana/web3.js";var rn=new Fu("CDSr3ssLcRB6XYPJwAfFt18MZvEZp4LjHcvzBVZ45duo"),Wt=5e4,Wu=R([b("x"),b("y"),b("price")]),Du=R([b("accountType"),b("status"),b("multiplier"),b("validDataCount"),q(Wu,Wt,"DataElement")]);function qu(r,e){return[0,Wt-2]}function Gu(r){return[0,Wt-2]}function Uu(r){return[0,Wt-2]}function Xu(r,e,t){let[n,i]=qu(e,t),o=n,s=i,a=0,u=e*r.multiplier/t;for(;o<=s;){if(a=Math.floor((s+o)/2),a===0||a>=Wt-2)return[a,a,!1];let c=r.DataElement[a].x*r.multiplier/r.DataElement[a].y,l=r.DataElement[a-1].x*r.multiplier/r.DataElement[a-1].y,m=r.DataElement[a+1].x*r.multiplier/r.DataElement[a+1].y;if(u===c)return[a,a,!0];if(u===l)return[a-1,a-1,!0];if(u===m)return[a+1,a+1,!0];if(u<l)s=a-1;else{if(u>l&&u<c)return[a-1,a,!0];if(u>c&&u<m)return[a,a+1,!0];o=a+1}}return[a,a,!1]}function ti(r,e,t){let[n,i,o]=Xu(r,e,t);if(!o)return 0;if(n===i){let s=r.DataElement[n].x;return e*r.multiplier/s}else{let s=r.DataElement[n].x,a=r.DataElement[n].y,u=r.DataElement[i].x,c=r.DataElement[i].y,l=t*(u*a-s*c),m=s*l,d=(u-s)*(e*a-s*t)*c,p=m+d;return e*r.multiplier*l/p}}function Ft(r,e,t){return e*r.multiplier/t}function Xo(r,e,t){return e*t/r.multiplier}function zu(r,e){let[t,n]=Gu(e),i=t,o=n,s=0,a=e;for(;i<o;){if(s=Math.floor((o+i)/2),s<=0||s>Wt-2)return[s,s,!1];let u=r.DataElement[s].x,c=r.DataElement[s-1].x,l=r.DataElement[s+1].x;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<c)o=s-1;else{if(a>c&&a<u)return[s-1,s,!0];if(a>u&&a<l)return[s,s+1,!0];i=s+1}}return[s,s,!1]}function Qu(r,e){let[t,n]=Uu(e),i=t,o=n,s=0,a=e;for(;i<=o;){if(s=Math.floor((o+i)/2),s<=0||s>=Wt-2)return[s,s,!1];let u=r.DataElement[s].y,c=r.DataElement[s-1].y,l=r.DataElement[s+1].y;if(a===u)return[s,s,!0];if(a===c)return[s-1,s-1,!0];if(a===l)return[s+1,s+1,!0];if(a<l)i=s+1;else{if(a<c&&a>u)return[s-1,s,!0];if(a<u&&a>l)return[s,s+1,!0];o=s-1}}return[s,s,!1]}function zo(r,e,t,n){let i=n?e+t:e-t,[o,s,a]=zu(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].y,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=u&&e<=c)return n?[m,p,!0,a]:[l,d,!0,a];{let y,f;return n?(y=l+(m-l)*(e-u)/(c-u),f=d-(i-u)*r.multiplier/m):(y=l+(m-l)*(e-u)/(c-u),f=p+(c-i)*r.multiplier/l),[y,f,!1,a]}}}function Hu(r,e,t,n){let i=n?e-t:e+t,[o,s,a]=Qu(r,i);if(!a)return[0,0,!1,a];if(o===s)return[r.DataElement[s].price,r.DataElement[s].x,!1,a];{let u=r.DataElement[o].x,c=r.DataElement[s].x,l=r.DataElement[o].price,m=r.DataElement[s].price,d=r.DataElement[o].y,p=r.DataElement[s].y;if(e>=p&&e<=d)return n?[m,c,!0,a]:[l,u,!0,a];{let y,f;return n?(y=l+(m-l)*(d-e)/(d-p),f=u+m*(d-i)/r.multiplier):(y=l+(m-l)*(d-e)/(d-p),f=c-l*(i-p)/r.multiplier),[y,f,!1,a]}}}function Yu(r,e){let t=zo(r,e,0,!1);return t[3]?t[0]:0}function Qo(r,e,t,n){let i=ti(r,e,t),o=Ft(r,e,i),s=Ft(r,t,i),a=Ft(r,n,i),u=!0,[c,l,m,d]=zo(r,o,a,u);if(!d)return 0;if(m)return n*r.multiplier/c;{let p=s-l;return Xo(r,p,i)}}function Ho(r,e,t,n){let i=ti(r,e,t),o=Ft(r,e,i),s=Ft(r,t,i),a=Ft(r,n,i),u=!1,[c,l,m,d]=Hu(r,s,a,u);if(!d)return 0;if(m)return n*c/r.multiplier;{let p=o-l;return Xo(r,p,i)}}function ju(r){let e=Du.decode(r);return{accountType:e.accountType.toNumber(),status:e.status.toNumber(),multiplier:e.multiplier.toNumber(),validDataCount:e.validDataCount.toNumber(),DataElement:e.DataElement.map(t=>({x:t.x.toNumber(),y:t.y.toNumber(),price:t.price.toNumber()}))}}function Yo(r,e,t,n){let i=Yu(r,Ft(r,e,ti(r,e,t)))/r.multiplier;return n?i:1/i}var Sn=class{constructor({connection:e}){this._layoutData={accountType:0,status:0,multiplier:0,validDataCount:0,DataElement:[]};this.connection=e}get stableModelData(){return this._layoutData}async initStableModelLayout(){if(this._layoutData.validDataCount===0&&this.connection){let e=await this.connection.getAccountInfo(rn);e&&(this._layoutData=ju(e==null?void 0:e.data))}}};var jo=ae("Raydium_liquidity_instruction");function Zo(r){let{poolInfo:e,poolKeys:t,userKeys:n,baseAmountIn:i,quoteAmountIn:o,fixedSide:s,otherAmountMin:a}=r,u=Buffer.alloc(Jr.span);Jr.encode({instruction:3,baseAmountIn:te(i),quoteAmountIn:te(o),otherAmountMin:te(a),fixedSide:s==="base"?wt:Fi},u);let c=[S({pubkey:Bn,isWritable:!1}),S({pubkey:new rt(e.id)}),S({pubkey:new rt(t.authority),isWritable:!1}),S({pubkey:new rt(t.openOrders),isWritable:!1}),S({pubkey:new rt(t.targetOrders)}),S({pubkey:new rt(e.lpMint.address)}),S({pubkey:new rt(t.vault.A)}),S({pubkey:new rt(t.vault.B)})];return e.pooltype.includes("StablePool")&&c.push(S({pubkey:rn})),c.push(S({pubkey:new rt(e.marketId),isWritable:!1}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:new rt(t.marketEventQueue),isWritable:!1})),new on({programId:new rt(e.programId),keys:c,data:u})}function ni(r){let{poolInfo:e,poolKeys:t,userKeys:n,lpAmount:i,baseAmountMin:o,quoteAmountMin:s}=r,a=It(t),u=4;if(e.pooltype.includes("StablePool")&&(u=5),u===4||u===5){let c=Buffer.alloc(ei.span);ei.encode({instruction:4,lpAmount:te(i),baseAmountMin:te(o),quoteAmountMin:te(s)},c);let l=[S({pubkey:Bn,isWritable:!1}),S({pubkey:a.id}),S({pubkey:a.authority,isWritable:!1}),S({pubkey:a.openOrders}),S({pubkey:a.targetOrders}),S({pubkey:a.mintLp.address}),S({pubkey:a.vault.A}),S({pubkey:a.vault.B})];return u===5?l.push(S({pubkey:rn})):(l.push(S({pubkey:a.id})),l.push(S({pubkey:a.id}))),l.push(S({pubkey:a.marketProgramId,isWritable:!1}),S({pubkey:a.marketId}),S({pubkey:a.marketBaseVault}),S({pubkey:a.marketQuoteVault}),S({pubkey:a.marketAuthority,isWritable:!1}),S({pubkey:n.lpTokenAccount}),S({pubkey:n.baseTokenAccount}),S({pubkey:n.quoteTokenAccount}),S({pubkey:n.owner,isWritable:!1,isSigner:!0}),S({pubkey:a.marketEventQueue}),S({pubkey:a.marketBids}),S({pubkey:a.marketAsks})),new on({programId:a.programId,keys:l,data:c})}return new on({programId:a.programId,keys:[]})}function ri({programId:r,ammId:e,ammAuthority:t,ammOpenOrders:n,lpMint:i,coinMint:o,pcMint:s,coinVault:a,pcVault:u,withdrawQueue:c,ammTargetOrders:l,poolTempLp:m,marketProgramId:d,marketId:p,userWallet:y,userCoinVault:f,userPcVault:w,userLpVault:g,nonce:A,openTime:h,coinAmount:k,pcAmount:T,ammConfigId:P,feeDestinationId:K}){let x=R([O("instruction"),O("nonce"),b("openTime"),b("pcAmount"),b("coinAmount")]),_=[{pubkey:Bn,isSigner:!1,isWritable:!1},{pubkey:$u,isSigner:!1,isWritable:!1},{pubkey:Zu.programId,isSigner:!1,isWritable:!1},{pubkey:at,isSigner:!1,isWritable:!1},{pubkey:e,isSigner:!1,isWritable:!0},{pubkey:t,isSigner:!1,isWritable:!1},{pubkey:n,isSigner:!1,isWritable:!0},{pubkey:i,isSigner:!1,isWritable:!0},{pubkey:o,isSigner:!1,isWritable:!1},{pubkey:s,isSigner:!1,isWritable:!1},{pubkey:a,isSigner:!1,isWritable:!0},{pubkey:u,isSigner:!1,isWritable:!0},{pubkey:l,isSigner:!1,isWritable:!0},{pubkey:P,isSigner:!1,isWritable:!1},{pubkey:K,isSigner:!1,isWritable:!0},{pubkey:d,isSigner:!1,isWritable:!1},{pubkey:p,isSigner:!1,isWritable:!1},{pubkey:y,isSigner:!0,isWritable:!0},{pubkey:f,isSigner:!1,isWritable:!0},{pubkey:w,isSigner:!1,isWritable:!0},{pubkey:g,isSigner:!1,isWritable:!0}],E=Buffer.alloc(x.span);return x.encode({instruction:1,nonce:A,openTime:h,coinAmount:k,pcAmount:T},E),{instruction:new on({keys:_,programId:r,data:E}),instructionType:X.AmmV4CreatePool}}function Ju({poolKeys:r,userKeys:e,amountIn:t,minAmountOut:n},i){let o=It(r),s=Buffer.alloc(Zr.span);Zr.encode({instruction:9,amountIn:te(t),minAmountOut:te(n)},s);let a=[S({pubkey:Bn,isWritable:!1}),S({pubkey:o.id}),S({pubkey:o.authority,isWritable:!1}),S({pubkey:o.openOrders})];return i===4&&a.push(S({pubkey:o.targetOrders})),a.push(S({pubkey:o.vault.A}),S({pubkey:o.vault.B})),i===5&&a.push(S({pubkey:rn})),a.push(S({pubkey:o.marketProgramId,isWritable:!1}),S({pubkey:o.marketId}),S({pubkey:o.marketBids}),S({pubkey:o.marketAsks}),S({pubkey:o.marketEventQueue}),S({pubkey:o.marketBaseVault}),S({pubkey:o.marketQuoteVault}),S({pubkey:o.marketAuthority,isWritable:!1}),S({pubkey:e.tokenAccountIn}),S({pubkey:e.tokenAccountOut}),S({pubkey:e.owner,isWritable:!1})),new on({programId:o.programId,keys:a,data:s})}function ec({poolKeys:r,userKeys:e,maxAmountIn:t,amountOut:n},i){let o=It(r),s=Buffer.alloc($r.span);$r.encode({instruction:11,maxAmountIn:te(t),amountOut:te(n)},s);let a=[S({pubkey:Bn,isWritable:!1}),S({pubkey:o.id}),S({pubkey:o.authority,isWritable:!1}),S({pubkey:o.openOrders}),S({pubkey:o.targetOrders}),S({pubkey:o.vault.A}),S({pubkey:o.vault.B})];return i===5&&a.push(S({pubkey:rn})),a.push(S({pubkey:o.marketProgramId,isWritable:!1}),S({pubkey:o.marketId}),S({pubkey:o.marketBids}),S({pubkey:o.marketAsks}),S({pubkey:o.marketEventQueue}),S({pubkey:o.marketBaseVault}),S({pubkey:o.marketQuoteVault}),S({pubkey:o.marketAuthority,isWritable:!1}),S({pubkey:e.tokenAccountIn}),S({pubkey:e.tokenAccountOut}),S({pubkey:e.owner,isWritable:!1,isSigner:!0})),new on({programId:o.programId,keys:a,data:s})}function $o(r){let{poolKeys:e,version:t,userKeys:n,amountIn:i,amountOut:o,fixedSide:s}=r;if(t===4||t===5){let a={poolKeys:e,userKeys:n};if(s==="in")return Ju(J(W({},a),{amountIn:i,minAmountOut:o}),t);if(s==="out")return ec(J(W({},a),{maxAmountIn:i,amountOut:o}),t);jo.logWithError("invalid params","params",r)}throw jo.logWithError("invalid version","poolKeys.version",t),new Error("invalid version")}import{PublicKey as rc}from"@solana/web3.js";import Xg from"bn.js";import{TOKEN_PROGRAM_ID as ic}from"@solana/spl-token";import{PublicKey as tc}from"@solana/web3.js";var nc=ae("Raydium_liquidity_serum");function Jo({programId:r,marketId:e}){let t=[e.toBuffer()],n=0,i;for(;n<100;){try{let o=t.concat(Buffer.from([n]),Buffer.alloc(7));i=tc.createProgramAddressSync(o,r)}catch(o){if(o instanceof TypeError)throw o;n++;continue}return{publicKey:i,nonce:n}}throw nc.logWithError("unable to find a viable program address nonce","params",{programId:r,marketId:e}),new Error("unable to find a viable program address nonce")}function ir({programId:r}){let{publicKey:e}=de([Buffer.from("amm_config_account_seed","utf-8")],r);return e}function Dt({name:r,programId:e,marketId:t}){let{publicKey:n}=de([e.toBuffer(),t.toBuffer(),Buffer.from(r,"utf-8")],e);return n}function oc({programId:r,marketId:e}){let{publicKey:t}=de([r.toBuffer(),e.toBuffer(),Buffer.from("open_order_associated_seed","utf-8")],r);return t}function sc({programId:r}){return de([Buffer.from([97,109,109,32,97,117,116,104,111,114,105,116,121])],r)}function oi({version:r,marketVersion:e,marketId:t,baseMint:n,quoteMint:i,baseDecimals:o,quoteDecimals:s,programId:a,marketProgramId:u}){let c=Dt({name:"amm_associated_seed",programId:a,marketId:t}),l=Dt({name:"lp_mint_associated_seed",programId:a,marketId:t}),{publicKey:m,nonce:d}=sc({programId:a}),p=Dt({name:"coin_vault_associated_seed",programId:a,marketId:t}),y=Dt({name:"pc_vault_associated_seed",programId:a,marketId:t}),f=Dt({name:"temp_lp_token_associated_seed",programId:a,marketId:t}),w=oc({programId:a,marketId:t}),g=Dt({name:"target_associated_seed",programId:a,marketId:t}),A=Dt({name:"withdraw_associated_seed",programId:a,marketId:t}),{publicKey:h}=Jo({programId:u,marketId:t});return{id:c,baseMint:n,quoteMint:i,lpMint:l,baseDecimals:o,quoteDecimals:s,lpDecimals:o,version:r,programId:a,authority:m,nonce:d,baseVault:p,quoteVault:y,lpVault:f,openOrders:w,targetOrders:g,withdrawQueue:A,marketVersion:e,marketProgramId:u,marketId:t,marketAuthority:h,lookupTableAccount:rc.default,configId:ir({programId:a})}}var ii={volume:0,volumeQuote:0,volumeFee:0,apr:0,feeApr:0,priceMin:0,priceMax:0,rewardApr:[]},es=r=>{let e={},t=ic.toBase58();return Object.keys(r).map(n=>{let i=r[n],[o,s]=[i.baseMint.toBase58(),i.quoteMint.toBase58()];e[n]={id:n,version:4,status:i.status.toNumber(),programId:i.programId.toBase58(),mintA:nr({address:o,programId:t,decimals:i.baseDecimal.toNumber()}),mintB:nr({address:s,programId:t,decimals:i.quoteDecimal.toNumber()}),rewardDefaultInfos:[],rewardDefaultPoolInfos:"Ecosystem",price:i.poolPrice.toNumber(),mintAmountA:new L(i.mintAAmount.toString()).div(10**i.baseDecimal.toNumber()).toNumber(),mintAmountB:new L(i.mintBAmount.toString()).div(10**i.quoteDecimal.toNumber()).toNumber(),baseReserve:i.baseReserve,quoteReserve:i.quoteReserve,feeRate:new L(i.tradeFeeNumerator.toString()).div(i.tradeFeeDenominator.toString()).toNumber(),openTime:i.poolOpenTime.toString(),tvl:0,day:ii,week:ii,month:ii,pooltype:[],farmUpcomingCount:0,farmOngoingCount:0,farmFinishedCount:0,type:"Standard",marketId:i.marketId.toBase58(),configId:ir({programId:i.programId}).toBase58(),lpPrice:0,lpAmount:0,lpMint:nr({address:i.lpMint.toBase58(),programId:t,decimals:Math.min(i.baseDecimal.toNumber(),i.quoteDecimal.toNumber())}),burnPercent:0}}),e};import pe from"bn.js";import{Keypair as mc,PublicKey as dc}from"@solana/web3.js";import yw from"bn.js";import{TOKEN_PROGRAM_ID as pc}from"@solana/spl-token";function ac(r){return r instanceof Uint8Array||r!=null&&typeof r=="object"&&r.constructor.name==="Uint8Array"}function si(r,...e){if(!ac(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error(`Uint8Array expected of length ${e}, not of length=${r.length}`)}function ai(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function ts(r,e){si(r);let t=e.outputLen;if(r.length<t)throw new Error(`digestInto() expects output buffer of length at least ${t}`)}var sr=r=>new DataView(r.buffer,r.byteOffset,r.byteLength),Ze=(r,e)=>r<<32-e|r>>>e;var nw=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function uc(r){if(typeof r!="string")throw new Error(`utf8ToBytes expected string, got ${typeof r}`);return new Uint8Array(new TextEncoder().encode(r))}function ui(r){return typeof r=="string"&&(r=uc(r)),si(r),r}var or=class{clone(){return this._cloneInto()}},rw={}.toString;function ns(r){let e=n=>r().update(ui(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function cc(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);let i=BigInt(32),o=BigInt(4294967295),s=Number(t>>i&o),a=Number(t&o),u=n?4:0,c=n?0:4;r.setUint32(e+u,s,n),r.setUint32(e+c,a,n)}var rs=(r,e,t)=>r&e^~r&t,is=(r,e,t)=>r&e^r&t^e&t,ar=class extends or{constructor(e,t,n,i){super(),this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.buffer=new Uint8Array(e),this.view=sr(this.buffer)}update(e){ai(this);let{view:t,buffer:n,blockLen:i}=this;e=ui(e);let o=e.length;for(let s=0;s<o;){let a=Math.min(i-this.pos,o-s);if(a===i){let u=sr(e);for(;i<=o-s;s+=i)this.process(u,s);continue}n.set(e.subarray(s,s+a),this.pos),this.pos+=a,s+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){ai(this),ts(e,this),this.finished=!0;let{buffer:t,view:n,blockLen:i,isLE:o}=this,{pos:s}=this;t[s++]=128,this.buffer.subarray(s).fill(0),this.padOffset>i-s&&(this.process(n,0),s=0);for(let m=s;m<i;m++)t[m]=0;cc(n,i-8,BigInt(this.length*8),o),this.process(n,0);let a=sr(e),u=this.outputLen;if(u%4)throw new Error("_sha2: outputLen should be aligned to 32bit");let c=u/4,l=this.get();if(c>l.length)throw new Error("_sha2: outputLen bigger than state");for(let m=0;m<c;m++)a.setUint32(4*m,l[m],o)}digest(){let{buffer:e,outputLen:t}=this;this.digestInto(e);let n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());let{blockLen:t,buffer:n,length:i,finished:o,destroyed:s,pos:a}=this;return e.length=i,e.pos=a,e.finished=o,e.destroyed=s,i%t&&e.buffer.set(n),e}};var lc=new Uint32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),At=new Uint32Array([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Pt=new Uint32Array(64),ci=class extends ar{constructor(){super(64,32,8,!1),this.A=At[0]|0,this.B=At[1]|0,this.C=At[2]|0,this.D=At[3]|0,this.E=At[4]|0,this.F=At[5]|0,this.G=At[6]|0,this.H=At[7]|0}get(){let{A:e,B:t,C:n,D:i,E:o,F:s,G:a,H:u}=this;return[e,t,n,i,o,s,a,u]}set(e,t,n,i,o,s,a,u){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=o|0,this.F=s|0,this.G=a|0,this.H=u|0}process(e,t){for(let m=0;m<16;m++,t+=4)Pt[m]=e.getUint32(t,!1);for(let m=16;m<64;m++){let d=Pt[m-15],p=Pt[m-2],y=Ze(d,7)^Ze(d,18)^d>>>3,f=Ze(p,17)^Ze(p,19)^p>>>10;Pt[m]=f+Pt[m-7]+y+Pt[m-16]|0}let{A:n,B:i,C:o,D:s,E:a,F:u,G:c,H:l}=this;for(let m=0;m<64;m++){let d=Ze(a,6)^Ze(a,11)^Ze(a,25),p=l+d+rs(a,u,c)+lc[m]+Pt[m]|0,f=(Ze(n,2)^Ze(n,13)^Ze(n,22))+is(n,i,o)|0;l=c,c=u,u=a,a=s+p|0,s=o,o=i,i=n,n=p+f|0}n=n+this.A|0,i=i+this.B|0,o=o+this.C|0,s=s+this.D|0,a=a+this.E|0,u=u+this.F|0,c=c+this.G|0,l=l+this.H|0,this.set(n,i,o,s,a,u,c,l)}roundClean(){Pt.fill(0)}destroy(){this.set(0,0,0,0,0,0,0,0),this.buffer.fill(0)}};var os=ns(()=>new ci);var Aw=ae("Raydium_Util");function it({fromPublicKey:r,programId:e=pc,assignSeed:t}){let n=t?btoa(t).slice(0,32):mc.generate().publicKey.toBase58().slice(0,32);return{publicKey:fc(r,n,e),seed:n}}function fc(r,e,t){let n=Buffer.concat([r.toBuffer(),Buffer.from(e),t.toBuffer()]),i=os(n);return new dc(i)}import{PublicKey as Bw,SystemProgram as Kw}from"@solana/web3.js";import Rw from"bn.js";import{createCloseAccountInstruction as vw,createInitializeAccountInstruction as _w,createTransferInstruction as Ow,TOKEN_PROGRAM_ID as Vw}from"@solana/spl-token";import{PublicKey as ah}from"@solana/web3.js";import ch from"bn.js";import{TOKEN_PROGRAM_ID as mh}from"@solana/spl-token";import{SystemProgram as qt,SYSVAR_RENT_PUBKEY as yc,Transaction as ss,TransactionInstruction as gc}from"@solana/web3.js";import{createInitializeAccountInstruction as as,TOKEN_PROGRAM_ID as us}from"@solana/spl-token";function bc(r="accountFlags"){let e=new Hn(r);return e.addBoolean("initialized"),e.addBoolean("market"),e.addBoolean("openOrders"),e.addBoolean("requestQueue"),e.addBoolean("eventQueue"),e.addBoolean("bids"),e.addBoolean("asks"),e}var li=R([we(5),bc("accountFlags"),I("ownAddress"),b("vaultSignerNonce"),I("baseMint"),I("quoteMint"),I("baseVault"),b("baseDepositsTotal"),b("baseFeesAccrued"),I("quoteVault"),b("quoteDepositsTotal"),b("quoteFeesAccrued"),b("quoteDustThreshold"),I("requestQueue"),I("eventQueue"),I("bids"),I("asks"),b("baseLotSize"),b("quoteLotSize"),b("feeRateBps"),b("referrerRebatesAccrued"),we(7)]);function wc({programId:r,marketInfo:e}){let t=R([O("version"),Le("instruction"),b("baseLotSize"),b("quoteLotSize"),Nt("feeRateBps"),b("vaultSignerNonce"),b("quoteDustThreshold")]),n=[{pubkey:e.id,isSigner:!1,isWritable:!0},{pubkey:e.requestQueue,isSigner:!1,isWritable:!0},{pubkey:e.eventQueue,isSigner:!1,isWritable:!0},{pubkey:e.bids,isSigner:!1,isWritable:!0},{pubkey:e.asks,isSigner:!1,isWritable:!0},{pubkey:e.baseVault,isSigner:!1,isWritable:!0},{pubkey:e.quoteVault,isSigner:!1,isWritable:!0},{pubkey:e.baseMint,isSigner:!1,isWritable:!1},{pubkey:e.quoteMint,isSigner:!1,isWritable:!1},{pubkey:e.authority?e.quoteMint:yc,isSigner:!1,isWritable:!1}].concat(e.authority?{pubkey:e.authority,isSigner:!1,isWritable:!1}:[]).concat(e.authority&&e.pruneAuthority?{pubkey:e.pruneAuthority,isSigner:!1,isWritable:!1}:[]),i=Buffer.alloc(t.span);return t.encode({version:0,instruction:0,baseLotSize:e.baseLotSize,quoteLotSize:e.quoteLotSize,feeRateBps:e.feeRateBps,vaultSignerNonce:e.vaultSignerNonce,quoteDustThreshold:e.quoteDustThreshold},i),new gc({keys:n,programId:r,data:i})}async function mi({connection:r,wallet:e,marketInfo:t}){var s,a,u,c,l,m,d,p;let n=new ss,i=await r.getMinimumBalanceForRentExemption(165);n.add(qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.baseVault.seed,newAccountPubkey:t.baseVault.publicKey,lamports:i,space:165,programId:us}),qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.quoteVault.seed,newAccountPubkey:t.quoteVault.publicKey,lamports:i,space:165,programId:us}),as(t.baseVault.publicKey,t.baseMint,t.vaultOwner),as(t.quoteVault.publicKey,t.quoteMint,t.vaultOwner),qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.id.seed,newAccountPubkey:t.id.publicKey,lamports:await r.getMinimumBalanceForRentExemption(li.span),space:li.span,programId:t.programId}));let o=new ss;return o.add(qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.requestQueue.seed,newAccountPubkey:t.requestQueue.publicKey,lamports:t.lowestFeeMarket?6208320:await r.getMinimumBalanceForRentExemption((s=t.requestQueueSpace)!=null?s:5120+12),space:t.lowestFeeMarket?764:(a=t.requestQueueSpace)!=null?a:5120+12,programId:t.programId}),qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.eventQueue.seed,newAccountPubkey:t.eventQueue.publicKey,lamports:t.lowestFeeMarket?79594560:await r.getMinimumBalanceForRentExemption((u=t.eventQueueSpace)!=null?u:262144+12),space:t.lowestFeeMarket?11308:(c=t.eventQueueSpace)!=null?c:262144+12,programId:t.programId}),qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.bids.seed,newAccountPubkey:t.bids.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((l=t.orderbookQueueSpace)!=null?l:65536+12),space:t.lowestFeeMarket?14524:(m=t.orderbookQueueSpace)!=null?m:65536+12,programId:t.programId}),qt.createAccountWithSeed({fromPubkey:e,basePubkey:e,seed:t.asks.seed,newAccountPubkey:t.asks.publicKey,lamports:t.lowestFeeMarket?101977920:await r.getMinimumBalanceForRentExemption((d=t.orderbookQueueSpace)!=null?d:65536+12),space:t.lowestFeeMarket?14524:(p=t.orderbookQueueSpace)!=null?p:65536+12,programId:t.programId}),wc({programId:t.programId,marketInfo:{id:t.id.publicKey,requestQueue:t.requestQueue.publicKey,eventQueue:t.eventQueue.publicKey,bids:t.bids.publicKey,asks:t.asks.publicKey,baseVault:t.baseVault.publicKey,quoteVault:t.quoteVault.publicKey,baseMint:t.baseMint,quoteMint:t.quoteMint,baseLotSize:t.baseLotSize,quoteLotSize:t.quoteLotSize,feeRateBps:t.feeRateBps,vaultSignerNonce:t.vaultSignerNonce,quoteDustThreshold:t.quoteDustThreshold}})),[{transaction:n,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.InitAccount,X.InitAccount]},{transaction:o,signer:[],instructionTypes:[X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.CreateAccount,X.InitMarket]}]}var di=class extends nn{constructor(t){super(t);this.stableLayout=new Sn({connection:this.scope.connection})}async initLayout(){await this.stableLayout.initStableModelLayout()}async load(){this.checkDisabled()}computePairAmount({poolInfo:t,amount:n,slippage:i,baseIn:o}){let s=new pe(new L(n).mul(10**t[o?"mintA":"mintB"].decimals).toFixed(0)),a=Do(t[o?"mintB":"mintA"]),[u,c]=[new pe(new L(t.mintAmountA).mul(10**t.mintA.decimals).toString()),new pe(new L(t.mintAmountB).mul(10**t.mintB.decimals).toString())],l=new pe(new L(t.lpAmount).mul(10**t.lpMint.decimals).toFixed(0,L.ROUND_DOWN));this.logDebug("baseReserve:",u.toString(),"quoteReserve:",c.toString()),this.logDebug("tokenIn:",o?t.mintA.symbol:t.mintB.symbol,"amountIn:",s.toString(),"anotherToken:",o?t.mintB.symbol:t.mintA.symbol,"slippage:",`${i.toSignificant()}%`,"baseReserve",u.toString(),"quoteReserve",c.toString());let m=o?"base":"quote";this.logDebug("input side:",m);let d=wt;s.isZero()||(d=m==="base"?Dn(s.mul(c),u):Dn(s.mul(u),c)),this.logDebug("amountRaw:",d.toString(),"lpAmount:",l.toString());let p=Dn(s.mul(l),m==="base"?u:c);this.logDebug("liquidity:",p.toString());let y=new We(new pe(1)).add(i),f=new We(new pe(1)).sub(i),w=y.mul(d).quotient,g=f.mul(d).quotient,A=new fe(a,d),h=new fe(a,w),k=new fe(a,g);return this.logDebug("anotherAmount:",A.toFixed(),"maxAnotherAmount:",h.toFixed()),{anotherAmount:A,maxAnotherAmount:h,minAnotherAmount:k,liquidity:p}}async getAmmPoolKeys(t){return(await this.scope.api.fetchPoolKeysById({idList:[t]}))[0]}async addLiquidity(t){let{poolInfo:n,poolKeys:i,amountInA:o,amountInB:s,otherAmountMin:a,fixedSide:u,config:c,txVersion:l,computeBudgetConfig:m}=t;this.scope.availability.addStandardPosition===!1&&this.logAndCreateError("add liquidity feature disabled in your region"),this.logDebug("amountInA:",o,"amountInB:",s),(o.isZero()||s.isZero())&&this.logAndCreateError("amounts must greater than zero","amountInA & amountInB",{amountInA:o.toFixed(),amountInB:s.toFixed()});let{account:d}=this.scope,{bypassAssociatedCheck:p,checkCreateATAOwner:y}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},c),[f,w]=[o.token,s.token],g=await d.getCreatedTokenAccount({mint:f.mint,associatedOnly:!1}),A=await d.getCreatedTokenAccount({mint:w.mint,associatedOnly:!1});!g&&!A&&this.logAndCreateError("cannot found target token accounts","tokenAccounts",d.tokenAccounts);let h=await d.getCreatedTokenAccount({mint:new ge(n.lpMint.address)}),k=[f,w],T=[g,A],P=[o.raw,s.raw],K=o.token.mint.toBase58()===n.mintA.address?"base":"quote",x="base";["quote","base"].includes(K)||this.logAndCreateError("invalid fixedSide","fixedSide",u),K==="quote"?(k.reverse(),T.reverse(),P.reverse(),x=u==="a"?"quote":"base"):K==="base"&&(x=u==="a"?"base":"quote");let[_,E]=k,[v,Q]=T,[H,ie]=P,ee=i!=null?i:await this.getAmmPoolKeys(n.id),D=this.createTxBuilder(),Xe=await d.handleTokenAccount({side:"in",amount:H,mint:_.mint,tokenAccount:v,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:Ue}=Xe,Gt=Fe(Xe,["tokenAccount"]);D.addInstruction(Gt);let Ve=await d.handleTokenAccount({side:"in",amount:ie,mint:E.mint,tokenAccount:Q,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:Ut}=Ve,xt=Fe(Ve,["tokenAccount"]);D.addInstruction(xt);let St=await d.handleTokenAccount({side:"out",amount:0,mint:new ge(n.lpMint.address),tokenAccount:h,bypassAssociatedCheck:p,checkCreateATAOwner:y}),{tokenAccount:Xt}=St,dt=Fe(St,["tokenAccount"]);return D.addInstruction(dt),D.addInstruction({instructions:[Zo({poolInfo:n,poolKeys:ee,userKeys:{baseTokenAccount:Ue,quoteTokenAccount:Ut,lpTokenAccount:Xt,owner:this.scope.ownerPubKey},baseAmountIn:H,quoteAmountIn:ie,otherAmountMin:a.raw,fixedSide:x})],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5AddLiquidity:X.AmmV4AddLiquidity],lookupTableAddress:ee.lookupTableAccount?[ee.lookupTableAccount]:[]}),D.addCustomComputeBudget(m),l===0&&await D.buildV0(),D.build()}async removeLiquidity(t){this.scope.availability.removeStandardPosition===!1&&this.logAndCreateError("remove liquidity feature disabled in your region");let{poolInfo:n,poolKeys:i,lpAmount:o,baseAmountMin:s,quoteAmountMin:a,config:u,txVersion:c,computeBudgetConfig:l}=t,m=i!=null?i:await this.getAmmPoolKeys(n.id),[d,p,y]=[new ge(n.mintA.address),new ge(n.mintB.address),new ge(n.lpMint.address)];this.logDebug("lpAmount:",o),this.logDebug("baseAmountMin:",s),this.logDebug("quoteAmountMin:",a),o.isZero()&&this.logAndCreateError("amount must greater than zero","lpAmount",o.toString());let{account:f}=this.scope,w=await f.getCreatedTokenAccount({mint:y,associatedOnly:!1});w||this.logAndCreateError("cannot found lpTokenAccount","tokenAccounts",f.tokenAccounts);let g=await f.getCreatedTokenAccount({mint:d}),A=await f.getCreatedTokenAccount({mint:p}),h=this.createTxBuilder(),{bypassAssociatedCheck:k,checkCreateATAOwner:T}=W({bypassAssociatedCheck:!1,checkCreateATAOwner:!1},u),E=await f.handleTokenAccount({side:"out",amount:0,mint:d,tokenAccount:g,bypassAssociatedCheck:k,checkCreateATAOwner:T}),{tokenAccount:P}=E,K=Fe(E,["tokenAccount"]);h.addInstruction(K);let v=await f.handleTokenAccount({side:"out",amount:0,mint:p,tokenAccount:A,bypassAssociatedCheck:k,checkCreateATAOwner:T}),{tokenAccount:x}=v,_=Fe(v,["tokenAccount"]);return h.addInstruction(_),h.addInstruction({instructions:[ni({poolInfo:n,poolKeys:m,userKeys:{lpTokenAccount:w,baseTokenAccount:P,quoteTokenAccount:x,owner:this.scope.ownerPubKey},lpAmount:o,baseAmountMin:s,quoteAmountMin:a})],lookupTableAddress:m.lookupTableAccount?[m.lookupTableAccount]:[],instructionTypes:[n.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity]}),h.addCustomComputeBudget(l),c===0?await h.buildV0():h.build()}async removeAllLpAndCreateClmmPosition({poolInfo:t,clmmPoolInfo:n,removeLpAmount:i,createPositionInfo:o,farmInfo:s,userFarmLpAmount:a,base:u,computeBudgetConfig:c,payer:l,userAuxiliaryLedgers:m,tokenProgram:d=Tt,checkCreateATAOwner:p=!0,getEphemeralSigners:y,txVersion:f}){if((this.scope.availability.removeStandardPosition===!1||this.scope.availability.createConcentratedPosition===!1)&&this.logAndCreateError("remove liquidity or create position feature disabled in your region"),!(t.mintA.address===n.mintA.address||t.mintA.address===n.mintB.address)||!(t.mintB.address===n.mintA.address||t.mintB.address===n.mintB.address))throw Error("mint check error");let w=this.createTxBuilder();w.addCustomComputeBudget(c);let g={};for(let D of this.scope.account.tokenAccountRawInfos)(g[D.accountInfo.mint.toString()]===void 0||Pe(this.scope.ownerPubKey,D.accountInfo.mint,Tt).publicKey.equals(D.pubkey))&&(g[D.accountInfo.mint.toString()]=D.pubkey);let A=g[t.lpMint.address];if(A===void 0)throw Error("find lp account error in trade accounts");let h=i.add(a!=null?a:new pe(0)),k=t.mintA.address===Ke.WSOL.mint.toString(),T=t.mintB.address===Ke.WSOL.mint.toString(),{account:P,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Tt,mint:new ge(t.mintA.address),owner:this.scope.ownerPubKey,createInfo:k?{payer:this.scope.ownerPubKey}:void 0,skipCloseAccount:!k,notUseTokenAccount:k,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(K||{}),P===void 0)throw new Error("base token account not found");let{account:x,instructionParams:_}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Tt,mint:new ge(t.mintB.address),owner:this.scope.ownerPubKey,createInfo:T?{payer:this.scope.ownerPubKey,amount:0}:void 0,skipCloseAccount:!T,notUseTokenAccount:T,associatedOnly:!0,checkCreateATAOwner:p});if(w.addInstruction(_||{}),x===void 0)throw new Error("quote token account not found");if(g[t.mintA.address]=P,g[t.mintB.address]=x,s!==void 0&&!(a!=null&&a.isZero())){let D=vr[s.programId],Ue=en({programId:new ge(s.programId),poolId:new ge(s.id),owner:this.scope.ownerPubKey,version:D}),Gt,Ut=await this.scope.connection.getAccountInfo(Ue);if(Ut&&(Gt=po(D).decode(Ut.data)),D!==6&&!Gt){let{instruction:$e,instructionType:zt}=bo({id:new ge(s.id),programId:new ge(s.programId),version:D,ledger:Ue,owner:this.scope.ownerPubKey});w.addInstruction({instructions:[$e],instructionTypes:[zt]})}let xt=[];for(let $e of s.rewardInfos){let zt=$e.mint.address===Ke.WSOL.mint.toString();if(g[$e.mint.address])xt.push(g[$e.mint.address]);else{let{account:In,instructionParams:he}=await this.scope.account.getOrCreateTokenAccount({mint:new ge($e.mint.address),tokenProgram:d,owner:this.scope.ownerPubKey,skipCloseAccount:!zt,createInfo:{payer:l||this.scope.ownerPubKey},associatedOnly:!0,checkCreateATAOwner:p});In||this.logAndCreateError("farm reward account not found:",$e.mint.address),he&&w.addInstruction(he),xt.push(In)}}let Xt=(await this.scope.api.fetchFarmKeysById({ids:s.id}))[0],dt={userAuxiliaryLedgers:m,amount:a,owner:this.scope.ownerPubKey,farmInfo:s,farmKeys:Xt,lpAccount:A,rewardAccounts:xt},Xe=vr[s.programId],Ve=Xe===6?yo(dt):Xe===5?go(dt):wo(dt),St={3:X.FarmV3Withdraw,5:X.FarmV5Withdraw,6:X.FarmV6Withdraw};w.addInstruction({instructions:[Ve],instructionTypes:[St[Xe]]})}let E=await this.getAmmPoolKeys(t.id),v=ni({poolInfo:t,poolKeys:E,userKeys:{lpTokenAccount:A,baseTokenAccount:P,quoteTokenAccount:x,owner:this.scope.ownerPubKey},lpAmount:h,baseAmountMin:0,quoteAmountMin:0});w.addInstruction({instructions:[v],instructionTypes:[t.pooltype.includes("StablePool")?X.AmmV5RemoveLiquidity:X.AmmV4RemoveLiquidity],lookupTableAddress:E.lookupTableAccount?[E.lookupTableAccount]:[]});let[Q,H]=t.mintA.address===n.mintA.address?[P,x]:[x,P],ie=await this.scope.clmm.getClmmPoolKeys(n.id),ee=await tn.openPositionFromBaseInstructions(J(W({poolInfo:n,poolKeys:ie,ownerInfo:{feePayer:this.scope.ownerPubKey,wallet:this.scope.ownerPubKey,tokenAccountA:Q,tokenAccountB:H},withMetadata:"create"},o),{base:u,getEphemeralSigners:y}));return w.addInstruction({instructions:[...ee.instructions],signers:ee.signers,instructionTypes:[...ee.instructionTypes],lookupTableAddress:ie.lookupTableAccount?[ie.lookupTableAccount]:[]}),f===0?w.sizeCheckBuildV0():w.sizeCheckBuild()}async createPoolV4({programId:t,marketInfo:n,baseMintInfo:i,quoteMintInfo:o,baseAmount:s,quoteAmount:a,startTime:u,ownerInfo:c,associatedOnly:l=!1,checkCreateATAOwner:m=!1,tokenProgram:d,txVersion:p,feeDestinationId:y,computeBudgetConfig:f}){var Q;let w=c.feePayer||((Q=this.scope.owner)==null?void 0:Q.publicKey),g=c.useSOLBalance&&i.mint.equals(ur),A=c.useSOLBalance&&o.mint.equals(ur),h=this.createTxBuilder(),{account:k,instructionParams:T}=await this.scope.account.getOrCreateTokenAccount({mint:i.mint,owner:this.scope.ownerPubKey,createInfo:g?{payer:w,amount:s}:void 0,notUseTokenAccount:g,skipCloseAccount:!g,associatedOnly:g?!1:l,checkCreateATAOwner:m});h.addInstruction(T||{});let{account:P,instructionParams:K}=await this.scope.account.getOrCreateTokenAccount({mint:o.mint,owner:this.scope.ownerPubKey,createInfo:A?{payer:w,amount:a}:void 0,notUseTokenAccount:A,skipCloseAccount:!A,associatedOnly:A?!1:l,checkCreateATAOwner:m});if(h.addInstruction(K||{}),k===void 0||P===void 0)throw Error("you don't has some token account");let x=oi({version:4,marketVersion:3,marketId:n.marketId,baseMint:i.mint,quoteMint:o.mint,baseDecimals:i.decimals,quoteDecimals:o.decimals,programId:t,marketProgramId:n.programId}),_={programId:t,ammId:x.id,ammAuthority:x.authority,ammOpenOrders:x.openOrders,lpMint:x.lpMint,coinMint:x.baseMint,pcMint:x.quoteMint,coinVault:x.baseVault,pcVault:x.quoteVault,withdrawQueue:x.withdrawQueue,ammTargetOrders:x.targetOrders,poolTempLp:x.lpVault,marketProgramId:x.marketProgramId,marketId:x.marketId,ammConfigId:x.configId,feeDestinationId:y},{instruction:E,instructionType:v}=ri(J(W({},_),{userWallet:this.scope.ownerPubKey,userCoinVault:k,userPcVault:P,userLpVault:Pe(this.scope.ownerPubKey,x.lpMint,d).publicKey,nonce:x.nonce,openTime:u,coinAmount:s,pcAmount:a}));return h.addInstruction({instructions:[E],instructionTypes:[v]}),h.addCustomComputeBudget(f),h.versionBuild({txVersion:p,extInfo:{address:_}})}async createMarketAndPoolV4({programId:t=Zi,marketProgram:n=ji,feeDestinationId:i=$i,tokenProgram:o,baseMintInfo:s,quoteMintInfo:a,baseAmount:u,quoteAmount:c,startTime:l,ownerInfo:m,lowestFeeMarket:d,assignSeed:p,associatedOnly:y=!1,checkCreateATAOwner:f=!1,lotSize:w=1,tickSize:g=.01,txVersion:A,computeBudgetConfig:h}){var pi;let k=this.scope.ownerPubKey,T=m.feePayer||((pi=this.scope.owner)==null?void 0:pi.publicKey),P=m.useSOLBalance&&s.mint.equals(ur),K=m.useSOLBalance&&a.mint.equals(ur),x=p?`${s.mint.toBase58().slice(0,7)}-${a.mint.toBase58().slice(0,7)}-${p}`:void 0,_=it({fromPublicKey:k,programId:n,assignSeed:x&&`${x}-market`}),E=it({fromPublicKey:k,programId:n,assignSeed:x&&`${x}-request`}),v=it({fromPublicKey:k,programId:n,assignSeed:x&&`${x}-event`}),Q=it({fromPublicKey:k,programId:n,assignSeed:x&&`${x}-bids`}),H=it({fromPublicKey:k,programId:n,assignSeed:x&&`${x}-asks`}),ie=it({fromPublicKey:k,programId:Tt,assignSeed:x&&`${x}-baseVault`}),ee=it({fromPublicKey:k,programId:Tt,assignSeed:x&&`${x}-quoteVault`}),D=0,Ue=new pe(100);function Gt(){let pt=new pe(0);for(;;)try{return{vaultOwner:ge.createProgramAddressSync([_.publicKey.toBuffer(),pt.toArrayLike(Buffer,"le",8)],n),vaultSignerNonce:pt}}catch{if(pt.iaddn(1),pt.gt(new pe(25555)))throw Error("find vault owner error")}}let{vaultOwner:Ut,vaultSignerNonce:xt}=Gt(),Xt=new pe(Math.round(10**s.decimals*w)),dt=new pe(Math.round(w*10**a.decimals*g));if(Xt.eq(wt))throw Error("lot size is too small");if(dt.eq(wt))throw Error("tick size or lot size is too small");let Xe=await mi({connection:this.scope.connection,wallet:this.scope.ownerPubKey,marketInfo:{programId:n,vaultOwner:Ut,baseMint:s.mint,quoteMint:a.mint,id:_,baseVault:ie,quoteVault:ee,requestQueue:E,eventQueue:v,bids:Q,asks:H,feeRateBps:D,quoteDustThreshold:Ue,vaultSignerNonce:xt,baseLotSize:Xt,quoteLotSize:dt,lowestFeeMarket:d}}),Ve=this.createTxBuilder();Ve.addInstruction({instructions:Xe[0].transaction.instructions,signers:Xe[0].signer});for await(let pt of Xe.slice(1,Xe.length))Ve.addInstruction({instructions:pt.transaction.instructions,signers:pt.signer,instructionTypes:pt.instructionTypes});let{account:St,instructionParams:$e}=await this.scope.account.getOrCreateTokenAccount({mint:s.mint,owner:this.scope.ownerPubKey,createInfo:P?{payer:T,amount:u}:void 0,notUseTokenAccount:P,skipCloseAccount:!P,associatedOnly:P?!1:y,checkCreateATAOwner:f});Ve.addInstruction($e||{});let{account:zt,instructionParams:In}=await this.scope.account.getOrCreateTokenAccount({mint:a.mint,owner:this.scope.ownerPubKey,createInfo:K?{payer:T,amount:c}:void 0,notUseTokenAccount:K,skipCloseAccount:!K,associatedOnly:K?!1:y,checkCreateATAOwner:f});if(Ve.addInstruction(In||{}),St===void 0)throw Error("you don't has base token account");if(zt===void 0)throw Error("you don't has quote token account");let he=oi({version:4,marketVersion:3,marketId:_.publicKey,baseMint:s.mint,quoteMint:a.mint,baseDecimals:s.decimals,quoteDecimals:a.decimals,programId:t,marketProgramId:n}),cr={programId:t,ammId:he.id,ammAuthority:he.authority,ammOpenOrders:he.openOrders,lpMint:he.lpMint,coinMint:he.baseMint,pcMint:he.quoteMint,coinVault:he.baseVault,pcVault:he.quoteVault,withdrawQueue:he.withdrawQueue,ammTargetOrders:he.targetOrders,poolTempLp:he.lpVault,marketProgramId:he.marketProgramId,marketId:he.marketId,ammConfigId:he.configId,feeDestinationId:i},{instruction:cs,instructionType:ls}=ri(J(W({},cr),{userWallet:this.scope.ownerPubKey,userCoinVault:St,userPcVault:zt,userLpVault:Pe(this.scope.ownerPubKey,he.lpMint,o).publicKey,nonce:he.nonce,openTime:l,coinAmount:u,pcAmount:c}));return Ve.addInstruction({instructions:[cs],instructionTypes:[ls]}),A===0?Ve.sizeCheckBuildV0({computeBudgetConfig:h,address:W({requestQueue:E.publicKey,eventQueue:v.publicKey,bids:Q.publicKey,asks:H.publicKey,baseVault:ie.publicKey,quoteVault:ee.publicKey,baseMint:new ge(s.mint),quoteMin:new ge(a.mint)},cr)}):Ve.sizeCheckBuild({computeBudgetConfig:h,address:W({requestQueue:E.publicKey,eventQueue:v.publicKey,bids:Q.publicKey,asks:H.publicKey,baseVault:ie.publicKey,quoteVault:ee.publicKey,baseMint:new ge(s.mint),quoteMin:new ge(a.mint)},cr)})}async getCreatePoolFee({programId:t}){let n=ir({programId:t}),i=await this.scope.connection.getAccountInfo(n,{dataSlice:{offset:536,length:8}});if(i===null)throw Error("get config account error");return Uo.decode(i.data).fee}computeAmountOut({poolInfo:t,amountIn:n,mintIn:i,mintOut:o,slippage:s}){let[a,u]=[i.toString(),o.toString()];if(a!==t.mintA.address&&a!==t.mintB.address)throw new Error("toke not match");if(u!==t.mintA.address&&u!==t.mintB.address)throw new Error("toke not match");let{baseReserve:c,quoteReserve:l}=t,m=[c,l],d=[t.mintA.decimals,t.mintB.decimals],p=a==t.mintA.address?"base":"quote";p==="quote"&&(m.reverse(),d.reverse());let[y,f]=m,[w,g]=d,A=t.version===4,h;if(A)h=new L(f.toString()).div(10**g).div(new L(y.toString()).div(10**w));else{let H=Yo(this.stableLayout.stableModelData,c.toNumber(),l.toNumber(),!1);p==="quote"?h=new L(1e6).div(H*1e6):h=new L(H*1e6).div(1e6)}let k=n,T=new pe(0),P=new pe(0);if(!k.isZero())if(A){P=fn(k.mul(jr),rr);let H=k.sub(P),ie=y.add(H);T=f.mul(H).div(ie)}else{P=k.mul(new pe(2)).div(new pe(1e4));let H=k.sub(P);p==="quote"?T=new pe(Qo(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),H.toNumber())):T=new pe(Ho(this.stableLayout.stableModelData,l.toNumber(),c.toNumber(),H.toNumber()))}let K=new pe(new L(T.toString()).mul(1-s).toFixed(0)),x=T,_=K,E=new L(T.toString()).div(new L(k.sub(P).toString()).toFixed(0));!k.isZero()&&!T.isZero()&&(E=new L(T.toString()).div(10**g).div(new L(k.sub(P).toString()).div(10**w)));let v=h.sub(E).div(h).mul(100);return{amountOut:x,minAmountOut:_,currentPrice:h,executionPrice:E,priceImpact:v,fee:P}}computeAmountIn({poolInfo:t,amountOut:n,mintIn:i,mintOut:o,slippage:s}){let{baseReserve:a,quoteReserve:u}=t;i.toString()!==t.mintA.address&&i.toString()!==t.mintB.address&&this.logAndCreateError("mintIn does not match pool"),o.toString()!==t.mintA.address&&o.toString()!==t.mintB.address&&this.logAndCreateError("mintOut does not match pool"),this.logDebug("baseReserve:",a.toString()),this.logDebug("quoteReserve:",u.toString());let c=i.toString()===t.mintA.address,[l,m]=c?[t.mintA,t.mintB]:[t.mintB,t.mintA];this.logDebug("currencyOut:",m.symbol||m.address),this.logDebug("amountOut:",new L(n.toString()).div(10**m.decimals).toDecimalPlaces(m.decimals).toString(),l.symbol||l.address),this.logDebug("slippage:",`${s*100}%`);let d=[a,u],p=c?"quote":"base";p==="base"&&d.reverse(),this.logDebug("output side:",p);let[y,f]=d,w=new L(f.toString()).div(10**t[c?"mintB":"mintA"].decimals).div(new L(y.toString()).div(10**t[c?"mintA":"mintB"].decimals));this.logDebug("currentPrice:",`1 ${l.symbol||l.address} \u2248 ${w.toString()} ${m.symbol||m.address}`),this.logDebug("currentPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new L(1).div(w).toString()} ${l.symbol||l.address}`);let g=new pe(0),A=n;if(!A.isZero()){A.gt(f)&&(A=f.sub(new pe(1)));let _=f.sub(A);g=y.mul(A).div(_).mul(rr).div(rr.sub(jr))}let h=new pe(new L(g.toString()).mul(1+s).toFixed(0)),k=g,T=h;this.logDebug("amountIn:",new L(k.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString()),this.logDebug("maxAmountIn:",new L(T.toString()).div(10**l.decimals).toDecimalPlaces(l.decimals).toString());let P=null;!g.isZero()&&!A.isZero()&&(P=new L(A.toString()).div(10**m.decimals).div(new L(g.toString()).div(10**l.decimals)),this.logDebug("executionPrice:",`1 ${m.symbol||m.address} \u2248 ${P.toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`),this.logDebug("executionPrice invert:",`1 ${m.symbol||m.address} \u2248 ${new L(1).div(P).toDecimalPlaces(Math.max(t.mintA.decimals,t.mintB.decimals)).toString()} ${l.symbol||l.address}`));let K=w.mul(k.toString()),x=K.sub(n.toString()).abs().div(K);return this.logDebug("priceImpact:",`${x.toString()}%`),{amountIn:k,maxAmountIn:T,currentPrice:w,executionPrice:P,priceImpact:x}}async swap({poolInfo:t,poolKeys:n,amountIn:i,amountOut:o,inputMint:s,fixedSide:a,txVersion:u,config:c,computeBudgetConfig:l}){let m=this.createTxBuilder(),{associatedOnly:d=!0,inputUseSolBalance:p=!0,outputUseSolBalance:y=!0}=c||{},[f,w]=s===t.mintA.address?[t.mintA,t.mintB]:[t.mintB,t.mintA],g=p&&f.address===Yt.toBase58(),A=y&&w.address===Yt.toBase58(),{account:h,instructionParams:k}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Tt,mint:new ge(f.address),owner:this.scope.ownerPubKey,createInfo:g?{payer:this.scope.ownerPubKey,amount:i}:void 0,skipCloseAccount:!g,notUseTokenAccount:g,associatedOnly:d});m.addInstruction(k||{}),h||this.logAndCreateError("input token account not found",{token:f.symbol||f.address,tokenAccountIn:h,inputTokenUseSolBalance:g,associatedOnly:d});let{account:T,instructionParams:P}=await this.scope.account.getOrCreateTokenAccount({tokenProgram:Tt,mint:new ge(w.address),owner:this.scope.ownerPubKey,createInfo:{payer:this.scope.ownerPubKey,amount:0},skipCloseAccount:!A,notUseTokenAccount:A,associatedOnly:A?!1:d});m.addInstruction(P||{}),T===void 0&&this.logAndCreateError("output token account not found",{token:w.symbol||w.address,tokenAccountOut:T,outputTokenUseSolBalance:A,associatedOnly:d});let K=n||await this.getAmmPoolKeys(t.id),x=4;return t.pooltype.includes("StablePool")&&(x=5),m.addInstruction({instructions:[$o({version:x,poolKeys:K,userKeys:{tokenAccountIn:h,tokenAccountOut:T,owner:this.scope.ownerPubKey},amountIn:i,amountOut:o,fixedSide:a})],instructionTypes:[x===4?X.AmmV4SwapBaseIn:X.AmmV5SwapBaseIn]}),m.addCustomComputeBudget(l),m.versionBuild({txVersion:u})}async getRpcPoolInfo(t){return(await this.getRpcPoolInfos([t]))[t]}async getRpcPoolInfos(t,n){let i=await Lt(this.scope.connection,t.map(l=>({pubkey:new ge(l)})),n),o={},s=[];for(let l=0;l<t.length;l++){let m=i[l];if(m===null||!m.accountInfo)throw Error("fetch pool info error: "+String(t[l]));let d=Go.decode(m.accountInfo.data);o[String(t[l])]=J(W({},d),{programId:m.accountInfo.owner}),s.push(d.baseVault,d.quoteVault)}let a={},u=await Lt(this.scope.connection,s.map(l=>({pubkey:new ge(l)})),n);for(let l=0;l<s.length;l++){let m=u[l].accountInfo;if(m===null)throw Error("fetch vault info error: "+s[l]);a[String(s[l])]=new pe(hc.decode(m.data).amount.toString())}let c={};for(let[l,m]of Object.entries(o)){let d=a[m.baseVault.toString()].sub(m.baseNeedTakePnl),p=a[m.quoteVault.toString()].sub(m.quoteNeedTakePnl);c[l]=J(W({},m),{baseReserve:d,mintAAmount:a[m.baseVault.toString()],mintBAmount:a[m.quoteVault.toString()],quoteReserve:p,poolPrice:new L(p.toString()).div(new L(10).pow(m.quoteDecimal.toString())).div(new L(d.toString()).div(new L(10).pow(m.baseDecimal.toString())))})}return c}async getPoolInfoFromRpc({poolId:t}){let n=await this.getRpcPoolInfo(t),i=es({[t]:n}),o=i[t],s=await this.scope.tradeV2.computePoolToPoolKeys({pools:[i[t]],ammRpcData:{[t]:n}});return{poolRpcData:n,poolInfo:o,poolKeys:s[0]}}};export{di as default};
/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */
//# sourceMappingURL=liquidity.mjs.map